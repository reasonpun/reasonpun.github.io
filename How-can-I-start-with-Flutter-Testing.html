<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.3.0"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png"><link rel="mask-icon" href="/images/logo.svg" color="#222"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.0.0/css/all.min.css" integrity="sha256-jTIdiMuX/e3DGJUGwl3pKSxuc6YOuqtJYkM0bGQESA4=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous"><script class="next-config" data-name="main" type="application/json">{"hostname":"pangz.fun","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.10.1","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":true,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"æœç´¢...","empty":"æ²¡æœ‰æ‰¾åˆ°ä»»ä½•æœç´¢ç»“æœï¼š${query}","hits_time":"æ‰¾åˆ° ${hits} ä¸ªæœç´¢ç»“æœï¼ˆç”¨æ—¶ ${time} æ¯«ç§’ï¼‰","hits":"æ‰¾åˆ° ${hits} ä¸ªæœç´¢ç»“æœ"}}</script><script src="/js/config.js"></script><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4592202470693653" crossorigin="anonymous"></script><meta name="description" content="å¤§å®¶å¥½! ğŸ‘‹è¿™äº›å¤©æˆ‘å¼€å§‹äº†æˆ‘çš„Flutteræµ‹è¯•ä¹‹æ—…ã€‚è¿™ä¸ªä¸–ç•Œå¯¹æˆ‘æ¥è¯´æ˜¯æœªçŸ¥çš„ï¼Œä½†æˆ‘çŸ¥é“åœ¨æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºä¸­è¿›è¡Œæµ‹è¯•æ˜¯è¶…çº§é‡è¦çš„ï¼Œæˆ‘å†³å®šè‡ªå·±å­¦ä¹ ã€‚ä¹Ÿè®¸æˆ‘ç°åœ¨ç»™ä½ çœ‹çš„ä»£ç å¯ä»¥åšå¾—æ›´å¥½ï¼Œä½†è¯·è®°ä½ï¼Œè¿™æ˜¯æˆ‘ç¬¬ä¸€æ¬¡åšflutteræµ‹è¯•ï¼Œæˆ‘æƒ³å‘ä½ å±•ç¤ºæˆ‘æ‰€åšçš„ï¼Œå½“ç„¶ï¼Œå¦‚æœä½ æœ‰ä»»ä½•å»ºè®®ï¼Œä»£ç å°†æ˜¯å¼€æºçš„ã€‚æˆ‘å¯¹è¿™ä¸ªèµ„æºåº“çš„æƒ³æ³•æ˜¯ä¸ºæ¯ä¸ªå¯¹å­¦ä¹ æµ‹è¯•æ„Ÿå…´è¶£çš„äººæä¾›ä¸€ä¸ªåœ°æ–¹ï¼Œåˆ›å»ºæ–°çš„å†…å®¹ï¼ŒPRï¼Œå¹¶ä¸€èµ·åˆä½œã€‚"><meta property="og:type" content="article"><meta property="og:title" content="æˆ‘æ€æ ·æ‰èƒ½å¼€å§‹è¿›è¡ŒFlutteræµ‹è¯•ï¼Ÿ"><meta property="og:url" content="https://pangz.fun/How-can-I-start-with-Flutter-Testing.html"><meta property="og:site_name" content="é…·å­¦å°æ ˆ"><meta property="og:description" content="å¤§å®¶å¥½! ğŸ‘‹è¿™äº›å¤©æˆ‘å¼€å§‹äº†æˆ‘çš„Flutteræµ‹è¯•ä¹‹æ—…ã€‚è¿™ä¸ªä¸–ç•Œå¯¹æˆ‘æ¥è¯´æ˜¯æœªçŸ¥çš„ï¼Œä½†æˆ‘çŸ¥é“åœ¨æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºä¸­è¿›è¡Œæµ‹è¯•æ˜¯è¶…çº§é‡è¦çš„ï¼Œæˆ‘å†³å®šè‡ªå·±å­¦ä¹ ã€‚ä¹Ÿè®¸æˆ‘ç°åœ¨ç»™ä½ çœ‹çš„ä»£ç å¯ä»¥åšå¾—æ›´å¥½ï¼Œä½†è¯·è®°ä½ï¼Œè¿™æ˜¯æˆ‘ç¬¬ä¸€æ¬¡åšflutteræµ‹è¯•ï¼Œæˆ‘æƒ³å‘ä½ å±•ç¤ºæˆ‘æ‰€åšçš„ï¼Œå½“ç„¶ï¼Œå¦‚æœä½ æœ‰ä»»ä½•å»ºè®®ï¼Œä»£ç å°†æ˜¯å¼€æºçš„ã€‚æˆ‘å¯¹è¿™ä¸ªèµ„æºåº“çš„æƒ³æ³•æ˜¯ä¸ºæ¯ä¸ªå¯¹å­¦ä¹ æµ‹è¯•æ„Ÿå…´è¶£çš„äººæä¾›ä¸€ä¸ªåœ°æ–¹ï¼Œåˆ›å»ºæ–°çš„å†…å®¹ï¼ŒPRï¼Œå¹¶ä¸€èµ·åˆä½œã€‚"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://pangz.fun/How-can-I-start-with-Flutter-Testing/1.jpeg"><meta property="og:image" content="https://pangz.fun/How-can-I-start-with-Flutter-Testing/2.png"><meta property="og:image" content="https://pangz.fun/How-can-I-start-with-Flutter-Testing/3.png"><meta property="og:image" content="https://pangz.fun/How-can-I-start-with-Flutter-Testing/4.png"><meta property="og:image" content="https://pangz.fun/How-can-I-start-with-Flutter-Testing/5.png"><meta property="og:image" content="https://pangz.fun/How-can-I-start-with-Flutter-Testing/6.png"><meta property="og:image" content="https://pangz.fun/How-can-I-start-with-Flutter-Testing/7.png"><meta property="og:image" content="https://pangz.fun/How-can-I-start-with-Flutter-Testing/8.png"><meta property="og:image" content="https://pangz.fun/How-can-I-start-with-Flutter-Testing/9.png"><meta property="og:image" content="https://pangz.fun/How-can-I-start-with-Flutter-Testing/10.png"><meta property="og:image" content="https://pangz.fun/How-can-I-start-with-Flutter-Testing/11.png"><meta property="og:image" content="https://pangz.fun/How-can-I-start-with-Flutter-Testing/12.png"><meta property="og:image" content="https://pangz.fun/How-can-I-start-with-Flutter-Testing/13.png"><meta property="og:image" content="https://pangz.fun/How-can-I-start-with-Flutter-Testing/14.png"><meta property="article:published_time" content="2022-03-27T08:03:26.000Z"><meta property="article:modified_time" content="2025-01-23T09:09:21.641Z"><meta property="article:author" content="æœ¨è¾›å¿µåšæ¢“"><meta property="article:tag" content="Flutter"><meta property="article:tag" content="CI&#x2F;CD"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://pangz.fun/How-can-I-start-with-Flutter-Testing/1.jpeg"><link rel="canonical" href="https://pangz.fun/How-can-I-start-with-Flutter-Testing.html"><script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://pangz.fun/How-can-I-start-with-Flutter-Testing.html","path":"How-can-I-start-with-Flutter-Testing.html","title":"æˆ‘æ€æ ·æ‰èƒ½å¼€å§‹è¿›è¡ŒFlutteræµ‹è¯•ï¼Ÿ"}</script><script class="next-config" data-name="calendar" type="application/json">""</script><title>æˆ‘æ€æ ·æ‰èƒ½å¼€å§‹è¿›è¡ŒFlutteræµ‹è¯•ï¼Ÿ | é…·å­¦å°æ ˆ</title><script async src="https://www.googletagmanager.com/gtag/js?id=G-1HVT1YE421"></script><script class="next-config" data-name="google_analytics" type="application/json">{"tracking_id":"G-1HVT1YE421","only_pageview":false}</script><script src="/js/third-party/analytics/google-analytics.js"></script><link rel="stylesheet" type="text/css" href="/css/injector/main.css"><link rel="preload" as="style" href="/css/injector/light.css"><link rel="preload" as="style" href="/css/injector/dark.css"><noscript><link rel="stylesheet" href="/css/noscript.css"></noscript><style>.github-emoji{position:relative;display:inline-block;width:1.2em;min-height:1.2em;overflow:hidden;vertical-align:top;color:transparent}.github-emoji>span{position:relative;z-index:10}.github-emoji .fancybox,.github-emoji img{margin:0!important;padding:0!important;border:none!important;outline:0!important;text-decoration:none!important;user-select:none!important;cursor:auto!important}.github-emoji img{height:1.2em!important;width:1.2em!important;position:absolute!important;left:50%!important;top:50%!important;transform:translate(-50%,-50%)!important;user-select:none!important;cursor:auto!important}.github-emoji-fallback{color:inherit}.github-emoji-fallback img{opacity:0!important}</style><link rel="alternate" href="/atom.xml" title="é…·å­¦å°æ ˆ" type="application/atom+xml"></head><body itemscope itemtype="http://schema.org/WebPage" class="use-motion"><div class="headband"></div><main class="main"><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="åˆ‡æ¢å¯¼èˆªæ " role="button"><span class="toggle-line"></span> <span class="toggle-line"></span> <span class="toggle-line"></span></div></div><div class="site-meta"><a href="/" class="brand" rel="start"><i class="logo-line"></i><p class="site-title">é…·å­¦å°æ ˆ</p><i class="logo-line"></i></a><p class="site-subtitle" itemprop="description">è¿˜è¦å†èµ°500é‡Œ</p></div><div class="site-nav-right"><div class="toggle popup-trigger"></div></div></div><nav class="site-nav"><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>é¦–é¡µ</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>å…³äº</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>æ ‡ç­¾</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>åˆ†ç±»</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>å½’æ¡£</a></li><li class="menu-item menu-item-rss"><a href="/atom.xml" rel="section"><i class="fa fa-rss fa-fw"></i>RSS</a></li></ul></nav></div><div class="toggle sidebar-toggle" role="button"><span class="toggle-line"></span> <span class="toggle-line"></span> <span class="toggle-line"></span></div><aside class="sidebar"><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class="sidebar-nav"><li class="sidebar-nav-toc">æ–‡ç« ç›®å½•</li><li class="sidebar-nav-overview">ç«™ç‚¹æ¦‚è§ˆ</li></ul><div class="sidebar-panel-container"><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%9A%8F%E6%9C%BA%E7%8C%AB%E5%92%AA%F0%9F%90%B1"><span class="nav-number">1.</span> <span class="nav-text">éšæœºçŒ«å’ªğŸ±</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AF%B7%E6%B1%82%E6%88%90%E5%8A%9F%E7%9A%84%E6%83%85%E5%86%B5"><span class="nav-number">2.</span> <span class="nav-text">è¯·æ±‚æˆåŠŸçš„æƒ…å†µ</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%93%81%E7%A7%8D%E5%88%97%E8%A1%A8%E4%B8%BA%E7%A9%BA%E6%88%96%E7%A9%BA%E7%9A%84%E6%88%90%E5%8A%9F%E6%A1%88%E4%BE%8B"><span class="nav-number">3.</span> <span class="nav-text">å“ç§åˆ—è¡¨ä¸ºç©ºæˆ–ç©ºçš„æˆåŠŸæ¡ˆä¾‹</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BD%93response-body%E4%B8%BA%E7%A9%BA%E6%97%B6%E6%8A%9B%E5%87%BA%E4%B8%80%E4%B8%AA%E9%94%99%E8%AF%AF"><span class="nav-number">4.</span> <span class="nav-text">å½“response.bodyä¸ºç©ºæ—¶æŠ›å‡ºä¸€ä¸ªé”™è¯¯</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BD%93response-statusCode%E4%B8%8D%E6%98%AF200%E6%97%B6%EF%BC%8C%E6%8A%9B%E5%87%BA%E4%B8%80%E4%B8%AA%E9%94%99%E8%AF%AF%E3%80%82"><span class="nav-number">5.</span> <span class="nav-text">å½“response.statusCodeä¸æ˜¯200æ—¶ï¼ŒæŠ›å‡ºä¸€ä¸ªé”™è¯¯ã€‚</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AE%A9%E6%88%91%E4%BB%AC%E8%BF%9B%E5%85%A5%E6%B5%8B%E8%AF%95-%F0%9F%A7%AA"><span class="nav-number">6.</span> <span class="nav-text">è®©æˆ‘ä»¬è¿›å…¥æµ‹è¯• ğŸ§ª</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95"><span class="nav-number">7.</span> <span class="nav-text">å•å…ƒæµ‹è¯•</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Bloc-Test"><span class="nav-number">8.</span> <span class="nav-text">Bloc Test</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#random-cat-bloc-test-dart"><span class="nav-number">8.1.</span> <span class="nav-text">random_cat_bloc_test.dart</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Widget%E6%B5%8B%E8%AF%95"><span class="nav-number">9.</span> <span class="nav-text">Widgetæµ‹è¯•</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BB%93%E8%AE%BA"><span class="nav-number">10.</span> <span class="nav-text">ç»“è®º</span></a></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person"><p class="site-author-name" itemprop="name">æœ¨è¾›å¿µåšæ¢“</p><div class="site-description" itemprop="description">è¯»ä¸‡å·ä¹¦ï¼Œè¡Œä¸‡é‡Œè·¯ï¼Œèƒ¸ä¸­è„±å»å°˜æµŠ</div></div><div class="site-state-wrap site-overview-item animated"><nav class="site-state"><div class="site-state-item site-state-posts"><a href="/archives/"><span class="site-state-item-count">110</span> <span class="site-state-item-name">æ—¥å¿—</span></a></div><div class="site-state-item site-state-categories"><a href="/categories/"><span class="site-state-item-count">21</span> <span class="site-state-item-name">åˆ†ç±»</span></a></div><div class="site-state-item site-state-tags"><a href="/tags/"><span class="site-state-item-count">114</span> <span class="site-state-item-name">æ ‡ç­¾</span></a></div></nav></div><div class="links-of-blogroll site-overview-item animated"><div class="links-of-blogroll-title"><i class="fa fa-globe fa-fw"></i> Links</div><ul class="links-of-blogroll-list"><li class="links-of-blogroll-item"><a href="https://io-oi.me/" title="https:&#x2F;&#x2F;io-oi.me" rel="noopener" target="_blank">reuixiy</a></li></ul></div></div></div></div></aside><div class="sidebar-dimmer"></div></header><div class="back-to-top" role="button" aria-label="è¿”å›é¡¶éƒ¨"><i class="fa fa-arrow-up"></i> <span>0%</span></div><noscript><div class="noscript-warning">Theme NexT works best with JavaScript enabled</div></noscript><div class="main-inner post posts-expand"><div class="post-block"><article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://pangz.fun/How-can-I-start-with-Flutter-Testing.html"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.gif"><meta itemprop="name" content="æœ¨è¾›å¿µåšæ¢“"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="é…·å­¦å°æ ˆ"><meta itemprop="description" content="è¯»ä¸‡å·ä¹¦ï¼Œè¡Œä¸‡é‡Œè·¯ï¼Œèƒ¸ä¸­è„±å»å°˜æµŠ"></span><span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork"><meta itemprop="name" content="æˆ‘æ€æ ·æ‰èƒ½å¼€å§‹è¿›è¡ŒFlutteræµ‹è¯•ï¼Ÿ | é…·å­¦å°æ ˆ"><meta itemprop="description" content=""></span><header class="post-header"><h1 class="post-title" itemprop="name headline">æˆ‘æ€æ ·æ‰èƒ½å¼€å§‹è¿›è¡ŒFlutteræµ‹è¯•ï¼Ÿ</h1><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">å‘è¡¨äº</span> <time title="åˆ›å»ºæ—¶é—´ï¼š2022-03-27 16:03:26" itemprop="dateCreated datePublished" datetime="2022-03-27T16:03:26+08:00">2022-03-27</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i> </span><span class="post-meta-item-text">æ›´æ–°äº</span> <time title="ä¿®æ”¹æ—¶é—´ï¼š2025-01-23 17:09:21" itemprop="dateModified" datetime="2025-01-23T17:09:21+08:00">2025-01-23</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i> </span><span class="post-meta-item-text">åˆ†ç±»äº</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Flutter/" itemprop="url" rel="index"><span itemprop="name">Flutter</span></a> </span></span><span class="post-meta-item" title="é˜…è¯»æ¬¡æ•°" id="busuanzi_container_page_pv"><span class="post-meta-item-icon"><i class="far fa-eye"></i> </span><span class="post-meta-item-text">é˜…è¯»æ¬¡æ•°ï¼š</span> <span id="busuanzi_value_page_pv"></span> </span><span class="post-meta-break"></span> <span class="post-meta-item" title="æœ¬æ–‡å­—æ•°"><span class="post-meta-item-icon"><i class="far fa-file-word"></i> </span><span class="post-meta-item-text">æœ¬æ–‡å­—æ•°ï¼š</span> <span>31k</span> </span><span class="post-meta-item" title="é˜…è¯»æ—¶é•¿"><span class="post-meta-item-icon"><i class="far fa-clock"></i> </span><span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span> <span>28 åˆ†é’Ÿ</span></span></div></div></header><div class="post-body" itemprop="articleBody"><img src="/How-can-I-start-with-Flutter-Testing/1.jpeg" title="ç¤ºæ„å›¾ width=400"><p>å¤§å®¶å¥½! ğŸ‘‹<br>è¿™äº›å¤©æˆ‘å¼€å§‹äº†æˆ‘çš„Flutteræµ‹è¯•ä¹‹æ—…ã€‚è¿™ä¸ªä¸–ç•Œå¯¹æˆ‘æ¥è¯´æ˜¯æœªçŸ¥çš„ï¼Œä½†æˆ‘çŸ¥é“åœ¨æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºä¸­è¿›è¡Œæµ‹è¯•æ˜¯è¶…çº§é‡è¦çš„ï¼Œæˆ‘å†³å®šè‡ªå·±å­¦ä¹ ã€‚<br>ä¹Ÿè®¸æˆ‘ç°åœ¨ç»™ä½ çœ‹çš„ä»£ç å¯ä»¥åšå¾—æ›´å¥½ï¼Œä½†è¯·è®°ä½ï¼Œè¿™æ˜¯æˆ‘ç¬¬ä¸€æ¬¡åšflutteræµ‹è¯•ï¼Œæˆ‘æƒ³å‘ä½ å±•ç¤ºæˆ‘æ‰€åšçš„ï¼Œå½“ç„¶ï¼Œå¦‚æœä½ æœ‰ä»»ä½•å»ºè®®ï¼Œä»£ç å°†æ˜¯å¼€æºçš„ã€‚<br>æˆ‘å¯¹è¿™ä¸ªèµ„æºåº“çš„æƒ³æ³•æ˜¯ä¸ºæ¯ä¸ªå¯¹å­¦ä¹ æµ‹è¯•æ„Ÿå…´è¶£çš„äººæä¾›ä¸€ä¸ªåœ°æ–¹ï¼Œåˆ›å»ºæ–°çš„å†…å®¹ï¼ŒPRï¼Œå¹¶ä¸€èµ·åˆä½œã€‚</p><span id="more"></span><p>æ‰€ä»¥è®©æˆ‘ä»¬å¼€å§‹å§! ğŸ™Œ<br>é¦–å…ˆï¼Œæˆ‘æƒ³è§£é‡Šä¸€ä¸‹æˆ‘åˆ›å»ºçš„æ˜¯ä¸€ä¸ªä»€ä¹ˆæ ·çš„é¡¹ç›®ã€‚æˆ‘åˆ›å»ºäº†ä¸€ä¸ªæ˜¾ç¤ºçŒ«çš„åº”ç”¨ç¨‹åºï¼Œå®ƒæ¥è‡ªä¸€ä¸ªè·å–çŒ«çŒ«çš„APIã€‚<br>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘åˆ›å»ºäº†ä¸€ä¸ªåº•éƒ¨å¯¼èˆªå°éƒ¨ä»¶ï¼Œæœ‰ä¸‰ä¸ªé¡µé¢ã€‚åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†é‡ç‚¹è®¨è®ºç¬¬ä¸€é¡µã€‚</p><h3 id="éšæœºçŒ«å’ªğŸ±"><a href="#éšæœºçŒ«å’ªğŸ±" class="headerlink" title="éšæœºçŒ«å’ªğŸ±"></a>éšæœºçŒ«å’ªğŸ±</h3><p>è¿™ä¸ªé¡µé¢æ˜¯ä¸€ä¸ªéšæœºçŒ«å’ªçš„å¯è§†åŒ–å·¥å…·ï¼Œä½ åªéœ€è¦ç®€å•çš„ç‚¹å‡»å°±å¯ä»¥æ‹¥æœ‰çœ‹åˆ°ä¸–ç•Œä¸Šæ¯ä¸ªåœ°æ–¹çš„çŒ«å’ªçš„èƒ½åŠ›ï¼Œå¾ˆæ£’å§ï¼Ÿ<br>ç©ç¬‘å½’ç©ç¬‘ï¼Œè¿™ä¸ªé¡µé¢çš„æƒ³æ³•æ˜¯è®©ç”¨æˆ·åœ¨ç‚¹å‡»æµ®åŠ¨çš„è¡ŒåŠ¨æŒ‰é’®æ—¶å¯ä»¥çœ‹åˆ°éšæœºçš„çŒ«å’ªã€‚<br>ä¸ºäº†å¾—åˆ°è¿™ä¸ªç»“æœï¼Œæˆ‘æŠŠåº”ç”¨ç¨‹åºçš„ç»“æ„ä¿æŒå¾—å¾ˆç®€å•ï¼Œè¿™ç¯‡æ–‡ç« ä¸æ˜¯å…³äºæ¶æ„çš„ï¼Œæ‰€ä»¥æˆ‘å†³å®šä¸èŠ±å¾ˆå¤šæ—¶é—´æ¥åšè¿™ä¸ªï¼Œè€Œæ˜¯åŠªåŠ›ä¸“æ³¨äºè¿™ä¸ªé¡¹ç›®çš„ç›®çš„ï¼šæµ‹è¯•ã€‚ğŸ§ª</p><img src="/How-can-I-start-with-Flutter-Testing/2.png" title="ç¤ºæ„å›¾ width=400"><p>æ€»ä¹‹ï¼Œä»¥ä¸‹è¿™å°±æ˜¯åº”ç”¨ç¨‹åºæ–‡ä»¶å¤¹çš„ç»“æ„ã€‚</p><img src="/How-can-I-start-with-Flutter-Testing/3.png" title="ç¤ºæ„å›¾ width=400"><h3 id="è¯·æ±‚æˆåŠŸçš„æƒ…å†µ"><a href="#è¯·æ±‚æˆåŠŸçš„æƒ…å†µ" class="headerlink" title="è¯·æ±‚æˆåŠŸçš„æƒ…å†µ"></a>è¯·æ±‚æˆåŠŸçš„æƒ…å†µ</h3><p>åœ¨è¿™ä¸ªæµç¨‹ä¸­ï¼Œç”¨æˆ·éœ€è¦ç‚¹å‡»æµ®åŠ¨æŒ‰é’®ï¼Œè¿™ä¼šè§¦å‘äº†ä¸€ä¸ªBlocäº‹ä»¶ã€‚<br>Blocè´Ÿè´£ä¸å­˜å‚¨åº“é€šä¿¡ä»¥è·å¾—ä¸‹ä¸€åªçŒ«ã€‚<br>å­˜å‚¨åº“è°ƒç”¨ä¸€ä¸ªAPIï¼Œè·å¾—ä¸‹ä¸€åªéšæœºçŒ«ã€‚<br>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæµç¨‹æ˜¯æˆåŠŸçš„ï¼Œæ‰€ä»¥æœåŠ¡å°†è¿”å›ä¸€ä¸ªçŒ«å¯¹è±¡ç»™å­˜å‚¨åº“ï¼Œå®ƒå°†è¿”å›ç»™Blocã€‚Blocå°†æ£€æŸ¥è¯¥çŒ«æ˜¯å¦æ­£ç¡®ï¼ˆå¦‚æœå®ƒæœ‰ä¸€ä¸ªéç©ºçš„å“ç§åˆ—è¡¨ï¼‰ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ä¼šå‘å‡º</p><pre class="line-numbers language-none"><code class="language-none">RandomCatStatus.success<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>è§†å›¾æœ‰ä¸€ä¸ªBlocConsumerï¼Œå®ƒæœ‰ä¸€ä¸ªæ„å»ºå™¨ï¼Œæ­£åœ¨ç›‘å¬å¯èƒ½çš„çŠ¶æ€å˜åŒ–ï¼Œä»¥é‡å»ºè§†å›¾ã€‚</p><img src="/How-can-I-start-with-Flutter-Testing/4.png" title="ç¤ºæ„å›¾ width=400"><h3 id="å“ç§åˆ—è¡¨ä¸ºç©ºæˆ–ç©ºçš„æˆåŠŸæ¡ˆä¾‹"><a href="#å“ç§åˆ—è¡¨ä¸ºç©ºæˆ–ç©ºçš„æˆåŠŸæ¡ˆä¾‹" class="headerlink" title="å“ç§åˆ—è¡¨ä¸ºç©ºæˆ–ç©ºçš„æˆåŠŸæ¡ˆä¾‹"></a>å“ç§åˆ—è¡¨ä¸ºç©ºæˆ–ç©ºçš„æˆåŠŸæ¡ˆä¾‹</h3><p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒæœåŠ¡è¿”å›ä¸€ä¸ªæ­£ç¡®çš„ç­”æ¡ˆï¼Œä½†æ˜¯çŒ«çš„å“ç§åˆ—è¡¨ä¸ºç©ºæˆ–ç©ºã€‚<br>è¿™ä¸ªåˆ—è¡¨å¯¹äºæ˜¾ç¤ºçŒ«çš„ä¿¡æ¯æ˜¯å¿…è¦çš„ã€‚å› æ­¤ï¼Œå½“å­˜å‚¨åº“å°†å¯¹è±¡è¿”å›ç»™blocæ—¶ï¼Œå®ƒå°†è´Ÿè´£éªŒè¯è¿™ä¸ªåˆ—è¡¨æ˜¯å¦ä¸ºç©ºæˆ–ç©ºï¼Œåœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œè¿™ä¸ªåˆ—è¡¨æ˜¯ç©ºçš„ï¼Œæ‰€ä»¥blocå°†å‘å‡ºRandomCatStatus.emptyBreedã€‚è§†å›¾å°†åœ¨BlocConsumerçš„ç›‘å¬å™¨ä¸Šç›‘å¬è¿™ä¸ªçŠ¶æ€ï¼Œå½“å®ƒå‘ç”Ÿæ—¶ï¼Œè§†å›¾åº”è¯¥å†æ¬¡è°ƒç”¨è¯¥äº‹ä»¶ä»¥è·å¾—å¦ä¸€åªéšæœºçŒ«ã€‚</p><img src="/How-can-I-start-with-Flutter-Testing/5.png" title="ç¤ºæ„å›¾ width=400"><h3 id="å½“response-bodyä¸ºç©ºæ—¶æŠ›å‡ºä¸€ä¸ªé”™è¯¯"><a href="#å½“response-bodyä¸ºç©ºæ—¶æŠ›å‡ºä¸€ä¸ªé”™è¯¯" class="headerlink" title="å½“response.bodyä¸ºç©ºæ—¶æŠ›å‡ºä¸€ä¸ªé”™è¯¯"></a>å½“response.bodyä¸ºç©ºæ—¶æŠ›å‡ºä¸€ä¸ªé”™è¯¯</h3><p>è¿™æ˜¯å¦ä¸€ç§å¯èƒ½å‘ç”Ÿçš„æƒ…å†µï¼Œå½“æœåŠ¡å“åº”çš„çŠ¶æ€ä»£ç ä¸º200ï¼Œä½†å“åº”ä½“æ˜¯ç©ºçš„ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒæœåŠ¡å°†æŠ›å‡ºä¸€ä¸ªé”™è¯¯ã€‚<br>å½“ä¸€ä¸ªé”™è¯¯è¢«æŠ›å‡ºæ—¶ï¼ŒBlocä¸Šçš„try/catchå°†æ•è·è¿™ä¸ªé”™è¯¯å¹¶å‘å‡ºRandomCatStatus.failureã€‚è§†å›¾å°†ç›‘å¬è¿™ä¸ªçŠ¶æ€ï¼Œä»¥æ˜¾ç¤ºä¸€ä¸ªå¸¦æœ‰é”™è¯¯çš„æ¶ˆæ¯ã€‚</p><img src="/How-can-I-start-with-Flutter-Testing/6.png" title="ç¤ºæ„å›¾ width=400"><h3 id="å½“response-statusCodeä¸æ˜¯200æ—¶ï¼ŒæŠ›å‡ºä¸€ä¸ªé”™è¯¯ã€‚"><a href="#å½“response-statusCodeä¸æ˜¯200æ—¶ï¼ŒæŠ›å‡ºä¸€ä¸ªé”™è¯¯ã€‚" class="headerlink" title="å½“response.statusCodeä¸æ˜¯200æ—¶ï¼ŒæŠ›å‡ºä¸€ä¸ªé”™è¯¯ã€‚"></a>å½“response.statusCodeä¸æ˜¯200æ—¶ï¼ŒæŠ›å‡ºä¸€ä¸ªé”™è¯¯ã€‚</h3><p>ä¾‹å¦‚ï¼Œå¦‚æœå“åº”çŠ¶æ€ä»£ç è¿”å›404æˆ–400ï¼Œåº”ç”¨ç¨‹åºå°†æŠ›å‡ºä¸€ä¸ªé”™è¯¯ã€‚Blocä¼šæ•æ‰åˆ°è¿™ä¸ªé”™è¯¯ï¼Œå¹¶å‘è§†å›¾å‘å‡ºä¸€ä¸ªRandomCatStatus.failureã€‚</p><img src="/How-can-I-start-with-Flutter-Testing/7.png" title="ç¤ºæ„å›¾ width=400"><p>è¿™äº›æ˜¯è¯¥åº”ç”¨ç¨‹åºçš„æ‰€æœ‰å¯èƒ½æƒ…å†µã€‚</p><h3 id="è®©æˆ‘ä»¬è¿›å…¥æµ‹è¯•-ğŸ§ª"><a href="#è®©æˆ‘ä»¬è¿›å…¥æµ‹è¯•-ğŸ§ª" class="headerlink" title="è®©æˆ‘ä»¬è¿›å…¥æµ‹è¯• ğŸ§ª"></a>è®©æˆ‘ä»¬è¿›å…¥æµ‹è¯• ğŸ§ª</h3><p>ç°åœ¨æ˜¯åœ¨flutterä¸­è¿›è¡Œæµ‹è¯•çš„æ—¶å€™äº†ã€‚æˆ‘ä»¬éœ€è¦çš„ç¬¬ä¸€ä»¶äº‹æ˜¯åœ¨pubspec.yamlä¸­å»ºç«‹æ­£ç¡®çš„ä¾èµ–å…³ç³»æ¥è¿›è¡Œæµ‹è¯•ã€‚</p><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">dependencies</span><span class="token punctuation">:</span>
  <span class="token key atrule">mocktail</span><span class="token punctuation">:</span> ^0.3.0 // to mock classes
  <span class="token key atrule">network_image_mock</span><span class="token punctuation">:</span> ^2.0.1 // to mock image network
<span class="token key atrule">dev_dependencies</span><span class="token punctuation">:</span>
  <span class="token key atrule">flutter_test</span><span class="token punctuation">:</span>
    <span class="token key atrule">sdk</span><span class="token punctuation">:</span> flutter
  <span class="token key atrule">bloc_test</span><span class="token punctuation">:</span> ^9.0.3 // to do bloc testing<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¾ˆå¥½ï¼Œç°åœ¨æˆ‘ä»¬å¯ä»¥å¼€å§‹äº†! âœ…</p><p>åœ¨æ ¹é¡¹ç›®â†’æµ‹è¯•æ–‡ä»¶å¤¹ä¸­ï¼Œæˆ‘å·²ç»åˆ›å»ºäº†è¿™ä¸ªã€‚</p><img src="/How-can-I-start-with-Flutter-Testing/8.png" title="ç¤ºæ„å›¾ width=400"><p>åœ¨flutterä¸­ï¼Œæˆ‘ä»¬å¯ä»¥åšä¸åŒç±»å‹çš„æµ‹è¯•ã€‚</p><ul><li>å•å…ƒæµ‹è¯•</li><li>å—çŠ¶æµ‹è¯•</li><li>å°å·¥å…·æµ‹è¯•</li><li>é›†æˆæµ‹è¯•<br>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å°†ä¸“æ³¨äºå‰ä¸‰ç§ã€‚<br>å½“ä½ åœ¨æµ‹è¯•æ—¶ï¼Œä½ æœ‰ä¸åŒçš„æ–¹æ³•å¯ä»¥åœ¨åšæµ‹è¯•ä¹‹åæˆ–ä¹‹å‰ä½¿ç”¨ã€‚</li></ul><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token comment">// Registers a function to be run once before all tests</span>
<span class="token function">setUpAll</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Registers a function to be run before tests</span>
<span class="token function">setUp</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Registers a function to be run after tests</span>
<span class="token function">tearDown</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Registers a function to be run once after all tests</span>
<span class="token function">tearDownAll</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="å•å…ƒæµ‹è¯•"><a href="#å•å…ƒæµ‹è¯•" class="headerlink" title="å•å…ƒæµ‹è¯•"></a>å•å…ƒæµ‹è¯•</h3><p>åœ¨è¿™ä¸€éƒ¨åˆ†ï¼Œæˆ‘å°†æµ‹è¯•æˆ‘åœ¨æœåŠ¡å’Œèµ„æºåº“ç±»ä¸Šåˆ›å»ºçš„æ–¹æ³•ã€‚<br>è¿™æ˜¯ <strong>service.dartç±»</strong></p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'dart:convert'</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'package:catsapp/repository/model/cat.dart'</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'package:catsapp/repository/model/result_error.dart'</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'package:http/http.dart'</span></span> <span class="token operator">as</span> http<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'package:http/http.dart'</span></span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">CatService</span> <span class="token punctuation">{</span>
  <span class="token class-name">CatService</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token class-name"><span class="token namespace">http<span class="token punctuation">.</span></span>Client</span><span class="token operator">?</span> httpClient<span class="token punctuation">,</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>baseUrl <span class="token operator">=</span> <span class="token string-literal"><span class="token string">'https://api.thecatapi.com/v1'</span></span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> _httpClient <span class="token operator">=</span> httpClient <span class="token operator">?</span><span class="token operator">?</span> <span class="token class-name"><span class="token namespace">http<span class="token punctuation">.</span></span>Client</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">final</span> <span class="token class-name">String</span> baseUrl<span class="token punctuation">;</span>
  <span class="token keyword">final</span> <span class="token class-name">Client</span> _httpClient<span class="token punctuation">;</span>

  <span class="token class-name">Future</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Cat</span><span class="token punctuation">&gt;</span></span> <span class="token function">search</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token punctuation">{</span>
    <span class="token keyword">final</span> response <span class="token operator">=</span> <span class="token keyword">await</span> _httpClient
        <span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token class-name">Uri</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">'</span><span class="token interpolation"><span class="token punctuation">$</span><span class="token expression">baseUrl</span></span><span class="token string">/images/search?has_breeds=true'</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>response<span class="token punctuation">.</span>statusCode <span class="token operator">==</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>response<span class="token punctuation">.</span>body<span class="token punctuation">.</span>isNotEmpty<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">Cat</span><span class="token punctuation">.</span><span class="token function">fromJson</span><span class="token punctuation">(</span>json<span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token class-name">ErrorEmptyResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">throw</span> <span class="token class-name">ErrorSearchingCat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘å¿…é¡»æµ‹è¯•è¯¥æœåŠ¡å¯èƒ½å‡ºç°çš„æ‰€æœ‰æƒ…å†µã€‚è¦åšåˆ°è¿™ä¸€ç‚¹ï¼Œæˆ‘éœ€è¦åšçš„ç¬¬ä¸€ä»¶äº‹å°±æ˜¯ä¸ºå“åº”ã€å¯¹è±¡ç­‰åˆ›å»ºæ¨¡æ‹Ÿç±»ã€‚</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token keyword">class</span> <span class="token class-name">MockHttp</span> <span class="token keyword">extends</span> <span class="token class-name">Mock</span> <span class="token keyword">implements</span> <span class="token class-name"><span class="token namespace">http<span class="token punctuation">.</span></span>Client</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
 
<span class="token keyword">class</span> <span class="token class-name">MockResponse</span> <span class="token keyword">extends</span> <span class="token class-name">Mock</span> <span class="token keyword">implements</span> <span class="token class-name"><span class="token namespace">http<span class="token punctuation">.</span></span>Response</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">FakeUri</span> <span class="token keyword">extends</span> <span class="token class-name">Fake</span> <span class="token keyword">implements</span> <span class="token class-name">Uri</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç„¶ååœ¨mainæ–¹æ³•ä¸­ï¼Œæˆ‘åˆ›å»ºäº†ä¸€ä¸ªç»„ï¼Œæ‹¥æœ‰æ‰€æœ‰ä¸æœåŠ¡ç±»ç›¸å…³çš„æµ‹è¯•ã€‚åœ¨<strong>setUpAll</strong>æ–¹æ³•ä¸­ï¼Œæˆ‘æ³¨å†Œäº†ä¸€ä¸ª**registerFallbackValue(FakeUri())**ï¼Œå› ä¸ºæˆ‘éœ€è¦å®ƒåœ¨æµ‹è¯•ä¸­ä½¿ç”¨ä¸€ä¸ªå‡çš„URIã€‚<br>å¦‚æœæˆ‘ä¸è¿™æ ·åšï¼Œæˆ‘å°±ä¸èƒ½ä½¿ç”¨any()æ–¹æ³•ã€‚<br>å¦å¤–ï¼Œæˆ‘å·²ç»ä¸ºæ¨¡æ‹Ÿåˆ›å»ºäº†æ‰€éœ€çš„å˜é‡ã€‚è¿™äº›éƒ½å°†è¢«å®ä¾‹åŒ–åˆ°setUpæ–¹æ³•ä¸­ã€‚æ­¤å¤–ï¼Œæˆ‘è¿˜åœ¨ä¸€ä¸ªå•ç‹¬çš„ç±»ä¸­åˆ›å»ºäº†ä¸€ä¸ªJSONå˜é‡æ¥ä¼ªé€ APIçš„ç»“æœï¼ˆå½“APIè¿”å›ä¸€ä¸ªæ­£ç¡®çš„çŒ«æ—¶ï¼‰ã€‚</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token function">group</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">'Service'</span></span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  late <span class="token class-name">CatService</span> catService<span class="token punctuation">;</span>
  late <span class="token class-name">MockHttp</span> httpClient<span class="token punctuation">;</span>

  <span class="token function">setUpAll</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">registerFallbackValue</span><span class="token punctuation">(</span><span class="token class-name">FakeUri</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">setUp</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    httpClient <span class="token operator">=</span> <span class="token class-name">MockHttp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    catService <span class="token operator">=</span> <span class="token class-name">CatService</span><span class="token punctuation">(</span>httpClient<span class="token punctuation">:</span> httpClient<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æˆ‘å‡†å¤‡åšçš„ç¬¬ä¸€ä¸ªæµ‹è¯•æ˜¯æ£€æŸ¥æ„é€ å‡½æ•°æ˜¯å¦ä¸éœ€è¦httpClientã€‚</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token function">group</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">'constructor'</span></span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token function">test</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">'does not required a httpClient'</span></span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">expect</span><span class="token punctuation">(</span><span class="token class-name">CatService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> isNotNull<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç°åœ¨æˆ‘æ‰“ç®—åˆ›å»ºä¸€ä¸ªå°ç»„ï¼Œè®©æ‰€æœ‰çš„æµ‹è¯•å¾—åˆ°ä¸€åªéšæœºçš„çŒ«ã€‚</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token function">group</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">'catSearch'</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>åœ¨è¿™ä¸ªç»„é‡Œé¢ï¼Œæˆ‘éœ€è¦æ£€æŸ¥ä¸åŒçš„ä¸œè¥¿ã€‚</p><ol><li>å½“æœåŠ¡åšäº†ä¸€ä¸ªæ­£ç¡®çš„HTTPè¯·æ±‚ä½†ä¸»ä½“æ˜¯ç©ºçš„ã€‚</li></ol><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token function">test</span><span class="token punctuation">(</span>
          <span class="token string-literal"><span class="token string">'make correct http request with empty response,'</span></span>
          <span class="token string-literal"><span class="token string">' throw [ErrorEmptyResponse]'</span></span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token punctuation">{</span>
        <span class="token keyword">final</span> response <span class="token operator">=</span> <span class="token class-name">MockResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">when</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> response<span class="token punctuation">.</span>statusCode<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">thenReturn</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">when</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> response<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">thenReturn</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">''</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">when</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> httpClient<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token function">any</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">thenAnswer</span><span class="token punctuation">(</span><span class="token punctuation">(</span>_<span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token operator">=</span><span class="token operator">&gt;</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
          <span class="token keyword">await</span> catService<span class="token punctuation">.</span><span class="token function">search</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token function">fail</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">'should throw error empty body'</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token function">expect</span><span class="token punctuation">(</span>
            error<span class="token punctuation">,</span>
            isA<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ErrorEmptyResponse</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token function">verify</span><span class="token punctuation">(</span>
          <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> httpClient<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span>
            <span class="token class-name">Uri</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>
                <span class="token string-literal"><span class="token string">'https://api.thecatapi.com/v1/images/search?has_breeds=true'</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">called</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="2"><li>å½“æœåŠ¡æŠ›å‡ºä¸€ä¸ªé”™è¯¯æ—¶ï¼Œå“åº”ä¸æ˜¯200ã€‚</li></ol><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token function">test</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">'throws ResultError on non-200 response'</span></span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token punctuation">{</span>
  <span class="token keyword">final</span> response <span class="token operator">=</span> <span class="token class-name">MockResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">when</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> response<span class="token punctuation">.</span>statusCode<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">thenReturn</span><span class="token punctuation">(</span><span class="token number">404</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">when</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> httpClient<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token function">any</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">thenAnswer</span><span class="token punctuation">(</span><span class="token punctuation">(</span>_<span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token operator">=</span><span class="token operator">&gt;</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>
    catService<span class="token punctuation">.</span><span class="token function">search</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">throwsA</span><span class="token punctuation">(</span>
      isA<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ErrorSearchingCat</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="3"><li>å½“æœåŠ¡åœ¨ä¸€ä¸ªæœ‰æ•ˆçš„å“åº”ä¸Šè¿”å›ä¸€ä¸ªCat.jsonã€‚</li></ol><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token function">test</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">'return Cat.json on a valid response'</span></span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token punctuation">{</span>
        <span class="token keyword">final</span> response <span class="token operator">=</span> <span class="token class-name">MockResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">when</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> response<span class="token punctuation">.</span>statusCode<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">thenReturn</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">when</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> response<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">thenReturn</span><span class="token punctuation">(</span><span class="token class-name">TestHelper</span><span class="token punctuation">.</span>searchCatJsonResponse<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">when</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> httpClient<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token function">any</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">thenAnswer</span><span class="token punctuation">(</span><span class="token punctuation">(</span>_<span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token operator">=</span><span class="token operator">&gt;</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">await</span> catService<span class="token punctuation">.</span><span class="token function">search</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">expect</span><span class="token punctuation">(</span>
          <span class="token class-name">Cat</span><span class="token punctuation">.</span><span class="token function">fromJson</span><span class="token punctuation">(</span><span class="token function">jsonDecode</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          isA<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Cat</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¦‚æœä½ è¿è¡Œæ‰€æœ‰è¿™äº›æµ‹è¯•ï¼Œä½ å°†å¾—åˆ°æœ€å¥½çš„ä¸€å¥è¯ï¼šæ‰€æœ‰çš„æµ‹è¯•éƒ½é€šè¿‡äº†ï¼ã€‚</p><img src="/How-can-I-start-with-Flutter-Testing/9.png" title="ç¤ºæ„å›¾ width=400"><p>è¿™é‡Œæ˜¯ä¸€ä¸ªå®Œæ•´çš„ç±»ã€‚</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'dart:convert'</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'package:catsapp/repository/model/cat.dart'</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'package:catsapp/repository/model/result_error.dart'</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'package:catsapp/repository/service.dart'</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'package:catsapp/utils/test_helper.dart'</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'package:flutter_test/flutter_test.dart'</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'package:http/http.dart'</span></span> <span class="token operator">as</span> http<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'package:mocktail/mocktail.dart'</span></span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">MockHttp</span> <span class="token keyword">extends</span> <span class="token class-name">Mock</span> <span class="token keyword">implements</span> <span class="token class-name"><span class="token namespace">http<span class="token punctuation">.</span></span>Client</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">MockResponse</span> <span class="token keyword">extends</span> <span class="token class-name">Mock</span> <span class="token keyword">implements</span> <span class="token class-name"><span class="token namespace">http<span class="token punctuation">.</span></span>Response</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">FakeUri</span> <span class="token keyword">extends</span> <span class="token class-name">Fake</span> <span class="token keyword">implements</span> <span class="token class-name">Uri</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">group</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">'Service'</span></span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    late <span class="token class-name">CatService</span> catService<span class="token punctuation">;</span>
    late <span class="token class-name">MockHttp</span> httpClient<span class="token punctuation">;</span>

    <span class="token function">setUpAll</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">registerFallbackValue</span><span class="token punctuation">(</span><span class="token class-name">FakeUri</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">setUp</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      httpClient <span class="token operator">=</span> <span class="token class-name">MockHttp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      catService <span class="token operator">=</span> <span class="token class-name">CatService</span><span class="token punctuation">(</span>httpClient<span class="token punctuation">:</span> httpClient<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">group</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">'constructor'</span></span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">test</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">'does not required a httpClient'</span></span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">expect</span><span class="token punctuation">(</span><span class="token class-name">CatService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> isNotNull<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">group</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">'catSearch'</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">test</span><span class="token punctuation">(</span>
          <span class="token string-literal"><span class="token string">'make correct http request with empty response,'</span></span>
          <span class="token string-literal"><span class="token string">' throw [ErrorEmptyResponse]'</span></span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token punctuation">{</span>
        <span class="token keyword">final</span> response <span class="token operator">=</span> <span class="token class-name">MockResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">when</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> response<span class="token punctuation">.</span>statusCode<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">thenReturn</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">when</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> response<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">thenReturn</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">''</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">when</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> httpClient<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token function">any</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">thenAnswer</span><span class="token punctuation">(</span><span class="token punctuation">(</span>_<span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token operator">=</span><span class="token operator">&gt;</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
          <span class="token keyword">await</span> catService<span class="token punctuation">.</span><span class="token function">search</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token function">fail</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">'should throw error empty body'</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token function">expect</span><span class="token punctuation">(</span>
            error<span class="token punctuation">,</span>
            isA<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ErrorEmptyResponse</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token function">verify</span><span class="token punctuation">(</span>
          <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> httpClient<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span>
            <span class="token class-name">Uri</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>
                <span class="token string-literal"><span class="token string">'https://api.thecatapi.com/v1/images/search?has_breeds=true'</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">called</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token function">test</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">'throws ResultError on non-200 response'</span></span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token punctuation">{</span>
        <span class="token keyword">final</span> response <span class="token operator">=</span> <span class="token class-name">MockResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">when</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> response<span class="token punctuation">.</span>statusCode<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">thenReturn</span><span class="token punctuation">(</span><span class="token number">404</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">when</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> httpClient<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token function">any</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">thenAnswer</span><span class="token punctuation">(</span><span class="token punctuation">(</span>_<span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token operator">=</span><span class="token operator">&gt;</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">expect</span><span class="token punctuation">(</span>
          catService<span class="token punctuation">.</span><span class="token function">search</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token function">throwsA</span><span class="token punctuation">(</span>
            isA<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ErrorSearchingCat</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token function">test</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">'return Cat.json on a valid response'</span></span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token punctuation">{</span>
        <span class="token keyword">final</span> response <span class="token operator">=</span> <span class="token class-name">MockResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">when</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> response<span class="token punctuation">.</span>statusCode<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">thenReturn</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">when</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> response<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">thenReturn</span><span class="token punctuation">(</span><span class="token class-name">TestHelper</span><span class="token punctuation">.</span>searchCatJsonResponse<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">when</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> httpClient<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token function">any</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">thenAnswer</span><span class="token punctuation">(</span><span class="token punctuation">(</span>_<span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token operator">=</span><span class="token operator">&gt;</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">await</span> catService<span class="token punctuation">.</span><span class="token function">search</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">expect</span><span class="token punctuation">(</span>
          <span class="token class-name">Cat</span><span class="token punctuation">.</span><span class="token function">fromJson</span><span class="token punctuation">(</span><span class="token function">jsonDecode</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          isA<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Cat</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç°åœ¨æ˜¯æ—¶å€™å¯¹ç‰ˆæœ¬åº“ç±»è¿›è¡Œæµ‹è¯•äº†ã€‚è¿™é‡Œæ˜¯cat_respositoryç±»ã€‚</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'model/cat.dart'</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'service.dart'</span></span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">CatRepository</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token class-name">CatRepository</span><span class="token punctuation">(</span><span class="token punctuation">{</span>required <span class="token keyword">this</span><span class="token punctuation">.</span>service<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">final</span> <span class="token class-name">CatService</span> service<span class="token punctuation">;</span>

  <span class="token class-name">Future</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Cat</span><span class="token punctuation">&gt;</span></span> <span class="token function">search</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token operator">=</span><span class="token operator">&gt;</span> service<span class="token punctuation">.</span><span class="token function">search</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>é¦–å…ˆï¼Œæˆ‘åˆ›å»ºäº†å¿…è¦çš„æ¨¡æ‹Ÿ</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token keyword">class</span> <span class="token class-name">MockService</span> <span class="token keyword">extends</span> <span class="token class-name">Mock</span> <span class="token keyword">implements</span> <span class="token class-name"><span class="token namespace">cat_service<span class="token punctuation">.</span></span>CatService</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ç¬¬äºŒï¼Œæˆ‘åˆ›å»ºäº†ä¸€ä¸ªç»„ï¼Œæ‹¥æœ‰ä¸è¿™ä¸ªç±»ç›¸å…³çš„æ‰€æœ‰æµ‹è¯•ã€‚è¿™é‡Œæ˜¯åˆ›å»ºæ‰€éœ€å˜é‡å¹¶å°†å…¶åˆå§‹åŒ–åˆ°setUpæ–¹æ³•çš„åœ°æ–¹ã€‚</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token function">group</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">'Cat Repository'</span></span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    late <span class="token class-name"><span class="token namespace">cat_service<span class="token punctuation">.</span></span>CatService</span> catService<span class="token punctuation">;</span>
    late <span class="token class-name">CatRepository</span> catRepository<span class="token punctuation">;</span>
    <span class="token function">setUp</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      catService <span class="token operator">=</span> <span class="token class-name">MockService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      catRepository <span class="token operator">=</span> <span class="token class-name">CatRepository</span><span class="token punctuation">(</span>service<span class="token punctuation">:</span> catService<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä¸ºæ„é€ å‡½æ•°åˆ›å»ºäº†ä¸€ä¸ªæµ‹è¯•ï¼Œåœ¨è¿™é‡Œæˆ‘æ£€æŸ¥äº†catæœåŠ¡æ˜¯å¦éœ€è¦ã€‚</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token function">test</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">'instantiates CatRepository with a required carService'</span></span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                                         
   <span class="token function">expect</span><span class="token punctuation">(</span>catRepository<span class="token punctuation">,</span> isNotNull<span class="token punctuation">)</span><span class="token punctuation">;</span>                                  
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>å®Œæˆè¿™ä¸ªç±»çš„æ‰€æœ‰è¦†ç›–çš„å…¶ä»–æ£€æŸ¥:</p><ol><li>å¯¹æœç´¢æ–¹æ³•çš„è°ƒç”¨ã€‚</li></ol><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token function">test</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">'calls search method'</span></span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token punctuation">{</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">await</span> catRepository<span class="token punctuation">.</span><span class="token function">search</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>_<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token function">verify</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> catService<span class="token punctuation">.</span><span class="token function">search</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">called</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="2"><li>å½“æœç´¢æ–¹æ³•å¤±è´¥æ—¶æŠ›å‡ºé”™è¯¯ã€‚</li></ol><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token function">test</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">'throws Result exception when search fails'</span></span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token punctuation">{</span>
    <span class="token comment">// first create a exception mock instance</span>
    <span class="token keyword">final</span> exception <span class="token operator">=</span> <span class="token class-name">ErrorSearchingCat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// when calls and api and throw an exception</span>
    <span class="token function">when</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> catService<span class="token punctuation">.</span><span class="token function">search</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">thenThrow</span><span class="token punctuation">(</span>exception<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// then expect an error result</span>
    <span class="token function">expect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token operator">=</span><span class="token operator">&gt;</span> catRepository<span class="token punctuation">.</span><span class="token function">search</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">throwsA</span><span class="token punctuation">(</span>exception<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä»¥ä¸‹å°±æ˜¯cat_repository_test.dartç±»çš„ä»£ç ã€‚</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'package:catsapp/repository/cat_repository.dart'</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'package:catsapp/repository/model/result_error.dart'</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'package:catsapp/repository/service.dart'</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'package:flutter_test/flutter_test.dart'</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'package:mocktail/mocktail.dart'</span></span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">MockService</span> <span class="token keyword">extends</span> <span class="token class-name">Mock</span> <span class="token keyword">implements</span> <span class="token class-name">CatService</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">group</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">'Cat Repository'</span></span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    late <span class="token class-name">CatService</span> catService<span class="token punctuation">;</span>
    late <span class="token class-name">CatRepository</span> catRepository<span class="token punctuation">;</span>

    <span class="token function">setUp</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      catService <span class="token operator">=</span> <span class="token class-name">MockService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      catRepository <span class="token operator">=</span> <span class="token class-name">CatRepository</span><span class="token punctuation">(</span>service<span class="token punctuation">:</span> catService<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">group</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">'constructor'</span></span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">test</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">'instantiates CatRepository with a required carService'</span></span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">expect</span><span class="token punctuation">(</span>catRepository<span class="token punctuation">,</span> isNotNull<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">group</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">'search next cat'</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">test</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">'calls search method'</span></span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
          <span class="token keyword">await</span> catRepository<span class="token punctuation">.</span><span class="token function">search</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>_<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
        <span class="token function">verify</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> catService<span class="token punctuation">.</span><span class="token function">search</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">called</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token function">test</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">'throws Result exception when search fails'</span></span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token punctuation">{</span>
        <span class="token comment">// first create a exception mock instance</span>
        <span class="token keyword">final</span> exception <span class="token operator">=</span> <span class="token class-name">ErrorSearchingCat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// when calls and api and throw an exception</span>
        <span class="token function">when</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> catService<span class="token punctuation">.</span><span class="token function">search</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">thenThrow</span><span class="token punctuation">(</span>exception<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// then expect an error result</span>
        <span class="token function">expect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token operator">=</span><span class="token operator">&gt;</span> catRepository<span class="token punctuation">.</span><span class="token function">search</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">throwsA</span><span class="token punctuation">(</span>exception<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ‰€æœ‰æµ‹è¯•éƒ½é€šè¿‡äº†!</p><img src="/How-can-I-start-with-Flutter-Testing/10.png" title="ç¤ºæ„å›¾ width=400"><p>é…·! ç°åœ¨æˆ‘ä»¬å·²ç»æŠŠæ‰€æœ‰çš„æµ‹è¯•éƒ½ä¼ åˆ°äº†æˆ‘ä»¬çš„æœåŠ¡å’Œèµ„æºåº“ä¸­ï¼Œç°åœ¨æ˜¯æ—¶å€™è¿›å…¥blocæµ‹è¯•äº†ã€‚</p><h3 id="Bloc-Test"><a href="#Bloc-Test" class="headerlink" title="Bloc Test"></a>Bloc Test</h3><h4 id="random-cat-bloc-test-dart"><a href="#random-cat-bloc-test-dart" class="headerlink" title="random_cat_bloc_test.dart"></a>random_cat_bloc_test.dart</h4><p>é¦–å…ˆï¼Œè¿™æ˜¯random_cat_blocç±»ã€‚</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'package:equatable/equatable.dart'</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'package:flutter_bloc/flutter_bloc.dart'</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'../../random_cat.dart'</span></span><span class="token punctuation">;</span>

<span class="token keyword">part</span> <span class="token string-literal"><span class="token string">'random_cat_state.dart'</span></span><span class="token punctuation">;</span>
<span class="token keyword">part</span> <span class="token string-literal"><span class="token string">'random_cat_event.dart'</span></span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">RandomCatBloc</span> <span class="token keyword">extends</span> <span class="token class-name">Bloc</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">RandomCatEvent</span><span class="token punctuation">,</span> <span class="token class-name">RandomCatState</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
  <span class="token class-name">RandomCatBloc</span><span class="token punctuation">(</span><span class="token punctuation">{</span>required <span class="token keyword">this</span><span class="token punctuation">.</span>catRepository<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token class-name">RandomCatState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">on</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SearchRandomCat</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">(</span>event<span class="token punctuation">,</span> emit<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">_mapSearchEventToState</span><span class="token punctuation">(</span>event<span class="token punctuation">,</span> emit<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">final</span> <span class="token class-name">CatRepository</span> catRepository<span class="token punctuation">;</span>
  <span class="token keyword">void</span> <span class="token function">_mapSearchEventToState</span><span class="token punctuation">(</span>
      <span class="token class-name">SearchRandomCat</span> event<span class="token punctuation">,</span> <span class="token class-name">Emitter</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">RandomCatState</span><span class="token punctuation">&gt;</span></span> emit<span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      <span class="token function">emit</span><span class="token punctuation">(</span>state<span class="token punctuation">.</span><span class="token function">copyWith</span><span class="token punctuation">(</span>status<span class="token punctuation">:</span> <span class="token class-name">RandomCatStatus</span><span class="token punctuation">.</span>loading<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">final</span> cat <span class="token operator">=</span> <span class="token keyword">await</span> catRepository<span class="token punctuation">.</span><span class="token function">search</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>cat<span class="token punctuation">.</span>breeds <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> cat<span class="token punctuation">.</span>breeds<span class="token operator">!</span><span class="token punctuation">.</span>isEmpty<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">emit</span><span class="token punctuation">(</span>state<span class="token punctuation">.</span><span class="token function">copyWith</span><span class="token punctuation">(</span>status<span class="token punctuation">:</span> <span class="token class-name">RandomCatStatus</span><span class="token punctuation">.</span>emptyBreeds<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token function">emit</span><span class="token punctuation">(</span>state<span class="token punctuation">.</span><span class="token function">copyWith</span><span class="token punctuation">(</span>cat<span class="token punctuation">:</span> cat<span class="token punctuation">,</span> status<span class="token punctuation">:</span> <span class="token class-name">RandomCatStatus</span><span class="token punctuation">.</span>success<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>_<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">emit</span><span class="token punctuation">(</span>state<span class="token punctuation">.</span><span class="token function">copyWith</span><span class="token punctuation">(</span>status<span class="token punctuation">:</span> <span class="token class-name">RandomCatStatus</span><span class="token punctuation">.</span>failure<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨è¿™ç§ç±»å‹çš„æµ‹è¯•ä¸­ï¼Œè¯­æ³•ä¸å•å…ƒæµ‹è¯•æœ‰ä¸€ç‚¹ä¸åŒï¼Œä½†å®ƒçš„ç†å¿µæ˜¯ä¸€æ ·çš„ã€‚ä»¥ä¸‹æ˜¯å…³äºå¦‚ä½•åœ¨flutterä¸­æµ‹è¯•Blocçš„å®˜æ–¹æ–‡æ¡£ï¼š<a target="_blank" rel="noopener" href="https://bloclibrary.dev/#/testing">BlocçŠ¶æ€ç®¡ç†åº“</a></p><p>æˆ‘æŒ‰ç…§è¿™ä¸ªæ–‡æ¡£ï¼Œæˆ‘å¾—åˆ°äº†è¿è¡Œæˆ‘è‡ªå·±çš„blocæµ‹è¯•ã€‚</p><p>è®©æˆ‘ä»¬å¼€å§‹å§! ğŸ™Œ<br>åƒå¾€å¸¸ä¸€æ ·ï¼Œæˆ‘ä»¬éœ€è¦åšçš„ç¬¬ä¸€æ­¥æ˜¯åˆ›å»ºéœ€è¦çš„æ¨¡æ‹Ÿç±»ã€‚</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token keyword">class</span> <span class="token class-name">MockRepository</span> <span class="token keyword">extends</span> <span class="token class-name">Mock</span> <span class="token keyword">implements</span> <span class="token class-name">CatRepository</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">MockCat</span> <span class="token keyword">extends</span> <span class="token class-name">Mock</span> <span class="token keyword">implements</span> <span class="token class-name">Cat</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºå¹¶åˆå§‹åŒ–æ‰€éœ€çš„å˜é‡ç»™æˆ‘ä»¬çš„æ¨¡æ‹Ÿç±»ã€‚<br>æ­¤å¤–ï¼Œæˆ‘è¿˜åˆ›å»ºäº†ç¬¬ä¸€ä¸ªæµ‹è¯•ï¼Œä»¥æ£€æŸ¥è¯¥é›†å›¢çš„åˆå§‹çŠ¶æ€æ˜¯å¦ä¸º <em>RandomCatStatus.initial</em>ã€‚</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token function">group</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">'RandomCatBloc'</span></span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  late <span class="token class-name"><span class="token namespace">catRepository<span class="token punctuation">.</span></span>CatRepository</span> catRepositoryMock<span class="token punctuation">;</span>
  late <span class="token class-name"><span class="token namespace">cat<span class="token punctuation">.</span></span>Cat</span> catMock<span class="token punctuation">;</span>

  <span class="token function">setUp</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    catRepositoryMock <span class="token operator">=</span> <span class="token class-name">MockRepository</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    catMock <span class="token operator">=</span> <span class="token class-name">MockCat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">'initial state of the bloc is [RandomCatStatus.initial]'</span></span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">expect</span><span class="token punctuation">(</span><span class="token class-name">RandomCatBloc</span><span class="token punctuation">(</span>catRepository<span class="token punctuation">:</span> catRepositoryMock<span class="token punctuation">)</span><span class="token punctuation">.</span>state<span class="token punctuation">,</span>
      <span class="token keyword">const</span> <span class="token class-name">RandomCatState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç°åœ¨æˆ‘ä»¬å¯ä»¥å¼€å§‹è¿›è¡Œæˆ‘ä»¬çš„blocæµ‹è¯•ã€‚<br>å½“å“ç§åˆ—è¡¨ä¸ºç©ºæ—¶ï¼Œæ‰§è¡ŒRandomCatStatus.loadingå’ŒRandomCatStatus.emptyBreedsã€‚</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart">blocTest<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">RandomCatBloc</span><span class="token punctuation">,</span> <span class="token class-name">RandomCatState</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>
  <span class="token string-literal"><span class="token string">'emits [RandomCatStatus.loading, RandomCatStatus.emptyBreeds] '</span></span>
  <span class="token string-literal"><span class="token string">'state when cat.breeds are empty'</span></span><span class="token punctuation">,</span>
  setUp<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">when</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> catMock<span class="token punctuation">.</span>breeds<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">thenReturn</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">when</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> catRepositoryMock<span class="token punctuation">.</span><span class="token function">search</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">thenAnswer</span><span class="token punctuation">(</span><span class="token punctuation">(</span>_<span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token operator">=</span><span class="token operator">&gt;</span> catMock<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  build<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token class-name">RandomCatBloc</span><span class="token punctuation">(</span>catRepository<span class="token punctuation">:</span> catRepositoryMock<span class="token punctuation">)</span><span class="token punctuation">,</span>
  act<span class="token punctuation">:</span> <span class="token punctuation">(</span>bloc<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> bloc<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">SearchRandomCat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  expect<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">RandomCatState</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span>
    <span class="token keyword">const</span> <span class="token class-name">RandomCatState</span><span class="token punctuation">(</span>status<span class="token punctuation">:</span> <span class="token class-name">RandomCatStatus</span><span class="token punctuation">.</span>loading<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">const</span> <span class="token class-name">RandomCatState</span><span class="token punctuation">(</span>status<span class="token punctuation">:</span> <span class="token class-name">RandomCatStatus</span><span class="token punctuation">.</span>emptyBreeds<span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="2"><li>å½“å“ç§åˆ—è¡¨ä¸ºç©ºæ—¶ï¼Œå‘å‡ºRandomCatStatus.loadingå’ŒRandomCatStatus.emptyBreedsã€‚</li></ol><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart">blocTest<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">RandomCatBloc</span><span class="token punctuation">,</span> <span class="token class-name">RandomCatState</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>
  <span class="token string-literal"><span class="token string">'emits [RandomCatStatus.loading, RandomCatStatus.emptyBreeds] '</span></span>
  <span class="token string-literal"><span class="token string">'state when cat.breeds are null'</span></span><span class="token punctuation">,</span>
  setUp<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">when</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> catMock<span class="token punctuation">.</span>breeds<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">thenReturn</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">when</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> catRepositoryMock<span class="token punctuation">.</span><span class="token function">search</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">thenAnswer</span><span class="token punctuation">(</span><span class="token punctuation">(</span>_<span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token operator">=</span><span class="token operator">&gt;</span> catMock<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  build<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token class-name">RandomCatBloc</span><span class="token punctuation">(</span>catRepository<span class="token punctuation">:</span> catRepositoryMock<span class="token punctuation">)</span><span class="token punctuation">,</span>
  act<span class="token punctuation">:</span> <span class="token punctuation">(</span>bloc<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> bloc<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">SearchRandomCat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  expect<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span>
    <span class="token keyword">const</span> <span class="token class-name">RandomCatState</span><span class="token punctuation">(</span>status<span class="token punctuation">:</span> <span class="token class-name">RandomCatStatus</span><span class="token punctuation">.</span>loading<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">const</span> <span class="token class-name">RandomCatState</span><span class="token punctuation">(</span>status<span class="token punctuation">:</span> <span class="token class-name">RandomCatStatus</span><span class="token punctuation">.</span>emptyBreeds<span class="token punctuation">)</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="3"><li>å½“å“åº”æ­£ç¡®ä¸”çŒ«çš„æ•°æ®åŒ…å«å“ç±»æ—¶ï¼Œå‘å‡ºRandomCatStatus.loadingå’ŒRandomCatStatus.successã€‚</li></ol><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart">blocTest<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">RandomCatBloc</span><span class="token punctuation">,</span> <span class="token class-name">RandomCatState</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>
     <span class="token string-literal"><span class="token string">'emits [RandomCatStatus.loading, RandomCatStatus.success]'</span></span>
     <span class="token string-literal"><span class="token string">' with a copyWith of other cat'</span></span>
     <span class="token string-literal"><span class="token string">'state for successful'</span></span><span class="token punctuation">,</span>
     setUp<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token function">when</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> catMock<span class="token punctuation">.</span>breeds<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">thenReturn</span><span class="token punctuation">(</span>
         <span class="token class-name">List</span><span class="token punctuation">.</span><span class="token function">generate</span><span class="token punctuation">(</span>
           <span class="token number">1</span><span class="token punctuation">,</span>
           <span class="token punctuation">(</span>index<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token keyword">const</span> <span class="token class-name">Breed</span><span class="token punctuation">(</span>id<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">'1'</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
         <span class="token punctuation">)</span><span class="token punctuation">,</span>
       <span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token function">when</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> catRepositoryMock<span class="token punctuation">.</span><span class="token function">search</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">thenAnswer</span><span class="token punctuation">(</span><span class="token punctuation">(</span>_<span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token operator">=</span><span class="token operator">&gt;</span> catMock<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span><span class="token punctuation">,</span>
     build<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token class-name">RandomCatBloc</span><span class="token punctuation">(</span>catRepository<span class="token punctuation">:</span> catRepositoryMock<span class="token punctuation">)</span><span class="token punctuation">,</span>
     act<span class="token punctuation">:</span> <span class="token punctuation">(</span>bloc<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> bloc<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">SearchRandomCat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
     expect<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span>
       <span class="token keyword">const</span> <span class="token class-name">RandomCatState</span><span class="token punctuation">(</span>status<span class="token punctuation">:</span> <span class="token class-name">RandomCatStatus</span><span class="token punctuation">.</span>loading<span class="token punctuation">)</span><span class="token punctuation">,</span>
       <span class="token class-name">RandomCatState</span><span class="token punctuation">(</span>status<span class="token punctuation">:</span> <span class="token class-name">RandomCatStatus</span><span class="token punctuation">.</span>success<span class="token punctuation">,</span> cat<span class="token punctuation">:</span> catMock<span class="token punctuation">)</span><span class="token punctuation">,</span>
     <span class="token punctuation">]</span><span class="token punctuation">,</span>
   <span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="4"><li>å½“ä¸æˆåŠŸæ—¶å‘å‡ºRandomCatStatus.loadingå’ŒRandomCatStatus.failationã€‚</li></ol><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart">blocTest<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">RandomCatBloc</span><span class="token punctuation">,</span> <span class="token class-name">RandomCatState</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>
  <span class="token string-literal"><span class="token string">'emits [RandomCatStatus.loading, RandomCatStatus.failure] '</span></span>
  <span class="token string-literal"><span class="token string">'when unsuccessful'</span></span><span class="token punctuation">,</span>
  setUp<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">when</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span>    catRepositoryMock<span class="token punctuation">.</span><span class="token function">search</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">thenThrow</span><span class="token punctuation">(</span><span class="token class-name">ErrorSearchingCat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  build<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token class-name">RandomCatBloc</span><span class="token punctuation">(</span>catRepository<span class="token punctuation">:</span> catRepositoryMock<span class="token punctuation">)</span><span class="token punctuation">,</span>
  act<span class="token punctuation">:</span> <span class="token punctuation">(</span>bloc<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> bloc<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">SearchRandomCat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  expect<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">RandomCatState</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span>
    <span class="token keyword">const</span> <span class="token class-name">RandomCatState</span><span class="token punctuation">(</span>status<span class="token punctuation">:</span> <span class="token class-name">RandomCatStatus</span><span class="token punctuation">.</span>loading<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">const</span> <span class="token class-name">RandomCatState</span><span class="token punctuation">(</span>status<span class="token punctuation">:</span> <span class="token class-name">RandomCatStatus</span><span class="token punctuation">.</span>failure<span class="token punctuation">)</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ¥ä¸‹æ¥çœ‹çœ‹å…¨éƒ¨çš„random_cat_bloc_testç±»!</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'package:bloc_test/bloc_test.dart'</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'package:catsapp/repository/cat_repository.dart'</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'package:catsapp/repository/model/cat.dart'</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'package:catsapp/ui/random_cat/random_cat.dart'</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'package:flutter_test/flutter_test.dart'</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'package:mocktail/mocktail.dart'</span></span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">MockRepository</span> <span class="token keyword">extends</span> <span class="token class-name">Mock</span> <span class="token keyword">implements</span> <span class="token class-name">CatRepository</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">MockCat</span> <span class="token keyword">extends</span> <span class="token class-name">Mock</span> <span class="token keyword">implements</span> <span class="token class-name">Cat</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">group</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">'RandomCatBloc'</span></span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    late <span class="token class-name">CatRepository</span> catRepositoryMock<span class="token punctuation">;</span>
    late <span class="token class-name">Cat</span> catMock<span class="token punctuation">;</span>

    <span class="token function">setUp</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      catRepositoryMock <span class="token operator">=</span> <span class="token class-name">MockRepository</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      catMock <span class="token operator">=</span> <span class="token class-name">MockCat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">test</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">'initial state of the bloc is [RandomCatStatus.initial]'</span></span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">expect</span><span class="token punctuation">(</span><span class="token class-name">RandomCatBloc</span><span class="token punctuation">(</span>catRepository<span class="token punctuation">:</span> catRepositoryMock<span class="token punctuation">)</span><span class="token punctuation">.</span>state<span class="token punctuation">,</span>
          <span class="token keyword">const</span> <span class="token class-name">RandomCatState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">copyWith</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    blocTest<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">RandomCatBloc</span><span class="token punctuation">,</span> <span class="token class-name">RandomCatState</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>
      <span class="token string-literal"><span class="token string">'emits [RandomCatStatus.loading, RandomCatStatus.emptyBreeds] '</span></span>
      <span class="token string-literal"><span class="token string">'state when cat.breeds are empty'</span></span><span class="token punctuation">,</span>
      setUp<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">when</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> catMock<span class="token punctuation">.</span>breeds<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">thenReturn</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">when</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> catRepositoryMock<span class="token punctuation">.</span><span class="token function">search</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">thenAnswer</span><span class="token punctuation">(</span><span class="token punctuation">(</span>_<span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token operator">=</span><span class="token operator">&gt;</span> catMock<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      build<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token class-name">RandomCatBloc</span><span class="token punctuation">(</span>catRepository<span class="token punctuation">:</span> catRepositoryMock<span class="token punctuation">)</span><span class="token punctuation">,</span>
      act<span class="token punctuation">:</span> <span class="token punctuation">(</span>bloc<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> bloc<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">SearchRandomCat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      expect<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">RandomCatState</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span>
        <span class="token keyword">const</span> <span class="token class-name">RandomCatState</span><span class="token punctuation">(</span>status<span class="token punctuation">:</span> <span class="token class-name">RandomCatStatus</span><span class="token punctuation">.</span>loading<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token keyword">const</span> <span class="token class-name">RandomCatState</span><span class="token punctuation">(</span>status<span class="token punctuation">:</span> <span class="token class-name">RandomCatStatus</span><span class="token punctuation">.</span>emptyBreeds<span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>

    blocTest<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">RandomCatBloc</span><span class="token punctuation">,</span> <span class="token class-name">RandomCatState</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>
      <span class="token string-literal"><span class="token string">'emits [RandomCatStatus.loading, RandomCatStatus.emptyBreeds] '</span></span>
      <span class="token string-literal"><span class="token string">'state when cat.breeds are null'</span></span><span class="token punctuation">,</span>
      setUp<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">when</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> catMock<span class="token punctuation">.</span>breeds<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">thenReturn</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">when</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> catRepositoryMock<span class="token punctuation">.</span><span class="token function">search</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">thenAnswer</span><span class="token punctuation">(</span><span class="token punctuation">(</span>_<span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token operator">=</span><span class="token operator">&gt;</span> catMock<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      build<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token class-name">RandomCatBloc</span><span class="token punctuation">(</span>catRepository<span class="token punctuation">:</span> catRepositoryMock<span class="token punctuation">)</span><span class="token punctuation">,</span>
      act<span class="token punctuation">:</span> <span class="token punctuation">(</span>bloc<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> bloc<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">SearchRandomCat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      expect<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span>
        <span class="token keyword">const</span> <span class="token class-name">RandomCatState</span><span class="token punctuation">(</span>status<span class="token punctuation">:</span> <span class="token class-name">RandomCatStatus</span><span class="token punctuation">.</span>loading<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token keyword">const</span> <span class="token class-name">RandomCatState</span><span class="token punctuation">(</span>status<span class="token punctuation">:</span> <span class="token class-name">RandomCatStatus</span><span class="token punctuation">.</span>emptyBreeds<span class="token punctuation">)</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>

    blocTest<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">RandomCatBloc</span><span class="token punctuation">,</span> <span class="token class-name">RandomCatState</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>
      <span class="token string-literal"><span class="token string">'emits [RandomCatStatus.loading, RandomCatStatus.success]'</span></span>
      <span class="token string-literal"><span class="token string">' with a copyWith of other cat'</span></span>
      <span class="token string-literal"><span class="token string">'state for successful'</span></span><span class="token punctuation">,</span>
      setUp<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">when</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> catMock<span class="token punctuation">.</span>breeds<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">thenReturn</span><span class="token punctuation">(</span>
          <span class="token class-name">List</span><span class="token punctuation">.</span><span class="token function">generate</span><span class="token punctuation">(</span>
            <span class="token number">1</span><span class="token punctuation">,</span>
            <span class="token punctuation">(</span>index<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token keyword">const</span> <span class="token class-name">Breed</span><span class="token punctuation">(</span>id<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">'1'</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">when</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> catRepositoryMock<span class="token punctuation">.</span><span class="token function">search</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">thenAnswer</span><span class="token punctuation">(</span><span class="token punctuation">(</span>_<span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token operator">=</span><span class="token operator">&gt;</span> catMock<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      build<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token class-name">RandomCatBloc</span><span class="token punctuation">(</span>catRepository<span class="token punctuation">:</span> catRepositoryMock<span class="token punctuation">)</span><span class="token punctuation">,</span>
      act<span class="token punctuation">:</span> <span class="token punctuation">(</span>bloc<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> bloc<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">SearchRandomCat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      expect<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span>
        <span class="token keyword">const</span> <span class="token class-name">RandomCatState</span><span class="token punctuation">(</span>status<span class="token punctuation">:</span> <span class="token class-name">RandomCatStatus</span><span class="token punctuation">.</span>loading<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token class-name">RandomCatState</span><span class="token punctuation">(</span>status<span class="token punctuation">:</span> <span class="token class-name">RandomCatStatus</span><span class="token punctuation">.</span>success<span class="token punctuation">,</span> cat<span class="token punctuation">:</span> catMock<span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>

    blocTest<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">RandomCatBloc</span><span class="token punctuation">,</span> <span class="token class-name">RandomCatState</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>
      <span class="token string-literal"><span class="token string">'emits [RandomCatStatus.loading, RandomCatStatus.failure] '</span></span>
      <span class="token string-literal"><span class="token string">'when unsuccessful'</span></span><span class="token punctuation">,</span>
      setUp<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">when</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> catRepositoryMock<span class="token punctuation">.</span><span class="token function">search</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">thenThrow</span><span class="token punctuation">(</span><span class="token class-name">ErrorSearchingCat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      build<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token class-name">RandomCatBloc</span><span class="token punctuation">(</span>catRepository<span class="token punctuation">:</span> catRepositoryMock<span class="token punctuation">)</span><span class="token punctuation">,</span>
      act<span class="token punctuation">:</span> <span class="token punctuation">(</span>bloc<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> bloc<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">SearchRandomCat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      expect<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">RandomCatState</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span>
        <span class="token keyword">const</span> <span class="token class-name">RandomCatState</span><span class="token punctuation">(</span>status<span class="token punctuation">:</span> <span class="token class-name">RandomCatStatus</span><span class="token punctuation">.</span>loading<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token keyword">const</span> <span class="token class-name">RandomCatState</span><span class="token punctuation">(</span>status<span class="token punctuation">:</span> <span class="token class-name">RandomCatStatus</span><span class="token punctuation">.</span>failure<span class="token punctuation">)</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ­¤å¤–ï¼Œä½ å¯ä»¥æµ‹è¯•ä½ çš„åº”ç”¨ç¨‹åºçš„çŠ¶æ€å’Œäº‹ä»¶ã€‚<br>ä¸‹é¢æ˜¯random_cat_state_test.dartã€‚</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'package:flutter_test/flutter_test.dart'</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'package:catsapp/ui/random_cat/random_cat.dart'</span></span><span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">group</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">'RandomCatStatusX '</span></span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">test</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">'returns correct values for RandomCatStatus.initial'</span></span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> status <span class="token operator">=</span> <span class="token class-name">RandomCatStatus</span><span class="token punctuation">.</span>initial<span class="token punctuation">;</span>
      <span class="token function">expect</span><span class="token punctuation">(</span>status<span class="token punctuation">.</span>isInitial<span class="token punctuation">,</span> isTrue<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">expect</span><span class="token punctuation">(</span>status<span class="token punctuation">.</span>isLoading<span class="token punctuation">,</span> isFalse<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">expect</span><span class="token punctuation">(</span>status<span class="token punctuation">.</span>isSuccess<span class="token punctuation">,</span> isFalse<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">expect</span><span class="token punctuation">(</span>status<span class="token punctuation">.</span>isFailure<span class="token punctuation">,</span> isFalse<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">expect</span><span class="token punctuation">(</span>status<span class="token punctuation">.</span>isEmptyBreeds<span class="token punctuation">,</span> isFalse<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">test</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">'returns correct values for RandomCatStatus.loading'</span></span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> status <span class="token operator">=</span> <span class="token class-name">RandomCatStatus</span><span class="token punctuation">.</span>loading<span class="token punctuation">;</span>
      <span class="token function">expect</span><span class="token punctuation">(</span>status<span class="token punctuation">.</span>isInitial<span class="token punctuation">,</span> isFalse<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">expect</span><span class="token punctuation">(</span>status<span class="token punctuation">.</span>isLoading<span class="token punctuation">,</span> isTrue<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">expect</span><span class="token punctuation">(</span>status<span class="token punctuation">.</span>isSuccess<span class="token punctuation">,</span> isFalse<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">expect</span><span class="token punctuation">(</span>status<span class="token punctuation">.</span>isFailure<span class="token punctuation">,</span> isFalse<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">expect</span><span class="token punctuation">(</span>status<span class="token punctuation">.</span>isEmptyBreeds<span class="token punctuation">,</span> isFalse<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">test</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">'returns correct values for RandomCatStatus.isSuccess'</span></span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> status <span class="token operator">=</span> <span class="token class-name">RandomCatStatus</span><span class="token punctuation">.</span>success<span class="token punctuation">;</span>
      <span class="token function">expect</span><span class="token punctuation">(</span>status<span class="token punctuation">.</span>isInitial<span class="token punctuation">,</span> isFalse<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">expect</span><span class="token punctuation">(</span>status<span class="token punctuation">.</span>isLoading<span class="token punctuation">,</span> isFalse<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">expect</span><span class="token punctuation">(</span>status<span class="token punctuation">.</span>isSuccess<span class="token punctuation">,</span> isTrue<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">expect</span><span class="token punctuation">(</span>status<span class="token punctuation">.</span>isFailure<span class="token punctuation">,</span> isFalse<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">expect</span><span class="token punctuation">(</span>status<span class="token punctuation">.</span>isEmptyBreeds<span class="token punctuation">,</span> isFalse<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">test</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">'returns correct values for RandomCatStatus.isFailure'</span></span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> status <span class="token operator">=</span> <span class="token class-name">RandomCatStatus</span><span class="token punctuation">.</span>failure<span class="token punctuation">;</span>
      <span class="token function">expect</span><span class="token punctuation">(</span>status<span class="token punctuation">.</span>isInitial<span class="token punctuation">,</span> isFalse<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">expect</span><span class="token punctuation">(</span>status<span class="token punctuation">.</span>isLoading<span class="token punctuation">,</span> isFalse<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">expect</span><span class="token punctuation">(</span>status<span class="token punctuation">.</span>isSuccess<span class="token punctuation">,</span> isFalse<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">expect</span><span class="token punctuation">(</span>status<span class="token punctuation">.</span>isFailure<span class="token punctuation">,</span> isTrue<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">expect</span><span class="token punctuation">(</span>status<span class="token punctuation">.</span>isEmptyBreeds<span class="token punctuation">,</span> isFalse<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">test</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">'returns correct values for RandomCatStatus.isEmptyBreeds'</span></span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> status <span class="token operator">=</span> <span class="token class-name">RandomCatStatus</span><span class="token punctuation">.</span>emptyBreeds<span class="token punctuation">;</span>
      <span class="token function">expect</span><span class="token punctuation">(</span>status<span class="token punctuation">.</span>isInitial<span class="token punctuation">,</span> isFalse<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">expect</span><span class="token punctuation">(</span>status<span class="token punctuation">.</span>isLoading<span class="token punctuation">,</span> isFalse<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">expect</span><span class="token punctuation">(</span>status<span class="token punctuation">.</span>isSuccess<span class="token punctuation">,</span> isFalse<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">expect</span><span class="token punctuation">(</span>status<span class="token punctuation">.</span>isFailure<span class="token punctuation">,</span> isFalse<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">expect</span><span class="token punctuation">(</span>status<span class="token punctuation">.</span>isEmptyBreeds<span class="token punctuation">,</span> isTrue<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™é‡Œæ˜¯random_cat_event_test.dartã€‚</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'package:catsapp/ui/random_cat/random_cat.dart'</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'package:flutter_test/flutter_test.dart'</span></span><span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">group</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">'RandomCatEvent'</span></span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">test</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">'supports comparisons'</span></span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">expect</span><span class="token punctuation">(</span><span class="token class-name">RandomCatEvent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">RandomCatEvent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">group</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">'SearchRandomCat'</span></span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">test</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">'supports comparisons'</span></span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">expect</span><span class="token punctuation">(</span><span class="token class-name">SearchRandomCat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">SearchRandomCat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ‰€æœ‰æµ‹è¯•éƒ½é€šè¿‡äº†!</p><img src="/How-can-I-start-with-Flutter-Testing/11.png" title="ç¤ºæ„å›¾ width=400"><p>ç°åœ¨æˆ‘ä»¬å·²ç»å®Œæˆäº†å•å…ƒæµ‹è¯•å’Œæ¨¡å—æµ‹è¯•çš„éƒ¨åˆ†ï¼Œæ˜¯æ—¶å€™å¼€å§‹è¿›è¡ŒWidgetæµ‹è¯•äº†!</p><h3 id="Widgetæµ‹è¯•"><a href="#Widgetæµ‹è¯•" class="headerlink" title="Widgetæµ‹è¯•"></a>Widgetæµ‹è¯•</h3><p>è¿™ç§æµ‹è¯•æ˜¯è¶…çº§é…·çš„ï¼Œä½ å¯ä»¥æµ‹è¯•ç”¨æˆ·ä¸åº”ç”¨ç¨‹åºçš„å¯èƒ½äº’åŠ¨ï¼Œæ‰€ä»¥ä½ å¯ä»¥å®Œå…¨æ§åˆ¶ä½ çš„åº”ç”¨ç¨‹åºçš„æ‰€æœ‰çŠ¶æ€ã€‚<br>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒWidgetæµ‹è¯•å°†æ˜¯å¾ˆå®¹æ˜“çš„ã€‚âœŒï¸<br>è®©æˆ‘ä»¬å¼€å§‹å§!<br>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦æµ‹è¯•æˆ‘ä»¬çš„random_cat_pageã€‚</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'package:catsapp/ui/random_cat/pages/bloc/random_cat_bloc.dart'</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'package:catsapp/ui/random_cat/pages/random_cat_layout.dart'</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'package:catsapp/repository/cat_repository.dart'</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'package:catsapp/repository/service.dart'</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'package:flutter/material.dart'</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'package:flutter_bloc/flutter_bloc.dart'</span></span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">RandomCatPage</span> <span class="token keyword">extends</span> <span class="token class-name">StatelessWidget</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token class-name">RandomCatPage</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token class-name">Key</span><span class="token operator">?</span> key<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword">super</span><span class="token punctuation">(</span>key<span class="token punctuation">:</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token metadata function">@override</span>
  <span class="token class-name">Widget</span> <span class="token function">build</span><span class="token punctuation">(</span><span class="token class-name">BuildContext</span> context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token class-name">RepositoryProvider</span><span class="token punctuation">(</span>
      create<span class="token punctuation">:</span> <span class="token punctuation">(</span>context<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token class-name">CatRepository</span><span class="token punctuation">(</span>service<span class="token punctuation">:</span> <span class="token class-name">CatService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      child<span class="token punctuation">:</span> <span class="token class-name">BlocProvider</span><span class="token punctuation">(</span>
        create<span class="token punctuation">:</span> <span class="token punctuation">(</span>context<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token class-name">RandomCatBloc</span><span class="token punctuation">(</span>
          catRepository<span class="token punctuation">:</span> context<span class="token punctuation">.</span>read<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CatRepository</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">SearchRandomCat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        child<span class="token punctuation">:</span> <span class="token keyword">const</span> <span class="token class-name">RandomCatLayout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åŒæ ·ï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºå‡çš„ç±»ã€‚</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token keyword">class</span> <span class="token class-name">FakeRandomCatState</span> <span class="token keyword">extends</span> <span class="token class-name">Fake</span> <span class="token keyword">implements</span> <span class="token class-name">RandomCatState</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">FakeRandomCatEvent</span> <span class="token keyword">extends</span> <span class="token class-name">Fake</span> <span class="token keyword">implements</span> <span class="token class-name">RandomCatEvent</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>ç„¶åæˆ‘ä»¬éœ€è¦åœ¨setUpAllæ–¹æ³•ä¸­æ³¨å†Œã€‚</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token function">setUpAll</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">registerFallbackValue</span><span class="token punctuation">(</span><span class="token class-name">RandomCatEvent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">registerFallbackValue</span><span class="token punctuation">(</span><span class="token class-name">FakeRandomCatState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬åªéœ€è¦æµ‹è¯•é¡µé¢çš„æ¸²æŸ“æ˜¯å¦æ­£å¸¸ã€‚</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token function">group</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">'RandomCatPage '</span></span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">testWidgets</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">'renders RandomCatPage'</span></span><span class="token punctuation">,</span> <span class="token punctuation">(</span>tester<span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token punctuation">{</span>
    <span class="token keyword">await</span> <span class="token function">mockNetworkImagesFor</span><span class="token punctuation">(</span>
      <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> tester<span class="token punctuation">.</span><span class="token function">pumpWidget</span><span class="token punctuation">(</span>
        <span class="token keyword">const</span> <span class="token class-name">MaterialApp</span><span class="token punctuation">(</span>
          home<span class="token punctuation">:</span> <span class="token class-name">RandomCatPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>find<span class="token punctuation">.</span><span class="token function">byType</span><span class="token punctuation">(</span><span class="token class-name">RandomCatPage</span><span class="token punctuation">)</span><span class="token punctuation">,</span> findsOneWidget<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ¥çœ‹ä¸‹å®Œæ•´çš„ç¨‹åº</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'package:catsapp/ui/random_cat/random_cat.dart'</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'package:flutter/material.dart'</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'package:flutter_test/flutter_test.dart'</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'package:mocktail/mocktail.dart'</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'package:network_image_mock/network_image_mock.dart'</span></span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">FakeRandomCatState</span> <span class="token keyword">extends</span> <span class="token class-name">Fake</span> <span class="token keyword">implements</span> <span class="token class-name">RandomCatState</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">FakeRandomCatEvent</span> <span class="token keyword">extends</span> <span class="token class-name">Fake</span> <span class="token keyword">implements</span> <span class="token class-name">RandomCatEvent</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">setUpAll</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">registerFallbackValue</span><span class="token punctuation">(</span><span class="token class-name">RandomCatEvent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">registerFallbackValue</span><span class="token punctuation">(</span><span class="token class-name">FakeRandomCatState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">group</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">'RandomCatPage '</span></span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">testWidgets</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">'renders RandomCatPage'</span></span><span class="token punctuation">,</span> <span class="token punctuation">(</span>tester<span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token punctuation">{</span>
      <span class="token keyword">await</span> <span class="token function">mockNetworkImagesFor</span><span class="token punctuation">(</span>
        <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> tester<span class="token punctuation">.</span><span class="token function">pumpWidget</span><span class="token punctuation">(</span>
          <span class="token keyword">const</span> <span class="token class-name">MaterialApp</span><span class="token punctuation">(</span>
            home<span class="token punctuation">:</span> <span class="token class-name">RandomCatPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">expect</span><span class="token punctuation">(</span>find<span class="token punctuation">.</span><span class="token function">byType</span><span class="token punctuation">(</span><span class="token class-name">RandomCatPage</span><span class="token punctuation">)</span><span class="token punctuation">,</span> findsOneWidget<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ‰€æœ‰æµ‹è¯•éƒ½é€šè¿‡äº†!</p><img src="/How-can-I-start-with-Flutter-Testing/12.png" title="ç¤ºæ„å›¾ width=400"><p>ä¸‹ä¸€ä¸ªæˆ‘ä»¬éœ€è¦æµ‹è¯•çš„ç±»æ˜¯ï¼šRandom_cat_layout_test.dartã€‚</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'../random_cat.dart'</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'bloc/random_cat_bloc.dart'</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'package:flutter/material.dart'</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'package:flutter_bloc/flutter_bloc.dart'</span></span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">RandomCatLayout</span> <span class="token keyword">extends</span> <span class="token class-name">StatelessWidget</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token class-name">RandomCatLayout</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token class-name">Key</span><span class="token operator">?</span> key<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword">super</span><span class="token punctuation">(</span>key<span class="token punctuation">:</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token metadata function">@override</span>
  <span class="token class-name">Widget</span> <span class="token function">build</span><span class="token punctuation">(</span><span class="token class-name">BuildContext</span> context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token class-name">BlocConsumer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">RandomCatBloc</span><span class="token punctuation">,</span> <span class="token class-name">RandomCatState</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>
      listener<span class="token punctuation">:</span> <span class="token punctuation">(</span>context<span class="token punctuation">,</span> state<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>state<span class="token punctuation">.</span>status<span class="token punctuation">.</span>isEmptyBreeds<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          context<span class="token punctuation">.</span>read<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">RandomCatBloc</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">SearchRandomCat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      builder<span class="token punctuation">:</span> <span class="token punctuation">(</span>context<span class="token punctuation">,</span> state<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>state<span class="token punctuation">.</span>status<span class="token punctuation">.</span>isFailure<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> <span class="token keyword">const</span> <span class="token class-name">FailureRandomCatView</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>state<span class="token punctuation">.</span>status<span class="token punctuation">.</span>isInitial<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> <span class="token keyword">const</span> <span class="token class-name">InitialRandomCatView</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>state<span class="token punctuation">.</span>status<span class="token punctuation">.</span>isLoading<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> <span class="token keyword">const</span> <span class="token class-name">LoadingView</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>state<span class="token punctuation">.</span>status<span class="token punctuation">.</span>isSuccess<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> <span class="token class-name">SuccessRandomCatView</span><span class="token punctuation">(</span>
            cat<span class="token punctuation">:</span> state<span class="token punctuation">.</span>cat<span class="token punctuation">,</span>
          <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> <span class="token keyword">const</span> <span class="token class-name">SizedBox</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™é‡Œæˆ‘æ ¹æ®è§†å›¾çš„çŠ¶æ€åˆ›å»ºäº†ä¸åŒç±»å‹çš„è§†å›¾ã€‚è¦æµ‹è¯•è¿™äº›è§†å›¾ï¼Œæœ€é‡è¦çš„éƒ¨åˆ†æ˜¯Keyã€‚<br>æŒ‰çŠ¶æ€åˆ’åˆ†çš„è§†å›¾ã€‚</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'../../../utils/const_keys_app.dart'</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'package:flutter/material.dart'</span></span><span class="token punctuation">;</span>

<span class="token comment">// Initial</span>

<span class="token keyword">class</span> <span class="token class-name">InitialRandomCatView</span> <span class="token keyword">extends</span> <span class="token class-name">StatelessWidget</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token class-name">InitialRandomCatView</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token metadata function">@override</span>
  <span class="token class-name">Widget</span> <span class="token function">build</span><span class="token punctuation">(</span><span class="token class-name">BuildContext</span> context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">const</span> <span class="token class-name">Center</span><span class="token punctuation">(</span>
      key<span class="token punctuation">:</span> <span class="token class-name">Key</span><span class="token punctuation">(</span><span class="token class-name">ConstWidgetKeysApp.RandomCatInitial</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      child<span class="token punctuation">:</span> <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">'No information available'</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// Loading</span>

<span class="token keyword">class</span> <span class="token class-name">LoadingView</span> <span class="token keyword">extends</span> <span class="token class-name">StatelessWidget</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token class-name">LoadingView</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token metadata function">@override</span>
  <span class="token class-name">Widget</span> <span class="token function">build</span><span class="token punctuation">(</span><span class="token class-name">BuildContext</span> context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">const</span> <span class="token class-name">Center</span><span class="token punctuation">(</span>
      key<span class="token punctuation">:</span> <span class="token class-name">Key</span><span class="token punctuation">(</span><span class="token class-name">ConstWidgetKeysApp.CatLoading</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      child<span class="token punctuation">:</span> <span class="token class-name">CircularProgressIndicator</span><span class="token punctuation">(</span>color<span class="token punctuation">:</span> <span class="token class-name">Colors</span><span class="token punctuation">.</span>green<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// Failure</span>

<span class="token keyword">class</span> <span class="token class-name">FailureRandomCatView</span> <span class="token keyword">extends</span> <span class="token class-name">StatelessWidget</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token class-name">FailureRandomCatView</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token metadata function">@override</span>
  <span class="token class-name">Widget</span> <span class="token function">build</span><span class="token punctuation">(</span><span class="token class-name">BuildContext</span> context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">const</span> <span class="token class-name">Center</span><span class="token punctuation">(</span>
      key<span class="token punctuation">:</span> <span class="token class-name">Key</span><span class="token punctuation">(</span><span class="token class-name">ConstWidgetKeysApp.RandomCatFailure</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      child<span class="token punctuation">:</span> <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">'Something was wrong'</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// Success</span>

<span class="token keyword">class</span> <span class="token class-name">SuccessRandomCatView</span> <span class="token keyword">extends</span> <span class="token class-name">StatelessWidget</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token class-name">SuccessRandomCatView</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    required <span class="token keyword">this</span><span class="token punctuation">.</span>cat<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">final</span> <span class="token class-name">Cat</span> cat<span class="token punctuation">;</span>
  <span class="token metadata function">@override</span>
  <span class="token class-name">Widget</span> <span class="token function">build</span><span class="token punctuation">(</span><span class="token class-name">BuildContext</span> context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token class-name">Column</span><span class="token punctuation">(</span>
      key<span class="token punctuation">:</span> <span class="token keyword">const</span> <span class="token class-name">Key</span><span class="token punctuation">(</span><span class="token class-name">ConstWidgetKeysApp.RandomCatSuccess</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      children<span class="token punctuation">:</span> <span class="token punctuation">[</span>
        <span class="token class-name">Padding</span><span class="token punctuation">(</span>
          padding<span class="token punctuation">:</span> <span class="token keyword">const</span> <span class="token class-name">EdgeInsets</span><span class="token punctuation">.</span><span class="token function">only</span><span class="token punctuation">(</span>top<span class="token punctuation">:</span> <span class="token number">28.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          child<span class="token punctuation">:</span> <span class="token class-name">CatCard</span><span class="token punctuation">(</span>
            key<span class="token punctuation">:</span> <span class="token keyword">const</span> <span class="token class-name">Key</span><span class="token punctuation">(</span><span class="token class-name">ConstWidgetKeysApp.RandomCatCardKey</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            cat<span class="token punctuation">:</span> cat<span class="token punctuation">,</span>
          <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token keyword">const</span> <span class="token class-name">Spacer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token class-name">Padding</span><span class="token punctuation">(</span>
          padding<span class="token punctuation">:</span> <span class="token keyword">const</span> <span class="token class-name">EdgeInsets</span><span class="token punctuation">.</span><span class="token function">only</span><span class="token punctuation">(</span>right<span class="token punctuation">:</span> <span class="token number">18.0</span><span class="token punctuation">,</span> bottom<span class="token punctuation">:</span> <span class="token number">8.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          child<span class="token punctuation">:</span> <span class="token class-name">Align</span><span class="token punctuation">(</span>
            alignment<span class="token punctuation">:</span> <span class="token class-name">Alignment</span><span class="token punctuation">.</span>bottomRight<span class="token punctuation">,</span>
            child<span class="token punctuation">:</span> <span class="token class-name">FloatingActionButton</span><span class="token punctuation">(</span>
              key<span class="token punctuation">:</span> <span class="token keyword">const</span> <span class="token class-name">Key</span><span class="token punctuation">(</span><span class="token class-name">ConstWidgetKeysApp.RandomCatFabButtonKey</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
              onPressed<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token punctuation">{</span>
                context<span class="token punctuation">.</span>read<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">RandomCatBloc</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">SearchRandomCat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token punctuation">}</span><span class="token punctuation">,</span>
              child<span class="token punctuation">:</span> <span class="token keyword">const</span> <span class="token class-name">Icon</span><span class="token punctuation">(</span><span class="token class-name">Icons</span><span class="token punctuation">.</span>refresh<span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™ä¸ªç±»æœ‰æ›´å¤šçš„æµ‹è¯•è¦åšã€‚è¿™é‡Œæˆ‘ä»¬æœ‰ä¸åŒçš„çŠ¶æ€å’Œä¸€ä¸ªæŒ‰é’®çš„äº¤äº’ï¼Œæ‰€ä»¥è®©æˆ‘ä»¬å¼€å§‹å§ã€‚<br>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦æ¨¡æ‹Ÿå’Œå‡çš„ç±»ã€‚</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token keyword">class</span> <span class="token class-name">MockRandomCatBloc</span> <span class="token keyword">extends</span> <span class="token class-name">MockBloc</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">RandomCatEvent</span><span class="token punctuation">,</span> <span class="token class-name">RandomCatState</span><span class="token punctuation">&gt;</span></span>
    <span class="token keyword">implements</span> <span class="token class-name">RandomCatBloc</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">FakeRandomCatState</span> <span class="token keyword">extends</span> <span class="token class-name">Fake</span> <span class="token keyword">implements</span> <span class="token class-name">RandomCatState</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">FakeRandomCatEvent</span> <span class="token keyword">extends</span> <span class="token class-name">Fake</span> <span class="token keyword">implements</span> <span class="token class-name">RandomCatEvent</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç„¶åæˆ‘ä»¬éœ€è¦åˆ›å»ºå’Œåˆå§‹åŒ–å˜é‡ã€‚</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart">late <span class="token class-name">MockRandomCatBloc</span> blocCat<span class="token punctuation">;</span>

<span class="token function">setUpAll</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// Register the event and the state</span>
  <span class="token function">registerFallbackValue</span><span class="token punctuation">(</span><span class="token class-name">FakeRandomCatEvent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">registerFallbackValue</span><span class="token punctuation">(</span><span class="token class-name">FakeRandomCatState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">setUp</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  blocCat <span class="token operator">=</span> <span class="token class-name">MockRandomCatBloc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æˆ‘ä»¬è¦æµ‹è¯•çš„ç¬¬ä¸€ä»¶äº‹æ˜¯è§†å›¾çš„å¯èƒ½çŠ¶æ€ï¼Œä¸ºäº†åšåˆ°è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬è¦åˆ›å»ºä¸€ä¸ªç‰¹å®šçš„ç»„ï¼Œç„¶ååœ¨é‡Œé¢ï¼Œæˆ‘ä»¬å¯ä»¥æµ‹è¯•æ‰€æœ‰æƒ…å†µã€‚</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token function">group</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">'RandomCatPage states '</span></span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ol><li>å½“çŠ¶æ€ä¸ºRandomCatStatus.failureæ—¶ï¼Œæ¸²æŸ“è§†å›¾FailureRandomCatViewã€‚</li></ol><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token function">testWidgets</span><span class="token punctuation">(</span>
        <span class="token string-literal"><span class="token string">'render FailureRandomCatView when state is [RandomCatStatus.failure]'</span></span><span class="token punctuation">,</span>
        <span class="token punctuation">(</span>tester<span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token punctuation">{</span>
      <span class="token function">when</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> blocCat<span class="token punctuation">.</span>state<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">thenReturn</span><span class="token punctuation">(</span>
        <span class="token keyword">const</span> <span class="token class-name">RandomCatState</span><span class="token punctuation">(</span>status<span class="token punctuation">:</span> <span class="token class-name">RandomCatStatus</span><span class="token punctuation">.</span>failure<span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">await</span> <span class="token function">mockNetworkImagesFor</span><span class="token punctuation">(</span>
        <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> tester<span class="token punctuation">.</span><span class="token function">pumpWidget</span><span class="token punctuation">(</span>
          <span class="token class-name">BlocProvider</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">RandomCatBloc</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>
            lazy<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
            create<span class="token punctuation">:</span> <span class="token punctuation">(</span>_<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> blocCat<span class="token punctuation">,</span>
            child<span class="token punctuation">:</span> <span class="token keyword">const</span> <span class="token class-name">MaterialApp</span><span class="token punctuation">(</span>
              home<span class="token punctuation">:</span> <span class="token class-name">RandomCatLayout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">expect</span><span class="token punctuation">(</span>find<span class="token punctuation">.</span><span class="token function">byKey</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token class-name">Key</span><span class="token punctuation">(</span><span class="token class-name">ConstWidgetKeysApp.RandomCatFailure</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          findsOneWidget<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="2"><li>å½“çŠ¶æ€ä¸ºRandomCatStatus.loadingæ—¶ï¼Œæ¸²æŸ“è§†å›¾LoadingViewã€‚</li></ol><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token function">testWidgets</span><span class="token punctuation">(</span>
        <span class="token string-literal"><span class="token string">'render LoadingView when state is [RandomCatStatus.loading]'</span></span><span class="token punctuation">,</span>
        <span class="token punctuation">(</span>tester<span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token punctuation">{</span>
      <span class="token function">when</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> blocCat<span class="token punctuation">.</span>state<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">thenReturn</span><span class="token punctuation">(</span>
        <span class="token keyword">const</span> <span class="token class-name">RandomCatState</span><span class="token punctuation">(</span>status<span class="token punctuation">:</span> <span class="token class-name">RandomCatStatus</span><span class="token punctuation">.</span>loading<span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">await</span> <span class="token function">mockNetworkImagesFor</span><span class="token punctuation">(</span>
        <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> tester<span class="token punctuation">.</span><span class="token function">pumpWidget</span><span class="token punctuation">(</span>
          <span class="token class-name">BlocProvider</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">RandomCatBloc</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>
            lazy<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
            create<span class="token punctuation">:</span> <span class="token punctuation">(</span>_<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> blocCat<span class="token punctuation">,</span>
            child<span class="token punctuation">:</span> <span class="token keyword">const</span> <span class="token class-name">MaterialApp</span><span class="token punctuation">(</span>
              home<span class="token punctuation">:</span> <span class="token class-name">RandomCatLayout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">expect</span><span class="token punctuation">(</span>
          find<span class="token punctuation">.</span><span class="token function">byKey</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token class-name">Key</span><span class="token punctuation">(</span><span class="token class-name">ConstWidgetKeysApp.CatLoading</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> findsOneWidget<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="3"><li>å½“çŠ¶æ€ä¸ºRandomCatStatus.successæ—¶ï¼Œæ¸²æŸ“è§†å›¾SuccessRandomCatViewã€‚</li></ol><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token function">testWidgets</span><span class="token punctuation">(</span>
        <span class="token string-literal"><span class="token string">'render SuccessRandomCatView when state is [RandomCatStatus.success]'</span></span><span class="token punctuation">,</span>
        <span class="token punctuation">(</span>tester<span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token punctuation">{</span>
      <span class="token function">when</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> blocCat<span class="token punctuation">.</span>state<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">thenReturn</span><span class="token punctuation">(</span>
        <span class="token keyword">const</span> <span class="token class-name">RandomCatState</span><span class="token punctuation">(</span>status<span class="token punctuation">:</span> <span class="token class-name">RandomCatStatus</span><span class="token punctuation">.</span>success<span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">await</span> <span class="token function">mockNetworkImagesFor</span><span class="token punctuation">(</span>
        <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> tester<span class="token punctuation">.</span><span class="token function">pumpWidget</span><span class="token punctuation">(</span>
          <span class="token class-name">BlocProvider</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">RandomCatBloc</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>
            lazy<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
            create<span class="token punctuation">:</span> <span class="token punctuation">(</span>_<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> blocCat<span class="token punctuation">,</span>
            child<span class="token punctuation">:</span> <span class="token keyword">const</span> <span class="token class-name">MaterialApp</span><span class="token punctuation">(</span>
              home<span class="token punctuation">:</span> <span class="token class-name">RandomCatLayout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">expect</span><span class="token punctuation">(</span>find<span class="token punctuation">.</span><span class="token function">byKey</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token class-name">Key</span><span class="token punctuation">(</span><span class="token class-name">ConstWidgetKeysApp.RandomCatSuccess</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          findsOneWidget<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="4"><li>å½“çŠ¶æ€ä¸ºRandomCatStatus.initialæ—¶ï¼Œæ¸²æŸ“è§†å›¾InitialRandomCatViewã€‚</li></ol><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token function">testWidgets</span><span class="token punctuation">(</span>
        <span class="token string-literal"><span class="token string">'render InitialRandomCatView when state is [RandomCatStatus.initial]'</span></span><span class="token punctuation">,</span>
        <span class="token punctuation">(</span>tester<span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token punctuation">{</span>
      <span class="token function">when</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> blocCat<span class="token punctuation">.</span>state<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">thenReturn</span><span class="token punctuation">(</span>
        <span class="token keyword">const</span> <span class="token class-name">RandomCatState</span><span class="token punctuation">(</span>status<span class="token punctuation">:</span> <span class="token class-name">RandomCatStatus</span><span class="token punctuation">.</span>initial<span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">await</span> <span class="token function">mockNetworkImagesFor</span><span class="token punctuation">(</span>
        <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> tester<span class="token punctuation">.</span><span class="token function">pumpWidget</span><span class="token punctuation">(</span>
          <span class="token class-name">BlocProvider</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">RandomCatBloc</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>
            lazy<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
            create<span class="token punctuation">:</span> <span class="token punctuation">(</span>_<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> blocCat<span class="token punctuation">,</span>
            child<span class="token punctuation">:</span> <span class="token keyword">const</span> <span class="token class-name">MaterialApp</span><span class="token punctuation">(</span>
              home<span class="token punctuation">:</span> <span class="token class-name">RandomCatLayout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">expect</span><span class="token punctuation">(</span>find<span class="token punctuation">.</span><span class="token function">byKey</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token class-name">Key</span><span class="token punctuation">(</span><span class="token class-name">ConstWidgetKeysApp.RandomCatInitial</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          findsOneWidget<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>é…·ğŸ˜! ç°åœ¨æˆ‘ä»¬å·²ç»æµ‹è¯•äº†è§†å›¾çš„æ‰€æœ‰å¯èƒ½çŠ¶æ€ï¼Œæˆ‘ä»¬å¯ä»¥å¼€å§‹ä¸‹ä¸€æ­¥äº†ã€‚æµ‹è¯•æŒ‰é’®çš„ç‚¹å‡»!<br>å½“æŒ‰é’®è¢«ç‚¹å‡»çš„æ—¶å€™ï¼Œè°ƒç”¨äº‹ä»¶SearchRandomCatã€‚</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token function">group</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">'Click on FAB '</span></span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token function">testWidgets</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">'call to bloc to get next cat'</span></span><span class="token punctuation">,</span> <span class="token punctuation">(</span>tester<span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token punctuation">{</span>
     <span class="token function">when</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> blocCat<span class="token punctuation">.</span>state<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">thenReturn</span><span class="token punctuation">(</span>
       <span class="token keyword">const</span> <span class="token class-name">RandomCatState</span><span class="token punctuation">(</span>status<span class="token punctuation">:</span> <span class="token class-name">RandomCatStatus</span><span class="token punctuation">.</span>success<span class="token punctuation">)</span><span class="token punctuation">,</span>
     <span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token keyword">await</span> <span class="token function">mockNetworkImagesFor</span><span class="token punctuation">(</span>
       <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> tester<span class="token punctuation">.</span><span class="token function">pumpWidget</span><span class="token punctuation">(</span>
         <span class="token class-name">BlocProvider</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">RandomCatBloc</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>
           lazy<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
           create<span class="token punctuation">:</span> <span class="token punctuation">(</span>_<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> blocCat<span class="token punctuation">,</span>
           child<span class="token punctuation">:</span> <span class="token keyword">const</span> <span class="token class-name">MaterialApp</span><span class="token punctuation">(</span>
             home<span class="token punctuation">:</span> <span class="token class-name">RandomCatLayout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
           <span class="token punctuation">)</span><span class="token punctuation">,</span>
         <span class="token punctuation">)</span><span class="token punctuation">,</span>
       <span class="token punctuation">)</span><span class="token punctuation">,</span>
     <span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token function">expect</span><span class="token punctuation">(</span>find<span class="token punctuation">.</span><span class="token function">byType</span><span class="token punctuation">(</span><span class="token class-name">FloatingActionButton</span><span class="token punctuation">)</span><span class="token punctuation">,</span> findsOneWidget<span class="token punctuation">)</span><span class="token punctuation">;</span>

     <span class="token keyword">await</span> tester<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span>find<span class="token punctuation">.</span><span class="token function">byType</span><span class="token punctuation">(</span><span class="token class-name">FloatingActionButton</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token keyword">await</span> tester<span class="token punctuation">.</span><span class="token function">pumpAndSettle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

     <span class="token function">verify</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> blocCat<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">SearchRandomCat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">called</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æœ€åï¼Œæˆ‘ä»¬éœ€è¦æ§åˆ¶çŒ«çš„å“ç§ä¸ºç©ºçš„æ—¶å€™ã€‚<br>æˆ‘ä»¬åœ¨BlocConsumeré‡Œé¢ç›‘å¬ï¼Œæ‰€ä»¥å¦‚æœå‘ç”Ÿè¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬éœ€è¦å†æ¬¡è°ƒç”¨SearchRandomCatäº‹ä»¶ï¼Œä¸ºäº†æµ‹è¯•ï¼Œæˆ‘ä»¬éœ€è¦åšä»¥ä¸‹å·¥ä½œã€‚</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token function">group</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">'Call to SearchRandomCat on BlocListener '</span></span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> cat <span class="token operator">=</span> <span class="token class-name">Cat</span><span class="token punctuation">(</span>id<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">'1'</span></span><span class="token punctuation">,</span> breeds<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> width<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> height<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> url<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">'www'</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">testWidgets</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">'Call to event when breeds is empty'</span></span><span class="token punctuation">,</span> <span class="token punctuation">(</span>tester<span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token punctuation">{</span>
      <span class="token function">whenListen</span><span class="token punctuation">(</span>
        blocCat<span class="token punctuation">,</span>
        <span class="token class-name">Stream</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">RandomCatState</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">.</span><span class="token function">fromIterable</span><span class="token punctuation">(</span>
          <span class="token punctuation">[</span>
            <span class="token keyword">const</span> <span class="token class-name">RandomCatState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token keyword">const</span> <span class="token class-name">RandomCatState</span><span class="token punctuation">(</span>status<span class="token punctuation">:</span> <span class="token class-name">RandomCatStatus</span><span class="token punctuation">.</span>emptyBreeds<span class="token punctuation">,</span> cat<span class="token punctuation">:</span> cat<span class="token punctuation">)</span>
          <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">when</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> blocCat<span class="token punctuation">.</span>state<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">thenReturn</span><span class="token punctuation">(</span>
        <span class="token keyword">const</span> <span class="token class-name">RandomCatState</span><span class="token punctuation">(</span>status<span class="token punctuation">:</span> <span class="token class-name">RandomCatStatus</span><span class="token punctuation">.</span>emptyBreeds<span class="token punctuation">,</span> cat<span class="token punctuation">:</span> cat<span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">await</span> <span class="token function">mockNetworkImagesFor</span><span class="token punctuation">(</span>
        <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> tester<span class="token punctuation">.</span><span class="token function">pumpWidget</span><span class="token punctuation">(</span>
          <span class="token class-name">BlocProvider</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">RandomCatBloc</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>
            lazy<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
            create<span class="token punctuation">:</span> <span class="token punctuation">(</span>_<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> blocCat<span class="token punctuation">,</span>
            child<span class="token punctuation">:</span> <span class="token keyword">const</span> <span class="token class-name">MaterialApp</span><span class="token punctuation">(</span>
              home<span class="token punctuation">:</span> <span class="token class-name">RandomCatLayout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token function">verify</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> blocCat<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">SearchRandomCat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">called</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ¥çœ‹å®Œæ•´çš„ç¨‹åº</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'package:bloc_test/bloc_test.dart'</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'package:catsapp/ui/random_cat/random_cat.dart'</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'package:catsapp/utils/const_keys_app.dart'</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'package:flutter/material.dart'</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'package:flutter_bloc/flutter_bloc.dart'</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'package:flutter_test/flutter_test.dart'</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'package:mocktail/mocktail.dart'</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'package:network_image_mock/network_image_mock.dart'</span></span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">MockRandomCatBloc</span> <span class="token keyword">extends</span> <span class="token class-name">MockBloc</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">RandomCatEvent</span><span class="token punctuation">,</span> <span class="token class-name">RandomCatState</span><span class="token punctuation">&gt;</span></span>
    <span class="token keyword">implements</span> <span class="token class-name">RandomCatBloc</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">FakeRandomCatState</span> <span class="token keyword">extends</span> <span class="token class-name">Fake</span> <span class="token keyword">implements</span> <span class="token class-name">RandomCatState</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">FakeRandomCatEvent</span> <span class="token keyword">extends</span> <span class="token class-name">Fake</span> <span class="token keyword">implements</span> <span class="token class-name">RandomCatEvent</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  late <span class="token class-name">MockRandomCatBloc</span> blocCat<span class="token punctuation">;</span>

  <span class="token function">setUpAll</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Register the event and the state</span>
    <span class="token function">registerFallbackValue</span><span class="token punctuation">(</span><span class="token class-name">FakeRandomCatEvent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">registerFallbackValue</span><span class="token punctuation">(</span><span class="token class-name">FakeRandomCatState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">setUp</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    blocCat <span class="token operator">=</span> <span class="token class-name">MockRandomCatBloc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">group</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">'RandomCatPage states '</span></span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">testWidgets</span><span class="token punctuation">(</span>
        <span class="token string-literal"><span class="token string">'render FailureRandomCatView when state is [RandomCatStatus.failure]'</span></span><span class="token punctuation">,</span>
        <span class="token punctuation">(</span>tester<span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token punctuation">{</span>
      <span class="token function">when</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> blocCat<span class="token punctuation">.</span>state<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">thenReturn</span><span class="token punctuation">(</span>
        <span class="token keyword">const</span> <span class="token class-name">RandomCatState</span><span class="token punctuation">(</span>status<span class="token punctuation">:</span> <span class="token class-name">RandomCatStatus</span><span class="token punctuation">.</span>failure<span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">await</span> <span class="token function">mockNetworkImagesFor</span><span class="token punctuation">(</span>
        <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> tester<span class="token punctuation">.</span><span class="token function">pumpWidget</span><span class="token punctuation">(</span>
          <span class="token class-name">BlocProvider</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">RandomCatBloc</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>
            lazy<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
            create<span class="token punctuation">:</span> <span class="token punctuation">(</span>_<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> blocCat<span class="token punctuation">,</span>
            child<span class="token punctuation">:</span> <span class="token keyword">const</span> <span class="token class-name">MaterialApp</span><span class="token punctuation">(</span>
              home<span class="token punctuation">:</span> <span class="token class-name">RandomCatLayout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">expect</span><span class="token punctuation">(</span>find<span class="token punctuation">.</span><span class="token function">byKey</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token class-name">Key</span><span class="token punctuation">(</span><span class="token class-name">ConstWidgetKeysApp.RandomCatFailure</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          findsOneWidget<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">testWidgets</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">'render LoadingView when state is [RandomCatStatus.loading]'</span></span><span class="token punctuation">,</span>
        <span class="token punctuation">(</span>tester<span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token punctuation">{</span>
      <span class="token function">when</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> blocCat<span class="token punctuation">.</span>state<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">thenReturn</span><span class="token punctuation">(</span>
        <span class="token keyword">const</span> <span class="token class-name">RandomCatState</span><span class="token punctuation">(</span>status<span class="token punctuation">:</span> <span class="token class-name">RandomCatStatus</span><span class="token punctuation">.</span>loading<span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">await</span> <span class="token function">mockNetworkImagesFor</span><span class="token punctuation">(</span>
        <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> tester<span class="token punctuation">.</span><span class="token function">pumpWidget</span><span class="token punctuation">(</span>
          <span class="token class-name">BlocProvider</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">RandomCatBloc</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>
            lazy<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
            create<span class="token punctuation">:</span> <span class="token punctuation">(</span>_<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> blocCat<span class="token punctuation">,</span>
            child<span class="token punctuation">:</span> <span class="token keyword">const</span> <span class="token class-name">MaterialApp</span><span class="token punctuation">(</span>
              home<span class="token punctuation">:</span> <span class="token class-name">RandomCatLayout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">expect</span><span class="token punctuation">(</span>
          find<span class="token punctuation">.</span><span class="token function">byKey</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token class-name">Key</span><span class="token punctuation">(</span><span class="token class-name">ConstWidgetKeysApp.CatLoading</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> findsOneWidget<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">testWidgets</span><span class="token punctuation">(</span>
        <span class="token string-literal"><span class="token string">'render SuccessRandomCatView when state is [RandomCatStatus.success]'</span></span><span class="token punctuation">,</span>
        <span class="token punctuation">(</span>tester<span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token punctuation">{</span>
      <span class="token function">when</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> blocCat<span class="token punctuation">.</span>state<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">thenReturn</span><span class="token punctuation">(</span>
        <span class="token keyword">const</span> <span class="token class-name">RandomCatState</span><span class="token punctuation">(</span>status<span class="token punctuation">:</span> <span class="token class-name">RandomCatStatus</span><span class="token punctuation">.</span>success<span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">await</span> <span class="token function">mockNetworkImagesFor</span><span class="token punctuation">(</span>
        <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> tester<span class="token punctuation">.</span><span class="token function">pumpWidget</span><span class="token punctuation">(</span>
          <span class="token class-name">BlocProvider</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">RandomCatBloc</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>
            lazy<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
            create<span class="token punctuation">:</span> <span class="token punctuation">(</span>_<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> blocCat<span class="token punctuation">,</span>
            child<span class="token punctuation">:</span> <span class="token keyword">const</span> <span class="token class-name">MaterialApp</span><span class="token punctuation">(</span>
              home<span class="token punctuation">:</span> <span class="token class-name">RandomCatLayout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">expect</span><span class="token punctuation">(</span>find<span class="token punctuation">.</span><span class="token function">byKey</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token class-name">Key</span><span class="token punctuation">(</span><span class="token class-name">ConstWidgetKeysApp.RandomCatSuccess</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          findsOneWidget<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">testWidgets</span><span class="token punctuation">(</span>
        <span class="token string-literal"><span class="token string">'render InitialRandomCatView when state is [RandomCatStatus.initial]'</span></span><span class="token punctuation">,</span>
        <span class="token punctuation">(</span>tester<span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token punctuation">{</span>
      <span class="token function">when</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> blocCat<span class="token punctuation">.</span>state<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">thenReturn</span><span class="token punctuation">(</span>
        <span class="token keyword">const</span> <span class="token class-name">RandomCatState</span><span class="token punctuation">(</span>status<span class="token punctuation">:</span> <span class="token class-name">RandomCatStatus</span><span class="token punctuation">.</span>initial<span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">await</span> <span class="token function">mockNetworkImagesFor</span><span class="token punctuation">(</span>
        <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> tester<span class="token punctuation">.</span><span class="token function">pumpWidget</span><span class="token punctuation">(</span>
          <span class="token class-name">BlocProvider</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">RandomCatBloc</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>
            lazy<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
            create<span class="token punctuation">:</span> <span class="token punctuation">(</span>_<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> blocCat<span class="token punctuation">,</span>
            child<span class="token punctuation">:</span> <span class="token keyword">const</span> <span class="token class-name">MaterialApp</span><span class="token punctuation">(</span>
              home<span class="token punctuation">:</span> <span class="token class-name">RandomCatLayout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">expect</span><span class="token punctuation">(</span>find<span class="token punctuation">.</span><span class="token function">byKey</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token class-name">Key</span><span class="token punctuation">(</span><span class="token class-name">ConstWidgetKeysApp.RandomCatInitial</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          findsOneWidget<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">group</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">'Click on FAB '</span></span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">testWidgets</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">'call to bloc to get next cat'</span></span><span class="token punctuation">,</span> <span class="token punctuation">(</span>tester<span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token punctuation">{</span>
      <span class="token function">when</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> blocCat<span class="token punctuation">.</span>state<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">thenReturn</span><span class="token punctuation">(</span>
        <span class="token keyword">const</span> <span class="token class-name">RandomCatState</span><span class="token punctuation">(</span>status<span class="token punctuation">:</span> <span class="token class-name">RandomCatStatus</span><span class="token punctuation">.</span>success<span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">await</span> <span class="token function">mockNetworkImagesFor</span><span class="token punctuation">(</span>
        <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> tester<span class="token punctuation">.</span><span class="token function">pumpWidget</span><span class="token punctuation">(</span>
          <span class="token class-name">BlocProvider</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">RandomCatBloc</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>
            lazy<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
            create<span class="token punctuation">:</span> <span class="token punctuation">(</span>_<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> blocCat<span class="token punctuation">,</span>
            child<span class="token punctuation">:</span> <span class="token keyword">const</span> <span class="token class-name">MaterialApp</span><span class="token punctuation">(</span>
              home<span class="token punctuation">:</span> <span class="token class-name">RandomCatLayout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">expect</span><span class="token punctuation">(</span>find<span class="token punctuation">.</span><span class="token function">byType</span><span class="token punctuation">(</span><span class="token class-name">FloatingActionButton</span><span class="token punctuation">)</span><span class="token punctuation">,</span> findsOneWidget<span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token keyword">await</span> tester<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span>find<span class="token punctuation">.</span><span class="token function">byType</span><span class="token punctuation">(</span><span class="token class-name">FloatingActionButton</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">await</span> tester<span class="token punctuation">.</span><span class="token function">pumpAndSettle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token function">verify</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> blocCat<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">SearchRandomCat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">called</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">group</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">'Call to SearchRandomCat on BlocListener '</span></span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> cat <span class="token operator">=</span> <span class="token class-name">Cat</span><span class="token punctuation">(</span>id<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">'1'</span></span><span class="token punctuation">,</span> breeds<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> width<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> height<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> url<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">'www'</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">testWidgets</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">'Call to event when breeds is empty'</span></span><span class="token punctuation">,</span> <span class="token punctuation">(</span>tester<span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token punctuation">{</span>
      <span class="token function">whenListen</span><span class="token punctuation">(</span>
        blocCat<span class="token punctuation">,</span>
        <span class="token class-name">Stream</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">RandomCatState</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">.</span><span class="token function">fromIterable</span><span class="token punctuation">(</span>
          <span class="token punctuation">[</span>
            <span class="token keyword">const</span> <span class="token class-name">RandomCatState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token keyword">const</span> <span class="token class-name">RandomCatState</span><span class="token punctuation">(</span>status<span class="token punctuation">:</span> <span class="token class-name">RandomCatStatus</span><span class="token punctuation">.</span>emptyBreeds<span class="token punctuation">,</span> cat<span class="token punctuation">:</span> cat<span class="token punctuation">)</span>
          <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">when</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> blocCat<span class="token punctuation">.</span>state<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">thenReturn</span><span class="token punctuation">(</span>
        <span class="token keyword">const</span> <span class="token class-name">RandomCatState</span><span class="token punctuation">(</span>status<span class="token punctuation">:</span> <span class="token class-name">RandomCatStatus</span><span class="token punctuation">.</span>emptyBreeds<span class="token punctuation">,</span> cat<span class="token punctuation">:</span> cat<span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">await</span> <span class="token function">mockNetworkImagesFor</span><span class="token punctuation">(</span>
        <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> tester<span class="token punctuation">.</span><span class="token function">pumpWidget</span><span class="token punctuation">(</span>
          <span class="token class-name">BlocProvider</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">RandomCatBloc</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>
            lazy<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
            create<span class="token punctuation">:</span> <span class="token punctuation">(</span>_<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> blocCat<span class="token punctuation">,</span>
            child<span class="token punctuation">:</span> <span class="token keyword">const</span> <span class="token class-name">MaterialApp</span><span class="token punctuation">(</span>
              home<span class="token punctuation">:</span> <span class="token class-name">RandomCatLayout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token function">verify</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> blocCat<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">SearchRandomCat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">called</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ‰€æœ‰æµ‹è¯•éƒ½é€šè¿‡äº†!</p><img src="/How-can-I-start-with-Flutter-Testing/13.png" title="ç¤ºæ„å›¾ width=400"><p>æˆ‘ä»¬è¦åšçš„æœ€åä¸€æ­¥æ˜¯æ£€æŸ¥ä¿é™©ã€‚ä½ æœ‰ä¸åŒçš„é€‰æ‹©ã€‚</p><ul><li>åœ¨ç»ˆç«¯ä¸Šè¿è¡Œflutteræµ‹è¯•â€“è¦†ç›–ç‡ã€‚</li><li>å®‰è£…LCOVä»¥å®ç°HTMLçš„å¯è§†åŒ–<br>æˆ‘ä½¿ç”¨äº†ç¬¬äºŒä¸ªé€‰é¡¹ï¼Œæ‰€ä»¥æˆ‘å°†å‘Šè¯‰ä½ å¦‚ä½•å®‰è£…å’Œä½¿ç”¨å®ƒã€‚(macçš„å®‰è£…)ã€‚</li><li>brew install lcov</li><li>flutter test â€” coverage</li><li>genhtml coverage/lcov.info -o coverage/html<br>æœ€åï¼Œä½ å°†ä¼šçœ‹åˆ°æˆ‘ä»¬çš„åº”ç”¨ç¨‹åº100%çš„è¦†ç›–ç‡ğŸ§ªâœŒï¸ã€‚</li></ul><img src="/How-can-I-start-with-Flutter-Testing/14.png" title="ç¤ºæ„å›¾ width=400"><h3 id="ç»“è®º"><a href="#ç»“è®º" class="headerlink" title="ç»“è®º"></a>ç»“è®º</h3><p>æˆ‘è®¤ä¸ºä¸€å¼€å§‹å­¦ä¹ æµ‹è¯•å¯èƒ½ä¼šå¾ˆå›°éš¾å’Œä»¤äººæ²®ä¸§ï¼Œä½†ä½ åº”è¯¥å­¦ä¹ å®ƒï¼Œå› ä¸ºå¦‚æœä½ æƒ³å»ºç«‹å¥½çš„åº”ç”¨ç¨‹åºï¼Œä½ éœ€è¦äº†è§£æµ‹è¯•çš„å·¥ä½œåŸç†ã€‚åœ¨æˆ‘ç¬¬ä¸€æ¬¡æ¥è§¦å®ƒçš„æ—¶å€™ï¼Œæˆ‘è§£å†³äº†å¾ˆå¤šbugï¼Œå¦‚æœæˆ‘æ²¡æœ‰åšæµ‹è¯•ï¼Œè¿™äº›bugå°±ä¼šå­˜åœ¨ã€‚<br>æ‰€ä»¥â€¦â€¦è¯·åšæµ‹è¯•!</p><p>ä»¥ä¸Šæ‰€æœ‰æºä»£ç ï¼Œæ‚¨å¯ä»¥ç§»æ­¥ï¼š<a target="_blank" rel="noopener" href="https://github.com/reasonpun/my_100_goals/tree/main/goals_01">https://github.com/reasonpun/my_100_goals/tree/main/goals_01</a></p></div><footer class="post-footer"><div class="reward-container"><div>ä½ çš„é¼“åŠ±æ˜¯æˆ‘æ›´æ–°çš„åŠ¨åŠ›ï¼</div><button>èµèµ</button><div class="post-reward"><div><img src="/images/wechatpay.png" alt="æœ¨è¾›å¿µåšæ¢“ å¾®ä¿¡"> <span>å¾®ä¿¡</span></div><div><img src="/images/alipay.png" alt="æœ¨è¾›å¿µåšæ¢“ æ”¯ä»˜å®"> <span>æ”¯ä»˜å®</span></div></div></div><div class="post-tags"><a href="/tags/Flutter/" rel="tag"># Flutter</a> <a href="/tags/CI-CD/" rel="tag"># CI/CD</a></div><div class="post-nav"><div class="post-nav-item"><a href="/Deep-Drive-into-Flutter-Lifecycle.html" rel="prev" title="æ·±å…¥äº†è§£ Flutter ç”Ÿå‘½å‘¨æœŸ"><i class="fa fa-chevron-left"></i> æ·±å…¥äº†è§£ Flutter ç”Ÿå‘½å‘¨æœŸ</a></div><div class="post-nav-item"><a href="/Breakdown-setState-signature.html" rel="next" title="æµ…æsetState()">æµ…æsetState() <i class="fa fa-chevron-right"></i></a></div></div></footer></article></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright">&copy; <span itemprop="copyrightYear">2025</span> <span class="with-love"><i class="fa fa-heart"></i> </span><span class="author" itemprop="copyrightHolder">æœ¨è¾›å¿µåšæ¢“</span></div><div class="wordcount"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-chart-line"></i> </span><span>ç«™ç‚¹æ€»å­—æ•°ï¼š</span> <span title="ç«™ç‚¹æ€»å­—æ•°">534k</span> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-coffee"></i> </span><span>ç«™ç‚¹é˜…è¯»æ—¶é•¿ &asymp;</span> <span title="ç«™ç‚¹é˜…è¯»æ—¶é•¿">8:06</span></span></div><div class="busuanzi-count"><span class="post-meta-item" id="busuanzi_container_site_uv"><span class="post-meta-item-icon"><i class="fa fa-user"></i> </span><span class="site-uv" title="æ€»è®¿å®¢é‡"><span id="busuanzi_value_site_uv"></span> </span></span><span class="post-meta-item" id="busuanzi_container_site_pv"><span class="post-meta-item-icon"><i class="fa fa-eye"></i> </span><span class="site-pv" title="æ€»è®¿é—®é‡"><span id="busuanzi_value_site_pv"></span></span></span></div><div class="powered-by">ç”± <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> å¼ºåŠ›é©±åŠ¨</div></div></footer><script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.6/dist/medium-zoom.min.js" integrity="sha256-EdPgYcPk/IIrw7FYeuJQexva49pVRZNmt3LculEr7zM=" crossorigin="anonymous"></script><script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div class="moon-menu"><div class="moon-menu-items"><div id="moon-menu-item-back2bottom" class="moon-menu-item"><i class="fas fa-chevron-down"></i></div><div id="moon-menu-item-back2top" class="moon-menu-item"><i class="fas fa-chevron-up"></i></div></div><div class="moon-menu-button"><svg class="moon-menu-bg"><circle class="moon-menu-cricle" cx="50%" cy="50%" r="44%"></circle><circle class="moon-menu-border" cx="50%" cy="50%" r="48%"></circle></svg><div class="moon-menu-content"><div class="moon-menu-icon"><i class="fas fa-ellipsis-v"></i></div><div class="moon-menu-text"></div></div></div></div><script src="/js/injector.js"></script></body></html>