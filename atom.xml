<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title><![CDATA[Tensor Cell]]></title>
  <subtitle><![CDATA[è¿˜è¦å†èµ°500é‡Œ]]></subtitle>
  <link href="/atom.xml" rel="self"/>
  <link href="http://reasonpun.com/"/>
  <updated>2016-04-06T11:10:33.000Z</updated>
  <id>http://reasonpun.com/</id>
  
  <author>
    <name><![CDATA[reasono]]></name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title><![CDATA[Oryx2 å¼€å‘è€…æ–‡æ¡£]]></title>
    <link href="http://reasonpun.com/2016/04/06/Oryx2-developer-doc/"/>
    <id>http://reasonpun.com/2016/04/06/Oryx2-developer-doc/</id>
    <published>2016-04-06T09:58:20.000Z</published>
    <updated>2016-04-06T11:10:33.000Z</updated>
    <content type="html"><![CDATA[<!--  -->
<!--  -->
<!--  _ __    __     __      ____    ___     ___   _____   __  __    ___     -->
<!-- /\`'__\/'__`\ /'__`\   /',__\  / __`\ /' _ `\/\ '__`\/\ \/\ \ /' _ `\   -->
<!-- \ \ \//\  __//\ \L\.\_/\__, `\/\ \L\ \/\ \/\ \ \ \L\ \ \ \_\ \/\ \/\ \  -->
<!--  \ \_\\ \____\ \__/.\_\/\____/\ \____/\ \_\ \_\ \ ,__/\ \____/\ \_\ \_\ -->
<!--   \/_/ \/____/\/__/\/_/\/___/  \/___/  \/_/\/_/\ \ \/  \/___/  \/_/\/_/ -->
<!--                                                 \ \_\                   -->
<!--                                                  \/_/                   -->
<!--  -->
<h3 id="u73AF_u5883_u9700_u6C42"><a href="#u73AF_u5883_u9700_u6C42" class="headerlink" title="ç¯å¢ƒéœ€æ±‚"></a>ç¯å¢ƒéœ€æ±‚</h3><ul>
<li><a href="http://git-scm.com/" target="_blank" rel="external">git</a>, æˆ–è€…ä¸€ä¸ªæ”¯æŒgitçš„IDE</li>
<li><a href="http://maven.apache.org/" target="_blank" rel="external">Apache Maven</a> 3.2.1 æˆ–è€…æ›´æ–°ç‰ˆæœ¬</li>
<li><a href="http://www.oracle.com/technetwork/java/javase/downloads/index.html" target="_blank" rel="external">Java JDK</a> (ä¸èƒ½åªæœ‰JRE) 7 æˆ–è€…æ›´æ–°ç‰ˆæœ¬</li>
</ul>
<p>ä»¥ä¸Šéœ€è¦å·²ç»å®‰è£…åˆ°äº†ä½ çš„å¼€å‘ç¯å¢ƒä¸­ã€‚</p>
<h2 id="Building"><a href="#Building" class="headerlink" title="Building"></a>Building</h2><p>å…‹éš†ä»£ç åˆ°ä½ æœ¬åœ°ï¼Œå¹¶ä¸”ç¼–è¯‘ï¼š</p>
<figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git <span class="keyword">clone</span> <span class="title">https</span>://github.com/OryxProject/oryx.git oryx</span><br><span class="line">cd oryx</span><br><span class="line">mvn -DskipTests package</span><br></pre></td></tr></table></figure>
<p>ä¼šç¼–è¯‘å‡ºå¦‚ä¸‹çš„äºŒè¿›åˆ¶çš„jaræ–‡ä»¶ï¼š</p>
<ul>
<li>æ‰¹å¤„ç†å±‚: deploy/oryx-batch/target/oryx-batch-2.1.2.jar</li>
<li>å®æ—¶å¤„ç†å±‚: deploy/oryx-speed/target/oryx-speed-2.1.2.jar</li>
<li>æœåŠ¡å±‚: deploy/oryx-serving/target/oryx-serving-2.1.2.jar</li>
</ul>
<p>å‹æƒ…æé†’ï¼Œå¦‚æœä½ å¯¹å¼€å‘Oryxæ„Ÿå…´è¶£ï¼Œå¯ä»¥æ ¹æ®è¿™ä¸ª<a href="https://help.github.com/articles/fork-a-repo" target="_blank" rel="external">åˆ†æ”¯</a>å…‹éš†è‡ªå·±çš„åˆ†æ”¯ï¼Œç„¶åå°±å¯ä»¥æäº¤ä¿®æ”¹äº†ã€‚</p>
<h3 id="Java_8"><a href="#Java_8" class="headerlink" title="Java 8"></a>Java 8</h3><p>å¦‚æœä½¿ç”¨Java8ç¼–è¯‘ï¼Œéœ€è¦æ·»åŠ å‚æ•°-Pjava8 å¹¶ä¸”æµ‹è¯•è¿™é‡Œçš„æŒ‡ä»¤ã€‚</p>
<h3 id="Platform_Only"><a href="#Platform_Only" class="headerlink" title="Platform Only"></a>Platform Only</h3><p>é»˜è®¤çš„ç¼–è¯‘åŒ…æ‹¬åŸºäºSpark MLlibå’Œå…¶ä»–åº“çš„ç«¯åˆ°ç«¯çš„MLç¨‹åºã€‚å¦‚æœåªæ˜¯ç¼–è¯‘lambdaå’ŒMLå±‚ï¼Œéœ€è¦é€šè¿‡å‚æ•°-P!app-tierå…³é—­å…¶ä»–çš„é€‰é¡¹ã€‚æ³¨æ„ï¼Œåœ¨bashä¸­ï¼Œï¼éœ€è¦è½¬ä¹‰ï¼š -P!app-tierã€‚</p>
<h3 id="u6D4B_u8BD5"><a href="#u6D4B_u8BD5" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h3><p>mvn æµ‹è¯•ä¼šæ‰§è¡Œæ‰€æœ‰çš„ä½†æ„¿æµ‹è¯•ç”¨ä¾‹ã€‚ä¹ŸåŒæ—¶ä¼šæ‰§è¡Œæ‰€æœ‰çš„é›†æˆæµ‹è¯•ï¼Œè¿™ä¸ªå¯èƒ½ä¼šéœ€è¦ç¨å¾®é•¿ç‚¹çš„æ—¶é—´ã€‚</p>
<h2 id="u6A21_u578B_u5BF9_u5E94_u8868"><a href="#u6A21_u578B_u5BF9_u5E94_u8868" class="headerlink" title="æ¨¡å‹å¯¹åº”è¡¨"></a>æ¨¡å‹å¯¹åº”è¡¨</h2><p>ä¸»è¦çš„æ¨¡å‹å’Œä»–ä»¬å¯¹åº”çš„å±‚ï¼š</p>
<table>
<thead>
<tr>
<th></th>
<th>Serving</th>
<th>Speed</th>
<th>Batch</th>
</tr>
</thead>
<tbody>
<tr>
<td>Binary</td>
<td>oryx-serving</td>
<td>oryx-speed</td>
<td>oryx-batch</td>
</tr>
<tr>
<td>App</td>
<td>oryx-app-serving</td>
<td>oryx-app-mllib oryx-app</td>
<td>oryx-app-mllib oryx-app</td>
</tr>
<tr>
<td>ML</td>
<td></td>
<td>oryx-ml</td>
<td>oryx-ml</td>
</tr>
<tr>
<td>Lambda</td>
<td>oryx-lambda-serving</td>
<td>oryx-lambda</td>
<td>oryx-lambda</td>
</tr>
</tbody>
</table>
<p>æ”¯æŒçš„æ¨¡å‹ï¼Œæ¯”å¦‚ï¼š<a href="https://github.com/OryxProject/oryx/tree/master/framework/oryx-common" target="_blank" rel="external">oryx-common</a>, <a href="https://github.com/OryxProject/oryx/tree/master/app/oryx-app-common" target="_blank" rel="external">oryx-app-common</a>, <a href="https://github.com/OryxProject/oryx/tree/master/framework/oryx-api" target="_blank" rel="external">oryx-api</a>, and <a href="https://github.com/OryxProject/oryx/tree/master/app/oryx-app-api" target="_blank" rel="external">oryx-app-api</a> æ²¡æœ‰åœ¨è¿™é‡Œåˆ—å‡ºäº†ã€‚</p>
<h2 id="u5B9E_u73B0_u4E00_u4E2AOryx__u7A0B_u5E8F"><a href="#u5B9E_u73B0_u4E00_u4E2AOryx__u7A0B_u5E8F" class="headerlink" title="å®ç°ä¸€ä¸ªOryx ç¨‹åº"></a>å®ç°ä¸€ä¸ªOryx ç¨‹åº</h2><p>Oryx ä¸­çš„â€œapp å±‚â€ï¼Œæ˜¯å®ç°äº†æ¨èçš„çœŸå®çš„æ‰¹å¤„ç†ï¼Œå®æ—¶ï¼ŒæœåŠ¡å±‚é€»è¾‘ï¼Œé›†ç¾¤å’Œåˆ†ç±»ã€‚ç„¶è€Œï¼Œä»»ä½•å®ç°éƒ½éœ€è¦ä½¿ç”¨åˆ°Oryxã€‚ä»–ä»¬ä¹Ÿå¯ä»¥æ··åˆå’ŒåŒ¹é…ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œä½ å¯ä»¥é‡æ–°å®ç°ALS-relatedæ¨èçš„æ‰¹å¤„ç†å±‚ï¼Œä½†æ˜¯ä»ç„¶ä½¿ç”¨åŸæ¥çš„ALSçš„æœåŠ¡å±‚å’Œå®æ—¶è®¡ç®—å±‚ã€‚</p>
<h3 id="u521B_u5EFA_u4E00_u4E2A_u7A0B_u5E8F"><a href="#u521B_u5EFA_u4E00_u4E2A_u7A0B_u5E8F" class="headerlink" title="åˆ›å»ºä¸€ä¸ªç¨‹åº"></a>åˆ›å»ºä¸€ä¸ªç¨‹åº</h3><p>åœ¨æ¯ä¸ªä¾‹å­ä¸­ï¼Œåˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰çš„æ‰¹å¤„ç†å±‚ï¼Œå®æ—¶è®¡ç®—å±‚æˆ–è€…æœåŠ¡å±‚çš„ç¨‹åºéƒ½éœ€è¦å®ç°com.cloudera.oryx.apiä¸­çš„å‡ ä¸ªå…³é”®çš„Javaæ¥å£æˆ–è€…Scalaçš„ç‰¹æ€§ã€‚è¿™äº›æ¥å£/ç‰¹æ€§å¯ä»¥åœ¨é¡¹ç›®çš„oryx-apiæ¨¡å‹ä¸­æ‰¾åˆ°ã€‚</p>
<table>
<thead>
<tr>
<th></th>
<th>Java</th>
<th>Scala</th>
</tr>
</thead>
<tbody>
<tr>
<td>Batch</td>
<td>batch.BatchLayerUpdate</td>
<td>batch.ScalaBatchLayerUpdate</td>
</tr>
<tr>
<td>Speed</td>
<td>speed.SpeedModelManager</td>
<td>speed.ScalaSpeedModelManager</td>
</tr>
<tr>
<td>Serving</td>
<td>serving.ServingModelManager</td>
<td>serving.ScalaServingModelManager</td>
</tr>
</tbody>
</table>
<p>com.cloudera.oryx.apiä¹ŸåŒ…å«å¤§é‡çš„å…³é”®çš„ç±»å’Œæ¥å£ï¼Œä¸¾ä¸ªä¾‹å­ï¼Œ<a href="https://github.com/OryxProject/oryx/blob/master/framework/oryx-api/src/main/java/com/cloudera/oryx/api/serving/OryxResource.java" target="_blank" rel="external">serving.OryxResource</a>  æ˜¯ä¸€ä¸ªå…¥å£ï¼Œç”¨æ¥ç¼–è¯‘è‡ªå®šä¹‰çš„JAX-RS ç«¯ç‚¹ï¼Œä½†æ˜¯ä¸éœ€è¦ä½¿ç”¨ã€‚</p>
<h3 id="u7F16_u8BD1_u7A0B_u5E8F"><a href="#u7F16_u8BD1_u7A0B_u5E8F" class="headerlink" title="ç¼–è¯‘ç¨‹åº"></a>ç¼–è¯‘ç¨‹åº</h3><p>è¿›å…¥ä½ çš„ç¨‹åºçš„è¿™äº›æ¥å£/ç‰¹æ€§ï¼Œæ·»åŠ ä¸€ä¸ªcom.cloudera.oryx:oryx-apiçš„ä¾èµ–ï¼Œscopeå­—æ®µéœ€è¦å¡«å†™â€œprovidedâ€ï¼Œåœ¨Mavenä¸­ï¼Œéœ€è¦æ·»åŠ å¦‚ä¸‹ä¾èµ–ï¼š<br>In Maven, this would mean adding a dependency like:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">dependencies</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">groupId</span>&gt;</span>com.cloudera.oryx<span class="tag">&lt;/<span class="title">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">artifactId</span>&gt;</span>oryx-api<span class="tag">&lt;/<span class="title">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="title">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">version</span>&gt;</span>2.1.2<span class="tag">&lt;/<span class="title">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="title">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>è¿™äº›artifactsè¢«æ”¾åœ¨äº†<a href="https://repository.cloudera.com/artifactory/cloudera-repos/" target="_blank" rel="external">Cloudera</a>è¿™ä¸ªåˆ†æ”¯ä¸‹ï¼Œå› æ­¤åœ¨ç¼–è¯‘çš„æ—¶å€™éœ€è¦å¼•ç”¨è¿™ä¸ªåˆ†æ”¯ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">repositories</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">repository</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">id</span>&gt;</span>cloudera<span class="tag">&lt;/<span class="title">id</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">url</span>&gt;</span>https://repository.cloudera.com/artifactory/cloudera-repos/<span class="tag">&lt;/<span class="title">url</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="title">repository</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">repositories</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>ä¸€ä¸ªæœ€å°çš„å®ä¾‹å¯ä»¥è®¿é—®<a href="https://github.com/OryxProject/oryx/tree/master/app/example" target="_blank" rel="external">example/</a> è¿™é‡Œã€‚</p>
<p>â€Word Countâ€ è¿™ä¸ªç¨‹åºæ˜¯æŒ‰ç…§ç©ºæ ¼å°†è¡Œåˆ†å‰²æˆç‹¬ç«‹çš„å•è¯ï¼Œç„¶åç»Ÿè®¡å‡ºæ’é‡åçš„å•è¯å‡ºç°çš„æ¬¡æ•°ã€‚</p>
<p>ç¼–è¯‘ä»£ç åç”Ÿæˆä¸€ä¸ªJARæ–‡ä»¶ï¼ŒåŒ…å«äº†ç¨‹åºå®ç°å’Œæ‰€æœ‰ç¬¬ä¸‰æ–¹çš„diamï¼Œå¦‚æœä½¿ç”¨Mavenï¼Œå¯ä»¥é€šè¿‡mvn packageå‘½ä»¤ã€‚</p>
<h3 id="u7F16_u8BD1_Word_Count__u4F8B_u5B50"><a href="#u7F16_u8BD1_Word_Count__u4F8B_u5B50" class="headerlink" title="ç¼–è¯‘ Word Count ä¾‹å­"></a>ç¼–è¯‘ Word Count ä¾‹å­</h3><p>ä¸¾ä¾‹ï¼šç¼–è¯‘æ ·ä¾‹ä»£ç å¦‚ä¸‹ï¼š<br><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cd</span> <span class="keyword">app</span>/example</span><br><span class="line">mvn package</span><br></pre></td></tr></table></figure></p>
<p>ç”Ÿæˆçš„JARåŒ…åœ¨target/example-2.1.2.jarã€‚</p>
<h3 id="u81EA_u5B9A_u4E49Oryx_u7A0B_u5E8F"><a href="#u81EA_u5B9A_u4E49Oryx_u7A0B_u5E8F" class="headerlink" title="è‡ªå®šä¹‰Oryxç¨‹åº"></a>è‡ªå®šä¹‰Oryxç¨‹åº</h3><p>å½“å‘å¸ƒä¸€ä¸ªæºè‡ªOryxçš„é¢„æ‰“åŒ…ç¨‹åºï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæœ‰å¯èƒ½ä¼šæä¾›ä¸€ä¸ªæ‰©å±•çš„å®ç°ï¼Œä»è€Œå¯ä»¥è‡ªå®šä¹‰ä»–ä»¬çš„è¡Œä¸ºã€‚ä¸¾ä¾‹ï¼ŒALSæ¨èç¨‹åºæš´éœ²äº†com.cloudera.oryx.app.als.RescorerProvideræ¥å£ã€‚è¿™äº›ç‰¹å®šç¨‹åºAPIç±»å¯ä»¥åœ¨æ¨¡å—oryx-app-apiä¸­æ‰¾åˆ°ã€‚è¿™äº›æ¥å£çš„å®ç°ä¹Ÿå¯ä»¥åœ¨ç‹¬ç«‹æ¨¡å¼ä¸‹è¢«ç¼–è¯‘ï¼Œæ‰“åŒ…ï¼Œéƒ¨ç½²ã€‚</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">dependencies</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">groupId</span>&gt;</span>com.cloudera.oryx<span class="tag">&lt;/<span class="title">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">artifactId</span>&gt;</span>oryx-app-api<span class="tag">&lt;/<span class="title">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="title">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">version</span>&gt;</span>2.1.2<span class="tag">&lt;/<span class="title">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="title">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="u53D1_u5E03_u7A0B_u5E8F"><a href="#u53D1_u5E03_u7A0B_u5E8F" class="headerlink" title="å‘å¸ƒç¨‹åº"></a>å‘å¸ƒç¨‹åº</h2><p>æ‹·è´ç”Ÿæˆçš„JARæ–‡ä»¶â€“myapp.jarï¼Œæ”¾åˆ°éœ€è¦æ‰§è¡Œçš„Oryx äºŒè¿›åˆ¶JARæ–‡ä»¶ç›¸åŒçš„ç›®å½•ä¸‹ã€‚</p>
<p>ä¿®æ”¹Oryxçš„é…ç½®æ–‡ä»¶ï¼Œä»¥ä¾¿äºå¼•ç”¨è‡ªå®šä¹‰çš„æ‰¹å¤„ç†ï¼Œå®æ—¶è®¡ç®—å’ŒæœåŠ¡å±‚çš„å®ç°ã€‚<br>å½“æ‰§è¡Œæ‰¹å¤„ç†ï¼Œå®æ—¶è®¡ç®—å’ŒæœåŠ¡å±‚æ—¶ï¼Œéœ€è¦æ·»åŠ â€“app-jar myapp.jaråˆ°oryx-run.shå‘½ä»¤è¡Œä¸­ã€‚</p>
<h3 id="u53D1_u5E03_Word_Count__u4F8B_u5B50"><a href="#u53D1_u5E03_Word_Count__u4F8B_u5B50" class="headerlink" title="å‘å¸ƒ Word Count ä¾‹å­"></a>å‘å¸ƒ Word Count ä¾‹å­</h3><p>ä¸¾ä¾‹ï¼Œå¦‚æœå·²ç»ç¼–è¯‘å¥½äº†ä¸Šè¿°çš„â€œword countâ€çš„ç¨‹åºï¼Œä½ å¯ä»¥æ‰§è¡Œè¿™ä¸ªç¨‹åºï¼Œç›´æ¥å¼•ç”¨wordcount-example.confè¿™ä¸ªé…ç½®æ–‡ä»¶ï¼š</p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./oryx-<span class="keyword">run</span>.<span class="keyword">sh</span> batch --<span class="keyword">conf</span> wordcount-example.<span class="keyword">conf</span> --<span class="keyword">app</span>-jar example-2.1.2.jar</span><br></pre></td></tr></table></figure>
<p>â€¦ å¯¹äºå®æ—¶è®¡ç®—å’ŒæœåŠ¡å±‚ä¹Ÿæ˜¯åŒæ ·çš„ã€‚</p>
<figure class="highlight nimrod"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">curl -X <span class="type">POST</span> http://.../add/foo%<span class="number">20</span>bar%<span class="number">20</span>baz</span><br><span class="line">...</span><br><span class="line">curl http://.../<span class="keyword">distinct</span></span><br><span class="line">&#123;<span class="string">"foo"</span>:<span class="number">2</span>,<span class="string">"bar"</span>:<span class="number">2</span>,<span class="string">"baz"</span>:<span class="number">2</span>&#125;</span><br></pre></td></tr></table></figure>
<p>é…ç½®æ–‡ä»¶æœ¬èº«å·²ç»é…ç½®å¥½äº†ä¸»æœºåç§°å’Œ<a href="http://www.cloudera.com/content/www/en-us/downloads/quickstart_vms.html" target="_blank" rel="external">Cloudera Quickstart VM</a>çš„å‚æ•°ã€‚äº‹å®ä¸Šï¼Œè¿™ä¸ªä¾‹å­å¯ä»¥ä½œä¸ºä¸€ä¸ªé›†ç¾¤é…ç½®çš„ä¾‹å­ï¼š<a href="http://oryx.io/docs/admin.html#cloudera_quickstart_vm_setup" target="_blank" rel="external">Cloudera Quickstart VM Setup</a>ã€‚</p>
]]></content>
    <summary type="html">
    <![CDATA[<!--  -->
<!--  -->
<!--  _ __    __     __      ____    ___     ___   _____   __  __    ___     -->
<!-- /\`'__\/'__`\ /'__`\   /',__\  / _]]>
    </summary>
    
      <category term="Admin" scheme="http://reasonpun.com/tags/Admin/"/>
    
      <category term="Hadoop" scheme="http://reasonpun.com/tags/Hadoop/"/>
    
      <category term="Oryx2" scheme="http://reasonpun.com/tags/Oryx2/"/>
    
      <category term="Spark" scheme="http://reasonpun.com/tags/Spark/"/>
    
      <category term="Spark-Streaming" scheme="http://reasonpun.com/tags/Spark-Streaming/"/>
    
      <category term="documentation" scheme="http://reasonpun.com/tags/documentation/"/>
    
      <category term="æ•°æ®æŒ–æ˜" scheme="http://reasonpun.com/categories/%E6%95%B0%E6%8D%AE%E6%8C%96%E6%8E%98/"/>
    
      <category term="å®æ—¶è®¡ç®—" scheme="http://reasonpun.com/categories/%E6%95%B0%E6%8D%AE%E6%8C%96%E6%8E%98/%E5%AE%9E%E6%97%B6%E8%AE%A1%E7%AE%97/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[Oryx2 ç»ˆç«¯ç”¨æˆ·æ–‡æ¡£]]></title>
    <link href="http://reasonpun.com/2016/04/06/Oryx2-%E7%BB%88%E7%AB%AF%E7%94%A8%E6%88%B7%E6%96%87%E6%A1%A3/"/>
    <id>http://reasonpun.com/2016/04/06/Oryx2-ç»ˆç«¯ç”¨æˆ·æ–‡æ¡£/</id>
    <published>2016-04-06T07:18:22.000Z</published>
    <updated>2016-04-06T09:54:44.000Z</updated>
    <content type="html"><![CDATA[<!--  -->
<!--  -->
<!--  _ __    __     __      ____    ___     ___   _____   __  __    ___     -->
<!-- /\`'__\/'__`\ /'__`\   /',__\  / __`\ /' _ `\/\ '__`\/\ \/\ \ /' _ `\   -->
<!-- \ \ \//\  __//\ \L\.\_/\__, `\/\ \L\ \/\ \/\ \ \ \L\ \ \ \_\ \/\ \/\ \  -->
<!--  \ \_\\ \____\ \__/.\_\/\____/\ \____/\ \_\ \_\ \ ,__/\ \____/\ \_\ \_\ -->
<!--   \/_/ \/____/\/__/\/_/\/___/  \/___/  \/_/\/_/\ \ \/  \/___/  \/_/\/_/ -->
<!--                                                 \ \_\                   -->
<!--                                                  \/_/                   -->
<!--  -->
<h3 id="u8FD0_u884C"><a href="#u8FD0_u884C" class="headerlink" title="è¿è¡Œ"></a>è¿è¡Œ</h3><p>æ³¨æ„ï¼šä½ å¿…é¡»å·²ç»æŒ‰ç…§<a href="http://reasonpun.com/2015/12/21/Oryx2-Admin-Docs/">ç®¡ç†å‘˜æ–‡æ¡£</a>ä¸­æåˆ°çš„é…ç½®å¥½äº†ä½ çš„é›†ç¾¤ã€‚</p>
<p>ä¸‹è½½æœ€æ–°çš„Oryxç‰ˆæœ¬ï¼ŒåŒ…æ‹¬æ‰¹å¤„ç†å±‚ï¼Œå®æ—¶è®¡ç®—å±‚å’ŒæœåŠ¡å±‚çš„jaræ–‡ä»¶å’Œshè„šæœ¬ã€‚</p>
<p>æˆ–è€…ï¼Œæºç ç¼–è¯‘ä»–ä»¬å¹¶ä»deploy/bin/è·å–æœ€æ–°çš„è„šæœ¬ã€‚</p>
<p>æ‹·è´äºŒè¿›åˆ¶å’Œè„šæœ¬åˆ°hadoopé›†ç¾¤çš„æœºå™¨ä¸Šã€‚ä»–ä»¬å¯ä»¥ä¼šè¢«éƒ¨ç½²åˆ°ä¸åŒçš„æœºå™¨ï¼Œæˆ–è€…æ˜¯è¢«éƒ¨ç½²åˆ°ä¸€ä¸ªæµ‹è¯•æœºå™¨ä¸Šã€‚å®æ—¶å’Œæ‰¹å¤„ç†å±‚åº”è¯¥è¿è¡Œä¸”åªèƒ½è¿è¡Œåœ¨ä¸€å°æœºå™¨ä¸Šï¼ˆThe Speed and Batch Layers should run on at most one machine, eachï¼‰ï¼ŒæœåŠ¡å±‚åˆ™å¯ä»¥è¿è¡Œäºå¤šä¸ªèŠ‚ç‚¹ä¸Šã€‚</p>
<p>åˆ›å»ºä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼Œå¯ä»¥ç®€å•çš„æ‹·è´ä¾‹å­ä¸­çš„conf/als-example.confã€‚å¹¶ä¿®æ”¹hoståç§°ï¼Œç«¯å£å’Œç›®å½•ã€‚å®é™…ä¸Šï¼Œé€‰æ‹©hdfsä¸Šå·²ç»å­˜åœ¨çš„æ•°æ®å’Œæ¨¡å‹ç›®å½•ä¾¿äºç”¨æˆ·è¿è¡ŒOryx äºŒè¿›åˆ¶å‘½ä»¤ã€‚</p>
<p>æ‹·è´è¯¥é…ç½®æ–‡ä»¶ï¼Œå¹¶é‡å‘½åä¸ºoryx.confï¼Œå°†ä»–æ”¾åˆ°æ¯ä¸ªæœºå™¨çš„ä¸ŠäºŒè¿›åˆ¶å‘½ä»¤å’Œè„šæœ¬ç›¸åŒçš„ç›®å½•ä¸‹ã€‚</p>
<p>æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤å¼€å§‹è¿™3ä¸ªå±‚çš„è¿è¡Œï¼š</p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">./oryx-<span class="keyword">run</span>.<span class="keyword">sh</span> batch</span><br><span class="line">./oryx-<span class="keyword">run</span>.<span class="keyword">sh</span> speed</span><br><span class="line">./oryx-<span class="keyword">run</span>.<span class="keyword">sh</span> serving</span><br></pre></td></tr></table></figure>
<p>å‚æ•°â€“layer-jar your-layer.jar and â€“conf your-config.confå¯ä»¥æŒ‡å®šæŸä¸€å±‚ç‰¹å®šä½ç½®çš„jaræ–‡ä»¶å’Œé…ç½®æ–‡ä»¶ã€‚ä¹Ÿå¯ä»¥ä½¿ç”¨â€“jvm-argsç›´æ¥ä¼ é€’æ›´å¤šçš„å‚æ•°ç»™Sparké©±åŠ¨ç¨‹åºï¼Œæ¯”å¦‚ï¼šâ€“jvm-args=â€-Dkey=valueâ€</p>
<p>è¿™éƒ½ä¸éœ€è¦åœ¨åŒä¸€å°æœºå™¨ä¸Šï¼Œä½†æ˜¯ä¹Ÿä¸ä¸€å®šï¼ˆå¦‚æœé…ç½®ç‰¹æ®ŠæŒ‡å®šæ‰¹å¤„ç†å’Œå®æ—¶å¤„ç†å±‚ï¼ŒæœåŠ¡å±‚APIä¸åŒçš„ç«¯å£ï¼‰ã€‚æœåŠ¡å±‚å¯ä»¥è¿è¡Œåœ¨å¤šä¸ªæœºå™¨ä¸Šã€‚</p>
<p>ä¸¾ä¸ªä¾‹å­ï¼Œæ‰¹å¤„ç†å±‚SparkUIè¿è¡Œåœ¨å¯åŠ¨è„šæœ¬æ‰€åœ¨çš„æœºå™¨çš„4040ç«¯å£ï¼ˆé™¤éé€šè¿‡é…ç½®æ›´æ”¹ï¼‰ã€‚ä¸€ä¸ªç®€å•çš„åŸºäºwebç«¯çš„æ§åˆ¶å°çš„æœåŠ¡å±‚é»˜è®¤æ˜¯è¿è¡Œåœ¨8080ç«¯å£çš„ã€‚</p>
<p>å®Œç¾ï¼</p>
<h3 id="u5C1D_u8BD5_u4E0BALS_u7684_u4F8B_u5B50_u5427"><a href="#u5C1D_u8BD5_u4E0BALS_u7684_u4F8B_u5B50_u5427" class="headerlink" title="å°è¯•ä¸‹ALSçš„ä¾‹å­å§"></a>å°è¯•ä¸‹ALSçš„ä¾‹å­å§</h3><p>å¦‚æœä½ å·²ç»ä½¿ç”¨äº†ä¸Šè¿°çš„é…ç½®ï¼Œä½ å°±å·²ç»å¯ä»¥è¿è¡Œä¸€ä¸ªåŸºäºALSçš„æ¨èç¨‹åºå®ä¾‹ã€‚<br>è‡ªè·å–GroupLens 100Kçš„æ•°æ®é›†ï¼Œå¹¶ä¸”æ‰¾åˆ°u.dataæ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶çš„å†…å®¹éœ€è¦è½¬æ¢æˆcsvæ ¼å¼ï¼š</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">tr</span> <span class="string">'\t'</span> <span class="string">','</span> &lt; u<span class="class">.data</span> &gt; data.csv</span><br></pre></td></tr></table></figure>
<p>å°†è¿™äº›æ•°æ®æ”¾å…¥æœåŠ¡å±‚ï¼Œä½¿ç”¨æœ¬åœ°çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wget --quiet --post-file data<span class="class">.csv</span> --output-document - \</span><br><span class="line">  --<span class="tag">header</span> <span class="string">"Content-Type: text/csv"</span> \</span><br><span class="line">  http:<span class="comment">//your-serving-layer:8080/ingest</span></span><br></pre></td></tr></table></figure>
<p>å¦‚æœä½ ä½¿ç”¨tailå‘½ä»¤æŸ¥çœ‹è¾“å…¥çš„å†…å®¹ï¼Œå¯ä»¥çœ‹åˆ°å¦‚ä¸‹æ•°æ®ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">196</span>,<span class="number">242</span>,<span class="number">3.0</span>,<span class="number">881250949186</span></span><br><span class="line"><span class="number">196</span>,<span class="number">242</span>,<span class="number">3.0</span>,<span class="number">881250949</span></span><br><span class="line"><span class="number">186</span>,<span class="number">302</span>,<span class="number">3.0</span>,<span class="number">891717742</span></span><br><span class="line"><span class="number">22</span>,<span class="number">377</span>,<span class="number">1.0</span>,<span class="number">878887116</span></span><br><span class="line"><span class="number">244</span>,<span class="number">51</span>,<span class="number">2.0</span>,<span class="number">880606923</span></span><br><span class="line"><span class="number">166</span>,<span class="number">346</span>,<span class="number">1.0</span>,<span class="number">886397596</span></span><br><span class="line"><span class="number">298</span>,<span class="number">474</span>,<span class="number">4.0</span>,<span class="number">884182806</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>å¾ˆå¿«çš„ï¼Œä½ ä¹Ÿå¯ä»¥çœ‹åˆ°æ‰¹å¤„ç†å±‚å·²ç»å¼€å§‹è§¦å‘ä¸€ä¸ªæ–°çš„è®¡ç®—äº†ã€‚è¿™ä¸ªä¾‹å­è¢«é…ç½®ä¸º5åˆ†é’Ÿä¸€ä¸ªå‘¨æœŸã€‚</p>
<p>æ•°æ®é¦–å…ˆä¼šè¢«å†™å…¥HDFSã€‚é»˜è®¤é…ç½®è¢«å†™å…¥hdfs:///user/example/Oryx/data/ç›®å½•ä¸‹ã€‚ä¸”ç›®å½•ä»¥æ—¶é—´æˆ³å‘½åï¼Œæ¯ä¸€éƒ¨åˆ†éƒ½åŒ…å«Hadoop part-r-* æ–‡ä»¶ï¼Œéƒ½æ˜¯ä»¥æ–‡æœ¬çš„åºåˆ—è¯æ–‡ä»¶çš„æ–¹å¼å­˜å‚¨ã€‚è™½ç„¶ä¸æ˜¯çº¯æ–‡æœ¬ï¼Œæ‰“å°å‡ºæ¥çš„è¯ï¼Œè¿˜æ˜¯æœ‰ä¸€éƒ¨åˆ†æ˜¯å¯ä»¥è¯†åˆ«çš„ï¼Œå› ä¸ºè¿™å…¶å®çœŸçš„æ˜¯æ–‡æœ¬ã€‚</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SEQorg<span class="class">.apache</span><span class="class">.hadoop</span><span class="class">.io</span><span class="class">.Text</span>org<span class="class">.apache</span><span class="class">.hadoop</span><span class="class">.io</span><span class="class">.Text</span>ï¿½ï¿½ï¿½ï¿½^ï¿½]ï¿½XØ³Nï¿½<span class="number">22</span>,<span class="number">377</span>,<span class="number">1.0</span>,<span class="number">878887116</span><span class="number">62</span>...</span><br></pre></td></tr></table></figure>
<p>æ¨¡å‹è®¡ç®—å¼€å§‹ã€‚è¿™äº›æ‰¹å¤„ç†å±‚ä¼šä»¥å¤§é‡çš„æ–°çš„åˆ†å¸ƒå¼çš„ä½œä¸šå½¢å¼å±•ç°ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼ŒSpark UIå¯ä»¥é€šè¿‡<a href="http://your-batch-layer:4040è®¿é—®ã€‚" target="_blank" rel="external">http://your-batch-layer:4040è®¿é—®ã€‚</a></p>
<p>æ¨¡å‹è®¡ç®—æ˜¯éå¸¸å¿«çš„ï¼Œæ‰§è¡Œå®Œæ¯•ä»¥åä¼šåˆå¹¶PMMLå’Œæ”¯æŒæ•°æ®æ–‡ä»¶å¹¶å­˜å‚¨åˆ°ç›®å½•hdfs:///user/example/Oryx/model/ä¸‹ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œmodel.pmml çš„å†…å®¹å¦‚ä¸‹ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="pi">&lt;?xml version="1.0" encoding="UTF-8" standalone="yes"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">PMML</span> <span class="attribute">xmlns</span>=<span class="value">"http://www.dmg.org/PMML-4_2"</span> <span class="attribute">version</span>=<span class="value">"4.2.1"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">Header</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">Application</span> <span class="attribute">name</span>=<span class="value">"Oryx"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">Timestamp</span>&gt;</span>2014-12-18T04:48:54-0800<span class="tag">&lt;/<span class="title">Timestamp</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="title">Header</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">Extension</span> <span class="attribute">name</span>=<span class="value">"X"</span> <span class="attribute">value</span>=<span class="value">"X/"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">Extension</span> <span class="attribute">name</span>=<span class="value">"Y"</span> <span class="attribute">value</span>=<span class="value">"Y/"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">Extension</span> <span class="attribute">name</span>=<span class="value">"features"</span> <span class="attribute">value</span>=<span class="value">"10"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">Extension</span> <span class="attribute">name</span>=<span class="value">"lambda"</span> <span class="attribute">value</span>=<span class="value">"0.001"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">Extension</span> <span class="attribute">name</span>=<span class="value">"implicit"</span> <span class="attribute">value</span>=<span class="value">"true"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">Extension</span> <span class="attribute">name</span>=<span class="value">"alpha"</span> <span class="attribute">value</span>=<span class="value">"1.0"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">Extension</span> <span class="attribute">name</span>=<span class="value">"XIDs"</span>&gt;</span>56 168 222 343 397 ...</span><br><span class="line">     ...</span><br></pre></td></tr></table></figure>
<p>The X/ and Y/ subdirectories next to it contain feature vectors, like:</p>
<figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[56,[<span class="number">0.57462828</span><span class="number">34154238</span>,-<span class="number">0.088966141</span><span class="number">31333057</span>,-<span class="number">0.029456222</span><span class="number">765775263</span>,</span><br><span class="line">  <span class="number">0.603982121</span><span class="number">9690552,0</span>.<span class="number">149790181477</span>4658,-<span class="number">0.01865431</span><span class="number">2114339863</span>,</span><br><span class="line">  -<span class="number">0.37342063</span><span class="number">488340266</span>,-<span class="number">0.237076884</span><span class="number">3521807,1</span>.<span class="number">148260034028</span>485,</span><br><span class="line">  <span class="number">1.06456436</span><span class="number">56769153</span>]]</span><br><span class="line">[168,[<span class="number">0.87227698</span><span class="number">82777296,0</span>.<span class="number">43704169430</span><span class="number">31704,0.27</span><span class="number">40204446154</span>9885,</span><br><span class="line">  -<span class="number">0.031252701</span><span class="number">117490456</span>,-<span class="number">0.724138575</span><span class="number">3098256,0</span>.<span class="number">02607908100</span><span class="number">2582338</span>,</span><br><span class="line">  <span class="number">0.42050973</span><span class="number">702065714</span>,<span class="number">0.277669233</span><span class="number">96205817,0</span>.<span class="number">6241033215856</span>671,</span><br><span class="line">  -<span class="number">0.48530795</span><span class="number">198811266</span>]]</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>å¦‚æœä½¿ç”¨tailå‘½ä»¤æŸ¥çœ‹æ›´æ–°çš„å†…å®¹ã€‚<br>è¿™äº›æ•°æ®ä¼šå¾ˆå¿«æ”¾å…¥æœåŠ¡å±‚ï¼Œæ­¤æ—¶è®¿é—®/readyä¼šè¿”å›200 OKã€‚</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">wget --quiet --output-document - --server-response \</span><br><span class="line">  http:<span class="comment">//your-serving-layer:8080/ready</span></span><br><span class="line">...</span><br><span class="line">  HTTP/<span class="number">1.1</span> <span class="number">200</span> OK</span><br><span class="line">  Content-Length: <span class="number">0</span></span><br><span class="line">  Date: Tue, <span class="number">1</span> Sep <span class="number">2015</span> <span class="number">13</span>:<span class="number">26</span>:<span class="number">53</span> GMT</span><br><span class="line">  Server: Oryx</span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">wget --quiet --output-document -  http:<span class="comment">//your-serving-layer:8080/recommend/17</span></span><br><span class="line">...</span><br><span class="line"><span class="number">50</span>,<span class="number">0.7749542842056966</span></span><br><span class="line"><span class="number">275</span>,<span class="number">0.7373013861581563</span></span><br><span class="line"><span class="number">258</span>,<span class="number">0.731818692628511</span></span><br><span class="line"><span class="number">181</span>,<span class="number">0.7049967175706345</span></span><br><span class="line"><span class="number">127</span>,<span class="number">0.704518989947498</span></span><br><span class="line"><span class="number">121</span>,<span class="number">0.7014631029793741</span></span><br><span class="line"><span class="number">15</span>,<span class="number">0.6954683387287907</span></span><br><span class="line"><span class="number">288</span>,<span class="number">0.6774889711024022</span></span><br><span class="line"><span class="number">25</span>,<span class="number">0.6663619887033064</span></span><br><span class="line"><span class="number">285</span>,<span class="number">0.6398968471343595</span></span><br></pre></td></tr></table></figure>
<p>æ­å–œï¼å®æ—¶æ¨èç³»ç»Ÿæ­å»ºå®Œæ¯•ï¼å¯ä»¥é€šè¿‡Ctrl-Cå…³é—­ã€‚</p>
<h3 id="API_u624B_u518C"><a href="#API_u624B_u518C" class="headerlink" title="APIæ‰‹å†Œ"></a>APIæ‰‹å†Œ</h3><p>Oryx æ”¯æŒå¤šç§ç«¯åˆ°ç«¯çš„ç¨‹åºï¼ŒåŒ…æ‹¬æœåŠ¡å±‚çš„REST æ¥å£ã€‚</p>
<h3 id="u534F_u540C_u8FC7_u6EE4_u548C_u63A8_u8350"><a href="#u534F_u540C_u8FC7_u6EE4_u548C_u63A8_u8350" class="headerlink" title="ååŒè¿‡æ»¤å’Œæ¨è"></a>ååŒè¿‡æ»¤å’Œæ¨è</h3><ul>
<li><a href="http://oryx.io/apidocs/com/cloudera/oryx/app/serving/als/Recommend.html" target="_blank" rel="external">/recommend</a></li>
<li><a href="http://oryx.io/apidocs/com/cloudera/oryx/app/serving/als/RecommendToMany.html" target="_blank" rel="external">/recommendToMany</a></li>
<li><a href="http://oryx.io/apidocs/com/cloudera/oryx/app/serving/als/RecommendToAnonymous.html" target="_blank" rel="external">/recommendToAnonymous</a></li>
<li><a href="http://oryx.io/apidocs/com/cloudera/oryx/app/serving/als/RecommendWithContext.html" target="_blank" rel="external">/recommendWithContext</a></li>
<li><a href="http://oryx.io/apidocs/com/cloudera/oryx/app/serving/als/Similarity.html" target="_blank" rel="external">/similarity</a></li>
<li><a href="http://oryx.io/apidocs/com/cloudera/oryx/app/serving/als/SimilarityToItem.html" target="_blank" rel="external">/similarityToItem</a></li>
<li><a href="http://oryx.io/apidocs/com/cloudera/oryx/app/serving/als/KnownItems.html" target="_blank" rel="external">/knownItems</a></li>
<li><a href="http://oryx.io/apidocs/com/cloudera/oryx/app/serving/als/Estimate.html" target="_blank" rel="external">/estimate</a></li>
<li><a href="http://oryx.io/apidocs/com/cloudera/oryx/app/serving/als/EstimateForAnonymous.html" target="_blank" rel="external">/estimateForAnonymous</a></li>
<li><a href="http://oryx.io/apidocs/com/cloudera/oryx/app/serving/als/Because.html" target="_blank" rel="external">/because</a></li>
<li><a href="http://oryx.io/apidocs/com/cloudera/oryx/app/serving/als/MostSurprising.html" target="_blank" rel="external">/mostSurprising</a></li>
<li><a href="http://oryx.io/apidocs/com/cloudera/oryx/app/serving/als/PopularRepresentativeItems.html" target="_blank" rel="external">/popularRepresentativeItems</a></li>
<li><a href="http://oryx.io/apidocs/com/cloudera/oryx/app/serving/als/MostActiveUsers.html" target="_blank" rel="external">/mostActiveUsers</a></li>
<li><a href="http://oryx.io/apidocs/com/cloudera/oryx/app/serving/als/MostPopularItems.html" target="_blank" rel="external">/mostPopularItems</a></li>
<li><a href="http://oryx.io/apidocs/com/cloudera/oryx/app/serving/als/MostActiveUsers.html" target="_blank" rel="external">/mostActiveUsers</a></li>
<li><a href="http://oryx.io/apidocs/com/cloudera/oryx/app/serving/als/AllItemIDs.html" target="_blank" rel="external">/item/allIDs</a></li>
<li><a href="http://oryx.io/apidocs/com/cloudera/oryx/app/serving/als/Ready.html" target="_blank" rel="external">/ready</a></li>
<li><a href="http://oryx.io/apidocs/com/cloudera/oryx/app/serving/als/Preference.html" target="_blank" rel="external">/pref</a></li>
<li><a href="http://oryx.io/apidocs/com/cloudera/oryx/app/serving/als/Ingest.html" target="_blank" rel="external">/ingest</a></li>
</ul>
<h3 id="u5206_u7C7B_/__u56DE_u5F52"><a href="#u5206_u7C7B_/__u56DE_u5F52" class="headerlink" title="åˆ†ç±» / å›å½’"></a>åˆ†ç±» / å›å½’</h3><ul>
<li><a href="http://oryx.io/apidocs/com/cloudera/oryx/app/serving/rdf/Predict.html" target="_blank" rel="external">/predict</a></li>
<li><a href="http://oryx.io/apidocs/com/cloudera/oryx/app/serving/rdf/ClassificationDistribution.html" target="_blank" rel="external">/classificationDistribution</a></li>
<li><a href="http://oryx.io/apidocs/com/cloudera/oryx/app/serving/rdf/Ready.html" target="_blank" rel="external">/ready</a></li>
<li><a href="http://oryx.io/apidocs/com/cloudera/oryx/app/serving/rdf/Train.html" target="_blank" rel="external">/train</a></li>
</ul>
<h3 id="u805A_u7C7B"><a href="#u805A_u7C7B" class="headerlink" title="èšç±»"></a>èšç±»</h3><ul>
<li><a href="http://oryx.io/apidocs/com/cloudera/oryx/app/serving/kmeans/Assign.html" target="_blank" rel="external">/assign</a></li>
<li><a href="http://oryx.io/apidocs/com/cloudera/oryx/app/serving/kmeans/DistanceToNearest.html" target="_blank" rel="external">/distanceToNearest</a></li>
<li><a href="http://oryx.io/apidocs/com/cloudera/oryx/app/serving/kmeans/Ready.html" target="_blank" rel="external">/ready</a></li>
<li><a href="http://oryx.io/apidocs/com/cloudera/oryx/app/serving/kmeans/Add.html" target="_blank" rel="external">/add</a></li>
</ul>
<h3 id="u914D_u7F6E"><a href="#u914D_u7F6E" class="headerlink" title="é…ç½®"></a>é…ç½®</h3><ul>
<li><a href="https://github.com/OryxProject/oryx/blob/master/app/conf/als-example.conf" target="_blank" rel="external">app/conf/als-example.conf</a></li>
<li><a href="https://github.com/OryxProject/oryx/blob/master/app/conf/kmeans-example.conf" target="_blank" rel="external">app/conf/kmeans-example.conf</a></li>
<li><a href="https://github.com/OryxProject/oryx/blob/master/app/conf/rdf-example.conf" target="_blank" rel="external">app/conf/rdf-example.conf</a></li>
</ul>
]]></content>
    <summary type="html">
    <![CDATA[<!--  -->
<!--  -->
<!--  _ __    __     __      ____    ___     ___   _____   __  __    ___     -->
<!-- /\`'__\/'__`\ /'__`\   /',__\  / _]]>
    </summary>
    
      <category term="Admin" scheme="http://reasonpun.com/tags/Admin/"/>
    
      <category term="Hadoop" scheme="http://reasonpun.com/tags/Hadoop/"/>
    
      <category term="Oryx2" scheme="http://reasonpun.com/tags/Oryx2/"/>
    
      <category term="Spark" scheme="http://reasonpun.com/tags/Spark/"/>
    
      <category term="Spark-Streaming" scheme="http://reasonpun.com/tags/Spark-Streaming/"/>
    
      <category term="documentation" scheme="http://reasonpun.com/tags/documentation/"/>
    
      <category term="æ•°æ®æŒ–æ˜" scheme="http://reasonpun.com/categories/%E6%95%B0%E6%8D%AE%E6%8C%96%E6%8E%98/"/>
    
      <category term="å®æ—¶è®¡ç®—" scheme="http://reasonpun.com/categories/%E6%95%B0%E6%8D%AE%E6%8C%96%E6%8E%98/%E5%AE%9E%E6%97%B6%E8%AE%A1%E7%AE%97/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[Javaå…³é”®å­—volatile]]></title>
    <link href="http://reasonpun.com/2016/03/08/Java%E5%85%B3%E9%94%AE%E5%AD%97volatile/"/>
    <id>http://reasonpun.com/2016/03/08/Javaå…³é”®å­—volatile/</id>
    <published>2016-03-08T09:59:30.000Z</published>
    <updated>2016-03-15T07:19:35.000Z</updated>
    <content type="html"><![CDATA[<!--  -->
<!--  -->
<!--  _ __    __     __      ____    ___     ___   _____   __  __    ___     -->
<!-- /\`'__\/'__`\ /'__`\   /',__\  / __`\ /' _ `\/\ '__`\/\ \/\ \ /' _ `\   -->
<!-- \ \ \//\  __//\ \L\.\_/\__, `\/\ \L\ \/\ \/\ \ \ \L\ \ \ \_\ \/\ \/\ \  -->
<!--  \ \_\\ \____\ \__/.\_\/\____/\ \____/\ \_\ \_\ \ ,__/\ \____/\ \_\ \_\ -->
<!--   \/_/ \/____/\/__/\/_/\/___/  \/___/  \/_/\/_/\ \ \/  \/___/  \/_/\/_/ -->
<!--                                                 \ \_\                   -->
<!--                                                  \/_/                   -->
<!--  -->
<p>ç¿»è¯‘è‡ªï¼š<a href="http://tutorials.jenkov.com/java-concurrency/volatile.html" target="_blank" rel="external">http://tutorials.jenkov.com/java-concurrency/volatile.html</a></p>
<h3 id="Java_Volatile__u5173_u952E_u5B57"><a href="#Java_Volatile__u5173_u952E_u5B57" class="headerlink" title="Java Volatile å…³é”®å­—"></a>Java Volatile å…³é”®å­—</h3><p>Javaå…³é”®å­—volatileæ ‡è¯†ä¸€ä¸ªå˜é‡â€œè¢«å­˜å‚¨åœ¨ä¸»å†…å­˜ä¸­â€ã€‚æ›´å‡†ç¡®çš„è¯´æ³•æ˜¯ï¼šæ¯æ¬¡volatileå˜é‡ä¼šä»ä¸»å†…å­˜ä¸­è¯»å–ï¼Œè€Œä¸æ˜¯ä»CPUç¼“å­˜ï¼›æ¯æ¬¡volatileå˜é‡çš„å†™æ“ä½œä¼šå†™å…¥ä¸»å†…å­˜ï¼Œè€Œä¸ä»…ä»…æ˜¯CPUç¼“å­˜ã€‚</p>
<p>å®é™…ä¸Šï¼Œè‡ªJava5å¼€å§‹ï¼Œvolatileå…³é”®å­—ä¿è¯çš„æ˜¯volatileå£°æ˜çš„å˜é‡éƒ½æ˜¯å†™å…¥å’Œè¯»å–è‡ªä¸»å†…å­˜çš„ã€‚ä»¥ä¸‹å°†ä¼šè¯¦ç»†è®²è§£ã€‚</p>
<h3 id="Java_volatile_u4FDD_u8BC1_u53EF_u89C1_u6027"><a href="#Java_volatile_u4FDD_u8BC1_u53EF_u89C1_u6027" class="headerlink" title="Java volatileä¿è¯å¯è§æ€§"></a>Java volatileä¿è¯å¯è§æ€§</h3><p>Javaä¸­volatileå…³é”®å­—ä¿è¯äº†çº¿ç¨‹ä¹‹é—´å˜é‡ä¿®æ”¹çš„å¯è§æ€§ã€‚è¿™ä¸ªå¯èƒ½ä¼šæœ‰ç‚¹æŠ½è±¡ï¼Œå› æ­¤è®©æˆ‘è¯¦ç»†è®²è§£ä¸‹ã€‚</p>
<p>åœ¨å¤šçº¿ç¨‹ç¨‹åºä¸­ï¼Œç”±äºæ€§èƒ½çš„åŸå› ï¼Œåœ¨æ“ä½œévolatileå˜é‡çš„æ—¶å€™ï¼Œæ¯ä¸ªçº¿ç¨‹ä¼šå°†å˜é‡è‡ªä¸»å†…å­˜æ‹·è´ğŸˆ¯ï¸CPUç¼“å­˜ã€‚å¦‚æœä½ çš„è®¡ç®—æœºæ˜¯å¤šæ ¸çš„ï¼Œæ¯ä¸ªçº¿ç¨‹å°±ä¼šè¿è¡Œåœ¨ä¸åŒçš„CPUä¸Šã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ¯ä¸ªçº¿ç¨‹ä¼šæ‹·è´å˜é‡åˆ°ä¸åŒçš„CPUç¼“å­˜ä¸­ã€‚è§æ’å›¾ï¼š</p>
<img src="/images/volatile/java-volatile-1.png" title="volatile">
<p>ä½¿ç”¨évolatileå˜é‡ï¼Œå½“JVMè‡ªä¸»å†…å­˜è¯»å–æ•°æ®åˆ°CPUç¼“å­˜ï¼Œæˆ–è€…è‡ªCPUç¼“å­˜å†™å…¥ä¸»å†…å­˜æ—¶ï¼Œæ˜¯æ²¡æœ‰ä¿è¯çš„ã€‚è¿™å¯èƒ½ä¼šå¼•èµ·å¾ˆå¤šé—®é¢˜ï¼Œæ¥ä¸‹æ¥ç« èŠ‚ä¸­ä¼šé™åˆ°ã€‚</p>
<p>è®¾æƒ³ä¸€ç§æƒ…å†µï¼Œå¤šä¸ªçº¿ç¨‹å¯ä»¥è®¿é—®ç±»ä¼¼å¦‚ä¸‹çš„åŒä¸€ä¸ªå…±äº«å¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡åŒ…å«ä¸€ä¸ªè®¡æ•°å™¨å˜é‡ï¼š</p>
<figure class="highlight axapta"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SharedObject</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> counter = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¦ä¸€ä¸ªè®¾æƒ³ï¼Œåªæœ‰çº¿ç¨‹1æ”¹å˜è®¡æ•°å˜é‡ï¼Œä½†æ˜¯çº¿ç¨‹1å’Œçº¿ç¨‹2éƒ½å¯èƒ½ç»å¸¸è¯»å–è¿™ä¸ªè®¡æ•°å˜é‡ã€‚</p>
<p>å¦‚æœè®¡æ•°å˜é‡æ²¡æœ‰è¢«å£°æ˜ä¸ºvolatileï¼Œé‚£ä¹ˆè‡ªCPUç¼“å­˜å›å†™åˆ°ä¸»å†…å­˜çš„è¿‡ç¨‹ä¸­ï¼Œå°±æ— æ³•ä¿è¯è¿™ä¸ªè®¡æ•°å˜é‡çš„å€¼äº†ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒæŠ€æœ¯å˜é‡çš„å€¼åœ¨é€šè¿‡CPUç¼“å­˜å†™ä¼šä¸»å†…å­˜çš„è¿‡ç¨‹ä¸­å‘ç”Ÿäº†æ”¹å˜ã€‚å¦‚å›¾ï¼š</p>
<img src="/images/volatile/java-volatile-2.png" title="volatile 2">
<p>è¿™ä¸ªé—®é¢˜æ˜¯å› ä¸ºçº¿ç¨‹å¹¶æ²¡æœ‰å¾—åˆ°æœ€æ–°çš„å€¼ï¼Œå¦å¤–é‚£ä¸ªçº¿ç¨‹å¹¶æ²¡æœ‰å°†æœ€æ–°çš„å˜é‡å†™å›ä¸»å†…å­˜ï¼Œè¿™å°±æ˜¯æ‰€è°“çš„â€œå¯è§â€é—®é¢˜ã€‚æŸä¸€ä¸ªçº¿ç¨‹çš„æ›´æ–°å¹¶æ²¡æœ‰è¢«å¦å¤–çš„çº¿ç¨‹è·å–ã€‚</p>
<p>é€šè¿‡å£°æ˜è®¡æ•°å˜é‡ä¸ºvolatileï¼Œé‚£ä¹ˆè¿™ä¸ªè®¡æ•°å˜é‡æ‰€æœ‰çš„æ›´æ–°éƒ½ä¼šç«‹å³è¢«å†™å›ä¸»å†…å­˜ã€‚åŒæ—¶ï¼Œæ‰€æœ‰çš„è¯»æ“ä½œéƒ½ä¼šç›´æ¥é€šè¿‡ä¸»å†…å­˜ã€‚å¦‚ä¸‹æ—¢æ˜¯å¦‚ä½•å£°æ˜è®¡æ•°å˜é‡ä¸ºvolatileç±»å‹ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> SharedObject &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">volatile</span> <span class="keyword">int</span> counter = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å£°æ˜ä¸€ä¸ªå˜é‡ä¸ºvolatileç”±æ­¤å¯ä»¥ä¿è¯äº†å˜é‡çš„å†™æ“ä½œå¯¹äºå…¶ä»–çº¿ç¨‹éƒ½æ˜¯å¯è§çš„ã€‚</p>
<h3 id="The_Java_volatile_Happens-Before_Guarantee"><a href="#The_Java_volatile_Happens-Before_Guarantee" class="headerlink" title="The Java volatile Happens-Before Guarantee"></a>The Java volatile Happens-Before Guarantee</h3><p>è‡ªJava5å¼€å§‹ï¼Œvolatileå…³é”®å­—ä¿è¯çš„ä¸æ­¢æ˜¯å˜é‡çš„ä¸»å†…å­˜è¯»å’Œå†™ï¼Œå®é™…ä¸Šè¿˜åŒ…å«ï¼š</p>
<ul>
<li><p>å¦‚æœçº¿ç¨‹Aå†™å…¥ä¸€ä¸ªvolatileå˜é‡ï¼Œæ­¤æ—¶çº¿ç¨‹Bè¯»å–äº†ç›¸åŒçš„volatileå˜é‡ï¼Œé‚£ä¹ˆæ­¤æ—¶æ‰€æœ‰çš„å˜é‡åœ¨å†™å…¥volatileå˜é‡å‰å¯¹çº¿ç¨‹Aæ˜¯å¯è§çš„ï¼ŒåŒæ—¶ä¹Ÿå¯¹çº¿ç¨‹Båœ¨è¯»å–äº†volatileå˜é‡åä¹Ÿæ˜¯å¯è§çš„ã€‚</p>
</li>
<li><p>volatileå˜é‡çš„è¯»å†™æŒ‡ä»¤ä¸èƒ½ä¿ƒä½¿JVMé‡æ–°æ’åºï¼ˆåªè¦JVMå‘ç°æ’åºä¸ä¼šæ”¹å˜ç¨‹åºçš„è¡Œä¸ºï¼ŒåŸºäºæ€§èƒ½çš„åŸå› ï¼ŒJVMä¼šè¿›è¡Œæ’åºï¼‰ã€‚å‰åçš„æŒ‡ä»¤ä¼šè¢«æ’åºï¼Œä½†æ˜¯volatileå¾—è¯»å†™ä¸ä¼šæ··å…¥è¿™äº›æŒ‡ä»¤ã€‚æ— è®ºå¦‚ä½•ï¼ŒæŒ‡ä»¤éƒ½ä¼šfollowä¸€ä¸ªvolatileå˜é‡çš„è¯»å†™ï¼Œå¹¶ä¸”ä¿è¯è¿™ç§æ“ä½œå‘ç”Ÿåœ¨è¯»æˆ–è€…å†™ä¹‹åã€‚</p>
</li>
</ul>
<p>è¿™ä¸ªéœ€è¦æ›´æ·±å…¥çš„è§£é‡Šã€‚</p>
<p>å½“ä¸€ä¸ªçº¿ç¨‹å†™å…¥ä¸€ä¸ªvolatileå˜é‡æ—¶ï¼Œå¹¶ä¸æ­¢è¿™ä¸ªvolatileå˜é‡è‡ªå·±å†™å…¥äº†ä¸»å†…å­˜ã€‚åŒæ—¶æ‰€æœ‰è¢«çº¿ç¨‹ä¿®æ”¹çš„å˜é‡åœ¨å†™å…¥volatileå˜é‡ä¹‹å‰éƒ½ä¼šè¢«å›å†™åˆ°ä¸»å†…å­˜ã€‚å½“ä¸€ä¸ªçº¿ç¨‹è¯»å–ä¸€ä¸ªvolatileå˜é‡æ—¶ï¼Œä»–ä¼šåŒæ—¶è¯»å–ä¸»å†…å­˜ä¸­æ‰€æœ‰å…¶ä»–çš„å˜é‡ï¼Œè¿™äº›å˜é‡éƒ½æ˜¯å’Œvolatileå˜é‡ä¸€åŒå†™å…¥ä¸»å†…å­˜çš„ã€‚</p>
<p>çœ‹ä¾‹å­ï¼š</p>
<figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Thread <span class="keyword">A</span>:</span><br><span class="line">    sharedObject.nonVolatile = 123<span class="comment">;</span></span><br><span class="line">    sharedObject.counter     = sharedObject.counter + 1<span class="comment">;</span></span><br><span class="line"></span><br><span class="line">Thread B:</span><br><span class="line">    int counter     = sharedObject.counter<span class="comment">;</span></span><br><span class="line">    int nonVolatile = sharedObject.nonVolatile<span class="comment">;</span></span><br></pre></td></tr></table></figure>
<p>å› ä¸ºçº¿ç¨‹Aåœ¨å†™å…¥volatileå˜é‡sharedObject.counterä¹‹å‰å†™å…¥äº†évolatileå˜é‡sharedObject.nonVolatileï¼Œé‚£ä¹ˆå½“çº¿ç¨‹Aå†™å…¥sharedObject.counteræ—¶ï¼ŒsharedObject.nonVolatile å’Œ sharedObject.counter éƒ½ä¼šè¢«å†™å…¥ä¸»å†…å­˜ã€‚</p>
<p>ç”±äºçº¿ç¨‹Bå¼€å§‹çš„æ—¶å€™è¯»å–volatileç±»å‹çš„sharedObject.counterï¼Œé‚£ä¹ˆsharedObject.counter and sharedObject.nonVolatileéƒ½ä¼šä½¿ç”¨çº¿ç¨‹Bè‡ªä¸»å†…å­˜è¯»å–åˆ°CPUç¼“å­˜ã€‚ç­‰åˆ°çº¿ç¨‹Bè¯»å–sharedObject.nonVolatileæ—¶ï¼Œå°±ä¼šçœ‹åˆ°çº¿ç¨‹Aå†™å…¥çš„å€¼ã€‚</p>
<p>å¼€å‘è€…å¯èƒ½ä¼šä½¿ç”¨è¿™ç§æ‰©å±•çš„å¯è§æ€§ï¼Œä¿è¯äº†çº¿ç¨‹ä¹‹é—´å˜é‡çš„å¯è§æ€§ã€‚åªéœ€è¦å£°æ˜ä¸€ä¸ªæˆ–è€…éå¸¸å°‘çš„volatileå˜é‡æ›¿æ¢æ‰æ¯ä¸ªå˜é‡éƒ½å£°æ˜ä¸ºvolatileã€‚å¦‚ä¸‹æ˜¯ä¸€ä¸ªä¾‹å­ï¼š</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Exchanger</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Object   <span class="keyword">object</span>       = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> hasNewObject = <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">put</span>(<span class="params">Object newObject</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">while</span>(hasNewObject) &#123;</span><br><span class="line">            <span class="comment">//wait - do not overwrite existing new object</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">object</span> = newObject;</span><br><span class="line">        hasNewObject = <span class="keyword">true</span>; <span class="comment">//volatile write</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">take</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">while</span>(!hasNewObject)&#123; <span class="comment">//volatile read</span></span><br><span class="line">            <span class="comment">//wait - don't take old object (or null)</span></span><br><span class="line">        &#125;</span><br><span class="line">        Object obj = <span class="keyword">object</span>;</span><br><span class="line">        hasNewObject = <span class="keyword">false</span>; <span class="comment">//volatile write</span></span><br><span class="line">        <span class="keyword">return</span> obj;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>çº¿ç¨‹Aé€šè¿‡è°ƒç”¨put()æŒç»­çš„å†™å…¥å¯¹è±¡ã€‚çº¿ç¨‹Bé€šè¿‡take()æŒç»­çš„è·å–å¯¹è±¡ã€‚è¿™ä¸ªç±»åªæœ‰åœ¨çº¿ç¨‹Aè°ƒç”¨put()å’Œçº¿ç¨‹Bè°ƒç”¨take()æ—¶ï¼Œé€šè¿‡ä½¿ç”¨volatileå˜é‡æ‰èƒ½å·¥ä½œæ­£å¸¸ã€‚</p>
<p>å¦‚æœJVMåœ¨ä¸æ”¹å˜æ’åºæŒ‡ä»¤çš„è¯­ä¹‰çš„åŸºç¡€ä¸Šå®ç°ï¼Œé‚£ä¹ˆJVMåˆ™ä¼šé€šè¿‡è®°å½•JAVAæŒ‡ä»¤ä¼˜åŒ–æ€§èƒ½ã€‚</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span>(hasNewObject) &#123;</span><br><span class="line">    <span class="regexp">//wait</span> - <span class="keyword">do</span> <span class="keyword">not</span> overwrite existing new object</span><br><span class="line">&#125;</span><br><span class="line">hasNewObject = <span class="keyword">true</span>; <span class="regexp">//volatile</span> write</span><br><span class="line">object = newObject;</span><br></pre></td></tr></table></figure>
<p>æ³¨æ„åˆ°volatileå˜é‡hasNewObjectåœ¨è¢«å®é™…è®¾ç½®å‰å·²ç»è¢«æ‰§è¡Œã€‚å¯¹äºJVMï¼Œè¿™çœ‹ä¸Šå»å®Œå…¨åˆæ³•ã€‚è¿™ä¸¤ä¸ªå†™å…¥å˜é‡çš„å€¼ç›¸å¯¹äºå¦å¤–ä¸€ä¸ªæ˜¯ç‹¬ç«‹çš„ã€‚</p>
<p>ç„¶è€Œï¼Œæ’åºæ‰§è¡Œçš„æŒ‡ä»¤ä¼šæœ‰æŸå¯¹è±¡å˜é‡çš„å¯è§æ€§ã€‚é¦–å…ˆï¼Œçº¿ç¨‹Bå¯èƒ½åœ¨çº¿ç¨‹Aè®¾ç½®æ–°å€¼ä¹‹å‰å°†hasNewObjectè®¾ç½®ä¸ºtrueã€‚å…¶æ¬¡ï¼Œç”šè‡³æ²¡æ³•ä¿è¯å½“æ–°å€¼å†™å…¥å¯¹è±¡åå›å†™åˆ°ä¸»å†…å­˜ã€‚</p>
<p>ä¸ºäº†é˜²æ­¢å¦‚ä¸Šè¿°æƒ…å†µçš„å‘ç”Ÿï¼Œvolatileå…³é”®å­—é‡‡ç”¨â€œå‘ç”Ÿå‰ä¿è¯â€æœºåˆ¶ã€‚â€å‘ç”Ÿå‰ä¿è¯â€œæœºåˆ¶ä¿è¯è¯»å’Œå†™volatileå˜é‡çš„æŒ‡ä»¤ä¸èƒ½è¢«æ’åºã€‚å‰åæŒ‡ä»¤å¯ä»¥è¢«æ’åºï¼Œä½†æ˜¯volatileè¯»æˆ–è€…å†™æŒ‡ä»¤å‘ç”Ÿå‰åä¸èƒ½è¢«æ’åºã€‚</p>
<p>ä¸¾ä¸ªä¾‹å­ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">sharedObject.nonVolatile1 = <span class="number">123</span>;</span><br><span class="line">sharedObject.nonVolatile2 = <span class="number">456</span>;</span><br><span class="line">sharedObject.nonVolatile3 = <span class="number">789</span>;</span><br><span class="line"></span><br><span class="line">sharedObject.<span class="keyword">volatile</span>     = <span class="literal">true</span>; <span class="comment">//a volatile variable</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> someValue1 = sharedObject.nonVolatile4;</span><br><span class="line"><span class="keyword">int</span> someValue2 = sharedObject.nonVolatile5;</span><br><span class="line"><span class="keyword">int</span> someValue3 = sharedObject.nonVolatile6;</span><br></pre></td></tr></table></figure>
<p>JVMä¼šæ’åºå‰3ä¸ªæŒ‡ä»¤ï¼Œåªè¦ä»–ä»¬åœ¨volatileå†™æŒ‡ä»¤ä¹‹å‰ã€‚</p>
<p>åŒæ ·çš„ï¼Œåªè¦volatileå†™å…¥è´¨é‡å‘ç”Ÿåœ¨åä¸‰ä¸ªæŒ‡ä»¤ä¹‹å‰ï¼Œé‚£ä¹ˆåä¸‰ä¸ªæŒ‡ä»¤å°±ä¼šè¢«æ’åºã€‚åœ¨æ­¤ä¹‹å‰ï¼Œè¿™ä¸‰ä¸ªæŒ‡ä»¤ä¸­ä»»ä½•ä¸€ä¸ªæŒ‡ä»¤éƒ½ä¸ä¼šè¢«æ’åºã€‚<br>That is basically the meaning of the Java volatile happens before guarantee.</p>
<h3 id="volatile__u5E76_u4E0D_u603B_u662F_u9002_u7528_u7684"><a href="#volatile__u5E76_u4E0D_u603B_u662F_u9002_u7528_u7684" class="headerlink" title="volatile å¹¶ä¸æ€»æ˜¯é€‚ç”¨çš„"></a>volatile å¹¶ä¸æ€»æ˜¯é€‚ç”¨çš„</h3><p>å³ä½¿volatileå…³é”®å­—ä¿è¯äº†æ‰€æœ‰çš„volatileå˜é‡ç›´æ¥ä»ä¸»å†…å­˜è¯»å–ï¼Œæ‰€æœ‰çš„å†™æ“ä½œéƒ½æ˜¯ç›´æ¥å†™å…¥ä¸»å†…å­˜ï¼Œä½†æ˜¯å­˜åœ¨å£°æ˜äº†volatileè€Œä»ç„¶ä¸å¤Ÿçš„æƒ…å†µã€‚</p>
<p>ä¹‹å‰æè¿‡çš„ï¼Œåªæœ‰çº¿ç¨‹1å†™å…¥å…±äº«çš„counterå˜é‡ï¼Œå£°æ˜ä¸ºvolatileçš„æ—¶å€™æ‰èƒ½ç¡®ä¿çº¿ç¨‹2æ€»æ˜¯èƒ½è·å–æœ€æ–°çš„å†™å…¥å€¼ã€‚</p>
<p>äº‹å®ä¸Šï¼Œå¤šçº¿ç¨‹ç”šè‡³èƒ½å†™å…¥ä¸€ä¸ªå…±äº«çš„volatileå˜é‡ï¼Œå¦‚æœè¿™ä¸ªæ–°å†™å…¥çš„å€¼ä¸ä¾èµ–äºæ—§æ•°æ®çš„è¯å°±å°†æ­£ç¡®çš„å€¼å­˜å…¥ä¸»å†…å­˜ã€‚æ¢å¥è¯è¯´, å¦‚æœä¸€ä¸ªçº¿ç¨‹å†™å…¥ä¸€ä¸ªå€¼åˆ°å…±äº«çš„volatileå˜é‡ï¼Œå¹¶ä¸ä¼šé©¬ä¸Šå°†è¯»å–çš„å€¼ç”¨äºä¸‹ä¸€ä¸ªå€¼å¾—è¯ã€‚</p>
<p>ä¸€æ—¦ä¸€ä¸ªçº¿ç¨‹é¦–æ¬¡è¯»å–ä¸€ä¸ªvolatileå˜é‡çš„å€¼ï¼Œå¹¶ä¸”éœ€è¦åŸºäºè¿™ä¸ªå€¼ç”Ÿæˆä¸€ä¸ªæ–°çš„å…±äº«volatileå˜é‡å€¼ï¼Œé‚£ä¹ˆè¿™ä¸ªvolatileå˜é‡å°±ä¸èƒ½ä¿è¯æ­£ç¡®çš„å¯è§æ€§ã€‚è¯»å–volatileå˜é‡çš„å€¼å¹¶ä¸”å†™å…¥æ–°å€¼å¾—å¾ˆçŸ­çš„é—´éš™ï¼Œå°±ä¼šåˆ›å»ºä¸€ä¸ªç«äº‰çš„æ¡ä»¶ï¼šå¤šä¸ªçº¿ç¨‹ä¼šè¯»å–åŒä¸€ä¸ªvolatileå˜é‡çš„å€¼ï¼Œå¹¶ä¸”ç”Ÿæˆä¸€ä¸ªæ–°çš„å€¼ï¼Œå½“å›å†™è¿›ä¸»å†…å­˜åå°±ä¼šè¦†ç›–æ‰å…¶ä»–çš„å€¼ã€‚</p>
<p>å¤šçº¿ç¨‹å¢åŠ ç›¸åŒçš„è®¡æ•°å™¨å€¼å¾—è¿™ç§æƒ…å†µï¼Œå‡†ç¡®çš„è¯´å¯¹äºvolatileå˜é‡æ˜¯ä¸é€‚ç”¨çš„ã€‚ä¸€ä¸‹ç‰‡æ®µè®²è¯è¯¦ç»†è®²è¿°è¿™ç§æƒ…å†µã€‚</p>
<p>è®¾æƒ³ï¼Œå¦‚æœçº¿ç¨‹1è¯»å–å…±äº«è®¡æ•°å˜é‡ï¼Œä»–çš„å€¼æ˜¯0ï¼Œå¹¶æ”¾å…¥CPUçš„ç¼“å­˜ï¼Œä½¿å…¶åŠ 1ï¼Œä½†æ˜¯è¿™æ ·çš„æ”¹å˜å¹¶ä¸ä¼šå›å†™å¦‚ä¸»å†…å­˜ã€‚çº¿ç¨‹2æ­¤æ—¶å¯ä»¥è‡ªä¸»å†…å­˜è¯»å–ç›¸åŒçš„è®¡æ•°å™¨å˜é‡ï¼Œä½†æ˜¯è¯»åˆ°çš„å€¼ä»ç„¶æ˜¯0ï¼Œå¹¶å°†è¿™ä¸ªå€¼æ”¾å…¥äº†è‡ªå·±çš„CPUç¼“å­˜ã€‚çº¿ç¨‹2ä¹Ÿå¯ä»¥å¯¹å…¶åŠ 1ï¼Œå¹¶ä¸”å¯ä»¥å›å†™åˆ°ä¸»å†…å­˜ã€‚è¿™ç§æƒ…å†µè¯¦è§ä¸‹å›¾ï¼š</p>
<img src="/images/volatile/java-volatile-3.png" title="volatile 3">
<p>çº¿ç¨‹1å’Œçº¿ç¨‹2æ­¤æ—¶å¹¶ä¸æ˜¯åŒæ­¥çš„ã€‚è¿™ä¸ªå…±äº«è®¡æ•°å™¨çš„å€¼åº”è¯¥æ˜¯2ï¼Œä½†æ˜¯æ¯ä¸ªçº¿ç¨‹åœ¨è‡ªå·±çš„CPUç¼“å­˜ä¸­å­˜æ”¾çš„å€¼å´æ˜¯1ï¼Œåœ¨ä¸»å†…å­˜ä¸­çš„å€¼æ˜¯0.è¿™å·²ç»å®Œå…¨ä¹±äº†ï¼å³ä½¿æœ€åæ¯ä¸ªçº¿ç¨‹å›å†™è¿™ä¸ªå…±äº«è®¡æ•°å˜é‡çš„å€¼åˆ°ä¸»å†…å­˜ï¼Œè¿™ä¸ªå€¼ä¹Ÿæ˜¯é”™è¯¯çš„ã€‚</p>
<h3 id="volatile_u5728_u4EC0_u4E48_u65F6_u5019_u662F_u9002_u7528_u7684_3F"><a href="#volatile_u5728_u4EC0_u4E48_u65F6_u5019_u662F_u9002_u7528_u7684_3F" class="headerlink" title="volatileåœ¨ä»€ä¹ˆæ—¶å€™æ˜¯é€‚ç”¨çš„?"></a>volatileåœ¨ä»€ä¹ˆæ—¶å€™æ˜¯é€‚ç”¨çš„?</h3><p>å°±åƒä¹‹å‰æåˆ°è¿‡çš„ï¼Œå¦‚æœæ˜¯ä¸¤ä¸ªçº¿ç¨‹éƒ½éœ€è¦è¯»å–å’Œå†™å…¥ä¸€ä¸ªå…±äº«å˜é‡ï¼Œé‚£ä¹ˆæ­¤æ—¶é€‚ç”¨volatileå…³é”®å­—æ˜¯ä¸é€‚ç”¨çš„ã€‚é‚£ä¹ˆå°±éœ€è¦ä½¿ç”¨synchronizedæ¥ä¿è¯è¯»å’Œå†™çš„åŸå­æ€§ã€‚è¯»å†™volatileå˜é‡ä¸ä¼šé˜»å¡çº¿ç¨‹çš„è¯»å†™ã€‚ä¸ºäº†å®ç°è¿™ä¸€ç‚¹ï¼Œä½ å¿…é¡»ä½¿ç”¨synchronizedå…³é”®å­—ã€‚</p>
<p>ä½œä¸ºsynchronizedå¯ä¾›é€‰æ‹©ï¼Œéœ€è¦é‡‡ç”¨java.util.concurrentåŒ…ä¸­çš„æŸä¸€ä¸ªã€‚æ¯”å¦‚AtomicLongï¼ŒAtomicReferenceæˆ–è€…å…¶ä»–çš„ä»»æ„ä¸€ä¸ªã€‚</p>
<p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œåªæœ‰ä¸€ä¸ªçº¿ç¨‹è¯»å†™volatileå˜é‡çš„å€¼ï¼Œå…¶ä»–çº¿ç¨‹åªæ˜¯è¯»å–å˜é‡ï¼Œé‚£ä¹ˆè¯»å–çº¿ç¨‹å°±å¯ä»¥é€šè¿‡volatileå˜é‡ä¿è¯å¯ä»¥è¯»å–åˆ°æœ€æ–°çš„å†™å…¥å€¼ã€‚å¦‚æœæ²¡æœ‰volatileå˜é‡ï¼Œåˆ™è¿™ä¸ªè¿‡ç¨‹å°±ä¸èƒ½è¢«ä¿è¯ã€‚</p>
<p>volatileå…³é”®å­—å¯ä»¥è¢«ç”¨åœ¨32å’Œ64ä½å˜é‡ä¸­ã€‚</p>
<h3 id="volatile__u6027_u80FD_u6CE8_u610F_u4E8B_u9879"><a href="#volatile__u6027_u80FD_u6CE8_u610F_u4E8B_u9879" class="headerlink" title="volatile æ€§èƒ½æ³¨æ„äº‹é¡¹"></a>volatile æ€§èƒ½æ³¨æ„äº‹é¡¹</h3><p>volatileå˜é‡çš„è¯»å†™ä¼šè§¦å‘å˜é‡åœ¨ä¸»å†…å­˜ä¸­çš„è¯»å†™ã€‚ä¸»å†…å­˜ä¸­çš„è¯»å†™ä¼šæ¯”CPUç¼“å­˜æ¶ˆè€—çš„ä»£ä»·é«˜ã€‚ä½¿ç”¨volatileå˜é‡åŒæ ·ä¼šé˜»æ­¢æ™®é€šæ€§èƒ½å¢å¼ºæŒ‡ä»¤çš„æ’åºã€‚å› æ­¤ï¼Œåªèƒ½åœ¨ç¡®å®éœ€è¦å¢åŠ å˜é‡å¯è§æ€§åŸºç¡€ä¸Šä½¿ç”¨volatileå˜é‡ã€‚</p>
<h3 id="u53C2_u8003_u6587_u732E"><a href="#u53C2_u8003_u6587_u732E" class="headerlink" title="å‚è€ƒæ–‡çŒ®"></a>å‚è€ƒæ–‡çŒ®</h3><ul>
<li><a href="http://www.ibm.com/developerworks/cn/java/j-jtp06197.html" target="_blank" rel="external">http://www.ibm.com/developerworks/cn/java/j-jtp06197.html</a></li>
<li><a href="http://www.infoq.com/cn/articles/ftf-java-volatile" target="_blank" rel="external">http://www.infoq.com/cn/articles/ftf-java-volatile</a></li>
<li><a href="http://www.infoq.com/cn/articles/java-memory-model-4" target="_blank" rel="external">http://www.infoq.com/cn/articles/java-memory-model-4</a></li>
<li><a href="http://sakyone.iteye.com/blog/668091" target="_blank" rel="external">http://sakyone.iteye.com/blog/668091</a></li>
<li><a href="https://zh.wikipedia.org/wiki/Volatile%E5%8F%98%E9%87%8F" target="_blank" rel="external">https://zh.wikipedia.org/wiki/Volatile%E5%8F%98%E9%87%8F</a></li>
<li><a href="http://www.cnblogs.com/aigongsi/archive/2012/04/01/2429166.html" target="_blank" rel="external">http://www.cnblogs.com/aigongsi/archive/2012/04/01/2429166.html</a></li>
</ul>
]]></content>
    <summary type="html">
    <![CDATA[<!--  -->
<!--  -->
<!--  _ __    __     __      ____    ___     ___   _____   __  __    ___     -->
<!-- /\`'__\/'__`\ /'__`\   /',__\  / _]]>
    </summary>
    
      <category term="Android" scheme="http://reasonpun.com/tags/Android/"/>
    
      <category term="Android" scheme="http://reasonpun.com/categories/Android/"/>
    
      <category term="å…³é”®å­—" scheme="http://reasonpun.com/categories/Android/%E5%85%B3%E9%94%AE%E5%AD%97/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[OKHttpæºç å­¦ä¹ è¿‡ç¨‹]]></title>
    <link href="http://reasonpun.com/2016/03/08/OKHttp%E6%BA%90%E7%A0%81%E5%AD%A6%E4%B9%A0%E8%BF%87%E7%A8%8B/"/>
    <id>http://reasonpun.com/2016/03/08/OKHttpæºç å­¦ä¹ è¿‡ç¨‹/</id>
    <published>2016-03-08T09:52:23.000Z</published>
    <updated>2016-03-15T07:17:42.000Z</updated>
    <content type="html"><![CDATA[<!--  -->
<!--  -->
<!--  _ __    __     __      ____    ___     ___   _____   __  __    ___     -->
<!-- /\`'__\/'__`\ /'__`\   /',__\  / __`\ /' _ `\/\ '__`\/\ \/\ \ /' _ `\   -->
<!-- \ \ \//\  __//\ \L\.\_/\__, `\/\ \L\ \/\ \/\ \ \ \L\ \ \ \_\ \/\ \/\ \  -->
<!--  \ \_\\ \____\ \__/.\_\/\____/\ \____/\ \_\ \_\ \ ,__/\ \____/\ \_\ \_\ -->
<!--   \/_/ \/____/\/__/\/_/\/___/  \/___/  \/_/\/_/\ \ \/  \/___/  \/_/\/_/ -->
<!--                                                 \ \_\                   -->
<!--                                                  \/_/                   -->
<!--  -->
<h2 id="u5B66_u4E60OKHttp_u6E90_u7801_u7684_u8FC7_u7A0B"><a href="#u5B66_u4E60OKHttp_u6E90_u7801_u7684_u8FC7_u7A0B" class="headerlink" title="å­¦ä¹ OKHttpæºç çš„è¿‡ç¨‹"></a>å­¦ä¹ OKHttpæºç çš„è¿‡ç¨‹</h2><h3 id="u51C6_u5907"><a href="#u51C6_u5907" class="headerlink" title="å‡†å¤‡"></a>å‡†å¤‡</h3><p>å¯ä»¥åœ¨<a href="https://github.com/square/okhttp" target="_blank" rel="external">è¿™é‡Œ</a>ä¸‹è½½OKHttpæºä»£ç </p>
<h3 id="u8D77_u6B65"><a href="#u8D77_u6B65" class="headerlink" title="èµ·æ­¥"></a>èµ·æ­¥</h3><h4 id="Request-java"><a href="#Request-java" class="headerlink" title="Request.java"></a>Request.java</h4><p>æ‰€åœ¨ç›®å½•ï¼š/okhttp/okhttp/src/main/java/com/squareup/okhttp/Request.java</p>
<p>æ–‡ä»¶ç¬¬38è¡Œ~40è¡Œï¼Œé‡åˆ°å…³é”®å­— volatile</p>
<figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">volatile</span> URL url; <span class="comment">// Lazily initialized.</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">volatile</span> URI uri; <span class="comment">// Lazily initialized.</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">volatile</span> CacheControl cacheControl; <span class="comment">// Lazily initialized.</span></span><br></pre></td></tr></table></figure>
<p>ç„¶åç¨å¾®çœ‹äº†ä¸‹è¿™ä¸ªå…³é”®å­—çš„è§£é‡Šï¼Œå¯ä»¥ç§»æ­¥<a href="http://reasonpun.com/2016/03/08/Java%E5%85%B3%E9%94%AE%E5%AD%97volatile/">è¿™é‡Œ</a></p>
<hr>
<p>æœªå®Œå¾…ç»­</p>
<h3 id="u53C2_u8003_u6587_u732E"><a href="#u53C2_u8003_u6587_u732E" class="headerlink" title="å‚è€ƒæ–‡çŒ®"></a>å‚è€ƒæ–‡çŒ®</h3><ul>
<li><a href="http://frodoking.github.io/2015/03/12/android-okhttp/" target="_blank" rel="external">http://frodoking.github.io/2015/03/12/android-okhttp/</a></li>
</ul>
]]></content>
    <summary type="html">
    <![CDATA[<!--  -->
<!--  -->
<!--  _ __    __     __      ____    ___     ___   _____   __  __    ___     -->
<!-- /\`'__\/'__`\ /'__`\   /',__\  / _]]>
    </summary>
    
      <category term="Android" scheme="http://reasonpun.com/tags/Android/"/>
    
      <category term="Android" scheme="http://reasonpun.com/categories/Android/"/>
    
      <category term="æºç " scheme="http://reasonpun.com/categories/Android/%E6%BA%90%E7%A0%81/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[æ­£åˆ™è¡¨è¾¾å¼å¤„ç†Nginx]]></title>
    <link href="http://reasonpun.com/2016/01/24/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E5%A4%84%E7%90%86Nginx/"/>
    <id>http://reasonpun.com/2016/01/24/æ­£åˆ™è¡¨è¾¾å¼å¤„ç†Nginx/</id>
    <published>2016-01-24T03:37:16.000Z</published>
    <updated>2016-01-25T03:30:56.000Z</updated>
    <content type="html"><![CDATA[<!--  -->
<!--  -->
<!--  _ __    __     __      ____    ___     ___   _____   __  __    ___     -->
<!-- /\`'__\/'__`\ /'__`\   /',__\  / __`\ /' _ `\/\ '__`\/\ \/\ \ /' _ `\   -->
<!-- \ \ \//\  __//\ \L\.\_/\__, `\/\ \L\ \/\ \/\ \ \ \L\ \ \ \_\ \/\ \/\ \  -->
<!--  \ \_\\ \____\ \__/.\_\/\____/\ \____/\ \_\ \_\ \ ,__/\ \____/\ \_\ \_\ -->
<!--   \/_/ \/____/\/__/\/_/\/___/  \/___/  \/_/\/_/\ \ \/  \/___/  \/_/\/_/ -->
<!--                                                 \ \_\                   -->
<!--                                                  \/_/                   -->
<!--  -->
<h1 id="Nginx__u65E5_u5FD7_u914D_u7F6E_u683C_u5F0F"><a href="#Nginx__u65E5_u5FD7_u914D_u7F6E_u683C_u5F0F" class="headerlink" title="Nginx æ—¥å¿—é…ç½®æ ¼å¼"></a>Nginx æ—¥å¿—é…ç½®æ ¼å¼</h1><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="title">log_format</span>  main</span><br><span class="line">        <span class="string">'[<span class="variable">$upstream_addr</span>] <span class="variable">$remote_addr</span> [<span class="variable">$time_local</span>] "<span class="variable">$request</span>" <span class="variable">$status</span> '</span></span><br><span class="line">        <span class="string">'"<span class="variable">$request_body</span>" <span class="variable">$body_bytes_sent</span> "<span class="variable">$http_referer</span>" "<span class="variable">$http_user_agent</span>" '</span></span><br><span class="line">        <span class="string">'RESP:<span class="variable">$upstream_response_time</span> '</span></span><br><span class="line">        <span class="string">'REQ:<span class="variable">$request_time</span>'</span>;</span><br></pre></td></tr></table></figure>
<h1 id="u6837_u4F8B"><a href="#u6837_u4F8B" class="headerlink" title="æ ·ä¾‹"></a>æ ·ä¾‹</h1><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[<span class="number">192.168</span>.<span class="number">1.5</span>:<span class="number">80</span>] <span class="number">19.78</span>.<span class="number">22.51</span> [<span class="number">31</span>/Dec/<span class="number">2015</span>:<span class="number">13</span>:<span class="number">59</span>:<span class="number">02</span> +080<span class="number">0</span>] <span class="string">"POST /api/mbbb/dup_msg_send?pallow_dubbing=0&amp;partner_msgs_id=279&amp;roles_id=23&amp;score=6700&amp;section_id=512&amp;whole_audio=200.m4a&amp;d</span><br><span class="line">evice_id=112222f0fc3&amp;lang=zh-CN&amp;trigger=user&amp;user_id=516487&amp;v=ios_7.0.3 HTTP/1.1"</span> <span class="number">200</span> <span class="string">"audio_fragment=00280<span class="variable">%22</span><span class="variable">%3A</span><span class="variable">%7B</span><span class="variable">%22pitch</span><span class="variable">%22</span><span class="variable">%3A47</span><span class="variable">%2C</span><span class="variable">%22rhythm</span><span class="variable">%22</span><span class="variable">%3A95</span><span class="variable">%2C</span><span class="variable">%22tone</span><span class="variable">%22</span><span class="variable">%3A75</span><span class="variable">%7D</span><span class="variable">%2C</span><span class="variable">%226800278</span><span class="variable">%22</span><span class="variable">%3A</span><span class="variable">%7B</span><span class="variable">%22pitch</span><span class="variable">%22</span><span class="variable">%3A70</span><span class="variable">%2C</span><span class="variable">%22rhythm</span><span class="variable">%22</span><span class="variable">%3A90</span><span class="variable">%2</span><span class="variable">%7D</span><span class="variable">%2C</span><span class="variable">%226800276</span><span class="variable">%22</span></span><br><span class="line"><span class="variable">%3A</span><span class="variable">%7B</span><span class="variable">%22pitch</span><span class="variable">%22</span><span class="variable">%3A60</span><span class="variable">%2C</span><span class="variable">%22rhythm</span><span class="variable">%22</span><span class="variable">%3A82</span><span class="variable">%2C</span><span class="variable">%22tone</span><span class="variable">%22D</span>&amp;content=hhhhhh<span class="variable">%E5</span><span class="variable">%B0</span><span class="variable">%8F</span><span class="variable">%E5</span><span class="variable">%AB</span><span class="variable">%A9</span><span class="variable">%E8</span><span class="variable">%8D</span><span class="variable">%89</span>"</span> <span class="number">51</span> <span class="string">"-"</span> <span class="string">"paipao/7.0.3 (iPhone; iOS 9.2; Scale/2.00)"</span> RESP:<span class="number">0</span>.<span class="number">166</span> REQ:<span class="number">0</span>.<span class="number">167</span></span><br><span class="line">[<span class="number">192.168</span>.<span class="number">1.5</span>:<span class="number">80</span>, <span class="number">192.169</span>.<span class="number">1.33</span>:<span class="number">88</span>] <span class="number">60.12</span>.<span class="number">246.5</span> [<span class="number">31</span>/Dec/<span class="number">2015</span>:<span class="number">23</span>:<span class="number">59</span>:<span class="number">02</span> +080<span class="number">0</span>] <span class="string">"GET /api/mppb/notice/list?device_id=112233fe6a6d991f&amp;lang=zh-CN&amp;user_id=6120&amp;v=ios_7.0.3 HTTP/1.1"</span> <span class="number">200</span> <span class="string">"-"</span> <span class="number">54</span> <span class="string">"-"</span> <span class="string">"paipao/7.0.3 (iPhone; iOS 9.2; Scale/2.00)"</span> RESP:<span class="number">0</span>.<span class="number">006</span> REQ:<span class="number">0</span>.<span class="number">006</span></span><br></pre></td></tr></table></figure>
<h1 id="u6B63_u5219_u8868_u8FBE_u5F0F"><a href="#u6B63_u5219_u8868_u8FBE_u5F0F" class="headerlink" title="æ­£åˆ™è¡¨è¾¾å¼"></a>æ­£åˆ™è¡¨è¾¾å¼</h1><h2 id="Python_u7248_u672C"><a href="#Python_u7248_u672C" class="headerlink" title="Pythonç‰ˆæœ¬"></a>Pythonç‰ˆæœ¬</h2><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">p = re.compile(</span><br><span class="line"><span class="code">            r"\[\-?[\d.\:]*[\ \,]*?.*?\]\ [\d.\:]*\ \[(\d+)/(\w+)/(\d+)\:(\S+)\ [\S]+\]\ \"(\S+)\ (\S+)\ .*?\"\ (\d+)\ \"(.*?)\"\ (\d+)\ \"([^\"]*)\"\ \".*?\" .*?")</span></span><br><span class="line">m = re.findall(p, line)</span><br><span class="line">day = m[<span class="link_label">0</span>][<span class="link_reference">0</span>]</span><br><span class="line">month = m[<span class="link_label">0</span>][<span class="link_reference">1</span>]</span><br><span class="line">year = m[<span class="link_label">0</span>][<span class="link_reference">2</span>]</span><br><span class="line">ttime = m[<span class="link_label">0</span>][<span class="link_reference">3</span>]</span><br><span class="line">method = m[<span class="link_label">0</span>][<span class="link_reference">4</span>]</span><br><span class="line">request = m[<span class="link_label">0</span>][<span class="link_reference">5</span>]</span><br><span class="line">status = m[<span class="link_label">0</span>][<span class="link_reference">6</span>]</span><br></pre></td></tr></table></figure>
<h2 id="Scala_u7248_u672C"><a href="#Scala_u7248_u672C" class="headerlink" title="Scalaç‰ˆæœ¬"></a>Scalaç‰ˆæœ¬</h2><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">val regex = new Regex( """<span class="command">\[</span><span class="command">\-</span>?<span class="special">[</span><span class="command">\d</span>.<span class="command">\:</span><span class="special">]</span>*<span class="special">[</span><span class="command">\ </span><span class="command">\,</span><span class="special">]</span>*?.*?<span class="command">\]</span><span class="command">\ </span><span class="special">[</span><span class="command">\d</span>.<span class="command">\:</span><span class="special">]</span>*<span class="command">\ </span><span class="command">\[</span>(<span class="command">\d</span>+)/(<span class="command">\w</span>+)/(<span class="command">\d</span>+)<span class="command">\:</span>(<span class="command">\S</span>+)<span class="command">\ </span><span class="special">[</span><span class="command">\S</span><span class="special">]</span>+<span class="command">\]</span><span class="command">\ </span><span class="command">\"</span>(<span class="command">\S</span>+)<span class="command">\ </span>(<span class="command">\S</span>+)<span class="command">\ </span>.*?<span class="command">\"</span><span class="command">\ </span>(<span class="command">\d</span>+)<span class="command">\ </span><span class="command">\"</span>(.*?)<span class="command">\"</span><span class="command">\ </span>(<span class="command">\d</span>+)<span class="command">\ </span><span class="command">\"</span>(<span class="special">[</span>^<span class="command">\"</span><span class="special">]</span>*)<span class="command">\"</span><span class="command">\ </span><span class="command">\"</span>.*?<span class="command">\"</span> .*?""")</span><br><span class="line">val regex(day, month, year, time, method, request, status, postData, bytes, refer) = line</span><br></pre></td></tr></table></figure>
<h1 id="u53C2_u8003_u6587_u732E"><a href="#u53C2_u8003_u6587_u732E" class="headerlink" title="å‚è€ƒæ–‡çŒ®"></a>å‚è€ƒæ–‡çŒ®</h1><ul>
<li><a href="http://www.jianshu.com/p/5d8c802be13d" target="_blank" rel="external">http://www.jianshu.com/p/5d8c802be13d</a></li>
<li><a href="https://segmentfault.com/a/1190000002727070" target="_blank" rel="external">https://segmentfault.com/a/1190000002727070</a></li>
<li><a href="http://desert3.iteye.com/blog/1001568" target="_blank" rel="external">http://desert3.iteye.com/blog/1001568</a></li>
<li><a href="http://stackoverflow.com/questions/996536/regex-in-python" target="_blank" rel="external">http://stackoverflow.com/questions/996536/regex-in-python</a></li>
</ul>
]]></content>
    <summary type="html">
    <![CDATA[<!--  -->
<!--  -->
<!--  _ __    __     __      ____    ___     ___   _____   __  __    ___     -->
<!-- /\`'__\/'__`\ /'__`\   /',__\  / _]]>
    </summary>
    
      <category term="Nginx" scheme="http://reasonpun.com/tags/Nginx/"/>
    
      <category term="æ—¥å¿—" scheme="http://reasonpun.com/tags/%E6%97%A5%E5%BF%97/"/>
    
      <category term="æ­£åˆ™" scheme="http://reasonpun.com/tags/%E6%AD%A3%E5%88%99/"/>
    
      <category term="Nginx" scheme="http://reasonpun.com/categories/Nginx/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[TAPL]]></title>
    <link href="http://reasonpun.com/2016/01/06/TAPL/"/>
    <id>http://reasonpun.com/2016/01/06/TAPL/</id>
    <published>2016-01-06T04:42:09.000Z</published>
    <updated>2016-01-25T03:17:11.000Z</updated>
    <content type="html"><![CDATA[<!--  -->
<!--  -->
<!--  _ __    __     __      ____    ___     ___   _____   __  __    ___     -->
<!-- /\`'__\/'__`\ /'__`\   /',__\  / __`\ /' _ `\/\ '__`\/\ \/\ \ /' _ `\   -->
<!-- \ \ \//\  __//\ \L\.\_/\__, `\/\ \L\ \/\ \/\ \ \ \L\ \ \ \_\ \/\ \/\ \  -->
<!--  \ \_\\ \____\ \__/.\_\/\____/\ \____/\ \_\ \_\ \ ,__/\ \____/\ \_\ \_\ -->
<!--   \/_/ \/____/\/__/\/_/\/___/  \/___/  \/_/\/_/\ \ \/  \/___/  \/_/\/_/ -->
<!--                                                 \ \_\                   -->
<!--                                                  \/_/                   -->
<!--  -->
<p>TAPL The awk programming language, <a href="https://reasonpun.gitbooks.io/tapl/content/index.html" target="_blank" rel="external">see git book</a></p>
]]></content>
    <summary type="html">
    <![CDATA[<!--  -->
<!--  -->
<!--  _ __    __     __      ____    ___     ___   _____   __  __    ___     -->
<!-- /\`'__\/'__`\ /'__`\   /',__\  / _]]>
    </summary>
    
      <category term="awk" scheme="http://reasonpun.com/tags/awk/"/>
    
      <category term="programming" scheme="http://reasonpun.com/tags/programming/"/>
    
      <category term="AWK" scheme="http://reasonpun.com/categories/AWK/"/>
    
      <category term="Linux" scheme="http://reasonpun.com/categories/AWK/Linux/"/>
    
      <category term="Ebook" scheme="http://reasonpun.com/categories/AWK/Linux/Ebook/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[Sparkä¼˜åŒ–]]></title>
    <link href="http://reasonpun.com/2016/01/04/Spark%E4%BC%98%E5%8C%96/"/>
    <id>http://reasonpun.com/2016/01/04/Sparkä¼˜åŒ–/</id>
    <published>2016-01-04T06:13:35.000Z</published>
    <updated>2016-01-18T03:07:41.000Z</updated>
    <content type="html"><![CDATA[<!--  -->
<!--  -->
<!--  _ __    __     __      ____    ___     ___   _____   __  __    ___     -->
<!-- /\`'__\/'__`\ /'__`\   /',__\  / __`\ /' _ `\/\ '__`\/\ \/\ \ /' _ `\   -->
<!-- \ \ \//\  __//\ \L\.\_/\__, `\/\ \L\ \/\ \/\ \ \ \L\ \ \ \_\ \/\ \/\ \  -->
<!--  \ \_\\ \____\ \__/.\_\/\____/\ \____/\ \_\ \_\ \ ,__/\ \____/\ \_\ \_\ -->
<!--   \/_/ \/____/\/__/\/_/\/___/  \/___/  \/_/\/_/\ \ \/  \/___/  \/_/\/_/ -->
<!--                                                 \ \_\                   -->
<!--                                                  \/_/                   -->
<!--  -->
<h2 id="Spark__u4F18_u5316"><a href="#Spark__u4F18_u5316" class="headerlink" title="Spark ä¼˜åŒ–"></a>Spark ä¼˜åŒ–</h2><p>ç”±äºSparkå†…å­˜è®¡ç®—ç‰¹æ€§ï¼ŒSparkç¨‹åºä¼šç”±é›†ç¾¤ä¸Šçš„å¦‚ä¸‹å› ç´ å†³å®šå…¶æ€§èƒ½</p>
<ul>
<li>CPU</li>
<li>ç½‘ç»œå¸¦å®½</li>
<li>å†…å­˜</li>
</ul>
<p>é€šå¸¸æ¥è¯´ï¼Œå¦‚æœé…ç½®é€‚å½“çš„å†…å­˜ï¼Œé‚£ä¹ˆç“¶é¢ˆå°±æ˜¯å¸¦å®½ã€‚ä½†æ˜¯æœ‰äº›æ—¶å€™ï¼Œæœ‰éœ€è¦åšäº›ä¼˜åŒ–ï¼Œæ¯”å¦‚ä»¥åºåˆ—åŒ–çš„å½¢å¼å­˜å‚¨RDDï¼Œä»è€Œé™ä½å†…å­˜çš„å ç”¨ã€‚</p>
<p>æ­¤ä¼šä»ä¸¤æ–¹é¢åˆ†æ</p>
<ul>
<li>æ•°æ®åºåˆ—åŒ–</li>
<li>å†…å­˜ä¼˜åŒ–</li>
</ul>
<h3 id="Data_Serialization"><a href="#Data_Serialization" class="headerlink" title="Data Serialization"></a>Data Serialization</h3><p>åºåˆ—åŒ–åœ¨åˆ†å¸ƒå¼è®¡ç®—ç¨‹åºä¸­å æœ‰éå¸¸é‡è¦çš„åœ°ä½ã€‚è¿Ÿç¼“çš„åºåˆ—åŒ–æ ¼å¼ï¼Œæˆ–è€…æ¶ˆè´¹ä¸€ä¸ªè¶…å¤§çš„å­—èŠ‚æ•°æ®ï¼Œéƒ½ä¼šå¤§å¤§çš„å‡ç¼“è®¡ç®—é€Ÿåº¦ã€‚æ‰€ä»¥ï¼Œç¬¬ä¸€ä»¶äº‹åº”è¯¥å…ˆå°è¯•ä¼˜åŒ–Sparkç¨‹åºã€‚Sparkè¯•å›¾è¾¾åˆ°åœ¨æ˜“ç”¨æ€§ï¼ˆå…è®¸ä½ å®šä¹‰ä»»ä½•çš„Javaç±»å‹ï¼‰å’Œæ€§èƒ½ä¸¤æ–¹é¢è¾¾åˆ°ä¸€ç§å¹³è¡¡ï¼Œå¹¶ä¸”æä¾›ä¸¤ç§åºåˆ—åŒ–åº“ï¼š</p>
<ul>
<li><p>Javaåºåˆ—åŒ–ï¼šç¼ºçœæƒ…å†µä¸‹ï¼ŒSparkä½¿ç”¨Javaçš„ObjectOutputStreamæ¡†æ¶åºåˆ—åŒ–å¯¹è±¡ï¼Œ<br>ä»è€Œå¯ä»¥å’Œä»»ä½•å®ç°äº†java.io.Serializableæ¥å£çš„ç±»ä¸€èµ·ç©è€ã€‚ä¹Ÿå¯ä»¥æ›´ç´§å¯†çš„æ§åˆ¶æ‰©å±•äº†java.io.Externalizableçš„åºåˆ—åŒ–çš„æ€§èƒ½ã€‚Javaçš„åºåˆ—åŒ–æ˜¯éå¸¸ä¸°å¯Œçš„ï¼Œä½†æ˜¯é€Ÿåº¦å¥‡æ…¢ï¼Œå¹¶ä¸”ä¼šå¯¼è‡´å¾ˆå¤šç±»äº§ç”Ÿå¤§é‡çš„åºåˆ—åŒ–æ ¼å¼ã€‚</p>
</li>
<li><p>Kryoåºåˆ—åŒ–ï¼šSparkä¹Ÿå¯ä»¥ä½¿ç”¨Kryoåº“ï¼ˆVersion2ï¼‰éå¸¸è¿…é€Ÿçš„åºåˆ—åŒ–å¯¹è±¡ã€‚Kryoæ¯”Javaåºåˆ—åŒ–å¿«å¾ˆå¤šå¹¶ä¸”æ›´å¤§çš„å‹ç¼©ç‡ï¼ˆé€šå¸¸æ˜¯10xï¼‰ï¼Œä½†æ˜¯å¹¶ä¸æ”¯æŒæ‰€æœ‰çš„ç±»å‹ï¼Œå¦å¤–ä¹Ÿéœ€è¦ä½ åœ¨ç¨‹åºä¸­æ³¨å†Œç±»ä»¥è·å¾—æœ€å¥½çš„æ€§èƒ½ã€‚</p>
</li>
</ul>
<p>ä½ å¯ä»¥é€‰æ‹©é€šè¿‡è®¾ç½®SparkConfæˆ–è€…è°ƒç”¨conf.set(â€œspark.serializerâ€, â€œorg.apache.spark.serializer.KryoSerializerâ€)æ¥ä½¿ç”¨Kryoåˆå§‹åŒ–Jobã€‚è¿™æ ·è®¾ç½®çš„è¯ï¼Œä¸ä»…å¯ä»¥é…ç½®é€šè¿‡workerèŠ‚ç‚¹é—´shufflingæ•°æ®ï¼Œè¿˜èƒ½å°†RDDåºåˆ—åŒ–åˆ°ç£ç›˜ä¸Šã€‚Kryoä¸æ˜¯ç¼ºçœé…ç½®çš„åŸå› æ˜¯ç”±äºè‡ªå®šä¹‰æ³¨å†Œçš„è¦æ±‚å†³å®šçš„ï¼ŒåŒæ—¶æˆ‘ä»¬ä¹Ÿæƒ³åœ¨ç½‘ç»œå¯†é›†å‹åº”ç”¨ä¸­ä½¿ç”¨å®ƒã€‚</p>
<p>Spark automatically includes Kryo serializers for the many commonly-used core Scala classes covered in the AllScalaRegistrar from the Twitter chill library.</p>
<p>ä½¿ç”¨Kryoæ³¨å†Œè‡ªå®šä¹‰ç±»ï¼Œéœ€è¦ä½¿ç”¨registerKryoClassesæ–¹æ³•ã€‚</p>
  <figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">val conf = new <span class="function"><span class="title">SparkConf</span><span class="params">()</span></span>.<span class="function"><span class="title">setMaster</span><span class="params">(...)</span></span>.<span class="function"><span class="title">setAppName</span><span class="params">(...)</span></span></span><br><span class="line">conf.<span class="function"><span class="title">registerKryoClasses</span><span class="params">(Array(classOf[MyClass1], classOf[MyClass2])</span></span>)</span><br><span class="line">val sc = new <span class="function"><span class="title">SparkContext</span><span class="params">(conf)</span></span></span><br></pre></td></tr></table></figure>
<p>Kryoæ–‡æ¡£æè¿°äº†æ›´å¤šé«˜çº§çš„æ³¨å†Œé€‰é¡¹ï¼Œæ¯”å¦‚æ·»åŠ è‡ªå®šä¹‰åºåˆ—ä»£ç ã€‚</p>
<p>å¦‚æœä½ çš„å¯¹è±¡éå¸¸å¤§ï¼Œåˆ™éœ€è¦å¢åŠ spark.kryoserializer.bufferé…ç½®å‚æ•°ã€‚è¿™ä¸ªå€¼ç¼ºçœä¸º2ï¼Œä½†æ˜¯è¿™ä¸ªå€¼éœ€è¦è¶³å¤Ÿå¤§è¶³ä»¥ä¿å­˜åºåˆ—å·çš„å¯¹è±¡ã€‚</p>
<p>æœ€åï¼Œå¦‚æœä½ æ²¡æœ‰æ³¨å†Œè‡ªå®šä¹‰ç±»ï¼ŒKryoä»ç„¶ä¼šèµ·ä½œç”¨ï¼Œä½†æ˜¯å®ƒä¸å¾—ä¸å­˜å‚¨æ¯ä¸ªå¯¹è±¡çš„å…¨éƒ¨ç±»ï¼Œè¿™æ ·æ˜¯éå¸¸æµªè´¹çš„ã€‚</p>
<h3 id="u5185_u5B58_u4F18_u5316"><a href="#u5185_u5B58_u4F18_u5316" class="headerlink" title="å†…å­˜ä¼˜åŒ–"></a>å†…å­˜ä¼˜åŒ–</h3><p>å†…å­˜ä¼˜åŒ–çš„æ–¹æ³•æœ‰3ä¸ªæ–¹é¢éœ€è¦è€ƒè™‘çš„ï¼šä½ çš„å¯¹è±¡ä½¿ç”¨çš„æ€»å†…å­˜é‡ï¼ˆä½ å¯èƒ½å¸Œæœ›å…¨éƒ¨æ•°æ®éƒ½æ”¾åˆ°å†…å­˜é‡Œï¼‰ï¼Œå¯¹è±¡å­˜å–æˆæœ¬ï¼ŒGCçš„å¼€é”€ï¼ˆå¦‚æœä½ æœ‰éå¸¸é«˜çš„å¯¹è±¡äº¤æ¢é¢‘ç‡ï¼‰</p>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒJavaå¯¹è±¡å¯ä»¥è¢«å¿«é€Ÿçš„è®¿é—®ï¼Œä½†æ˜¯ä¼šè½»æ˜“çš„è€—å°½å®ƒä»¬å­—æ®µä¸­æ¯”â€œrawâ€æ•°æ®å¤š2åˆ°5å€çš„ç©ºé—´çš„å› å­ã€‚è¿™å–å†³äºå¤šä¸ªå› ç´ ï¼š</p>
<ul>
<li>æ¯ä¸ªç‹¬ç«‹çš„Javaå¯¹è±¡åŒ…å«ä¸€ä¸ªâ€œå¯¹è±¡å¤´â€ï¼Œ16å­—èŠ‚é•¿åº¦å¹¶åŒ…å«è¯¸å¦‚åªæƒ³å®ƒçš„ç±»çš„ä¸€äº›ä¿¡æ¯ã€‚<br>å¯¹äºä¸€ä¸ªéå¸¸å°çš„æ•°æ®æ¥è¯´ï¼ˆæ¯”å¦‚Intï¼‰ï¼Œè¿™ä¸ªå¯èƒ½æ¯”æ•°æ®æœ¬èº«éƒ½è¦å¤§ä¸€äº›ã€‚</li>
<li>Javaå­—ç¬¦ä¸²æœ‰å¤§çº¦40å­—èŠ‚çš„å¯¹è±¡å¤´ï¼Œæ¯”â€œrawâ€æ•°æ®è¦å¤šï¼ˆå› ä¸ºå®ƒä»¬æŒ‰ç…§å­—ç¬¦ä¸²æ•°ç»„çš„å½¢å¼ä¿å­˜ï¼Œå¹¶ä¸”è¿˜åŒ…å«æ‰©å±•æ•°æ®ï¼Œæ¯”å¦‚è¯´æ•°æ®çš„é•¿åº¦ï¼‰ï¼Œ<br>ç”±äºé‡‡ç”¨äº†UTF-16ç¼–ç æ ¼å¼ï¼Œæ‰€ä»¥åœ¨å­—ç¬¦ä¸²å†…éƒ¨ï¼Œå­˜å‚¨ä¸€ä¸ªå­—ç¬¦éœ€è¦å ç”¨2ä¸ªå­—èŠ‚çš„ç©ºé—´ã€‚å› æ­¤10ä¸ªå­—ç¬¦å°±å¯ä»¥è½»æ˜“çš„æ¶ˆè€—æ‰60å­—èŠ‚ç©ºé—´ã€‚</li>
<li>æ™®é€šçš„é›†åˆå¯¹è±¡ï¼Œæ¯”å¦‚è¯´HashMapå’ŒLinkedListï¼Œä½¿ç”¨çš„æ˜¯é“¾å¼æ•°æ®ç»“æ„ï¼Œå¯¹äºæ¯ä¸ªå®ä½“éƒ½å­˜åœ¨ä¸€ä¸ªâ€œwrapperâ€å¯¹è±¡ï¼ˆæ¯”å¦‚ Map.Entryï¼‰ã€‚è¿™ä¸ªå¯¹è±¡ä¸ä»…åŒ…å«å¤´ï¼Œé“¾è¡¨ä¸­è¿˜æœ‰æŒ‡å‘ä¸‹ä¸€ä¸ªå¯¹è±¡çš„æŒ‡é’ˆï¼ˆé€šå¸¸éœ€è¦8ä¸ªå­—èŠ‚ï¼‰ã€‚</li>
<li>ç§æœ‰ç±»å‹çš„é›†åˆç»å¸¸ä»¥â€œè£…ç®±â€å¯¹è±¡çš„å½¢å¼å­˜å‚¨ï¼Œæ¯”å¦‚java.lang.Integerã€‚</li>
</ul>
<p>è¿™ä¸€ç« è®¨è®ºçš„æ˜¯å¦‚ä½•ç¡®å®šå¯¹è±¡çš„å†…å­˜å ç”¨æƒ…å†µï¼Œå’Œæ”¹è¿›çš„æ–¹æ³•ï¼ä¸æ­¢ä¿æŠ¤æ”¹å˜ä½ çš„æ•°æ®ç»“æ„ï¼Œå¦å¤–è¿˜éœ€è¦ä»¥ä¸€ç§åºåˆ—å·çš„å½¢å¼å­˜å‚¨æ•°æ®ã€‚ç„¶åæˆ‘ä»¬å°±å¯ä»¥è¦†ç›–åˆ°ä¼˜åŒ–Sparkç¼“å­˜å’ŒJava GCçš„çŸ¥è¯†äº†ã€‚</p>
<h4 id="u641E_u6E05_u695A_u5185_u5B58_u6D88_u8017"><a href="#u641E_u6E05_u695A_u5185_u5B58_u6D88_u8017" class="headerlink" title="ææ¸…æ¥šå†…å­˜æ¶ˆè€—"></a>ææ¸…æ¥šå†…å­˜æ¶ˆè€—</h4><p>æµ‹è¯•ä¸€ä¸ªæ•°æ®é›†æ¶ˆè€—å†…å­˜çš„æ€»é‡æœ€å¥½çš„æ–¹å¼åˆ›å»ºä¸€ä¸ªRDDï¼Œå¹¶æ”¾åˆ°ç¼“å†²ä¸­ï¼Œé€šè¿‡webé¡µé¢æŸ¥çœ‹å­˜å‚¨æƒ…å†µã€‚è¿™ä¸ªé¡µé¢çš„å†…å®¹å¯ä»¥æ˜¾ç¤ºRDDåˆ°åº•å æœ‰äº†å¤šå°‘å†…å­˜ã€‚</p>
<p>ä¼°ç®—ä¸€ä¸ªåˆ†åŒºæ•°æ®æ¶ˆè€—çš„å†…å­˜ï¼Œå¯ä»¥ä½¿ç”¨SizeEstimatorâ€™s estimateçš„æ–¹æ³•ï¼Œè¿™æ˜¯ä¸€ç§éå¸¸æœ‰ç”¨çš„æ–¹å¼å»è¯•éªŒä¸åŒçš„æ•°æ®ç»“æ„å»å‡å°‘å†…å­˜çš„ä½¿ç”¨ï¼Œå³å¯ä»¥ç¡®å®šå¹¿æ’­å˜é‡å ç”¨ç©ºé—´å¯ä»¥æ¶ˆè€—æ¯ä¸ªå¯æ‰§è¡Œå †çš„æƒ…å†µã€‚</p>
<h4 id="u4F18_u5316_u6570_u636E_u7ED3_u6784"><a href="#u4F18_u5316_u6570_u636E_u7ED3_u6784" class="headerlink" title="ä¼˜åŒ–æ•°æ®ç»“æ„"></a>ä¼˜åŒ–æ•°æ®ç»“æ„</h4><p>é¦–é€‰çš„é™ä½å†…å­˜æ¶ˆè€—çš„æ–¹æ³•æ˜¯é¿å…ä½¿ç”¨å…·æœ‰Javaçš„ç‰¹æ€§å¯¼è‡´çš„å¼€é”€ï¼Œæ¯”å¦‚åŸºäºæŒ‡é’ˆçš„æ•°æ®ç»“æ„æ ¸åŒ…è£…ç±»ã€‚æœ‰å¤šç§æ–¹å¼å¯ä»¥åšåˆ°ï¼š</p>
<ul>
<li>è®¾è®¡ä½ çš„æ•°æ®ç»“æ„ä»¥æå‡å¯¹è±¡æ•°ç»„å’ŒåŸå§‹ç±»å‹ï¼Œç”¨æ¥æ›¿æ¢æ ‡å‡†çš„Javaæˆ–è€…Scalaçš„é›†åˆç±»ï¼ˆæ¯”å¦‚ï¼šHashMapï¼‰ã€‚<br>fastutilç±»åº“ä¸ºåŸå§‹ç±»å‹æä¾›äº†é€‚å½“çš„é›†åˆç±»å‹ï¼Œå¯ä»¥å…¼å®¹Javaçš„æ ‡å‡†åº“ã€‚</li>
<li>å°½é‡é¿å…åŒ…å«å¤§é‡å°å¯¹è±¡æ ¸æŒ‡é’ˆçš„åµŒå¥—æ•°æ®ç»“æ„ã€‚</li>
<li>è€ƒè™‘ä½¿ç”¨æ•°å­—ç±»å‹çš„IDæˆ–è€…æšä¸¾å¯¹è±¡æ¥æ›¿ä»£å­—ç¬¦ä¸²è¡Œçš„keyã€‚</li>
<li>å¦‚æœä½ çš„RAMä¸è¶³32GBï¼Œå¯ä»¥é€šè¿‡è®¾ç½®JVMçš„-XX:+UseCompressedOopså‚æ•°ï¼Œä¿®æ”¹æŒ‡é’ˆé»˜è®¤å ç”¨8å­—èŠ‚ä¸º4ä¸ªå­—èŠ‚ã€‚ä¹Ÿå¯ä»¥è®²è¿™äº›å‚æ•°åŠ åˆ°spaspark-env.shä¸­ã€‚</li>
</ul>
<h4 id="u5E8F_u5217_u5316_u7684RDD_u5B58_u50A8"><a href="#u5E8F_u5217_u5316_u7684RDD_u5B58_u50A8" class="headerlink" title="åºåˆ—åŒ–çš„RDDå­˜å‚¨"></a>åºåˆ—åŒ–çš„RDDå­˜å‚¨</h4><p>é€šè¿‡ä»¥ä¸Šçš„ä¼˜åŒ–ï¼Œä½ çš„å¯¹è±¡ä»ç„¶å¾ˆå¤§ä»è€Œå½±å“åˆ°é«˜æ•ˆçš„å­˜å‚¨çš„è¯ï¼Œä¸€ç§æ›´åŠ ç®€å•çš„å‡å°‘å†…å­˜ä½¿ç”¨çš„æ–¹æ³•æ˜¯é€šè¿‡RDDçš„æŒä¹…åŒ–APIåºåˆ—åŒ–StorageLevelsï¼Œä»è€Œä½¿ä»–ä»¬ä»¥åºåˆ—åŒ–çš„æ–¹å¼å­˜å‚¨ï¼Œæ¯”å¦‚MEMORY_ONLY_SERã€‚Sparkè¿™æ—¶å°±å¯ä»¥å°†æ¯ä¸ªRDDä½œä¸ºä¸€ä¸ªå¤§å­—èŠ‚æ•°ç»„åˆ†åŒºå­˜å‚¨ã€‚å”¯ä¸€çš„ä¸è¶³æ˜¯ï¼Œåºåˆ—åŒ–å­˜å‚¨çš„æ•°æ®æ¯æ¬¡è¯»å–çš„æ—¶å€™ä¼šå¾ˆæ…¢ï¼Œè¿™ä¸ªå–å†³äºæ¯ä¸ªå¯¹è±¡çš„ååºåˆ—åŒ–ï¼ˆon the flyï¼‰ã€‚æˆ‘ä»¬å¼ºçƒˆå»ºè®®ä½¿ç”¨Kryoä½œä¸ºç¼“å­˜åºåˆ—åŒ–æ•°æ®çš„æ–¹æ³•ï¼Œè¿™æ ·å¯ä»¥æ¯”Javaåºåˆ—åŒ–å ç”¨æ›´å°‘çš„ç©ºé—´ï¼ˆç”šè‡³æ˜¯åŸå§‹çš„Javaå¯¹è±¡ï¼‰</p>
<h4 id="GC_u4F18_u5316"><a href="#GC_u4F18_u5316" class="headerlink" title="GCä¼˜åŒ–"></a>GCä¼˜åŒ–</h4><p>JVM çš„GCå¯èƒ½ä¼šæ˜¯ä¸€ä¸ªé—®é¢˜ï¼Œå½“ä½ çš„ç¨‹åºåœ¨å­˜å‚¨ä¸€ä¸ªRDDæ–¹é¢å­˜åœ¨ä¸€ä¸ªå¾ˆå¤§çš„ã€churnã€ã€‚ï¼ˆä»–ä¸ä¼šæ˜¯ä¸€ä¸ªå¤§é—®é¢˜ï¼Œå¦‚æœåªæ˜¯æ¯æ¬¡è¯»å–ä¸€ä¸ªRDDï¼Œå¹¶å¤šæ¬¡æ“ä½œï¼‰å½“Javaéœ€è¦é€æ¸çš„ç”¨æ–°å¯¹è±¡æ›¿æ¢æ—§å¯¹è±¡æ—¶ï¼ŒGCå°±ä¼šè¿½è¸ªä½ çš„æ‰€æœ‰Javaå¯¹è±¡ï¼Œæ‰¾åˆ°å¹¶æ›¿æ¢æ‰ã€‚è¿™é‡Œçš„é‡ç‚¹æŒ‡å‡ºçš„ï¼ŒGCçš„æ‰§è¡Œæˆæœ¬æ˜¯ä¸Javaå¯¹è±¡çš„ä¸ªæ•°æˆæ­£æ¯”çš„ï¼Œå› æ­¤ä½¿ç”¨æ›´å°‘å¯¹è±¡çš„æ•°æ®ç»“æ„å¯ä»¥å¤§å¤§é™ä½GCçš„æˆæœ¬ï¼ˆæ¯”å¦‚ä¸€ä¸ªIntç±»å‹çš„æ•°ç»„æ›¿æ¢LinkedListçš„æ•°ç»„ï¼‰ã€‚æ›´å¥½çš„æ–¹æ³•æ˜¯æŒä¹…åŒ–è¢«åºåˆ—åŒ–ä¹‹åçš„å¯¹è±¡ï¼Œå¦‚ä¸Šè¿°ï¼Œåœ¨æ¯ä¸ªRDDåˆ†åŒºé‡Œåªä¼šå­˜åœ¨ä¸€ä¸ªå¯¹è±¡ï¼ˆä¸€ä¸ªå­—èŠ‚æ•°ç»„ï¼‰ã€‚åœ¨å°è¯•å…¶ä»–æŠ€æœ¯ä¹‹å‰ï¼Œå¦‚æœGCæ˜¯ä¸€ä¸ªé—®é¢˜ï¼Œé‚£ä¹ˆç¬¬ä¸€ä»¶äº‹å°±æ˜¯å°è¯•åºåˆ—åŒ–çš„ç¼“å­˜ã€‚</p>
<p>ä½ çš„ä»»åŠ¡çš„å ç”¨çš„æ´»åŠ¨å†…å­˜æ ¸ç¼“å­˜åœ¨ä½ èŠ‚ç‚¹ä¸Šçš„RDDä¹‹é—´çš„å¹²æ‰°ä¹Ÿä¼šå¯¼è‡´GCå‡ºç°é—®é¢˜ï¼ˆéœ€è¦æ‰§è¡Œä»»åŠ¡æ‰€éœ€çš„å†…å®¹æ€»é‡ï¼‰ã€‚æˆ‘ä»¬å°†ä¼šè®¨è®ºæ€æ ·æ§åˆ¶åˆ†é…ç»™RDDç¼“å­˜çš„ç©ºé—´ä»¥å‡å°‘è¿™ç§å½±å“ã€‚</p>
<h5 id="u8861_u91CFGC_u7684_u5F71_u54CD"><a href="#u8861_u91CFGC_u7684_u5F71_u54CD" class="headerlink" title="è¡¡é‡GCçš„å½±å“"></a>è¡¡é‡GCçš„å½±å“</h5><p>GCä¼˜åŒ–çš„ç¬¬ä¸€æ­¥éœ€è¦å…ˆæ‰‹æœºç»Ÿè®¡æ•°æ®ï¼šGCå‘ç”Ÿçš„é¢‘ç‡å’Œå‘è´¹çš„æ—¶é—´ã€‚è¿™ä¸ªå¯ä»¥é€šè¿‡æ·»åŠ è®¾ç½®javaå‚æ•°-verbose:gc -XX:+PrintGCDetails -XX:+PrintGCTimeStampså®ç°ã€‚ï¼ˆè¯¦æƒ…è§ä¼ é€’Javaå‚æ•°åˆ°Sparkä»»åŠ¡çš„æŒ‡å—ï¼‰ä¸‹ä¸€æ¬¡ä½ çš„Sparkä»»åŠ¡æ‰§è¡Œæ—¶ï¼Œä½ å°±å¯ä»¥åœ¨æ¯ä¸ªworkerçš„æ—¥å¿—ä¸­çœ‹åˆ°å…³äºGCäº‹ä»¶çš„ä¿¡æ¯ã€‚æ³¨æ„ï¼Œè¿™äº›æ—¥å¿—æ—¶å­˜æ”¾åˆ°workerèŠ‚ç‚¹ä¸Šçš„ï¼Œå¹¶ä¸æ˜¯åœ¨driver ç¨‹åºä¸Šã€‚</p>
<h5 id="u7F13_u51B2_u5927_u5C0F_u4F18_u5316"><a href="#u7F13_u51B2_u5927_u5C0F_u4F18_u5316" class="headerlink" title="ç¼“å†²å¤§å°ä¼˜åŒ–"></a>ç¼“å†²å¤§å°ä¼˜åŒ–</h5><p>GCä¸€ä¸ªé‡è¦çš„é…ç½®å‚æ•°æ˜¯åˆ†é…ç»™ç¼“å­˜RDDä½¿ç”¨çš„å†…å­˜æ€»é‡ã€‚ç¼ºçœæƒ…å†µä¸‹ï¼ŒSparkä¼šä½¿ç”¨é…ç½®ç»™executor memory (spark.executor.memory) 60%çš„å†…å­˜é‡ç¼“å†²RDDã€‚ä¹Ÿå°±æ˜¯è¯´40%çš„å†…å­˜æ˜¯ç”¨äºåœ¨ä»»åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­ä»»ä½•å…¶å®ƒçš„å¯¹è±¡ã€‚</p>
<p>å½“ä½ çš„ä»»åŠ¡é€Ÿåº¦ç¼“æ…¢ï¼Œå¹¶ä¸”å‘ç°JVM GCé¢‘ç‡ç‰¹åˆ«é¢‘ç¹æˆ–è€…å‡ºç°å†…å­˜æº¢å‡ºçš„é—®é¢˜æ—¶ï¼Œé™ä½è¿™ä¸ªå€¼ä¼šå¯¹é™ä½å†…å­˜æ¶ˆè€—æä¾›å¸®åŠ©ã€‚ä¿®æ”¹è¿™ä¸ªå€¼å¯ä»¥é€šè¿‡è®¾ç½®spark.storage.memoryFractionï¼Œæ¯”å¦‚ä¿®æ”¹æˆ50%ï¼Œåˆ™å¯ä»¥conf.set(â€œspark.storage.memoryFractionâ€, â€œ0.5â€)ã€‚ç»“åˆä½¿ç”¨åºåˆ—åŒ–ç¼“å­˜ï¼Œä½¿ç”¨æ›´å°‘çš„ç¼“å­˜å°±å¯ä»¥å……åˆ†çš„å‡è½»å¤§éƒ¨åˆ†çš„GCé—®é¢˜ã€‚</p>
<h5 id="u9AD8_u7EA7GC_u4F18_u5316"><a href="#u9AD8_u7EA7GC_u4F18_u5316" class="headerlink" title="é«˜çº§GCä¼˜åŒ–"></a>é«˜çº§GCä¼˜åŒ–</h5><p>æ›´è¿›ä¸€æ­¥çš„GCä¼˜åŒ–ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦ç†è§£ä¸€äº›åŸºæœ¬çš„JVMç®¡ç†å†…å­˜ç®¡ç†çŸ¥è¯†ï¼š</p>
<ul>
<li>Javaå †ç©ºé—´è¢«åˆ’åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†Young å’Œ Oldã€‚Young generationç”¨æ¥ä¿å­˜çŸ­å‘¨æœŸçš„å¯¹è±¡ï¼ŒåŒæ—¶Old generationæ˜¯ç”¨æ¥ä¿æŒé•¿å‘¨æœŸå¯¹è±¡ã€‚</li>
<li>Young generationè¢«è¿›ä¸€æ­¥åˆ’åˆ†ä¸º3éƒ¨åˆ†ï¼šEden, Survivor1, Survivor2ã€‚</li>
<li>ä¸€ä¸ªç®€å•çš„å…³äºåƒåœ¾å›æ”¶ç¨‹åºçš„æè¿°ï¼šå½“Edenæ»¡äº†çš„æ—¶å€™ï¼Œa minor GC is run on Eden and objects that are alive from Eden and Survivor1 are copied to Survivor2ã€‚Survivoréƒ¨åˆ†æ˜¯å¯ä»¥äº¤æ¢çš„ã€‚å¦‚æœä¸€ä¸ªå¯¹è±¡å·²ç»æ—§äº†æˆ–è€…Survivor2æ»¡äº†ï¼Œä»–å°±ä¼šè¢«ç§»åŠ¨åˆ°æ—§çš„éƒ¨åˆ†ã€‚æœ€åï¼Œå½“æ—§çš„éƒ¨åˆ†æ¥è¿‘æ»¡çš„æ—¶å€™ï¼Œä¸€ä¸ªæ»¡çš„GCå°±ä¼šè¢«å”¤èµ·ã€‚</li>
</ul>
<p>Sparkä¸­GCä¼˜åŒ–çš„ç›®æ ‡æ˜¯ç¡®ä¿åªæœ‰éœ€è¦é•¿ä¹…å­˜åœ¨çš„RDDæ‰ä¼šè¢«å­˜å‚¨åœ¨Old generationï¼ŒYoung generationæœ‰è¶³å¤Ÿçš„ç©ºé—´å¤„å¤„çŸ­å‘¨æœŸçš„å¯¹è±¡ã€‚è¿™å°±å¯ä»¥å¸®åŠ©é¿å…full GCsåœ¨ä»»åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­æ”¶é›†ä¸´æ—¶ä»»åŠ¡ã€‚è¿™é‡Œçš„ä¸€äº›æ­¥éª¤å¯èƒ½ä¼šæ¯”è¾ƒæœ‰ç”¨ï¼š</p>
<ul>
<li>é€šè¿‡æ£€æŸ¥GCçš„çŠ¶æ€æ£€æŸ¥æ˜¯å¦å­˜åœ¨å¤šä¸ªåƒåœ¾å›æ”¶ã€‚å¦‚æœä¸€ä¸ªfull GCåœ¨ä¸€ä¸ªä»»åŠ¡ç»“æŸä¹‹å‰è¢«å¤šæ¬¡å”¤é†’ï¼Œè¿™å°±æ„å‘³ç€æ²¡æœ‰è¶³å¤Ÿçš„å¯ç”¨å†…å­˜æ¶Œæ¥æ‰§è¡Œä»»åŠ¡ã€‚</li>
<li>In the GC stats that are printedï¼Œå¦‚æœOldGenæ¥è¿‘æ»¡çš„çŠ¶æ€çš„è¯ï¼Œå°±å‡å°‘ç¼“å­˜çš„å†…å­˜æ€»é‡ã€‚è¿™ä¸ªå¯ä»¥é€šè¿‡è®¾ç½®spark.storage.memoryFraction propertyæ¥è¾¾æˆã€‚ç¼“å­˜æ›´å°‘çš„å¯¹è±¡æ€»æ¯”å‡æ…¢ä»»åŠ¡æ‰§è¡Œé€Ÿåº¦è¦å¥½çš„å¤šï¼</li>
<li>å¦‚æœå­˜åœ¨å¾ˆå¤šçš„æ¬¡è¦collectionsè€Œä¸æ˜¯å¾ˆå¤šçš„ä¸»è¦çš„GCsï¼Œç»™Edenåˆ†é…æ›´å¤šçš„å†…å­˜ä¼šæœ‰æ‰€å¸®åŠ©ã€‚ä½ å¯ä»¥è®¾ç½®Edenç¨å¾®é«˜äº›çš„å†…å­˜ç»™æ¯ä¸ªä»»åŠ¡ã€‚å¦‚æœEdenè¡¨ç¤ºæˆEï¼Œé‚£ä¹ˆå¯ä»¥é€šè¿‡è®¾ç½®Young generationçš„å‚æ•°å¤§å°ä¸º-Xmn=4/3*Eã€‚ï¼ˆThe scaling up by 4/3 is to account for space used by survivor regions as well.ï¼‰</li>
<li>ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æœä½ çš„ä»»åŠ¡æ­£åœ¨ä»HDFSä¸­è¯»å–æ•°æ®ï¼Œä»»åŠ¡ä½¿ç”¨çš„å†…å­˜è¢«æ ‡è®°ä¸ºæ•°æ®çš„å—å¤§å°ã€‚<br>æ³¨æ„ï¼Œè§£å‹åçš„æ•°æ®å—å¤§çº¦æ˜¯ä¹‹å‰æ•°æ®çš„2ï½3å€ã€‚å› æ­¤æˆ‘ä»¬å¸Œæœ›æœ‰3æˆ–è€…4ä¸ªä»»åŠ¡çš„å·¥ä½œç©ºé—´ï¼Œå¹¶ä¸”HDFSå—çš„å¤§å°æ˜¯64Mï¼Œæˆ‘ä»¬å°±å¯ä»¥ä¼°ç®—å‡ºEdenå¤§å°å¤§çº¦æ˜¯4<em>3</em>64MBã€‚</li>
<li>é€šè¿‡ä¿®æ”¹æ–°çš„è®¾ç½®æ¥ç›‘æµ‹åƒåœ¾å›æ”¶çš„é¢‘ç‡å’Œæ—¶é—´</li>
</ul>
<p>æˆ‘çš„ç»éªŒå¾—å‡ºGCä¼˜åŒ–çš„æ”¹è¿›å–å†³äºä½ çš„ç¨‹åºå’Œå¯ç”¨çš„å†…å­˜æ€»é‡ã€‚åœ¨ç½‘ä¸Šæœ‰å¾ˆå¤šä¼˜åŒ–é€‰é¡¹çš„æè¿°ï¼Œä½†æ˜¯å†è¿›ä¸€æ­¥ï¼Œç®¡ç†full GCçš„é¢‘ç‡å¯ä»¥æœ‰åŠ©äºé™ä½é¡¶å±‚é™åˆ¶ã€‚</p>
<h3 id="u5176_u5B83_u9700_u8981_u8003_u8651_u7684_u4E8B_u60C5"><a href="#u5176_u5B83_u9700_u8981_u8003_u8651_u7684_u4E8B_u60C5" class="headerlink" title="å…¶å®ƒéœ€è¦è€ƒè™‘çš„äº‹æƒ…"></a>å…¶å®ƒéœ€è¦è€ƒè™‘çš„äº‹æƒ…</h3><h4 id="u5E76_u884C_u7684_u6C34_u5E73"><a href="#u5E76_u884C_u7684_u6C34_u5E73" class="headerlink" title="å¹¶è¡Œçš„æ°´å¹³"></a>å¹¶è¡Œçš„æ°´å¹³</h4><p>èŠ‚ç‚¹ä¸ä¼šè¢«å……åˆ†åˆ©ç”¨ï¼Œé™¤éå–‚æ¯ä¸ªæ“ä½œè®¾ç½®äº†è¶³å¤Ÿé«˜çš„å¹¶è¡Œæ°´å¹³ã€‚Sparkä¼šè‡ªåŠ¨è®¾ç½®â€œmapâ€ä»»åŠ¡çš„æ•°é‡æ‰§è¡Œæ¯ä¸ªæ–‡ä»¶ä»¥å’Œä»–çš„å¤§å°ä¿æŒä¸€è‡´ï¼ˆå°½ç®¡ä½ å¯ä»¥é€šè¿‡SparkContext.textFileçš„å¯é€‰å‚æ•°æ§åˆ¶ï¼‰ï¼Œå¹¶ä¸”å¯¹äºåˆ†å¸ƒå¼çš„â€œreduceâ€æ“ä½œï¼Œæ¯”å¦‚groupByKey å’Œ reduceByKeyï¼Œä¼šä½¿ç”¨æœ€å¤§çš„çˆ¶RDDçš„åˆ†åŒºæ•°ã€‚ä½ å¯ä»¥ä¼ é€’å¹¶è¡Œçš„levelä½œä¸ºç¬¬äºŒä¸ªå‚æ•°ï¼Œæ´»ç€è®¾ç½®spark.default.parallelismé…ç½®å±æ€§æ”¹å˜é»˜è®¤å€¼ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å»ºè®®åœ¨èŠ‚ç‚¹ä¸Šæ¯ä¸ªCPUå†…æ ¸æ‰§è¡Œ2ï½3ä¸ªä»»åŠ¡ã€‚</p>
<h4 id="u964D_u4F4E_u4EFB_u52A1_u7684_u5185_u5B58_u4F7F_u7528"><a href="#u964D_u4F4E_u4EFB_u52A1_u7684_u5185_u5B58_u4F7F_u7528" class="headerlink" title="é™ä½ä»»åŠ¡çš„å†…å­˜ä½¿ç”¨"></a>é™ä½ä»»åŠ¡çš„å†…å­˜ä½¿ç”¨</h4><p>æœ‰æ—¶ï¼Œä½ å¯èƒ½å¾—åˆ°OutOfMemoryErroré”™è¯¯ï¼Œä½†æ˜¯è¿™å¹¶ä¸æ˜¯å› ä¸ºä½ çš„Rddä¸é€‚åˆä½ çš„å†…å­˜ï¼Œè€Œæ˜¯å› ä¸ºä»»åŠ¡ä¸­çš„å…¶ä¸­ä¸€ä¸ªçš„è®¾ç½®ï¼Œæ¯”å¦‚å…¶ä¸­ä¸€ä¸ªreduceä»»åŠ¡æ‰§è¡ŒgroupByKeyæ—¶å¤ªå¤§ã€‚Sparkçš„shuffleæ“ä½œï¼ˆsortByKey, groupByKey, reduceByKey, joinç­‰ï¼‰ä¼šåˆ›å»ºä¸€ä¸ªå“ˆå¸Œè¡¨å¹¶ä¸”æ¯ä¸ªä»»åŠ¡ä¼šæ‰§è¡Œgroupingæ“ä½œï¼Œè¿™ä¸ªé€šå¸¸æƒ…å†µä¸‹ä¹Ÿä¼šå¾ˆå¤§ã€‚æ­¤æ—¶æœ€ç®€å•çš„è§£å†³åŠæ³•æ˜¯å¢åŠ å¹¶è¡Œçš„æ°´å¹³ï¼Œä»¥é™ä½ä»»åŠ¡çš„è¾“å…¥é›†å¤§å°ã€‚Sparkå¯ä»¥é«˜æ•ˆçš„æ”¯æŒä»»åŠ¡ï¼Œå› ä¸ºå®ƒå¯ä»¥é‡å¤åˆ©ç”¨ä¸€ä¸ªexecutor JVMï¼Œå¹¶ä¸”æœ‰å¾ˆä½çš„ä»»åŠ¡åŠ è½½æ¶ˆè€—ï¼Œæ‰€ä»¥ä½ å¯ä»¥å®‰å…¨çš„å¢åŠ å¹¶å‘æ°´å¹³ï¼Œç”šè‡³è¶…è¿‡ä½ èŠ‚ç‚¹ä¸Šæ ¸å¿ƒçš„æ•°ç›®ã€‚</p>
<h4 id="u5E7F_u64AD_u5927_u53D8_u91CF"><a href="#u5E7F_u64AD_u5927_u53D8_u91CF" class="headerlink" title="å¹¿æ’­å¤§å˜é‡"></a>å¹¿æ’­å¤§å˜é‡</h4><p>ä½¿ç”¨SparkContextä¸Šå¯ç”¨çš„å¹¿æ’­åŠŸèƒ½å¯ä»¥æ˜æ˜¾çš„å‡å°‘æ¯ä¸ªåºåˆ—åŒ–ä»»åŠ¡çš„å¤§å°ï¼Œå’Œé€šè¿‡èŠ‚ç‚¹åŠ è½½ä»»åŠ¡çš„æ¶ˆè€—ã€‚å¦‚æœä½ çš„ä»»åŠ¡ä½¿ç”¨æ¥è‡ªdriverç¨‹åºçš„å¤§çš„å¯¹è±¡ï¼ˆæ¯”å¦‚ï¼šé™æ€æŸ¥æ‰¾è¡¨ï¼‰ï¼Œè¯•ç€è½¬åŒ–æˆä¸€ä¸ªå¹¿æ’­å˜é‡ã€‚Sparkæ‰“å°å‡ºä¸»èŠ‚ç‚¹ä¸Šæ¯ä¸ªä»»åŠ¡çš„åºåˆ—åŒ–åçš„å¤§å°ï¼Œä»è€Œä½ å¯ä»¥é€šè¿‡è¿™ä¸ªå†³å®šä½ çš„ä»»åŠ¡æ˜¯å¦è¿‡å¤§ï¼›é€šå¸¸çš„ä»»åŠ¡å¤§äº20KBå°±å€¼å¾—ä¼˜åŒ–äº†ã€‚</p>
<h4 id="u6570_u636E_u7684_u4F4D_u7F6E"><a href="#u6570_u636E_u7684_u4F4D_u7F6E" class="headerlink" title="æ•°æ®çš„ä½ç½®"></a>æ•°æ®çš„ä½ç½®</h4><p>æ•°æ®çš„ä½ç½®å¯èƒ½æ˜¯å½±å“Sparkä½œä¸šçš„æœ€ä¸»è¦çš„ä¸€ä¸ªå½±å“å› ç´ ã€‚å¦‚æœæ•°æ®å’Œä»£ç è¢«æ”¾ç½®åœ¨ä¸€èµ·çš„è¯ï¼Œè®¡ç®—é€Ÿåº¦ä¼šæ˜æ˜¾åŠ å¿«ã€‚ä½†æ˜¯å¦‚æœä»£ç å’Œæ•°æ®æ˜¯åˆ†å¼€çš„ï¼Œä¸åŒçš„ä¸¤å—æ•°æ®ä¼šè¢«ç§»åŠ¨åˆ°ä¸€èµ·ã€‚ç‰¹åˆ«æ˜¯ï¼Œä¼ è¾“åºåˆ—åŒ–çš„ä»£ç æ¯”æ•°æ®å—è¦å¿«å¾ˆå¤šï¼Œè¿™æ˜¯å› ä¸ºä»£ç çš„å¤§å°æ¯”æ•°æ®å°å¾ˆå¤šã€‚Sparkæ„å»ºè°ƒåº¦çš„ä¸»è¦åŸåˆ™å°±æ˜¯ç”±æ•°æ®çš„ä½ç½®å†³å®šçš„ã€‚</p>
<p>æ•°æ®çš„ä½ç½®åˆ°åº•è·ç¦»æ“ä½œä»–çš„ä»£ç å¤šè¿‘çš„è·ç¦»æ‰åˆé€‚å‘¢ï¼Ÿè¿™é‡Œå­˜åœ¨å¤šä¸ªçº§åˆ«ï¼ˆè‡ªè¿‘åŠè¿œï¼‰ï¼š</p>
<ul>
<li>PROCESS_LOCAL  æ•°æ®å’Œä»£ç åœ¨åŒä¸€ä¸ªJVMä¸­ï¼Œè¿™ç§æ–¹å¼æ˜¯æœ€å¥½çš„ä¸€ç§æƒ…å†µ</li>
<li>NODE_LOCAL æ•°æ®åœ¨åŒä¸€ä¸ªèŠ‚ç‚¹ã€‚æ¯”å¦‚è¯´åœ¨HDFSçš„åŒä¸€ä¸ªèŠ‚ç‚¹ï¼Œæˆ–è€…ç›¸åŒèŠ‚ç‚¹çš„ä¸åŒexecutorã€‚<br>è¿™ç§æ–¹å¼æ¯”PROCESS_LOCALç¨å¾®æ…¢äº›ï¼Œå› ä¸ºè¿™ç§æƒ…å†µä¸‹ï¼Œæ•°æ®éœ€è¦åœ¨ä¸åŒè¿›ç¨‹ä¸­ä¼ è¾“</li>
<li>NO_PREF data is accessed equally quickly from anywhere and has no locality preference</li>
<li>RACK_LOCAL æ•°æ®åœ¨åŒä¸€ä¸ªæœåŠ¡å™¨æœºæ¶ã€‚æ•°æ®åœ¨åŒä¸€ä¸ªæœºæ¶çš„ä¸åŒçš„æœåŠ¡å™¨ä¸Šçš„è¯ï¼Œæ•°æ®éœ€è¦é€šè¿‡ç½‘ç»œè¿›è¡Œä¼ è¾“ï¼Œtypically through a single switch</li>
<li>ANY æ•°æ®åˆ†å¸ƒåœ¨ç½‘ç»œçš„å„ä¸ªåœ°æ–¹ï¼Œå¹¶ä¸”ä¸åœ¨åŒä¸€ä¸ªæœºæ¶</li>
</ul>
<p>Sparkæ›´å€¾å‘äºè°ƒåº¦æœ€å¥½çš„localityçº§åˆ«çš„æ‰€æœ‰ä»»åŠ¡ï¼Œä½†æ˜¯è¿™å¹¶ä¸æ˜¯ç»å¸¸å‘ç”Ÿçš„ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä¸åœ¨å¤„ç†æ•°æ®çš„ä»»ä½•ç©ºé—²executorï¼ŒSparkéƒ½ä¼šé€‰æ‹©æ›´ä½çš„localityçº§åˆ«ã€‚è¿™æœ‰ä¸¤ç§é€‰æ‹©ï¼š</p>
<ul>
<li>ç­‰å¾…åŒä¸€ä¸ªæœåŠ¡å™¨ä¸Šçš„ä»»åŠ¡ï¼Œç›´åˆ°å¯¹åº”çš„CPUé—²ä¸‹æ¥æ‰æ‰§è¡Œ</li>
<li>ç«‹å³æ‰§è¡Œä¸€ä¸ªæ–°ä»»åŠ¡ï¼Œå¹¶é€šè¿‡ç§»åŠ¨æ•°æ®åˆ°æ›´è¿œçš„èŠ‚ç‚¹æ‰§è¡Œ</li>
</ul>
<p>Sparké€šå¸¸ä¼šç¨å¾®ç­‰ä¸€ä¸‹ï¼Œä»¥ç­‰å¾…CPUæ‰§è¡Œå®Œæ¯•ã€‚ä¸€æ—¦è¶…æ—¶ï¼Œä»–å°±ä¼šå°†è¿œç«¯çš„æ•°æ®ä¼ é€’ç»™ç©ºé—²çš„CPUã€‚ä¸åŒçº§åˆ«çš„ç­‰å¾…è¶…æ—¶å›é€€å¯ä»¥å•ç‹¬é…ç½®ï¼Œæˆ–è€…åœ¨ä¸€ä¸ªå‚æ•°ä¸­é›†ä¸­ä¿®æ”¹ï¼›å‰å¾€é…ç½®é¡µæŸ¥çœ‹spark.localityå‚æ•°è¯¦æƒ…ã€‚å¦‚æœä½ çš„ä»»åŠ¡are long and see poor localityï¼Œä½ ä¹Ÿå¯ä»¥ä¿®æ”¹è®¾ç½®ï¼Œä½†æ˜¯ç¼ºçœå€¼æ˜¯å®Œå…¨å¯ä»¥æ»¡è¶³è¦æ±‚çš„ã€‚</p>
<h3 id="u603B_u7ED3"><a href="#u603B_u7ED3" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>è¿™æ˜¯ä¸€ä¸ªç®€çŸ­çš„ä»‹ç»ï¼Œå…¶ä¸­æŒ‡å‡ºäº†ä½ å¯èƒ½éœ€è¦äº†è§£çš„ä¼˜åŒ–Sparkåº”ç”¨çš„æœ€ä¸»è¦çš„è¦ç‚¹ï¼Œæ•°æ®åºåˆ—åŒ–å’Œå†…å­˜ä¼˜åŒ–ã€‚å¯¹äºå¤§å¤šæ•°çš„ç¨‹åºæ¥è¯´ï¼Œé€‰æ‹©Kryoåºåˆ—åŒ–ï¼Œå¹¶ä¸”ä»¥åºåˆ—åŒ–å½¢å¼ä¿å­˜æ•°æ®å¯ä»¥è§£å†³å¤§éƒ¨åˆ†ä¸€èˆ¬çš„æ€§èƒ½é—®é¢˜ã€‚Feel free to ask on the Spark mailing list about other tuning best practices.</p>
]]></content>
    <summary type="html">
    <![CDATA[<!--  -->
<!--  -->
<!--  _ __    __     __      ____    ___     ___   _____   __  __    ___     -->
<!-- /\`'__\/'__`\ /'__`\   /',__\  / _]]>
    </summary>
    
      <category term="spark" scheme="http://reasonpun.com/tags/spark/"/>
    
      <category term="ä¼˜åŒ–" scheme="http://reasonpun.com/tags/%E4%BC%98%E5%8C%96/"/>
    
      <category term="æ•°æ®æŒ–æ˜" scheme="http://reasonpun.com/categories/%E6%95%B0%E6%8D%AE%E6%8C%96%E6%8E%98/"/>
    
      <category term="å®æ—¶è®¡ç®—" scheme="http://reasonpun.com/categories/%E6%95%B0%E6%8D%AE%E6%8C%96%E6%8E%98/%E5%AE%9E%E6%97%B6%E8%AE%A1%E7%AE%97/"/>
    
      <category term="ä¼˜åŒ–" scheme="http://reasonpun.com/categories/%E6%95%B0%E6%8D%AE%E6%8C%96%E6%8E%98/%E5%AE%9E%E6%97%B6%E8%AE%A1%E7%AE%97/%E4%BC%98%E5%8C%96/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[Pythonå…³é”®å­—:yield]]></title>
    <link href="http://reasonpun.com/2016/01/02/Python%E5%85%B3%E9%94%AE%E5%AD%97-yield/"/>
    <id>http://reasonpun.com/2016/01/02/Pythonå…³é”®å­—-yield/</id>
    <published>2016-01-02T09:15:47.000Z</published>
    <updated>2016-01-04T06:13:14.000Z</updated>
    <content type="html"><![CDATA[<!--  -->
<!--  -->
<!--  _ __    __     __      ____    ___     ___   _____   __  __    ___     -->
<!-- /\`'__\/'__`\ /'__`\   /',__\  / __`\ /' _ `\/\ '__`\/\ \/\ \ /' _ `\   -->
<!-- \ \ \//\  __//\ \L\.\_/\__, `\/\ \L\ \/\ \/\ \ \ \L\ \ \ \_\ \/\ \/\ \  -->
<!--  \ \_\\ \____\ \__/.\_\/\____/\ \____/\ \_\ \_\ \ ,__/\ \____/\ \_\ \_\ -->
<!--   \/_/ \/____/\/__/\/_/\/___/  \/___/  \/_/\/_/\ \ \/  \/___/  \/_/\/_/ -->
<!--                                                 \ \_\                   -->
<!--                                                  \/_/                   -->
<!--  -->
<p>æ³¨ï¼šä»¥ä¸‹ä»£ç å®éªŒç¯å¢ƒå‡ä¸º</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">âœ  ~  python</span><br><span class="line">Python <span class="number">2.7</span><span class="number">.10</span> (<span class="keyword">default</span>, Oct <span class="number">23</span> <span class="number">2015</span>, <span class="number">18</span>:<span class="number">05</span>:<span class="number">06</span>)</span><br><span class="line">[GCC <span class="number">4.2</span><span class="number">.1</span> Compatible Apple LLVM <span class="number">7.0</span><span class="number">.0</span> (clang-<span class="number">700.0</span><span class="number">.59</span><span class="number">.5</span>)] on darwin</span><br><span class="line">Type <span class="string">"help"</span>, <span class="string">"copyright"</span>, <span class="string">"credits"</span> or <span class="string">"license"</span> <span class="keyword">for</span> more information.</span><br></pre></td></tr></table></figure>
<h3 id="Yield_u5173_u952E_u5B57"><a href="#Yield_u5173_u952E_u5B57" class="headerlink" title="Yieldå…³é”®å­—"></a>Yieldå…³é”®å­—</h3><p>ç†è§£yieldå…³é”®å­—ä¹‹å‰éœ€è¦å…ˆæ˜ç™½ä»€ä¹ˆæ˜¯è¿­ä»£ã€‚</p>
<h4 id="u53EF_u8FED_u4EE3_u5BF9_u8C61"><a href="#u53EF_u8FED_u4EE3_u5BF9_u8C61" class="headerlink" title="å¯è¿­ä»£å¯¹è±¡"></a>å¯è¿­ä»£å¯¹è±¡</h4><p>å»ºç«‹ä¸€ä¸ªåˆ—è¡¨ä¹‹åï¼Œå¯ä»¥é€é¡¹çš„è¯»å–åˆ—è¡¨ä¸­çš„å…ƒç´ ï¼Œè¿™å°±æ˜¯ä¸€ä¸ªå¯è¿­ä»£çš„å¯¹è±¡ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; <span class="built_in">list</span> = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>]</span><br><span class="line">&gt;&gt;&gt; <span class="keyword">for</span> i in <span class="built_in">list</span>:</span><br><span class="line">...     print i</span><br><span class="line">...</span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="number">4</span></span><br><span class="line">&gt;&gt;&gt;</span><br></pre></td></tr></table></figure>
<p>ä½¿ç”¨åˆ—è¡¨ç”Ÿæˆå™¨å»ºç«‹ä¸€ä¸ªåˆ—è¡¨ï¼ŒåŒæ ·ä¹Ÿæ˜¯åˆ›å»ºäº†ä¸€ä¸ªå¯è¿­ä»£çš„å¯¹è±¡ï¼š</p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; <span class="keyword">list</span> = [x * 2 <span class="keyword">for</span> x <span class="keyword">in</span> <span class="keyword">range</span>(3)]</span><br><span class="line">&gt;&gt;&gt; <span class="keyword">list</span></span><br><span class="line">[0, 2, 4]</span><br><span class="line">&gt;&gt;&gt; <span class="keyword">for</span> i <span class="keyword">in</span> <span class="keyword">list</span>:</span><br><span class="line">...     <span class="keyword">print</span> <span class="literal">i</span></span><br><span class="line">...</span><br><span class="line">0</span><br><span class="line">2</span><br><span class="line">4</span><br><span class="line">&gt;&gt;&gt;</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥ä½¿ç”¨for .. in .. çš„æ–¹å¼å¤„ç†ï¼šé“¾è¡¨ï¼Œå­—ç¬¦ä¸²ç­‰ï¼Œè¿™å°±å«åšä¸€ä¸ªè¿­ä»£å™¨ã€‚ä½†æ˜¯è¿™æ ·ä¼šå°†æ•°æ®å­˜æ”¾åˆ°å†…å­˜ä¸­ï¼Œå¦‚æœæ•°æ®é‡è¿‡å¤§çš„è¯ï¼Œå°±éå¸¸ä¸é€‚åˆäº†ã€‚</p>
<h4 id="u751F_u6210_u5668"><a href="#u751F_u6210_u5668" class="headerlink" title="ç”Ÿæˆå™¨"></a>ç”Ÿæˆå™¨</h4><p><a href="http://pyzh.readthedocs.org/en/latest/the-python-yield-keyword-explained.html" target="_blank" rel="external">ç”Ÿæˆå™¨æ˜¯å¯ä»¥è¿­ä»£çš„ï¼Œä½†æ˜¯ä½  åªå¯ä»¥è¯»å–å®ƒä¸€æ¬¡ ï¼Œå› ä¸ºå®ƒå¹¶ä¸æŠŠæ‰€æœ‰çš„å€¼æ”¾åœ¨å†…å­˜ä¸­ï¼Œå®ƒæ˜¯å®æ—¶åœ°ç”Ÿæˆæ•°æ®</a></p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; <span class="keyword">g</span> = (x * 2 <span class="keyword">for</span> x <span class="keyword">in</span> <span class="keyword">range</span>(3))</span><br><span class="line">&gt;&gt;&gt; <span class="keyword">g</span></span><br><span class="line">&lt;generator object &lt;genexpr&gt; at 0x10978ca00&gt;</span><br><span class="line">&gt;&gt;&gt; <span class="keyword">for</span> i <span class="keyword">in</span> <span class="keyword">g</span>:</span><br><span class="line">...     <span class="keyword">print</span> <span class="literal">i</span></span><br><span class="line">...</span><br><span class="line">0</span><br><span class="line">2</span><br><span class="line">4</span><br><span class="line">&gt;&gt;&gt; <span class="keyword">for</span> i <span class="keyword">in</span> <span class="keyword">g</span>:</span><br><span class="line">...     <span class="keyword">print</span> <span class="literal">i</span></span><br><span class="line">...</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">&gt;&gt;&gt;</span><br></pre></td></tr></table></figure>
<h4 id="yield_u5173_u952E_u5B57"><a href="#yield_u5173_u952E_u5B57" class="headerlink" title="yieldå…³é”®å­—"></a>yieldå…³é”®å­—</h4><p>yield æ˜¯ä¸€ä¸ªç±»ä¼¼returnçš„å…³é”®å­—ï¼Œä½†æ˜¯è¿™ä¸ªå‡½æ•°è¿”å›çš„æ˜¯ç”Ÿæˆå™¨ã€‚</p>
<p>åŒæ—¶æˆ‘ä»¬å¯ä»¥åˆ©ç”¨ isgeneratorfunction åˆ¤æ–­ä¸€ä¸ªç‰¹æ®Šçš„ generator å‡½æ•°</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; mg = <span class="function"><span class="title">createGenerator</span><span class="params">()</span></span></span><br><span class="line">&gt;&gt;&gt; print (mg)</span><br><span class="line">&lt;generator <span class="tag">object</span> createGenerator at <span class="number">0</span>x10978c9b0&gt;</span><br><span class="line">&gt;&gt;&gt; <span class="keyword">for</span> <span class="tag">i</span> <span class="keyword">in</span> mg:</span><br><span class="line">...     print <span class="tag">i</span></span><br><span class="line">...</span><br><span class="line"><span class="number">0</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="number">4</span></span><br><span class="line">&gt;&gt;&gt; from inspect import isgeneratorfunction</span><br><span class="line">&gt;&gt;&gt; <span class="function"><span class="title">isgeneratorfunction</span><span class="params">(mg)</span></span></span><br><span class="line">False</span><br><span class="line">&gt;&gt;&gt; <span class="function"><span class="title">isgeneratorfunction</span><span class="params">(createGenerator)</span></span></span><br><span class="line">True</span><br><span class="line">&gt;&gt;&gt;</span><br></pre></td></tr></table></figure>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼š<em>å½“ä½ è°ƒç”¨è¿™ä¸ªå‡½æ•°çš„æ—¶å€™ï¼Œå‡½æ•°å†…éƒ¨çš„ä»£ç å¹¶ä¸ç«‹é©¬æ‰§è¡Œ</em> ï¼Œè€Œæ˜¯è¿”å›ä¸€ä¸ªç”Ÿæˆå™¨å¯¹è±¡ã€‚åªæœ‰å½“ä½¿ç”¨forè¿›è¡Œè¿­ä»£çš„æ—¶å€™ï¼Œå‡½æ•°å†…çš„ä»£ç æ‰ä¼šæ‰§è¡Œã€‚</p>
<h4 id="u63A7_u5236_u8D44_u6E90_u8BBF_u95EE"><a href="#u63A7_u5236_u8D44_u6E90_u8BBF_u95EE" class="headerlink" title="æ§åˆ¶èµ„æºè®¿é—®"></a>æ§åˆ¶èµ„æºè®¿é—®</h4><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="prompt">&gt;&gt;</span>&gt; <span class="class"><span class="keyword">class</span> <span class="title">Bank</span>():</span></span><br><span class="line">...     crisis = <span class="constant">False</span></span><br><span class="line">...     <span class="function"><span class="keyword">def</span> <span class="title">createAtm</span><span class="params">(<span class="keyword">self</span>)</span>:</span></span><br><span class="line">...             <span class="keyword">while</span> <span class="keyword">not</span> <span class="keyword">self</span>.<span class="symbol">crisis:</span></span><br><span class="line">...                     <span class="keyword">yield</span> <span class="string">"$100"</span></span><br><span class="line">...</span><br><span class="line"><span class="prompt">&gt;&gt;</span>&gt;</span><br><span class="line">&gt;&gt;&gt; bank = <span class="constant">Bank</span>()</span><br><span class="line"><span class="prompt">&gt;&gt;</span>&gt; atm = bank.createAtm()</span><br><span class="line"><span class="prompt">&gt;&gt;</span>&gt; print(atm.next())</span><br><span class="line"><span class="variable">$100</span></span><br><span class="line"><span class="prompt">&gt;&gt;</span>&gt; print(atm.next())</span><br><span class="line"><span class="variable">$100</span></span><br><span class="line"><span class="prompt">&gt;&gt;</span>&gt; print(atm.next())</span><br><span class="line"><span class="variable">$100</span></span><br><span class="line"><span class="prompt">&gt;&gt;</span>&gt; print(atm.next())</span><br><span class="line"><span class="variable">$100</span></span><br><span class="line"><span class="prompt">&gt;&gt;</span>&gt; atm.crisis = <span class="constant">True</span></span><br><span class="line"><span class="constant">Traceback</span> (most recent call last)<span class="symbol">:</span></span><br><span class="line">  <span class="constant">File</span> <span class="string">"&lt;stdin&gt;"</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;<span class="class"><span class="keyword">module</span>&gt;</span></span><br><span class="line"><span class="constant">AttributeError</span><span class="symbol">:</span> <span class="string">'generator'</span> object has no attribute <span class="string">'crisis'</span></span><br><span class="line"><span class="prompt">&gt;&gt;</span>&gt; bank.crisis = <span class="constant">True</span></span><br><span class="line"><span class="prompt">&gt;&gt;</span>&gt; print (atm.next())</span><br><span class="line"><span class="constant">Traceback</span> (most recent call last)<span class="symbol">:</span></span><br><span class="line">  <span class="constant">File</span> <span class="string">"&lt;stdin&gt;"</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;<span class="class"><span class="keyword">module</span>&gt;</span></span><br><span class="line"><span class="constant">StopIteration</span></span><br><span class="line"><span class="prompt">&gt;&gt;</span>&gt;</span><br></pre></td></tr></table></figure>
<p>å¦‚æœä¸ä½¿ç”¨yieldçš„è¯ï¼Œè¿™ä¸ªç±»æ‰§è¡ŒcreateAtmä¹‹åå°±ä¼šå¯¼è‡´ç³»ç»Ÿèµ„æºè€—å°½ï¼ˆæˆ–è€…è¯´æ˜¯æ— é™å¾ªç¯ï¼‰</p>
<h4 id="u4F7F_u7528yield_u53EF_u4EE5_u662F_u7A0B_u5E8F_u975E_u5E38_u4F18_u7F8E_uFF0C_u867D_u7136python_u7A0B_u5E8F_u672C_u8EAB_u5C31_u4F1A_u5F88_u4F18_u7F8E"><a href="#u4F7F_u7528yield_u53EF_u4EE5_u662F_u7A0B_u5E8F_u975E_u5E38_u4F18_u7F8E_uFF0C_u867D_u7136python_u7A0B_u5E8F_u672C_u8EAB_u5C31_u4F1A_u5F88_u4F18_u7F8E" class="headerlink" title="ä½¿ç”¨yieldå¯ä»¥æ˜¯ç¨‹åºéå¸¸ä¼˜ç¾ï¼Œè™½ç„¶pythonç¨‹åºæœ¬èº«å°±ä¼šå¾ˆä¼˜ç¾"></a>ä½¿ç”¨yieldå¯ä»¥æ˜¯ç¨‹åºéå¸¸ä¼˜ç¾ï¼Œè™½ç„¶pythonç¨‹åºæœ¬èº«å°±ä¼šå¾ˆä¼˜ç¾</h4><h5 id="u751F_u6210_u6590_u6CE2_u90A3_u5951_uFF08Fibonacci_uFF09_u6570_u5217"><a href="#u751F_u6210_u6590_u6CE2_u90A3_u5951_uFF08Fibonacci_uFF09_u6570_u5217" class="headerlink" title="ç”Ÿæˆæ–æ³¢é‚£å¥‘ï¼ˆFibonacciï¼‰æ•°åˆ—"></a>ç”Ÿæˆæ–æ³¢é‚£å¥‘ï¼ˆFibonacciï¼‰æ•°åˆ—</h5><p>è®¸å¤šåˆå­¦è€…éƒ½ä¼šè¿™ä¹ˆå†™</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; def <span class="function"><span class="title">fab</span><span class="params">(max)</span></span>:</span><br><span class="line">...     n, <span class="tag">a</span>, <span class="tag">b</span> = <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span></span><br><span class="line">...     while n &lt; max:</span><br><span class="line">...             print <span class="tag">b</span></span><br><span class="line">...             <span class="tag">a</span>, <span class="tag">b</span> = <span class="tag">b</span>, <span class="tag">a</span> + <span class="tag">b</span></span><br><span class="line">...             n = n + <span class="number">1</span></span><br><span class="line">...</span><br><span class="line">&gt;&gt;&gt; <span class="function"><span class="title">fab</span><span class="params">(<span class="number">5</span>)</span></span></span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="number">5</span></span><br><span class="line">&gt;&gt;&gt;</span><br></pre></td></tr></table></figure>
<p>ä½¿ç”¨yieldæ”¹å†™ä¸€ä¸ªç‰ˆæœ¬</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="prompt">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">fab</span><span class="params">(max)</span>:</span></span><br><span class="line"><span class="prompt">... </span>    n, a, b = <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span></span><br><span class="line"><span class="prompt">... </span>    <span class="keyword">while</span> n &lt; max:</span><br><span class="line"><span class="prompt">... </span>            <span class="keyword">yield</span> b</span><br><span class="line"><span class="prompt">... </span>            a, b = b, a + b</span><br><span class="line"><span class="prompt">... </span>            n = n + <span class="number">1</span></span><br><span class="line">...</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="prompt">&gt;&gt;&gt; </span><span class="keyword">for</span> n <span class="keyword">in</span> fab(<span class="number">5</span>):</span><br><span class="line"><span class="prompt">... </span>    <span class="keyword">print</span> n</span><br><span class="line">...</span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="number">5</span></span><br><span class="line">&gt;&gt;&gt;</span><br></pre></td></tr></table></figure>
<h4 id="u7B80_u5355_u63CF_u8FF0_u4E0B"><a href="#u7B80_u5355_u63CF_u8FF0_u4E0B" class="headerlink" title="ç®€å•æè¿°ä¸‹"></a>ç®€å•æè¿°ä¸‹</h4><p>for è¯­å¥åœ¨ç¢°åˆ°ç”Ÿæˆå™¨ generator çš„æ—¶å€™ï¼Œ</p>
<p>è°ƒç”¨</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">generator</span><span class="class">.__next__</span>()</span><br></pre></td></tr></table></figure>
<p>è·å–ç”Ÿæˆå™¨çš„è¿”å›å€¼ã€‚</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="strong">__next__</span>()</span><br></pre></td></tr></table></figure>
<p>ä»¥Fibonacciä¸ºä¾‹ï¼šforæ¯æ¬¡è°ƒç”¨ï¼Œå¯ä»¥ç†è§£ä¸ºæ‰§è¡Œäº†ä¸€æ¬¡generator() æ‰§è¡Œåˆ° yield çš„æ—¶å€™ï¼Œç”Ÿæˆå™¨è¿”å›äº†nçš„å€¼å¹¶åœæ­¢ã€‚<br>è¿™å°±åƒæ™®é€šå‡½æ•°ç¢°åˆ° return æ—¶ä¸€æ ·ï¼Œå‰©ä¸‹çš„ä»£ç éƒ½è¢«å¿½ç•¥äº†ã€‚</p>
<p>ä¸åŒçš„åœ°æ–¹åœ¨äºï¼Œpython ä¼šè®°å½•è¿™ä¸ªåœæ­¢çš„ä½ç½®ã€‚ å½“å†æ¬¡æ‰§è¡Œgenerator()çš„æ—¶å€™ï¼Œpython ä»è¿™ä¸ªåœæ­¢ä½ç½®å¼€å§‹æ‰§è¡Œè€Œä¸æ˜¯å¼€å¤´ï¼Œ ä¹Ÿå°±æ˜¯è¯´è¿™æ¬¡è¿”å›äº†1ã€‚å†æ‰§è¡Œgenerator()ï¼Œåˆ™è¿”å›2ï¼Œå½“æ‰§è¡Œåˆ°è¿”å›5çš„æ—¶å€™ï¼Œå·²ç»æ²¡æœ‰ yield è¯­å¥äº†ï¼Œ å°±æŠ›å‡ºäº† StopIteration ã€‚è¿™å’Œå…¶ä»–è¿­ä»£å™¨æ˜¯ç±»ä¼¼çš„ï¼Œå½“ç„¶åœ¨forä¸­æ˜¯ä¸ä¼šæŠ›å‡ºå¼‚å¸¸çš„ã€‚</p>
<h4 id="u8FDB_u9636"><a href="#u8FDB_u9636" class="headerlink" title="è¿›é˜¶"></a>è¿›é˜¶</h4><p>åœ¨<a href="https://www.python.org/dev/peps/pep-0342/" target="_blank" rel="external">PEP 342</a>ä¸­åŠ å…¥äº†å°†å€¼ä¼ ç»™ç”Ÿæˆå™¨çš„æ”¯æŒã€‚PEP 342åŠ å…¥äº†æ–°çš„ç‰¹æ€§ï¼Œèƒ½è®©ç”Ÿæˆå™¨åœ¨å•ä¸€è¯­å¥ä¸­å®ç°ï¼Œç”Ÿæˆä¸€ä¸ªå€¼ï¼ˆåƒä»å‰ä¸€æ ·ï¼‰ï¼Œæ¥å—ä¸€ä¸ªå€¼ï¼Œæˆ–åŒæ—¶ç”Ÿæˆä¸€ä¸ªå€¼å¹¶æ¥å—ä¸€ä¸ªå€¼ã€‚<br>æˆ‘ä»¬ç”¨å‰é¢é‚£ä¸ªå…³äºç´ æ•°çš„å‡½æ•°æ¥å±•ç¤ºå¦‚ä½•å°†ä¸€ä¸ªå€¼ä¼ ç»™ç”Ÿæˆå™¨ã€‚è¿™ä¸€æ¬¡ï¼Œæˆ‘ä»¬ä¸å†ç®€å•åœ°ç”Ÿæˆæ¯”æŸä¸ªæ•°å¤§çš„ç´ æ•°ï¼Œè€Œæ˜¯æ‰¾å‡ºæ¯”æŸä¸ªæ•°çš„ç­‰æ¯”çº§æ•°å¤§çš„æœ€å°ç´ æ•°ï¼ˆä¾‹å¦‚10ï¼Œ æˆ‘ä»¬è¦ç”Ÿæˆæ¯”10ï¼Œ100ï¼Œ1000ï¼Œ10000 â€¦ å¤§çš„æœ€å°ç´ æ•°ï¼‰ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="prompt">&gt;&gt;&gt; </span><span class="keyword">import</span> math</span><br><span class="line"><span class="prompt">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">getPrimes</span><span class="params">(number)</span>:</span></span><br><span class="line"><span class="prompt">... </span>    <span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line"><span class="prompt">... </span>            <span class="keyword">if</span> isPrime(number):</span><br><span class="line"><span class="prompt">&gt;&gt;&gt; </span>                    <span class="string">'''</span><br><span class="line"><span class="prompt">... </span>                    yieldå…³é”®å­—è¿”å›numberçš„å€¼ï¼Œ</span><br><span class="line"><span class="prompt">... </span>                    è€Œother = yield foo "è¿”å›fooçš„å€¼ï¼Œ</span><br><span class="line"><span class="prompt">... </span>                    è¿™ä¸ªå€¼è¿”å›ç»™è°ƒç”¨è€…çš„åŒæ—¶ï¼Œå°†otherçš„å€¼ä¹Ÿè®¾ç½®ä¸ºé‚£ä¸ªå€¼"ã€‚</span><br><span class="line"><span class="prompt">... </span>                    å¯ä»¥é€šè¿‡sendæ–¹æ³•æ¥å°†ä¸€ä¸ªå€¼â€å‘é€â€œç»™ç”Ÿæˆå™¨ã€‚</span><br><span class="line"><span class="prompt">&gt;&gt;&gt; </span>                    '''</span></span><br><span class="line"><span class="prompt">... </span>                    number = <span class="keyword">yield</span> number</span><br><span class="line"><span class="prompt">... </span>            number += <span class="number">1</span></span><br><span class="line">...</span><br><span class="line"><span class="prompt">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">printSuccessivePrimes</span><span class="params">(iterations, base=<span class="number">10</span>)</span>:</span></span><br><span class="line"><span class="prompt">... </span>    printGenerator = getPrimes(base)</span><br><span class="line"><span class="prompt">&gt;&gt;&gt; </span>    <span class="string">'''</span><br><span class="line"><span class="prompt">... </span>    ç”¨sendæ¥â€œå¯åŠ¨â€ä¸€ä¸ªç”Ÿæˆå™¨æ—¶ï¼ˆå°±æ˜¯ä»ç”Ÿæˆå™¨å‡½æ•°çš„ç¬¬ä¸€è¡Œä»£ç æ‰§è¡Œåˆ°ç¬¬ä¸€ä¸ªyieldè¯­å¥çš„ä½ç½®ï¼‰ï¼Œå¿…é¡»å‘é€Noneã€‚å› ä¸ºæ­¤æ—¶ç”Ÿæˆå™¨è¿˜æ²¡æœ‰èµ°åˆ°ç¬¬ä¸€ä¸ªyieldè¯­å¥ï¼Œå¦‚æœsendä¸€ä¸ªçœŸå®çš„å€¼ï¼Œè¿™æ—¶æ˜¯æ²¡æœ‰äººå»â€œæ¥æ”¶â€å®ƒçš„ã€‚ä¸€æ—¦ç”Ÿæˆå™¨å¯åŠ¨äº†ï¼Œæˆ‘ä»¬å°±å¯ä»¥åƒä¸Šé¢é‚£æ ·å‘é€æ•°æ®äº†</span><br><span class="line"><span class="prompt">&gt;&gt;&gt; </span>    '''</span></span><br><span class="line"><span class="prompt">... </span>    printGenerator.send(<span class="keyword">None</span>)</span><br><span class="line"><span class="prompt">... </span>    <span class="keyword">for</span> power <span class="keyword">in</span> range(iterations):</span><br><span class="line"><span class="prompt">&gt;&gt;&gt; </span>            <span class="string">'''</span><br><span class="line"><span class="prompt">... </span>            æ‰“å°çš„æ˜¯generator.sendçš„ç»“æœï¼Œsendåœ¨å‘é€æ•°æ®ç»™ç”Ÿæˆå™¨çš„åŒæ—¶è¿˜è¿”å›ç”Ÿæˆå™¨é€šè¿‡yieldç”Ÿæˆçš„å€¼</span><br><span class="line"><span class="prompt">&gt;&gt;&gt; </span>            '''</span></span><br><span class="line"><span class="prompt">... </span>            print(printGenerator.send(base ** power))</span><br><span class="line">...</span><br><span class="line"><span class="prompt">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">isPrime</span><span class="params">(number)</span>:</span></span><br><span class="line"><span class="prompt">... </span>    <span class="keyword">if</span> number &gt; <span class="number">1</span>:</span><br><span class="line"><span class="prompt">... </span>            <span class="keyword">if</span> number == <span class="number">2</span>:</span><br><span class="line"><span class="prompt">... </span>                    <span class="keyword">return</span> <span class="keyword">True</span></span><br><span class="line"><span class="prompt">... </span>            <span class="keyword">if</span> number % <span class="number">2</span> == <span class="number">0</span>:</span><br><span class="line"><span class="prompt">... </span>                    <span class="keyword">return</span> <span class="keyword">False</span></span><br><span class="line"><span class="prompt">... </span>            <span class="keyword">for</span> current <span class="keyword">in</span> range(<span class="number">3</span>, int(math.sqrt(number) + <span class="number">1</span>), <span class="number">2</span>):</span><br><span class="line"><span class="prompt">... </span>                    <span class="keyword">if</span> number % current == <span class="number">0</span>:</span><br><span class="line"><span class="prompt">... </span>                            <span class="keyword">return</span> <span class="keyword">False</span></span><br><span class="line"><span class="prompt">... </span>            <span class="keyword">return</span> <span class="keyword">True</span></span><br><span class="line"><span class="prompt">... </span>    <span class="keyword">return</span> <span class="keyword">False</span></span><br><span class="line">...</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="prompt">&gt;&gt;&gt; </span>printSuccessivePrimes(<span class="number">10</span>)</span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="number">11</span></span><br><span class="line"><span class="number">101</span></span><br><span class="line"><span class="number">1009</span></span><br><span class="line"><span class="number">10007</span></span><br><span class="line"><span class="number">100003</span></span><br><span class="line"><span class="number">1000003</span></span><br><span class="line"><span class="number">10000019</span></span><br><span class="line"><span class="number">100000007</span></span><br><span class="line"><span class="number">1000000007</span></span><br><span class="line">&gt;&gt;&gt;</span><br></pre></td></tr></table></figure>
<p>Python ä½¿ç”¨yieldçš„å…³é”®æ€æƒ³</p>
<ul>
<li>generatoræ˜¯ç”¨æ¥äº§ç”Ÿä¸€ç³»åˆ—å€¼çš„</li>
<li>yieldåˆ™åƒæ˜¯generatorå‡½æ•°çš„è¿”å›ç»“æœ</li>
<li>yieldå”¯ä¸€æ‰€åšçš„å¦ä¸€ä»¶äº‹å°±æ˜¯ä¿å­˜ä¸€ä¸ªgeneratorå‡½æ•°çš„çŠ¶æ€</li>
<li>generatorå°±æ˜¯ä¸€ä¸ªç‰¹æ®Šç±»å‹çš„è¿­ä»£å™¨ï¼ˆiteratorï¼‰</li>
<li>å’Œè¿­ä»£å™¨ç›¸ä¼¼ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä½¿ç”¨next()æ¥ä»generatorä¸­è·å–ä¸‹ä¸€ä¸ªå€¼</li>
<li>é€šè¿‡éšå¼åœ°è°ƒç”¨next()æ¥å¿½ç•¥ä¸€äº›å€¼</li>
</ul>
<h3 id="u53C2_u8003_u6587_u732E"><a href="#u53C2_u8003_u6587_u732E" class="headerlink" title="å‚è€ƒæ–‡çŒ®"></a>å‚è€ƒæ–‡çŒ®</h3><ul>
<li><a href="http://pyzh.readthedocs.org/en/latest/the-python-yield-keyword-explained.html" target="_blank" rel="external">http://pyzh.readthedocs.org/en/latest/the-python-yield-keyword-explained.html</a></li>
<li><a href="http://www.dabeaz.com/coroutines/index.html" target="_blank" rel="external">http://www.dabeaz.com/coroutines/index.html</a></li>
<li><a href="https://docs.python.org/2/tutorial/classes.html" target="_blank" rel="external">https://docs.python.org/2/tutorial/classes.html</a></li>
<li><a href="http://stackoverflow.com/questions/231767/what-does-the-yield-keyword-do-in-python" target="_blank" rel="external">http://stackoverflow.com/questions/231767/what-does-the-yield-keyword-do-in-python</a></li>
<li><a href="http://www.pydanny.com/python-yields-are-fun.html" target="_blank" rel="external">http://www.pydanny.com/python-yields-are-fun.html</a></li>
<li><a href="http://dhcmrlchtdj.github.io/sia/post/2012-11-20/python_yield.html" target="_blank" rel="external">http://dhcmrlchtdj.github.io/sia/post/2012-11-20/python_yield.html</a></li>
<li><a href="http://www.oschina.net/translate/improve-your-python-yield-and-generators-explained" target="_blank" rel="external">http://www.oschina.net/translate/improve-your-python-yield-and-generators-explained</a></li>
<li><a href="http://www.pythonclub.org/python-basic/yield" target="_blank" rel="external">http://www.pythonclub.org/python-basic/yield</a></li>
<li><a href="https://www.ibm.com/developerworks/cn/opensource/os-cn-python-yield/" target="_blank" rel="external">https://www.ibm.com/developerworks/cn/opensource/os-cn-python-yield/</a></li>
<li><a href="https://www.jeffknupp.com/blog/2013/04/07/improve-your-python-yield-and-generators-explained/" target="_blank" rel="external">https://www.jeffknupp.com/blog/2013/04/07/improve-your-python-yield-and-generators-explained/</a></li>
<li><a href="http://pythontips.com/2013/09/29/the-python-yield-keyword-explained/" target="_blank" rel="external">http://pythontips.com/2013/09/29/the-python-yield-keyword-explained/</a></li>
<li><a href="http://blog.jobbole.com/28506/" target="_blank" rel="external">http://blog.jobbole.com/28506/</a></li>
</ul>
]]></content>
    <summary type="html">
    <![CDATA[<!--  -->
<!--  -->
<!--  _ __    __     __      ____    ___     ___   _____   __  __    ___     -->
<!-- /\`'__\/'__`\ /'__`\   /',__\  / _]]>
    </summary>
    
      <category term="Python" scheme="http://reasonpun.com/tags/Python/"/>
    
      <category term="Python" scheme="http://reasonpun.com/categories/Python/"/>
    
      <category term="å­¦ä¹ " scheme="http://reasonpun.com/categories/Python/%E5%AD%A6%E4%B9%A0/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[Oryx2 ç®¡ç†å‘˜æ–‡æ¡£]]></title>
    <link href="http://reasonpun.com/2015/12/21/Oryx2-Admin-Docs/"/>
    <id>http://reasonpun.com/2015/12/21/Oryx2-Admin-Docs/</id>
    <published>2015-12-21T08:53:46.000Z</published>
    <updated>2016-01-25T03:17:11.000Z</updated>
    <content type="html"><![CDATA[<!--  -->
<!--  -->
<!--  _ __    __     __      ____    ___     ___   _____   __  __    ___     -->
<!-- /\`'__\/'__`\ /'__`\   /',__\  / __`\ /' _ `\/\ '__`\/\ \/\ \ /' _ `\   -->
<!-- \ \ \//\  __//\ \L\.\_/\__, `\/\ \L\ \/\ \/\ \ \ \L\ \ \ \_\ \/\ \/\ \  -->
<!--  \ \_\\ \____\ \__/.\_\/\____/\ \____/\ \_\ \_\ \ ,__/\ \____/\ \_\ \_\ -->
<!--   \/_/ \/____/\/__/\/_/\/___/  \/___/  \/_/\/_/\ \ \/  \/___/  \/_/\/_/ -->
<!--                                                 \ \_\                   -->
<!--                                                  \/_/                   -->
<!--  -->
<h3 id="Oryx_2-1-0__u7CFB_u7EDF_u8981_u6C42"><a href="#Oryx_2-1-0__u7CFB_u7EDF_u8981_u6C42" class="headerlink" title="Oryx 2.1.0 ç³»ç»Ÿè¦æ±‚"></a>Oryx 2.1.0 ç³»ç»Ÿè¦æ±‚</h3><ul>
<li>Java 7 or later (JRE only is required)</li>
<li>A Hadoop cluster running the following components:<ul>
<li>Apache Hadoop 2.6.0 or later</li>
<li>Apache Zookeeper 3.4.5 or later</li>
<li>Apache Kafka 0.8.2 or later (in 0.8.x line)</li>
<li>Apache Spark 1.5.0 or later</li>
</ul>
</li>
</ul>
<h3 id="u670D_u52A1"><a href="#u670D_u52A1" class="headerlink" title="æœåŠ¡"></a>æœåŠ¡</h3><p>Hadoop cluster æœåŠ¡</p>
<ul>
<li>HDFS</li>
<li>YARN</li>
<li>Zookeeper</li>
<li>Kafka</li>
<li>Spark (on YARN)</li>
</ul>
<p>Note that for CDH, Kafka is available as a parcel from <a href="http://www.cloudera.com/content/cloudera/en/developers/home/cloudera-labs/apache-kafka.html" target="_blank" rel="external">Cloudera Labs</a>.</p>
<p>Kafka brokers éœ€è¦é…ç½®åœ¨é›†ç¾¤ä¸­ï¼Œæ ¹æ®å®ä¾‹ï¼Œéœ€è¦æ³¨æ„hostså’Œç«¯å£ã€‚ç«¯å£ä¸€èˆ¬ä¼šè®¾ç½®ä¸º9092ï¼Œæ­¤å¤„å’ŒZK serverçš„ç«¯å£ä¿æŒä¸€è‡´ï¼Œç¼ºçœè®¾ç½®ä¸º2181ã€‚ç¼ºçœç«¯å£ä¼šåœ¨éšåçš„ä¾‹å­ä¸­ä½¿ç”¨ã€‚</p>
<p>å¤šä¸ªhostséœ€è¦é€šè¿‡éƒ½å¥½åˆ†å‰²ï¼Œå¹¶éœ€è¦æä¾›host:port è¿™ç§æ–¹å¼ï¼Œæ¯”å¦‚ ï¼š your-zk-1:2181,your-zk-2:2181ã€‚</p>
<p>åŒæ—¶éœ€è¦æ³¨æ„ï¼Œä½ çš„ZKå®ä¾‹æ˜¯å¦ä½¿ç”¨äº†chroot pathã€‚è¿™æ˜¯ä¸€ä¸ªç®€å•çš„è·¯å¾„å‰ç¼€ï¼Œæ¯”å¦‚ your-zk:2181/your-chroot<br>/kafka æ˜¯ç»å¸¸ç”¨åˆ°ä½œä¸ºå‰ç¼€çš„ã€‚å¦‚æœæ²¡æœ‰ä½¿ç”¨chrootï¼Œå°±å¯ä»¥å¿½ç•¥è¿™ä¸ªã€‚æ³¨æ„ï¼šå¦‚æœå­˜åœ¨å¤šä¸ªZK serverï¼Œå’Œä¸€ä¸ªchrootï¼Œåªéœ€è¦åœ¨æœ€åæ·»åŠ ä¸€æ¬¡chrootå³å¯ï¼Œæ¯”å¦‚ your-zk-1:2181,your-zk-2:2181/kafka</p>
<h3 id="u914D_u7F6EKafka"><a href="#u914D_u7F6EKafka" class="headerlink" title="é…ç½®Kafka"></a>é…ç½®Kafka</h3><p>Oryx ä½¿ç”¨2ä¸ªKafka topics åšæ•°æ®ä¼ è¾“ã€‚</p>
<ul>
<li>ä¸€ä¸ªä¼ è¾“è¾“å…¥æ•°æ®åˆ°æ‰¹é‡å¤„ç†ï¼Œå’Œå®æ—¶è®¡ç®—å±‚</li>
<li>å¦ä¸€ä¸ªåŒæ­¥æ¨¡å‹æ›´æ–°åˆ°æœåŠ¡å±‚</li>
</ul>
<p>ç¼ºçœçš„topicsçš„åç§°åˆ†åˆ«ä¸ºOryxInput å’Œ OryxUpdateï¼Œåªæœ‰OryxæœåŠ¡å¯åŠ¨åæ‰èƒ½åˆ›å»ºè¿™ä¸¤ä¸ªtopicsã€‚</p>
<p>è¾“å…¥topicçš„åˆ†åŒºæ•°ç›®ä¼šå½±å“æ¶ˆè´¹æ•°æ®çš„Spark Streaming ä½œä¸šçš„åˆ†åŒºæ•°ï¼Œç”šè‡³æ˜¯å¹¶å‘æ•°ã€‚æ¯”å¦‚ï¼Œæ‰¹é‡å¤„ç†å±‚è¯»å–HDFSä¸Šçš„å†å²æ•°æ®åˆ†åŒºå’ŒKafkaæ•°æ®ã€‚</p>
<p>å¦‚æœè¾“å…¥topicåªæœ‰ä¸€ä¸ªåˆ†åŒºï¼Œä¸”åœ¨æ¯ä¸ªæ—¶é—´é—´éš”å†…æœ‰å¤§é‡çš„æ•°æ®æ¶Œå…¥ï¼Œè¿™æ˜¯KafkaåŸºäºçš„è¾“å…¥åˆ†åŒºç›¸å¯¹çš„éœ€è¦å¾ˆé•¿çš„æ—¶é—´å»å¤„ç†ã€‚ä¸€ä¸ªæ¯”è¾ƒåˆé€‚çš„ç»éªŒå€¼æ˜¯é€‰æ‹©ä¸€äº›topicåˆ†åŒºï¼Œåœ¨ä¸€ä¸ªæ‰¹å¤„ç†æ—¶é—´é—´éš”å†…åˆ°è¾¾çš„å¤§é‡æ•°æ®ï¼Œå¤§çº¦æ˜¯ä¸€ä¸ªHDFS å—å¤§å°ï¼Œç¼ºçœå€¼æ˜¯128MBã€‚</p>
<p>æä¾›çš„oryx-run.sh kafkaè®¾ç½®è„šæœ¬ï¼Œç¼ºçœè®¾ç½®ä¸º4ä¸ªåˆ†åŒºï¼Œå½“ç„¶äº†ï¼Œè¿™ä¸ªå€¼ä¹‹åæ˜¯å¯ä»¥ä¿®æ”¹çš„ã€‚å¿…é¡»æ³¨æ„ä¸èƒ½è®¾ç½®æ›´æ–°topicå¤šäº1ä¸ªåˆ†åŒºã€‚</p>
<p>é‡å¤å› å­å¯ä»¥è®¾ç½®ä¸ºä»»ä½•å€¼ï¼Œä½†æ˜¯å»ºè®®æœ€å°‘æ˜¯2ã€‚æ³¨æ„ï¼šé‡å¤å› å­æ•°ç›®ä¸èƒ½è¶…è¿‡Kafka brokersåœ¨é›†ç¾¤ä¸Šçš„æ•°ç›®ã€‚æ‰€ä»¥æä¾›çš„è®¾ç½®è„šæœ¬é‡Œç¼ºçœè®¾ç½®é‡å¤å› å­ä¸º1. ä¹‹åä½ å¯ä»¥é€šè¿‡kafka-topics â€“zookeeper â€¦ â€“alter â€“topic â€¦ â€“replication-factor N ç­‰ä¿®æ”¹è¿™äº›ç¼ºçœå€¼ã€‚</p>
<p>ä½ éœ€è¦ä¸ºå…¶ä¸­ä¸€ä¸ªæˆ–è€…ä¸¤ä¸ªtopicé…ç½®æŒç»­æ—¶é—´ã€‚å°¤å…¶é‡è¦çš„æ˜¯éœ€è¦é™åˆ¶æ›´æ–°topicçš„æŒç»­æ—¶é—´ï¼Œå› ä¸ºå®æ—¶è®¡ç®—å±‚å’ŒæœåŠ¡å±‚éœ€è¦ä»å¯åŠ¨å¼€å§‹çš„èµ·ç‚¹è·å–æ•´ä¸ªtopicã€‚è¿™ä¸ªæœºåˆ¶å¹¶å¦‚ä¸è¾“å…¥æ•°æ®é‡è¦ï¼Œè¾“å…¥æ•°æ®ä¸ä¼šå†æ¬¡ä»å¤´è¯»å–æ•°æ®ã€‚</p>
<p>è®¾ç½®è¿™ä¸ªå€¼ä¸ºæ‰¹é‡å¤„ç†å±‚æ›´æ–°é—´éš”çš„2å€æ˜¯æ¯”è¾ƒåˆé€‚ã€‚æ¯”å¦‚è®¾ç½®è¯¥å€¼ä¸º1å¤©ï¼ˆ24 <em> 60 </em> 60 * 1000 = 86400000 msï¼‰ï¼Œè®¾ç½®topicçš„ä¸º86400000msã€‚è¿™ä¸ªå¯ä»¥é€šè¿‡oryx-run.shè®¾ç½®è„šæœ¬è‡ªåŠ¨è®¾ç½®ã€‚</p>
<p>ä¸Šè¿°ä¸¤ä¸ªtopicsä¼šåŒ…å«å¤§é‡ä¿¡æ¯ï¼›å°¤å…¶æ˜¯æ›´æ–°topicåŒ…å«æ•´ä¸ªåºåˆ—åŒ–çš„PMMLæ¨¡å‹ã€‚å¾ˆæœ‰å¯èƒ½ä»–ä¼šè¶…è¿‡Kafkaç¼ºçœæœ€å¤§æ¶ˆæ¯çš„å¤§å°ï¼ˆkafkaæ¶ˆæ¯æœ€å¤§1Mibï¼‰ã€‚å¦‚æœæœ‰æ›´å¤§çš„æ•°æ®åˆ™éœ€è¦è®¾ç½®topicâ€™s max.message.bytesã€‚oryx-run.sh Kafkaè®¾ç½®è„šæœ¬è®¾ç½®æ›´æ–°topicç¼ºçœä¸º16Mibã€‚è¿™ä¹Ÿæ˜¯Oryxè¯•å›¾å¸å…¥æ›´æ–°topicé‡Œçš„æ¨¡å‹é»˜è®¤æœ€å¤§å€¼ï¼›æ›´å¤§çš„æ¨¡å‹åªä¼šä¿å­˜æ–‡ä»¶åœ¨HDFSä¸­çš„è·¯å¾„ã€‚è¯·æŸ¥çœ‹å±æ€§oryx.update-topic.message.max-sizeã€‚</p>
<p>Kafkaä»£ç†çš„message.max.byteså±æ€§å¯ä»¥æ§åˆ¶è¿™ä¸ªï¼Œä½†æ˜¯è®¾ç½®è¿™ä¸ªå€¼ä¼šå½±å“åˆ°ä»£ç†ç®¡ç†çš„æ‰€æœ‰çš„topicsï¼Œç”šè‡³åŒ…æ‹¬ä¸è‰¯çŠ¶æ€çš„topicsã€‚å¯ä»¥æŸ¥çœ‹æ€§èƒ½å’Œèµ„æºéƒ¨åˆ†äº†è§£æ›´å¤šã€‚å°¤å…¶æ˜¯ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯å¿…é¡»è®¾ç½®ä»£ç†çš„replica.fetch.max.byteså±æ€§ï¼Œä»¥é˜²æ­¢é‡å¤ä»»ä½•éå¸¸å¤§çš„æ¶ˆæ¯ã€‚</p>
<blockquote>
<p>There is no per-topic equivalent to this.</p>
</blockquote>
<h3 id="Kafka_u914D_u7F6E_u81EA_u52A8_u8BBE_u7F6E"><a href="#Kafka_u914D_u7F6E_u81EA_u52A8_u8BBE_u7F6E" class="headerlink" title="Kafkaé…ç½®è‡ªåŠ¨è®¾ç½®"></a>Kafkaé…ç½®è‡ªåŠ¨è®¾ç½®</h3><p>æä¾›çš„oryx-run.shè„šæœ¬å¯ä»¥æ‰“å°ZKçš„å½“å‰é…ç½®ï¼Œåˆ—å‡ºå·²ç»å­˜åœ¨çš„Kafkaä¸­çš„topicsï¼Œå¦‚æœéœ€è¦ï¼Œä¼šåˆ›å»ºé…ç½®å¥½çš„è¾“å…¥topicså’Œæ›´æ–°topicsã€‚</p>
<p>ä½ éœ€è¦å…ˆåˆ›å»ºOryxé…ç½®æ–‡ä»¶ï¼Œæˆ–è€…å¯ä»¥æ‹·è´conf/als-example.confã€‚éœ€è¦æŒ‰ç…§è¦æ±‚ä¿®æ”¹Kafkaå’ŒZKçš„é…ç½®æ–‡ä»¶ï¼Œæ¯”å¦‚topicåç§°ã€‚</p>
<p>oryx.confæ–‡ä»¶éœ€è¦å’Œæ¯ä¸ªå±‚çš„JARæ–‡ä»¶æ”¾åœ¨åŒä¸€ä¸ªç›®å½•ä¸‹ï¼Œç„¶åæ‰§è¡Œï¼š</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">./oryx-run.sh kafka-setup</span><br><span class="line"></span><br><span class="line">Input  ZK:    your-zk:<span class="number">2181</span></span><br><span class="line">Input  Kafka: your-kafka:<span class="number">9092</span></span><br><span class="line">Input  topic: OryxInput</span><br><span class="line">Update ZK:    your-zk:<span class="number">2181</span></span><br><span class="line">Update Kafka: your-kafka:<span class="number">9092</span></span><br><span class="line">Update topic: OryxUpdate</span><br><span class="line"></span><br><span class="line">All available topics:</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Input topic OryxInput does not exist. Create it? y</span><br><span class="line">Creating topic OryxInput</span><br><span class="line">Created topic <span class="string">"OryxInput"</span>.</span><br><span class="line">Status of topic OryxInput:</span><br><span class="line">Topic:OryxInput	PartitionCount:<span class="number">4</span>	ReplicationFactor:<span class="number">1</span>	Configs:</span><br><span class="line">	Topic: OryxInput	Partition: <span class="number">0</span>	Leader: <span class="number">120</span>	Replicas: <span class="number">120</span>,<span class="number">121</span>	Isr: <span class="number">120</span>,<span class="number">121</span></span><br><span class="line">	Topic: OryxInput	Partition: <span class="number">1</span>	Leader: <span class="number">121</span>	Replicas: <span class="number">121</span>,<span class="number">120</span>	Isr: <span class="number">121</span>,<span class="number">120</span></span><br><span class="line">	Topic: OryxInput	Partition: <span class="number">2</span>	Leader: <span class="number">120</span>	Replicas: <span class="number">120</span>,<span class="number">121</span>	Isr: <span class="number">120</span>,<span class="number">121</span></span><br><span class="line">	Topic: OryxInput	Partition: <span class="number">3</span>	Leader: <span class="number">121</span>	Replicas: <span class="number">121</span>,<span class="number">120</span>	Isr: <span class="number">121</span>,<span class="number">120</span></span><br><span class="line"></span><br><span class="line">Update topic OryxUpdate does not exist. Create it? y</span><br><span class="line">Creating topic OryxUpdate</span><br><span class="line">Created topic <span class="string">"OryxUpdate"</span>.</span><br><span class="line">Updated config <span class="keyword">for</span> topic <span class="string">"OryxUpdate"</span>.</span><br><span class="line">Status of topic OryxUpdate:</span><br><span class="line">Topic:OryxUpdate	PartitionCount:<span class="number">1</span>	ReplicationFactor:<span class="number">1</span>	Configs:retention.ms=<span class="number">86400000</span>,max.message.bytes=<span class="number">16777216</span></span><br><span class="line">	Topic: OryxUpdate	Partition: <span class="number">0</span>	Leader: <span class="number">120</span>	Replicas: <span class="number">120</span>,<span class="number">121</span>	Isr: <span class="number">120</span>,<span class="number">121</span></span><br></pre></td></tr></table></figure>
<p>æŸ¥çœ‹å‘é€åˆ°è¾“å…¥å’Œæ›´æ–°topicï¼Œç›‘æ§åº”ç”¨çš„åŠ¨ä½œï¼Œå¯ä»¥æ‰§è¡Œï¼š</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">./oryx-run.sh kafka-tail</span><br><span class="line">Input  <span class="string">ZK:</span>    your-<span class="string">zk:</span><span class="number">2181</span></span><br><span class="line">Input  <span class="string">Kafka:</span> your-<span class="string">kafka:</span><span class="number">9092</span></span><br><span class="line">Input  <span class="string">topic:</span> OryxInput</span><br><span class="line">Update <span class="string">ZK:</span>    your-<span class="string">zk:</span><span class="number">2181</span></span><br><span class="line">Update <span class="string">Kafka:</span> your-<span class="string">kafka:</span><span class="number">9092</span></span><br><span class="line">Update <span class="string">topic:</span> OryxUpdate</span><br><span class="line"></span><br><span class="line">...output...</span><br></pre></td></tr></table></figure>
<p>æ¥ç€åœ¨å¦å¤–ä¸€ä¸ªçª—å£ï¼Œå¯ä»¥æ¥å—è¾“å…¥æ•°æ®ï¼Œæ¯”å¦‚å°†æ¥è‡ªç»ˆç«¯ç”¨æˆ·çš„æ–‡æ¡£data.csvåŠ å…¥åˆ°è¾“å…¥é˜Ÿåˆ—ï¼Œå¹¶éªŒè¯ï¼š</p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./oryx-<span class="keyword">run</span>.<span class="keyword">sh</span> kafka-<span class="keyword">input</span> --<span class="keyword">input</span>-<span class="keyword">file</span> data.csv</span><br></pre></td></tr></table></figure>
<p>å¦‚æœä»¥ä¸Šå…¨éƒ¨æˆåŠŸäº†ï¼Œå¯ä»¥å…³é—­è¿™äº›è¿›ç¨‹ã€‚é›†ç¾¤è‡³æ­¤å·²ç»å‡†å¤‡å¥½è¿è¡ŒOryxäº†ã€‚</p>
<h3 id="HDFS_u548C_u6570_u636E_u5C42"><a href="#HDFS_u548C_u6570_u636E_u5C42" class="headerlink" title="HDFSå’Œæ•°æ®å±‚"></a>HDFSå’Œæ•°æ®å±‚</h3><p>åœ¨Oryxä¸­ï¼ŒKafkaæ˜¯æ•°æ®ä¼ è¾“çš„é€”å¾„ï¼Œå› æ­¤æ•°æ®åœ¨Kafkaä¸­åªæ˜¯éœ€è¦æš‚æ—¶å­˜æ”¾çš„ã€‚ç„¶è€Œè¾“å…¥æ•°æ®ä¹Ÿä¼šæŒä¹…åŒ–åˆ°HDFSä¸­ä»¥å¤‡ä¹‹åä½¿ç”¨ã€‚åŒæ ·çš„ï¼Œæ¨¡å‹å’Œæ›´æ–°ç”¨æ¥ä¸ºKafkaçš„æ›´æ–°topicæä¾›æ•°æ®ï¼Œæ¨¡å‹ä¹Ÿä¼šæŒä¹…åŒ–åˆ°HDFSä»¥å¤‡ä¹‹åå¼•ç”¨ã€‚</p>
<p>oryx.batch.storage.data-dirå®šä¹‰äº†è¾“å…¥æ•°æ®å­˜æ”¾åœ¨HDFSä¸­çš„ä½ç½®ã€‚åœ¨è¿™ä¸ªç›®å½•ä¸‹ï¼Œå­ç›®å½•æ ‡é¢˜ä¼šä»¥oryx-[timestamp].dataå½¢å¼åˆ›å»ºï¼Œæ¯ä¸€ä¸ªä¼šé€šè¿‡Spark Stramingåœ¨æ‰¹é‡å¤„ç†å±‚æ‰§è¡Œã€‚åœ¨è¿™é‡Œï¼Œæ—¶é—´æˆ³æ ¼å¼æ ¼å¼ä¸Unixç›¸åŒï¼Œä¸”ä»¥æ¯«ç§’ä¸ºå•ä½ã€‚</p>
<p>å®é™…ä¸Šï¼Œå’Œå¤§å¤šæ•°Hadoopä¸­åˆ†å¸ƒå¼å¼è¿›ç¨‹è¾“å‡ºçš„ã€æ–‡ä»¶ã€ä¸€æ ·ï¼Œå­˜åœ¨è¿™æ ·çš„ä¸€ä¸ªå­ç›®å½•ï¼ŒåŒ…å«äº†å¾ˆå¤šä»¥part-å¼€å¤´çš„æ–‡ä»¶ã€‚æ¯ä¸ªæ–‡ä»¶éƒ½æ˜¯åºåˆ—åŒ–æ–‡ä»¶ï¼Œé€šè¿‡Writableç±»åºåˆ—åŒ–Kafkaè¾“å…¥topicsçš„é”®å€¼ï¼ŒWritableç±»å®ç°è‡ªoryx.batch.storage.key-writable-class å’Œ oryx.batch.storage.message-writable-classç±»ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œè¿™æ˜¯TextWritableï¼Œå¹¶ä¸”keyså’Œæ¶ˆæ¯æ˜¯ä»¥å­—ç¬¦ä¸²å½¢å¼è¢«è®°å½•ä¸‹æ¥çš„ã€‚</p>
<p>è¯¥ç›®å½•ä¸‹çš„æ•°æ®ä¼šè¢«åˆ é™¤ã€‚ä¹Ÿå°±ä¸ä¼šå†æ¬¡è¢«æ‰¹å¤„ç†å±‚è®¡ç®—ä½¿ç”¨ã€‚å°¤å…¶æ˜¯ï¼Œè®¾ç½®oryx.batch.storage.max-age-data-hoursä¸ºä¸€ä¸ªéè´Ÿæ•°ï¼Œå°†ä¼šä½¿æ‰¹å¤„ç†å±‚è‡ªåŠ¨åˆ é™¤å¤§äºç»™å®šæ—¶é—´çš„æ•°æ®ã€‚</p>
<p>åŒæ ·çš„ï¼Œåœ¨æ¯ä¸ªæ‰¹å¤„ç†é—´éš”å†…è¢«æ‰¹å¤„ç†å±‚é€‰ä¸­çš„æ¨¡å‹ä¼šè¢«åŸå§‹çš„æœºå™¨å­¦ä¹ åº”ç”¨ï¼ˆæ‰©å±•å­MLUpdateï¼‰è¾“å‡ºã€‚ä¹Ÿä¼šè¢«æŒä¹…åŒ–åˆ°oryx.batch.storage.model-dirå®šä¹‰çš„ç›®å½•ä¸‹çš„å­ç›®å½•ä¸­ã€‚åœ¨è¿™ä¸ªç›®å½•ä¸‹ï¼Œå­ç›®å½•çš„å‘½åéƒ½æ˜¯ä»¥æ—¶é—´æˆ³å½¢å¼å®ç°çš„ï¼ŒåŒUnixæ¯«ç§’å½¢å¼ã€‚</p>
<p>å­ç›®å½•ä¸‹çš„å†…å®¹å–å†³äºåº”ç”¨ï¼Œä½†æ˜¯ä¸€èˆ¬ä¼šåŒ…å«ä»¥model.pmmlå‘½åçš„PMMLæ¨¡å—ï¼Œå¹¶ä¸”å’Œæ¨¡å—ä¸€èµ·å­˜åœ¨çš„å¯é€‰çš„è¿½åŠ æ–‡ä»¶ã€‚</p>
<p>è¿™ä¸ªç›®å½•ä¹‹æ‰€ä»¥å­˜åœ¨æ˜¯å› ä¸ºéœ€è¦è®°å½•PMMLæ¨¡å—ç”¨æ¥å½’æ¡£ç”¨æˆ–è€…è¢«å…¶ä»–å·¥å…·ä½¿ç”¨ã€‚ä¹Ÿå¯æŒ‰ç…§è§„åˆ™åˆ é™¤å…¶å†…å®¹ã€‚</p>
<h3 id="u6355_u83B7_u9519_u8BEF"><a href="#u6355_u83B7_u9519_u8BEF" class="headerlink" title="æ•è·é”™è¯¯"></a>æ•è·é”™è¯¯</h3><p>æœ€åï¼Œä½ å¯èƒ½å¸Œæœ›åœæ­¢å…¶ä¸­ä¸€ä¸ªæˆ–è€…å‡ ä¸ªå±‚çš„è¿è¡Œï¼Œæˆ–è€…é‡å¯ã€‚æœåŠ¡ä¹Ÿå¯èƒ½æŒ‚é¸Ÿã€‚è¿™åˆ°åº•å‘ç”Ÿäº†ç¥é©¬ï¼Ÿä¸ºå•¥ä¼šè¿™æ ·æï¼Ÿ</p>
<h4 id="u6570_u636E_u4E22_u5931"><a href="#u6570_u636E_u4E22_u5931" class="headerlink" title="æ•°æ®ä¸¢å¤±"></a>æ•°æ®ä¸¢å¤±</h4><p>å†å²æ•°æ®å­˜æ”¾åœ¨HDFSä¸­ï¼Œç†è®ºä¸Šä¼šå­˜æ”¾å¤šä¸ªå‰¯æœ¬ã€‚HDFSä¼šç¡®ä¿æ•°æ®è¢«é è°±çš„å­˜æ”¾ç€ã€‚å½“è®¾ç½®äº†å‰¯æœ¬ï¼ŒKafkaä¹Ÿè¢«è®¾è®¡ä¸ºé‡‡ç”¨å‰¯æœ¬æ–¹å¼åº”å¯¹æ•…éšœã€‚</p>
<p>è¿™å¹¶æ²¡æœ‰å•¥é¸Ÿç”¨ï¼Œè¿™æ ·ä¸èƒ½ç¡®ä¿æ•°æ®ä¸ä¼šä¸¢å¤±ï¼Œåªèƒ½ä¾é HDFSå’ŒKafkaèƒ½æ­£å¸¸å¯ç”¨ç½¢äº†ã€‚</p>
<h4 id="u670D_u52A1_u5668_u6302_u9E1F"><a href="#u670D_u52A1_u5668_u6302_u9E1F" class="headerlink" title="æœåŠ¡å™¨æŒ‚é¸Ÿ"></a>æœåŠ¡å™¨æŒ‚é¸Ÿ</h4><p>é€šå¸¸æƒ…å†µä¸‹ï¼Œæ‰€æœ‰çš„ä¸‰å±‚æœåŠ¡è¿›ç¨‹åº”è¯¥ä¼šæŒç»­çš„å·¥ä½œï¼Œå¦‚æœä¸å¾—ä¸åœæ­¢æˆ–è€…æŒ‚é¸Ÿçš„è¯ï¼ŒæœåŠ¡è‡ªå·±ä¼šç«‹å³é‡å¯ã€‚è¿™ä¸ªå¯ä»¥é€šè¿‡åˆå§‹åŒ–è„šæœ¬å®Œç¾å®Œæˆæˆ–è€…ç±»ä¼¼æœºåˆ¶ï¼ˆå°šæœªå®ç°é¸Ÿï¼‰</p>
<h5 id="u670D_u52A1_u5C42"><a href="#u670D_u52A1_u5C42" class="headerlink" title="æœåŠ¡å±‚"></a>æœåŠ¡å±‚</h5><p>æœåŠ¡å±‚æ˜¯æ— çŠ¶æ€çš„ã€‚å¯åŠ¨åï¼Œä»–ä¼šè¯»å–æ›´æ–°topicsä¸­çš„æ‰€æœ‰çš„æ¨¡å‹å’Œå¯ç”¨æ›´æ–°ã€‚å½“é¦–ä¸ªå¯ç”¨çš„æ¨¡å‹å°±ç»ªåï¼Œå°±å¯ä»¥å¼€å§‹åº”ç­”è¯·æ±‚ã€‚åŸºäºè¿™ä¸ªåŸå› ï¼Œéœ€è¦é€‚å½“çš„é™åˆ¶æ›´æ–°topicçš„æŒç»­æ—¶é—´ã€‚</p>
<p>æœåŠ¡å±‚çš„æ“ä½œä¸æ˜¯åˆ†å¸ƒå¼çš„ï¼Œæ¯ä¸ªå®ä¾‹æ˜¯ç‹¬ç«‹çš„ï¼Œå¯åŠ¨å’Œåœæ­¢ä¸ä¼šå½±å“åˆ°å…¶ä»–éƒ¨åˆ†ã€‚</p>
<h5 id="u5B9E_u65F6_u8BA1_u7B97_u5C42"><a href="#u5B9E_u65F6_u8BA1_u7B97_u5C42" class="headerlink" title="å®æ—¶è®¡ç®—å±‚"></a>å®æ—¶è®¡ç®—å±‚</h5><p>å®æ—¶è®¡ç®—å±‚åŒæ ·ä¹Ÿä¸å­˜åœ¨çŠ¶æ€ï¼Œä¹Ÿä¼šåœ¨è¯»å–å…¨éƒ¨çš„æ¨¡å‹å’Œæ›´æ–°topicçš„æ›´æ–°ã€‚åªè¦å­˜åœ¨åˆæ³•çš„æ¨¡å‹ï¼Œå°±å¯ä»¥ç”Ÿæˆæ›´æ–°ã€‚åŒæ—¶ï¼Œä»æœ€åä¸€æ¬¡åç§»ä½ç½®å¼€å§‹è¯»å–è¾“å…¥topicsã€‚</p>
<p>å®æ—¶è®¡ç®—å±‚ä½¿ç”¨Sparkå’ŒSpark Streaming åšè®¡ç®—ã€‚Sparkä¼šå“åº”è®¡ç®—è¿‡ç¨‹ä¸­å¤±è´¥æƒ…å†µï¼Œå¹¶é‡è¯•ä»»åŠ¡ã€‚</p>
<p>Spark Streamingçš„Kafkaé›†æˆæ¨¡å—åœ¨æŸäº›æƒ…å†µä¸‹å¯ä»¥æ¢å¤æ¥æ”¶çš„æ•…éšœã€‚<br>å¦‚æœæ˜¯æ•´ä¸ªè¿›ç¨‹æ­»æ‰å¹¶è¢«é‡æ–°å¯åŠ¨ï¼Œoryx.idçš„å€¼è¢«è®¾å®šä»¥åï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨ä»ä¸Šä¸€æ¬¡Kafkaè®°å½•çš„åç§»åœ°å€å¼€å§‹è¯»å–ã€‚ï¼ˆå¦åˆ™ï¼Œå°†ä¼šä»ä¸Šæ¬¡åç§»åœ°å€å¼€å§‹ï¼Œè¿™å°±æ„å‘³ç€å®æ—¶è®¡ç®—å±‚æ²¡æœ‰è¿è¡Œçš„æ—¶å€™ï¼Œåˆ°è¾¾çš„æ•°æ®å°±ä¸ä¼šç”Ÿæˆä»»ä½•æ›´æ–°ã€‚ï¼‰ï¼ŒåŒæ ·çš„ï¼Œå¦‚æœå®æ—¶è®¡ç®—å±‚çš„æ¨¡å‹è¿˜æ²¡æœ‰å‡†å¤‡å¥½çš„è¯ï¼Œæ”¶åˆ°çš„æ•°æ®ä¹Ÿä¼šè¢«å¿½ç•¥ã€‚It effectively adopts â€œat most onceâ€ semantics.</p>
<p>ç”±äºå®æ—¶è®¡ç®—å±‚çš„ä½œç”¨æ˜¯ä¸ºæœ€åå‘å¸ƒçš„æ¨¡å‹æä¾›approximate, â€œbest effortâ€çš„æ›´æ–°ã€‚è¿™ç§è¡Œä¸ºç”±äºå…¶é—´æ¥æ€§ä¸€èˆ¬æ˜¯æ²¡æœ‰é—®é¢˜ï¼Œä¸”ä»¤äººæ»¡æ„çš„ã€‚</p>
<h5 id="u6279_u5904_u7406_u5C42"><a href="#u6279_u5904_u7406_u5C42" class="headerlink" title="æ‰¹å¤„ç†å±‚"></a>æ‰¹å¤„ç†å±‚</h5><p>æ‰¹å¤„ç†å±‚æ˜¯æœ€å¤æ‚çš„ï¼Œå› ä¸ºä»–å¹¶ç”ŸæˆæŸäº›çŠ¶æ€ï¼š</p>
<ul>
<li>å†å²æ•°æ®ï¼Œæ€»æ˜¯æŒä¹…åŒ–åˆ°HDFS</li>
<li>å¦‚æœåº”ç”¨é€‰æ‹©çš„è¯ï¼Œæ¨¡å‹çš„æ‰©å±•çŠ¶æ€å’Œtopicséƒ½å¯ä»¥è¢«æŒä¹…åŒ–åˆ°HDFSä¸Š</li>
</ul>
<p>å¯¹äºå¤šæ¬¡æˆ–è€…æ ¹æœ¬ä¸è¯»å–æ•°æ®æ˜¯éå¸¸æ•æ„Ÿçš„ï¼Œå› ä¸ºä»–æœ¬æ¥å°±æ˜¯ç”Ÿäº§å®˜æ–¹ä¸‹ä¸€ä»£æ¨¡å‹çš„ç»„ä»¶</p>
<p>ä¸å®æ—¶è®¡ç®—å±‚ä¸€èµ·ï¼ŒSparkå’ŒSpark Streamingåœ¨è®¡ç®—è¿‡ç¨‹ä¸­å¯ä»¥æ•è·å¾ˆå¤šé”™è¯¯æƒ…å†µã€‚ä¹Ÿå¯ä»¥ç®¡ç†å­˜å‚¨åˆ°HDFSä¸­çš„æ•°æ®ï¼Œè´Ÿè´£é¿å…ä¸¤æ¬¡å†™å…¥ç›¸åŒæ•°æ®ã€‚</p>
<p>åº”ç”¨è´Ÿè´£å›å¤å„è‡ªçš„ã€ŒçŠ¶æ€ã€ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå»ºç«‹åœ¨Oryx MLå±‚çš„åº”ç”¨ä¼šå°†çŠ¶æ€å†™å…¥å”¯ä¸€çš„å­ç›®å½•ä¸­ï¼Œå¹¶ä¸”åœ¨é‡å¯åä¼šåœ¨æ–°çš„ç›®å½•ç®€å•çš„äº§ç”Ÿä¸€ä¸ªæ–°çŠ¶æ€ã€‚å‰ä¸€ä¸ªçŠ¶æ€å¦‚æœå­˜åœ¨çš„è¯ï¼Œä¹Ÿä¼šè¢«å®Œæ•´å†™å…¥æˆ–è€…è¢«å®Œå…¨å¿½è§†ã€‚</p>
<p>æ‰¹å¤„ç†å±‚ä¹Ÿå’Œå®æ—¶è®¡ç®—å±‚ä¸€æ ·ï¼Œç¬¦åˆã€è‡³å¤šä¸€æ¬¡ã€çš„è§„åˆ™ã€‚ç»¼ä¸Šï¼Œå¦‚æœæ•´ä¸ªè¿›ç¨‹æ­»æ‰æˆ–è€…è¢«é‡å¯ï¼Œoryx.idè¢«è®¾ç½®çš„è¯ï¼Œåˆ™ä¼šä»Kafkaè®°å½•çš„æœ€åä¸€æ¬¡åç§»é‡æ–°è¯»å–ï¼Œå¦åˆ™ä¼šåœ¨æœ€åä¸€æ¬¡åç§»å¤„é‡æ–°è¯»å–æ•°æ®ã€‚</p>
]]></content>
    <summary type="html">
    <![CDATA[<!--  -->
<!--  -->
<!--  _ __    __     __      ____    ___     ___   _____   __  __    ___     -->
<!-- /\`'__\/'__`\ /'__`\   /',__\  / _]]>
    </summary>
    
      <category term="Admin" scheme="http://reasonpun.com/tags/Admin/"/>
    
      <category term="Hadoop" scheme="http://reasonpun.com/tags/Hadoop/"/>
    
      <category term="Oryx2" scheme="http://reasonpun.com/tags/Oryx2/"/>
    
      <category term="Spark" scheme="http://reasonpun.com/tags/Spark/"/>
    
      <category term="Spark-Streaming" scheme="http://reasonpun.com/tags/Spark-Streaming/"/>
    
      <category term="documentation" scheme="http://reasonpun.com/tags/documentation/"/>
    
      <category term="æ•°æ®æŒ–æ˜" scheme="http://reasonpun.com/categories/%E6%95%B0%E6%8D%AE%E6%8C%96%E6%8E%98/"/>
    
      <category term="å®æ—¶è®¡ç®—" scheme="http://reasonpun.com/categories/%E6%95%B0%E6%8D%AE%E6%8C%96%E6%8E%98/%E5%AE%9E%E6%97%B6%E8%AE%A1%E7%AE%97/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[Oryx2 ç®€ä»‹]]></title>
    <link href="http://reasonpun.com/2015/12/21/Oryx2-Overview/"/>
    <id>http://reasonpun.com/2015/12/21/Oryx2-Overview/</id>
    <published>2015-12-21T03:37:05.000Z</published>
    <updated>2016-01-25T03:17:11.000Z</updated>
    <content type="html"><![CDATA[<!--  -->
<!--  -->
<!--  _ __    __     __      ____    ___     ___   _____   __  __    ___     -->
<!-- /\`'__\/'__`\ /'__`\   /',__\  / __`\ /' _ `\/\ '__`\/\ \/\ \ /' _ `\   -->
<!-- \ \ \//\  __//\ \L\.\_/\__, `\/\ \L\ \/\ \/\ \ \ \L\ \ \ \_\ \/\ \/\ \  -->
<!--  \ \_\\ \____\ \__/.\_\/\____/\ \____/\ \_\ \_\ \ ,__/\ \____/\ \_\ \_\ -->
<!--   \/_/ \/____/\/__/\/_/\/___/  \/___/  \/_/\/_/\ \ \/  \/___/  \/_/\/_/ -->
<!--                                                 \ \_\                   -->
<!--                                                  \/_/                   -->
<!--  -->
<h3 id="u7B80_u4ECB"><a href="#u7B80_u4ECB" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h3><img src="/images/oryx/OryxLogoMedium.png" title="oryx2">
<p>Oryx2æ˜¯ä¸“æ³¨äºè¿›è¡Œå¤§è§„æ¨¡ï¼Œå®æ—¶æœºå™¨å­¦ä¹ æ¡†æ¶ï¼Œéµå¾ªlambdaè§„åˆ™ï¼ŒåŸºäºApache Sparkå’ŒApache Kafkaæ„å»ºã€‚</p>
<p>Oryx ä¸ä»…æ˜¯æ„å»ºåº”ç”¨ç¨‹åºçš„æ¡†æ¶ï¼Œè€Œä¸”åŒ…å« ååŒè¿‡æ»¤ï¼Œåˆ†ç±»ï¼Œå›å½’å’Œèšç±»çš„æ‰“åŒ…çš„ç«¯åˆ°ç«¯çš„åº”ç”¨ã€‚</p>
<p>åŒ…å«3å±‚</p>
<ul>
<li>lambdaå±‚<ul>
<li>æ‰¹é‡å¤„ç†</li>
<li>å¿«é€Ÿå¤„ç†</li>
<li>æœåŠ¡</li>
</ul>
</li>
<li>MLæŠ½è±¡å±‚</li>
<li>ç«¯åˆ°ç«¯å®ç°å±‚</li>
</ul>
<p>ä»å¦ä¸€ä¸ªè§’åº¦ï¼Œå¯ä»¥çœ‹æˆæ˜¯ä¸€ç³»åˆ—é“¾æ¥çš„å…ƒç´ </p>
<ul>
<li>æ‰¹å¤„ç†å±‚ï¼šä¾æ®å†å²æ•°æ®è¿›è¡Œç¦»çº¿å¤„ç†</li>
<li>å®æ—¶å¤„ç†å±‚ï¼šé€šè¿‡å¢é‡æ•°æ®æµï¼Œå®æ—¶æ›´æ–°ç»“æœ</li>
<li>æœåŠ¡å±‚ï¼šé€šè¿‡æ¨¡å‹çš„ä¼ é€’å®ç°å¼‚æ­¥æŸ¥è¯¢API</li>
<li>æ•°æ®ä¼ è¾“å±‚ï¼šåœ¨å¤–éƒ¨æ•°æ®æºä¸å¤„ç†å±‚ä¹‹é—´ä¼ è¾“æ•°æ®</li>
</ul>
<p>The project</p>
<ul>
<li>may be reused tier by tier for example, the packaged app tier can be ignored, and it can be a framework for building new ML applications.</li>
<li>It can be reused layer by layer too: for example, the Speed Layer can be omitted if a deployment does not need incremental updates.</li>
<li>It can be modified piece-by-piece too: the collaborative filtering applicationâ€™s model-building batch layer could be swapped for a custom implementation based on a new algorithm outside Spark MLlib while retaining the serving and speed layer implementations.</li>
</ul>
<img src="/images/oryx/Architecture.png" title="Architecture">
<h3 id="Lambda_u5C42_u5B9E_u73B0"><a href="#Lambda_u5C42_u5B9E_u73B0" class="headerlink" title="Lambdaå±‚å®ç°"></a>Lambdaå±‚å®ç°</h3><h4 id="u6570_u636E_u4F20_u8F93"><a href="#u6570_u636E_u4F20_u8F93" class="headerlink" title="æ•°æ®ä¼ è¾“"></a>æ•°æ®ä¼ è¾“</h4><p>  æ•°æ®ä¼ è¾“æœºåˆ¶å…¶å®å°±æ˜¯ä¸€ä¸ªKafkaçš„Topicã€‚ä»»ä½•ä¸€ä¸ªè¿›ç¨‹ï¼ˆåŒ…å«ä¸”ä¸å±€é™ä¸æœåŠ¡å±‚ï¼‰éƒ½å¯ä»¥å‘topicä¸­å†™å…¥æ•°æ®ï¼Œå¹¶é€šè¿‡å®æ—¶å¤„ç†å’Œæ‰¹å¤„ç†å±‚æŸ¥çœ‹ã€‚<br>  Kafka Topicä¹Ÿå¯ä»¥ç”¨æ¥æ¨¡å‹å’Œæ¨¡å‹ä¹‹é—´çš„æ›´æ–°ï¼Œå¹¶è¢«å®æ—¶å¤„ç†å±‚å’ŒæœåŠ¡å±‚æ¶ˆè´¹ã€‚</p>
<h4 id="u6279_u5904_u7406_u5C42"><a href="#u6279_u5904_u7406_u5C42" class="headerlink" title="æ‰¹å¤„ç†å±‚"></a>æ‰¹å¤„ç†å±‚</h4><p>  æ‰¹å¤„ç†å±‚æ˜¯ä»¥Spark Streamingè¿›ç¨‹çš„æ–¹å¼å®ç°çš„ï¼Œè¿è¡Œåœ¨Hadoop ClusterèŠ‚ç‚¹ä¸Šï¼Œå¹¶è¯»å–æ¥è‡ªKafka topicçš„è¾“å…¥æ•°æ®ã€‚ Streaming è¿›ç¨‹ä¼šæœ‰ä¸€ä¸ªå¾ˆé•¿çš„è¿è¡Œå‘¨æœŸ-è‹¥å¹²å°æ—¶ç”šè‡³ä¸€å¤©ã€‚ä¼šä½¿ç”¨Sparkå­˜å‚¨å½“å‰ä¼šè¯æ•°æ®åˆ°HDFSä¸­ï¼Œç„¶ååˆå¹¶HDFSä¸Šçš„æ‰€æœ‰å†å²æ•°æ®ï¼Œä¹‹åé‡æ–°åˆå§‹åŒ–æ„å»ºæ–°çš„ç»“æœæ•°æ®ã€‚å¹¶å°†æ–°çš„ç»“æœé‡æ–°å†™å…¥HDFSï¼ŒåŒæ—¶å‘ä¸åˆ°Kafkaæ›´æ–°topicä¸­ã€‚</p>
<h4 id="u5B9E_u65F6_u5904_u7406_u5C42"><a href="#u5B9E_u65F6_u5904_u7406_u5C42" class="headerlink" title="å®æ—¶å¤„ç†å±‚"></a>å®æ—¶å¤„ç†å±‚</h4><p>  å®æ—¶å¤„ç†å±‚ä¹Ÿæ˜¯ç”±Spark Streamingè¿›ç¨‹å®ç°çš„ï¼ŒåŒæ ·è¯»å–Kafka topicè¾“å…¥æ•°æ®ã€‚ä½†æ˜¯ä»–å­˜åœ¨æ¯”è¾ƒçŸ­çš„è¿è¡Œå‘¨æœŸï¼Œæ¯”å¦‚ç§’çº§åˆ«ã€‚ä¼šæŒç»­æ¶ˆè´¹æ›´æ–°topicä¸­çš„æ–°æ¨¡å‹ï¼Œå¹¶ç”Ÿäº§æ–°çš„æ¨¡å‹ã€‚ä¹Ÿä¼šå›å†™æ›´æ–°topicã€‚</p>
<h4 id="u670D_u52A1_u5C42"><a href="#u670D_u52A1_u5C42" class="headerlink" title="æœåŠ¡å±‚"></a>æœåŠ¡å±‚</h4><p>  æœåŠ¡å±‚ç›‘å¬æ›´æ–°topicä¸Šçš„æ¨¡å‹ä»¥åŠæ¨¡å‹æ›´æ–°ã€‚åœ¨å†…å­˜ä¸­æŒä¹…åŒ–æ¨¡å‹çŠ¶æ€ã€‚<br>  ä¼šæš´éœ²é¡¶å±‚æ–¹æ³•çš„ HTTP REST API ç”¨äºæŸ¥è¯¢å†…å­˜ä¸­çš„æ¨¡å‹ã€‚å¤§éƒ¨åˆ†æ¥å£éƒ½æ”¯æŒå¤§è§„æ¨¡çš„éƒ¨ç½²ã€‚<br>  æ¯ä¸ªæ¥å£éƒ½å¯ä»¥æ¥æ”¶æ–°çš„æ•°æ®å¹¶å†™å…¥Kafkaï¼Œä»¥æ­¤åœ¨å®æ—¶å¤„ç†å±‚å’Œæ‰¹å¤„ç†å±‚å¯è§ã€‚</p>
<h4 id="u914D_u7F6E_u548C_u90E8_u7F72"><a href="#u914D_u7F6E_u548C_u90E8_u7F72" class="headerlink" title="é…ç½®å’Œéƒ¨ç½²"></a>é…ç½®å’Œéƒ¨ç½²</h4><p>  ç¨‹åºæ˜¯åŸºäºJavaå®ç°çš„ï¼Œä¾èµ–</p>
<pre><code>* Spark 1.3.x+
* Hadoop 2.6.x+
* Tomcat 8.x+
* Kafka 0.8.2+
* Zookeeper ç­‰ã€‚
</code></pre><p>  é…ç½®æ–‡ä»¶é€šè¿‡ <a href="https://github.com/typesafehub/config" target="_blank" rel="external">Typesafe Config</a> çš„æ–¹å¼å®ç°æ•´ä¸ªç³»ç»Ÿçš„éƒ¨ç½²é…ç½®ã€‚<br>  åŒ…æ‹¬ï¼š æ‰¹å¤„ç†ï¼Œå®æ—¶å¤„ç†ï¼ŒæœåŠ¡å±‚é€»è¾‘å…³é”®çš„æ¥å£ç±»çš„å®ç°</p>
<p>  æ¯ä¸ªå±‚çš„äºŒè¿›åˆ¶å½¢å¼åˆ†å¼€è¿›è¡Œæ‰“åŒ…å’Œéƒ¨ç½²çš„ï¼Œæ¯ä¸ªéƒ½æ˜¯ä»¥å¯æ‰§è¡Œçš„Javaçš„jaråŒ…çš„å½¢å¼å­˜åœ¨å¹¶åŒ…å«æ‰€æœ‰å¿…é¡»çš„æœåŠ¡ã€‚</p>
<h3 id="ML_u5C42_u5B9E_u73B0"><a href="#ML_u5C42_u5B9E_u73B0" class="headerlink" title="MLå±‚å®ç°"></a>MLå±‚å®ç°</h3><p>  MLå±‚å¯¹ä¸Šè¿°é€šç”¨æ¥å£æ–¹æ³•åšäº†ç®€å•çš„ä¸“ä¸€è¯çš„å®ç°ï¼Œå®ç°äº†é€šç”¨MLéœ€æ±‚ï¼Œå¹¶ä¸”å¯¹åº”ç”¨æš´éœ²äº†æœºå™¨å­¦ä¹ ç‰¹æœ‰çš„æ¥å…¥æ¥å£ã€‚</p>
<p>  ä¸¾ä¸ªä¾‹å­ï¼Œå®ç°äº†æ‰¹é‡å¤„ç†å±‚ï¼Œç”¨äºè‡ªåŠ¨æ›´æ–°æµ‹è¯•é›†å’Œè®­ç»ƒé›†è¿›ç¨‹ã€‚å¯ä»¥è°ƒç”¨åº”ç”¨æä¾›çš„å‡½æ•°æ¥è¯„ä¼°æµ‹è¯•æœºæ¨¡å‹ã€‚é€šè¿‡å°è¯•ä¸åŒçš„è¶…å‚æ•°å€¼ï¼Œé€‰æ‹©å‡ºæœ€ä½³ç»“æœã€‚é€šè¿‡PMMLç®¡ç†æ¨¡å‹çš„åºåˆ—å·ã€‚</p>
<h3 id="u7AEF_u5230_u7AEF_u5E94_u7528_u5B9E_u73B0"><a href="#u7AEF_u5230_u7AEF_u5E94_u7528_u5B9E_u73B0" class="headerlink" title="ç«¯åˆ°ç«¯åº”ç”¨å®ç°"></a>ç«¯åˆ°ç«¯åº”ç”¨å®ç°</h3><p>  é™¤äº†ä½œä¸ºä¸€ç§æ¡†æ¶ï¼ŒOryx2 åŒ…å«å®Œæ•´çš„ä¸‰ä¸­æœºå™¨å­¦ä¹ éœ€è¦çš„æ‰¹å¤„ç†å±‚ï¼Œå®æ—¶å¤„ç†å±‚ï¼ŒæœåŠ¡å±‚ã€‚<br>  å¼€ç®±å³ç”¨ï¼Œæˆ–è€…ä½œä¸ºè‡ªå®šä¹‰ç¨‹åºçš„åŸºç¡€ï¼š</p>
<pre><code>* åŸºäºæœ€å°äºŒä¹˜æ³•çš„ååŒè¿‡æ»¤/æ¨è
* åŸºäºk-meansçš„èšç±»
* åŸºäºéšæœºå†³ç­–æ£®æ—çš„åˆ†ç±»å’Œå›å½’
</code></pre><h3 id="u53C2_u8003_u6587_u732E"><a href="#u53C2_u8003_u6587_u732E" class="headerlink" title="å‚è€ƒæ–‡çŒ®"></a>å‚è€ƒæ–‡çŒ®</h3><ul>
<li><a href="http://oryx.io/index.html" target="_blank" rel="external">http://oryx.io/index.html</a></li>
<li><a href="http://www.ivanopt.com/oryx-document%E7%BF%BB%E8%AF%91/" target="_blank" rel="external">http://www.ivanopt.com/oryx-document%E7%BF%BB%E8%AF%91/</a></li>
<li><a href="http://jameskinley.tumblr.com/post/37398560534/the-lambda-architecture-principles-for" target="_blank" rel="external">http://jameskinley.tumblr.com/post/37398560534/the-lambda-architecture-principles-for</a></li>
<li><a href="http://dmg.org/pmml/v4-1/GeneralStructure.html" target="_blank" rel="external">http://dmg.org/pmml/v4-1/GeneralStructure.html</a></li>
<li><a href="http://blog.csdn.net/nxcjh321/article/details/24796879" target="_blank" rel="external">http://blog.csdn.net/nxcjh321/article/details/24796879</a></li>
<li><a href="http://youngfor.me/post/recsys/oryx-tui-jian-xi-tong-chu-ti-yan" target="_blank" rel="external">http://youngfor.me/post/recsys/oryx-tui-jian-xi-tong-chu-ti-yan</a></li>
<li><a href="https://github.com/OryxProject/oryx" target="_blank" rel="external">https://github.com/OryxProject/oryx</a></li>
</ul>
]]></content>
    <summary type="html">
    <![CDATA[<!--  -->
<!--  -->
<!--  _ __    __     __      ____    ___     ___   _____   __  __    ___     -->
<!-- /\`'__\/'__`\ /'__`\   /',__\  / _]]>
    </summary>
    
      <category term="Hadoop" scheme="http://reasonpun.com/tags/Hadoop/"/>
    
      <category term="Java" scheme="http://reasonpun.com/tags/Java/"/>
    
      <category term="Oryx2" scheme="http://reasonpun.com/tags/Oryx2/"/>
    
      <category term="Recommendation" scheme="http://reasonpun.com/tags/Recommendation/"/>
    
      <category term="Spark" scheme="http://reasonpun.com/tags/Spark/"/>
    
      <category term="Spark-Streaming" scheme="http://reasonpun.com/tags/Spark-Streaming/"/>
    
      <category term="æ•°æ®æŒ–æ˜" scheme="http://reasonpun.com/categories/%E6%95%B0%E6%8D%AE%E6%8C%96%E6%8E%98/"/>
    
      <category term="å®æ—¶è®¡ç®—" scheme="http://reasonpun.com/categories/%E6%95%B0%E6%8D%AE%E6%8C%96%E6%8E%98/%E5%AE%9E%E6%97%B6%E8%AE%A1%E7%AE%97/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[Genetic Algorithm]]></title>
    <link href="http://reasonpun.com/2015/12/14/Genetic-Algorithm/"/>
    <id>http://reasonpun.com/2015/12/14/Genetic-Algorithm/</id>
    <published>2015-12-14T08:25:10.000Z</published>
    <updated>2016-01-25T03:17:11.000Z</updated>
    <content type="html"><![CDATA[<!--  -->
<!--  -->
<!--  _ __    __     __      ____    ___     ___   _____   __  __    ___     -->
<!-- /\`'__\/'__`\ /'__`\   /',__\  / __`\ /' _ `\/\ '__`\/\ \/\ \ /' _ `\   -->
<!-- \ \ \//\  __//\ \L\.\_/\__, `\/\ \L\ \/\ \/\ \ \ \L\ \ \ \_\ \/\ \/\ \  -->
<!--  \ \_\\ \____\ \__/.\_\/\____/\ \____/\ \_\ \_\ \ ,__/\ \____/\ \_\ \_\ -->
<!--   \/_/ \/____/\/__/\/_/\/___/  \/___/  \/_/\/_/\ \ \/  \/___/  \/_/\/_/ -->
<!--                                                 \ \_\                   -->
<!--                                                  \/_/                   -->
<!--  -->
<p>Genetic Algorithm: é—ä¼ ç®—æ³•</p>
]]></content>
    <summary type="html">
    <![CDATA[<!--  -->
<!--  -->
<!--  _ __    __     __      ____    ___     ___   _____   __  __    ___     -->
<!-- /\`'__\/'__`\ /'__`\   /',__\  / _]]>
    </summary>
    
      <category term="Genetic Algorithm" scheme="http://reasonpun.com/tags/Genetic-Algorithm/"/>
    
      <category term="æ•°æ®æŒ–æ˜" scheme="http://reasonpun.com/categories/%E6%95%B0%E6%8D%AE%E6%8C%96%E6%8E%98/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[apache-flume-ng-structure]]></title>
    <link href="http://reasonpun.com/2015/12/10/apache-flume-ng-structure/"/>
    <id>http://reasonpun.com/2015/12/10/apache-flume-ng-structure/</id>
    <published>2015-12-10T07:01:57.000Z</published>
    <updated>2016-03-07T08:25:29.000Z</updated>
    <content type="html"><![CDATA[<!--  -->
<!--  -->
<!--  _ __    __     __      ____    ___     ___   _____   __  __    ___     -->
<!-- /\`'__\/'__`\ /'__`\   /',__\  / __`\ /' _ `\/\ '__`\/\ \/\ \ /' _ `\   -->
<!-- \ \ \//\  __//\ \L\.\_/\__, `\/\ \L\ \/\ \/\ \ \ \L\ \ \ \_\ \/\ \/\ \  -->
<!--  \ \_\\ \____\ \__/.\_\/\____/\ \____/\ \_\ \_\ \ ,__/\ \____/\ \_\ \_\ -->
<!--   \/_/ \/____/\/__/\/_/\/___/  \/___/  \/_/\/_/\ \ \/  \/___/  \/_/\/_/ -->
<!--                                                 \ \_\                   -->
<!--                                                  \/_/                   -->
<!--  -->
<h2 id="Apache-flume_NG__u914D_u7F6E"><a href="#Apache-flume_NG__u914D_u7F6E" class="headerlink" title="Apache-flume NG é…ç½®"></a>Apache-flume NG é…ç½®</h2><h3 id="u7B80_u4ECB"><a href="#u7B80_u4ECB" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h3><p>  Flume NGæ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼ã€å¯é ã€å¯ç”¨çš„ç³»ç»Ÿï¼Œå®ƒèƒ½å¤Ÿå°†ä¸åŒæ•°æ®æºçš„æµ·é‡æ—¥å¿—æ•°æ®è¿›è¡Œé«˜æ•ˆæ”¶é›†ã€èšåˆã€ç§»åŠ¨ï¼Œæœ€åå­˜å‚¨åˆ°ä¸€ä¸ªä¸­å¿ƒåŒ–æ•°æ®å­˜å‚¨ç³»ç»Ÿä¸­ã€‚</p>
<p>  ç”±åŸæ¥çš„Flume OGåˆ°ç°åœ¨çš„Flume NGï¼Œè¿›è¡Œäº†æ¶æ„é‡æ„ï¼Œå¹¶ä¸”ç°åœ¨NGç‰ˆæœ¬å®Œå…¨ä¸å…¼å®¹åŸæ¥çš„OGç‰ˆæœ¬ã€‚</p>
<p>  ç»è¿‡æ¶æ„é‡æ„åï¼ŒFlume NGæ›´åƒæ˜¯ä¸€ä¸ªè½»é‡çš„å°å·¥å…·ï¼Œéå¸¸ç®€å•ï¼Œå®¹æ˜“é€‚åº”å„ç§æ–¹å¼æ—¥å¿—æ”¶é›†ï¼Œå¹¶æ”¯æŒfailoverå’Œè´Ÿè½½å‡è¡¡ã€‚</p>
<h3 id="u67B6_u6784_u8BBE_u8BA1_u8981_u70B9"><a href="#u67B6_u6784_u8BBE_u8BA1_u8981_u70B9" class="headerlink" title="æ¶æ„è®¾è®¡è¦ç‚¹"></a>æ¶æ„è®¾è®¡è¦ç‚¹</h3><h4 id="u6838_u5FC3_u6982_u5FF5"><a href="#u6838_u5FC3_u6982_u5FF5" class="headerlink" title="æ ¸å¿ƒæ¦‚å¿µ"></a>æ ¸å¿ƒæ¦‚å¿µ</h4><ul>
<li>Eventï¼šä¸€ä¸ªæ•°æ®å•å…ƒï¼Œå¸¦æœ‰ä¸€ä¸ªå¯é€‰çš„æ¶ˆæ¯å¤´</li>
<li>Flowï¼šEventä»æºç‚¹åˆ°è¾¾ç›®çš„ç‚¹çš„è¿ç§»çš„æŠ½è±¡</li>
<li>Clientï¼šæ“ä½œä½äºæºç‚¹å¤„çš„Eventï¼Œå°†å…¶å‘é€åˆ°Flume Agent</li>
<li>Agentï¼šä¸€ä¸ªç‹¬ç«‹çš„Flumeè¿›ç¨‹ï¼ŒåŒ…å«ç»„ä»¶Sourceã€Channelã€Sink</li>
<li>Sourceï¼šç”¨æ¥æ¶ˆè´¹ä¼ é€’åˆ°è¯¥ç»„ä»¶çš„Event</li>
<li>Channelï¼šä¸­è½¬Eventçš„ä¸€ä¸ªä¸´æ—¶å­˜å‚¨ï¼Œä¿å­˜æœ‰Sourceç»„ä»¶ä¼ é€’è¿‡æ¥çš„Event</li>
<li>Sinkï¼šä»Channelä¸­è¯»å–å¹¶ç§»é™¤Eventï¼Œå°†Eventä¼ é€’åˆ°Flow Pipelineä¸­çš„ä¸‹ä¸€ä¸ªAgentï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰</li>
</ul>
<h4 id="u67B6_u6784_u56FE"><a href="#u67B6_u6784_u56FE" class="headerlink" title="æ¶æ„å›¾"></a>æ¶æ„å›¾</h4><pre><code><img src="/images/flume-ng/flume-ng-architecture.png" title="flume-ngæ€»ä½“ç»“æ„å›¾">
</code></pre><h4 id="u57FA_u672C_u6D41_u7A0B"><a href="#u57FA_u672C_u6D41_u7A0B" class="headerlink" title="åŸºæœ¬æµç¨‹"></a>åŸºæœ¬æµç¨‹</h4><p>å¤–éƒ¨ç³»ç»Ÿäº§ç”Ÿæ—¥å¿—ï¼Œç›´æ¥é€šè¿‡Flumeçš„Agentçš„Sourceç»„ä»¶å°†äº‹ä»¶ï¼ˆå¦‚æ—¥å¿—è¡Œï¼‰å‘é€åˆ°ä¸­é—´ä¸´æ—¶çš„channelç»„ä»¶ï¼Œæœ€åä¼ é€’ç»™Sinkç»„ä»¶ï¼ŒHDFS Sinkç»„ä»¶å¯ä»¥ç›´æ¥æŠŠæ•°æ®å­˜å‚¨åˆ°HDFSé›†ç¾¤ä¸Šã€‚</p>
<h4 id="u5355Agent"><a href="#u5355Agent" class="headerlink" title="å•Agent"></a>å•Agent</h4><p>  ä¸€ä¸ªæœ€åŸºæœ¬Flowçš„é…ç½®ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š</p>
  <figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># list the sources, sinks and channels for the agent</span></span><br><span class="line"><span class="variable">&lt;Agent&gt;</span>.sources = <span class="variable">&lt;Source1&gt;</span> <span class="variable">&lt;Source2&gt;</span></span><br><span class="line"><span class="variable">&lt;Agent&gt;</span>.sinks = <span class="variable">&lt;Sink1&gt;</span> <span class="variable">&lt;Sink2&gt;</span></span><br><span class="line"><span class="variable">&lt;Agent&gt;</span>.channels = <span class="variable">&lt;Channel1&gt;</span> <span class="variable">&lt;Channel2&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># set channel for source</span></span><br><span class="line"><span class="variable">&lt;Agent&gt;</span>.sources.<span class="variable">&lt;Source1&gt;</span>.channels = <span class="variable">&lt;Channel1&gt;</span> <span class="variable">&lt;Channel2&gt;</span> ...</span><br><span class="line"><span class="variable">&lt;Agent&gt;</span>.sources.<span class="variable">&lt;Source2&gt;</span>.channels = <span class="variable">&lt;Channel1&gt;</span> <span class="variable">&lt;Channel2&gt;</span> ...</span><br><span class="line"></span><br><span class="line"><span class="comment"># set channel for sink</span></span><br><span class="line"><span class="variable">&lt;Agent&gt;</span>.sinks.<span class="variable">&lt;Sink1&gt;</span>.channel = <span class="variable">&lt;Channel1&gt;</span></span><br><span class="line"><span class="variable">&lt;Agent&gt;</span>.sinks.<span class="variable">&lt;Sink2&gt;</span>.channel = <span class="variable">&lt;Channel2&gt;</span></span><br></pre></td></tr></table></figure>
<p>  å°–æ‹¬å·é‡Œé¢çš„ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®å®é™…éœ€æ±‚æˆ–ä¸šåŠ¡æ¥ä¿®æ”¹åç§°ã€‚</p>
<p>  ä¸‹é¢è¯¦ç»†è¯´æ˜ï¼š</p>
<ul>
<li><agent> è¡¨ç¤ºé…ç½®ä¸€ä¸ªAgentçš„åç§°ï¼Œä¸€ä¸ªAgentè‚¯å®šæœ‰ä¸€ä¸ªåç§°ã€‚</agent></li>
<li><source1>å’Œ<source2>æ˜¯Agentçš„Sourceç»„ä»¶çš„åç§°ï¼Œæ¶ˆè´¹ä¼ é€’è¿‡æ¥çš„Eventã€‚</source2></source1></li>
<li><channel1>å’Œ<channel2>æ˜¯Agentçš„Channelç»„ä»¶çš„åç§°ã€‚</channel2></channel1></li>
<li><p><sink1>ä¸<sink2>æ˜¯Agentçš„Sinkç»„ä»¶çš„åç§°ï¼Œä»Channelä¸­æ¶ˆè´¹ï¼ˆç§»é™¤ï¼‰Eventã€‚</sink2></sink1></p>
<p>ä¸Šé¢é…ç½®å†…å®¹ä¸­</p>
</li>
<li><p>ç¬¬ä¸€ç»„ä¸­é…ç½®Sourceã€Sinkã€Channelï¼Œå®ƒä»¬çš„å€¼å¯ä»¥æœ‰1ä¸ªæˆ–è€…å¤šä¸ªï¼›</p>
</li>
<li>ç¬¬äºŒç»„ä¸­é…ç½®Sourceå°†æŠŠæ•°æ®å­˜å‚¨ï¼ˆPutï¼‰åˆ°å“ªä¸€ä¸ªChannelä¸­ï¼Œå¯ä»¥å­˜å‚¨åˆ°1ä¸ªæˆ–å¤šä¸ªChannelä¸­ï¼Œ<br>åŒä¸€ä¸ªSourceå°†æ•°æ®å­˜å‚¨åˆ°å¤šä¸ªChannelä¸­ï¼Œå®é™…ä¸Šæ˜¯Replicationï¼›</li>
<li>ç¬¬ä¸‰ç»„ä¸­é…ç½®Sinkä»å“ªä¸€ä¸ªChannelä¸­å–ï¼ˆTaskï¼‰æ•°æ®ï¼Œä¸€ä¸ªSinkåªèƒ½ä»ä¸€ä¸ªChannelä¸­å–æ•°æ®ã€‚</li>
</ul>
<h4 id="u591A_u4E2AAgent_u987A_u5E8F_u8FDE_u63A5"><a href="#u591A_u4E2AAgent_u987A_u5E8F_u8FDE_u63A5" class="headerlink" title="å¤šä¸ªAgenté¡ºåºè¿æ¥"></a>å¤šä¸ªAgenté¡ºåºè¿æ¥</h4>  <img src="/images/flume-ng/flume-multiseq-agents.png" title="flume-ng å¤šä¸ªAgenté¡ºåºè¿æ¥">
<p>  å¯ä»¥å°†å¤šä¸ªAgenté¡ºåºè¿æ¥èµ·æ¥ï¼Œå°†æœ€åˆçš„æ•°æ®æºç»è¿‡æ”¶é›†ï¼Œå­˜å‚¨åˆ°æœ€ç»ˆçš„å­˜å‚¨ç³»ç»Ÿä¸­ã€‚è¿™æ˜¯æœ€ç®€å•çš„æƒ…å†µï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œåº”è¯¥æ§åˆ¶è¿™ç§é¡ºåºè¿æ¥çš„Agentçš„æ•°é‡ï¼Œå› ä¸ºæ•°æ®æµç»çš„è·¯å¾„å˜é•¿äº†ï¼Œå¦‚æœä¸è€ƒè™‘failoverçš„è¯ï¼Œå‡ºç°æ•…éšœå°†å½±å“æ•´ä¸ªFlowä¸Šçš„Agentæ”¶é›†æœåŠ¡ã€‚</p>
<h4 id="u591A_u4E2AAgent_u7684_u6570_u636E_u6C47_u805A_u5230_u540C_u4E00_u4E2AAgent"><a href="#u591A_u4E2AAgent_u7684_u6570_u636E_u6C47_u805A_u5230_u540C_u4E00_u4E2AAgent" class="headerlink" title="å¤šä¸ªAgentçš„æ•°æ®æ±‡èšåˆ°åŒä¸€ä¸ªAgent"></a>å¤šä¸ªAgentçš„æ•°æ®æ±‡èšåˆ°åŒä¸€ä¸ªAgent</h4>  <img src="/images/flume-ng/flume-join-agent.png" title="flume-ng å¤šä¸ªAgentçš„æ•°æ®æ±‡èšåˆ°åŒä¸€ä¸ªAgent">
<p>  è¿™ç§æƒ…å†µåº”ç”¨çš„åœºæ™¯æ¯”è¾ƒå¤šï¼Œæ¯”å¦‚è¦æ”¶é›†Webç½‘ç«™çš„ç”¨æˆ·è¡Œä¸ºæ—¥å¿—ï¼ŒWebç½‘ç«™ä¸ºäº†å¯ç”¨æ€§ä½¿ç”¨çš„è´Ÿè½½å‡è¡¡çš„é›†ç¾¤æ¨¡å¼ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½äº§ç”Ÿç”¨æˆ·è¡Œä¸ºæ—¥å¿—ï¼Œå¯ä»¥ä¸ºæ¯ä¸ªèŠ‚ç‚¹éƒ½é…ç½®ä¸€ä¸ªAgentæ¥å•ç‹¬æ”¶é›†æ—¥å¿—æ•°æ®ï¼Œç„¶åå¤šä¸ªAgentå°†æ•°æ®æœ€ç»ˆæ±‡èšåˆ°ä¸€ä¸ªç”¨æ¥å­˜å‚¨æ•°æ®å­˜å‚¨ç³»ç»Ÿï¼Œå¦‚HDFSä¸Šã€‚</p>
<h4 id="u591A_u8DEF_uFF08Multiplexing_uFF09Agent"><a href="#u591A_u8DEF_uFF08Multiplexing_uFF09Agent" class="headerlink" title="å¤šè·¯ï¼ˆMultiplexingï¼‰Agent"></a>å¤šè·¯ï¼ˆMultiplexingï¼‰Agent</h4>  <img src="/images/flume-ng/flume-multiplexing-agent.png" title="flume-ng å¤šè·¯ï¼ˆMultiplexingï¼‰Agent">
<p>  è¿™ç§æ¨¡å¼ï¼Œæœ‰ä¸¤ç§æ–¹å¼</p>
<ul>
<li><p>ä¸€ç§æ˜¯ç”¨æ¥å¤åˆ¶ï¼ˆReplicationï¼‰</p>
<ul>
<li><p>Replicationæ–¹å¼ï¼Œå¯ä»¥å°†æœ€å‰ç«¯çš„æ•°æ®æºå¤åˆ¶å¤šä»½ï¼Œåˆ†åˆ«ä¼ é€’åˆ°å¤šä¸ªchannelä¸­ï¼Œæ¯ä¸ªchannelæ¥æ”¶åˆ°çš„æ•°æ®éƒ½æ˜¯ç›¸åŒçš„ï¼Œé…ç½®æ ¼å¼</p>
<figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># List the sources, sinks and channels for the agent</span></span><br><span class="line"><span class="variable">&lt;Agent&gt;</span>.sources = <span class="variable">&lt;Source1&gt;</span></span><br><span class="line"><span class="variable">&lt;Agent&gt;</span>.sinks = <span class="variable">&lt;Sink1&gt;</span> <span class="variable">&lt;Sink2&gt;</span></span><br><span class="line"><span class="variable">&lt;Agent&gt;</span>.channels = <span class="variable">&lt;Channel1&gt;</span> <span class="variable">&lt;Channel2&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># set list of channels for source (separated by space)</span></span><br><span class="line"><span class="variable">&lt;Agent&gt;</span>.sources.<span class="variable">&lt;Source1&gt;</span>.channels = <span class="variable">&lt;Channel1&gt;</span> <span class="variable">&lt;Channel2&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># set channel for sinks</span></span><br><span class="line"><span class="variable">&lt;Agent&gt;</span>.sinks.<span class="variable">&lt;Sink1&gt;</span>.channel = <span class="variable">&lt;Channel1&gt;</span></span><br><span class="line"><span class="variable">&lt;Agent&gt;</span>.sinks.<span class="variable">&lt;Sink2&gt;</span>.channel = <span class="variable">&lt;Channel2&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="variable">&lt;Agent&gt;</span>.sources.<span class="variable">&lt;Source1&gt;</span>.selector.type = replicating</span><br></pre></td></tr></table></figure>
<p>ä½¿ç”¨çš„Replicationæ–¹å¼ï¼ŒSource1ä¼šå°†æ•°æ®åˆ†åˆ«å­˜å‚¨åˆ°Channel1å’ŒChannel2ï¼Œè¿™ä¸¤ä¸ªchannelé‡Œé¢å­˜å‚¨çš„æ•°æ®æ˜¯ç›¸åŒçš„ï¼Œç„¶åæ•°æ®è¢«ä¼ é€’åˆ°Sink1å’ŒSink2ã€‚</p>
</li>
</ul>
</li>
<li><p>å¦ä¸€ç§æ˜¯ç”¨æ¥åˆ†æµï¼ˆMultiplexingï¼‰</p>
<ul>
<li><p>Multiplexingæ–¹å¼ï¼Œselectorå¯ä»¥æ ¹æ®headerçš„å€¼æ¥ç¡®å®šæ•°æ®ä¼ é€’åˆ°å“ªä¸€ä¸ªchannel</p>
<figure class="highlight pf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Mapping for multiplexing selector</span></span><br><span class="line"><span class="variable">&lt;Agent&gt;</span>.sources.<span class="variable">&lt;Source1&gt;</span>.selector.type = multiplexing</span><br><span class="line"><span class="variable">&lt;Agent&gt;</span>.sources.<span class="variable">&lt;Source1&gt;</span>.selector.header = <span class="variable">&lt;someHeader&gt;</span></span><br><span class="line"><span class="variable">&lt;Agent&gt;</span>.sources.<span class="variable">&lt;Source1&gt;</span>.selector.mapping.<span class="variable">&lt;Value1&gt;</span> = <span class="variable">&lt;Channel1&gt;</span></span><br><span class="line"><span class="variable">&lt;Agent&gt;</span>.sources.<span class="variable">&lt;Source1&gt;</span>.selector.mapping.<span class="variable">&lt;Value2&gt;</span> = <span class="variable">&lt;Channel1&gt;</span> <span class="variable">&lt;Channel2&gt;</span></span><br><span class="line"><span class="variable">&lt;Agent&gt;</span>.sources.<span class="variable">&lt;Source1&gt;</span>.selector.mapping.<span class="variable">&lt;Value3&gt;</span> = <span class="variable">&lt;Channel2&gt;</span></span><br><span class="line"><span class="comment">#...</span></span><br><span class="line"></span><br><span class="line"><span class="variable">&lt;Agent&gt;</span>.sources.<span class="variable">&lt;Source1&gt;</span>.selector.<span class="keyword">default</span> = <span class="variable">&lt;Channel2&gt;</span></span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢selectorçš„typeçš„å€¼ä¸ºmultiplexingï¼ŒåŒæ—¶é…ç½®selectorçš„headerä¿¡æ¯ï¼Œè¿˜é…ç½®äº†å¤šä¸ªselectorçš„mappingçš„å€¼ï¼Œå³headerçš„å€¼ï¼šå¦‚æœheaderçš„å€¼ä¸ºValue1ã€Value2ï¼Œæ•°æ®ä»Source1è·¯ç”±åˆ°Channel1ï¼›å¦‚æœheaderçš„å€¼ä¸ºValue2ã€Value3ï¼Œæ•°æ®ä»Source1è·¯ç”±åˆ°Channel2ã€‚</p>
</li>
</ul>
</li>
</ul>
<h4 id="u5B9E_u73B0load_balance_u529F_u80FD"><a href="#u5B9E_u73B0load_balance_u529F_u80FD" class="headerlink" title="å®ç°load balanceåŠŸèƒ½"></a>å®ç°load balanceåŠŸèƒ½</h4>  <img src="/images/flume-ng/flume-load-balance-agents.png" title="å®ç°load balanceåŠŸèƒ½">
<p>  Load balancing Sink Processorèƒ½å¤Ÿå®ç°load balanceåŠŸèƒ½ï¼Œä¸Šå›¾Agent1æ˜¯ä¸€ä¸ªè·¯ç”±èŠ‚ç‚¹ï¼Œ<br>  è´Ÿè´£å°†Channelæš‚å­˜çš„Eventå‡è¡¡åˆ°å¯¹åº”çš„å¤šä¸ªSinkç»„ä»¶ä¸Šï¼Œè€Œæ¯ä¸ªSinkç»„ä»¶åˆ†åˆ«è¿æ¥åˆ°ä¸€ä¸ªç‹¬ç«‹çš„Agentä¸Š</p>
  <figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">a1<span class="class">.sinkgroups</span> = g1</span><br><span class="line">a1<span class="class">.sinkgroups</span><span class="class">.g1</span><span class="class">.sinks</span> = k1 k2 k3</span><br><span class="line">a1<span class="class">.sinkgroups</span><span class="class">.g1</span><span class="class">.processor</span><span class="class">.type</span> = load_balance</span><br><span class="line">a1<span class="class">.sinkgroups</span><span class="class">.g1</span><span class="class">.processor</span><span class="class">.backoff</span> = true</span><br><span class="line">a1<span class="class">.sinkgroups</span><span class="class">.g1</span><span class="class">.processor</span><span class="class">.selector</span> = round_robin</span><br><span class="line">a1<span class="class">.sinkgroups</span><span class="class">.g1</span><span class="class">.processor</span><span class="class">.selector</span><span class="class">.maxTimeOut</span>=<span class="number">10000</span></span><br></pre></td></tr></table></figure>
<h4 id="u5B9E_u73B0failover_u80FD"><a href="#u5B9E_u73B0failover_u80FD" class="headerlink" title="å®ç°failoverèƒ½"></a>å®ç°failoverèƒ½</h4><p>  Failover Sink Processorèƒ½å¤Ÿå®ç°failoveråŠŸèƒ½ï¼Œå…·ä½“æµç¨‹ç±»ä¼¼load balanceï¼Œ<br>  ä½†æ˜¯å†…éƒ¨å¤„ç†æœºåˆ¶ä¸load balanceå®Œå…¨ä¸åŒï¼šFailover Sink Processorç»´æŠ¤ä¸€ä¸ªä¼˜å…ˆçº§Sinkç»„ä»¶åˆ—è¡¨ï¼Œåªè¦æœ‰ä¸€ä¸ªSinkç»„ä»¶å¯ç”¨ï¼Œ<br>  Eventå°±è¢«ä¼ é€’åˆ°ä¸‹ä¸€ä¸ªç»„ä»¶ã€‚å¦‚æœä¸€ä¸ªSinkèƒ½å¤ŸæˆåŠŸå¤„ç†Eventï¼Œåˆ™ä¼šåŠ å…¥åˆ°ä¸€ä¸ªPoolä¸­ï¼Œå¦åˆ™ä¼šè¢«ç§»å‡ºPoolå¹¶è®¡ç®—å¤±è´¥æ¬¡æ•°ï¼Œè®¾ç½®ä¸€ä¸ªæƒ©ç½šå› å­</p>
  <figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">a1<span class="class">.sinkgroups</span> = g1</span><br><span class="line">a1<span class="class">.sinkgroups</span><span class="class">.g1</span><span class="class">.sinks</span> = k1 k2 k3</span><br><span class="line">a1<span class="class">.sinkgroups</span><span class="class">.g1</span><span class="class">.processor</span><span class="class">.type</span> = failover</span><br><span class="line">a1<span class="class">.sinkgroups</span><span class="class">.g1</span><span class="class">.processor</span><span class="class">.priority</span><span class="class">.k1</span> = <span class="number">5</span></span><br><span class="line">a1<span class="class">.sinkgroups</span><span class="class">.g1</span><span class="class">.processor</span><span class="class">.priority</span><span class="class">.k2</span> = <span class="number">7</span></span><br><span class="line">a1<span class="class">.sinkgroups</span><span class="class">.g1</span><span class="class">.processor</span><span class="class">.priority</span><span class="class">.k3</span> = <span class="number">6</span></span><br><span class="line">a1<span class="class">.sinkgroups</span><span class="class">.g1</span><span class="class">.processor</span><span class="class">.maxpenalty</span> = <span class="number">20000</span></span><br></pre></td></tr></table></figure>
<h3 id="u5B89_u88C5_u914D_u7F6E"><a href="#u5B89_u88C5_u914D_u7F6E" class="headerlink" title="å®‰è£…é…ç½®"></a>å®‰è£…é…ç½®</h3><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¸‹è½½äºŒè¿›åˆ¶åŒ…</span></span><br><span class="line">[mofun_mining<span class="variable">@i</span>-tev02vc1 ~]<span class="variable">$ </span>wget <span class="string">"http://apache.arvixe.com/flume/1.6.0/apache-flume-1.6.0-bin.tar.gz"</span></span><br><span class="line">[mofun_mining<span class="variable">@i</span>-tev02vc1 ~]<span class="variable">$ </span>tar xvzf apache-flume-<span class="number">1.6</span>.<span class="number">0</span>-bin.tar.gz</span><br><span class="line">[mofun_mining<span class="variable">@i</span>-tev02vc1 ~]<span class="variable">$ </span>mv apache-flume-<span class="number">1.6</span>.<span class="number">0</span>-bin /usr/local/</span><br><span class="line"><span class="comment"># ä¿®æ”¹é…ç½®æ–‡ä»¶</span></span><br><span class="line">[mofun_mining<span class="variable">@i</span>-qe32ajmq conf]<span class="variable">$ </span>pwd</span><br><span class="line">/usr/local/apache-flume-<span class="number">1.6</span>.<span class="number">0</span>-bin/conf</span><br><span class="line">[mofun_mining<span class="variable">@i</span>-qe32ajmq conf]<span class="variable">$ </span>sudo cp flume-conf.properties.template flume-conf.properties</span><br></pre></td></tr></table></figure>
<p>é‡‡ç”¨ Avro Source+Memory Channel+HDFS Sink æ–¹å¼</p>
<ul>
<li><p>æœåŠ¡å™¨ï¼ˆæ—¥å¿—æ±‡æ€»æœåŠ¡å™¨agentï¼‰ç«¯é…ç½®æ–‡ä»¶</p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">[mofun_mining@i-tev02vc1 ~]$ <span class="keyword">cd</span> /usr/<span class="keyword">local</span>/apache-flume-1.6.0-bin/<span class="keyword">conf</span>/</span><br><span class="line">[mofun_mining@i-tev02vc1 <span class="keyword">conf</span>]$ <span class="keyword">ls</span></span><br><span class="line">flume-<span class="keyword">conf</span>.properties  flume-<span class="keyword">conf</span>.properties.template  flume-env.ps1.template  flume-env.<span class="keyword">sh</span>  flume-env.<span class="keyword">sh</span>.template  log4j.properties</span><br><span class="line">[mofun_mining@i-tev02vc1 <span class="keyword">conf</span>]$ <span class="keyword">pwd</span></span><br><span class="line">/usr/<span class="keyword">local</span>/apache-flume-1.6.0-bin/<span class="keyword">conf</span></span><br><span class="line">[mofun_mining@i-tev02vc1 <span class="keyword">conf</span>]$ sudo vim flume-<span class="keyword">conf</span>.properties</span><br><span class="line"># example.<span class="keyword">conf</span>: A single-node Flume configuration</span><br><span class="line"></span><br><span class="line"># Name the components <span class="keyword">on</span> this agent</span><br><span class="line">agent1.sources = r1</span><br><span class="line">agent1.sinks = k1</span><br><span class="line">agent1.channels = c1</span><br><span class="line"></span><br><span class="line"># <span class="keyword">Describe</span>/configure the source</span><br><span class="line">agent1.sources.r1.<span class="keyword">type</span> = avro</span><br><span class="line">agent1.sources.r1.bind = 192.168.1.33</span><br><span class="line">agent1.sources.r1.port = 41414</span><br><span class="line">agent1.sources.r1.channels = c1</span><br><span class="line"></span><br><span class="line"># <span class="keyword">Describe</span> the sink</span><br><span class="line">agent1.sinks.k1.<span class="keyword">type</span> = hdfs</span><br><span class="line">agent1.sinks.k1.channel = c1</span><br><span class="line">agent1.sinks.k1.hdfs.fileType = DataStream</span><br><span class="line">agent1.sinks.k1.hdfs.useLocalTimeStamp = true</span><br><span class="line">agent1.sinks.k1.hdfs.path = /flume/events/%Y-%<span class="keyword">m</span>-%<span class="literal">d</span></span><br><span class="line">#agent1.sinks.k1.hdfs.round = true</span><br><span class="line">#agent1.sinks.k1.hdfs.roundValue = 10</span><br><span class="line">#agent1.sinks.k1.hdfs.roundUnit = minute</span><br><span class="line">agent1.sinks.k1.hdfs.rollCount = 5000</span><br><span class="line">agent1.sinks.k1.hdfs.rollSize = 0</span><br><span class="line">agent1.sinks.k1.hdfs.rollInterval= 0</span><br><span class="line"></span><br><span class="line"># <span class="keyword">Use</span> a channel <span class="keyword">which</span> buffers events <span class="keyword">in</span> <span class="keyword">memory</span></span><br><span class="line">agent1.channels.c1.<span class="keyword">type</span> = <span class="keyword">memory</span></span><br><span class="line">agent1.channels.c1.capacity = 10000</span><br><span class="line">agent1.channels.c1.transactionCapacity = 1000</span><br></pre></td></tr></table></figure>
</li>
<li><p>å®¢æˆ·ç«¯ï¼ˆæ—¥å¿—æ”¶é›†agentï¼‰</p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">[reason@i-qunray9x <span class="keyword">conf</span>]$ <span class="keyword">cd</span> /usr/<span class="keyword">local</span>/apache-flume-1.6.0-bin/<span class="keyword">conf</span>/</span><br><span class="line">[reason@i-qunray9x <span class="keyword">conf</span>]$ <span class="keyword">pwd</span></span><br><span class="line">/usr/<span class="keyword">local</span>/apache-flume-1.6.0-bin/<span class="keyword">conf</span></span><br><span class="line">[reason@i-qunray9x <span class="keyword">conf</span>]$ sudo vim flume-<span class="keyword">conf</span>.properties</span><br><span class="line"></span><br><span class="line"># example.<span class="keyword">conf</span>: A single-node Flume configuration</span><br><span class="line"></span><br><span class="line"># Name the components <span class="keyword">on</span> this agent</span><br><span class="line">agent1.sources = r1</span><br><span class="line">agent1.sinks = k1</span><br><span class="line">agent1.channels = c1</span><br><span class="line"></span><br><span class="line"># <span class="keyword">Describe</span>/configure the source</span><br><span class="line">agent1.sources.r1.<span class="keyword">type</span> = exec</span><br><span class="line">agent1.sources.r1.command = tail -<span class="keyword">n</span> 0 -F /home/reason/1.txt</span><br><span class="line">agent1.sources.r1.channels = c1</span><br><span class="line"></span><br><span class="line"># <span class="keyword">Describe</span> the sink</span><br><span class="line">agent1.sinks.k1.<span class="keyword">type</span> = avro</span><br><span class="line">agent1.sinks.k1.channel = c1</span><br><span class="line">agent1.sinks.k1.hdfs.useLocalTimeStamp = true</span><br><span class="line">agent1.sinks.k1.hdfs.path = /flume/events/%Y-%<span class="keyword">m</span>-%<span class="literal">d</span></span><br><span class="line">agent1.sinks.k1.hostname=192.168.1.33</span><br><span class="line">agent1.sinks.k1.port = 41414</span><br><span class="line"></span><br><span class="line"># <span class="keyword">Use</span> a channel <span class="keyword">which</span> buffers events <span class="keyword">in</span> <span class="keyword">memory</span></span><br><span class="line">agent1.channels.c1.<span class="keyword">type</span> = <span class="keyword">memory</span></span><br><span class="line">agent1.channels.c1.capacity = 5000</span><br><span class="line">agent1.channels.c1.transactionCapacity = 500</span><br></pre></td></tr></table></figure>
</li>
<li><p>å¯åŠ¨æœåŠ¡å™¨</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[mofun_mining<span class="annotation">@i</span>-tev02vc1 conf]$</span><br><span class="line"><span class="regexp">/usr/</span>local<span class="regexp">/apache-flume-1.6.0-bin/</span>bin<span class="regexp">/flume-ng agent -c ./</span>conf<span class="regexp">/ -f /</span>usr<span class="regexp">/local/</span>apache-flume-<span class="number">1.6</span><span class="number">.0</span>-bin<span class="regexp">/conf/</span>flume-conf.properties -n agent1 -Dflume.root.logger=INFO,console</span><br></pre></td></tr></table></figure>
</li>
<li><p>å¯åŠ¨å®¢æˆ·ç«¯</p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[reason@i-qunray9x <span class="keyword">conf</span>]$</span><br><span class="line">/usr/<span class="keyword">local</span>/apache-flume-1.6.0-bin/bin/flume-ng agent -c <span class="keyword">conf</span> -f /usr/<span class="keyword">local</span>/apache-flume-1.6.0-bin/<span class="keyword">conf</span>/flume-<span class="keyword">conf</span>.properties -<span class="keyword">n</span> agent1</span><br></pre></td></tr></table></figure>
</li>
<li><p>æµ‹è¯•</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[mofun_mining@i-r6cuv8iq ~]$ hdfs dfs -ls /flume/events/<span class="number">2015</span>-<span class="number">12</span>-<span class="number">15</span></span><br><span class="line">Found <span class="number">40</span> items</span><br><span class="line">-rw-r--r--   <span class="number">2</span> mofun_mining supergroup      <span class="number">34844</span> <span class="number">2015</span>-<span class="number">12</span>-<span class="number">15</span> <span class="number">17</span>:<span class="number">39</span> /flume/events/<span class="number">2015</span>-<span class="number">12</span>-<span class="number">15</span>/FlumeData<span class="number">.1450172340281</span></span><br><span class="line">-rw-r--r--   <span class="number">2</span> mofun_mining supergroup      <span class="number">34850</span> <span class="number">2015</span>-<span class="number">12</span>-<span class="number">15</span> <span class="number">17</span>:<span class="number">39</span> /flume/events/<span class="number">2015</span>-<span class="number">12</span>-<span class="number">15</span>/FlumeData<span class="number">.1450172340282</span></span><br><span class="line">-rw-r--r--   <span class="number">2</span> mofun_mining supergroup      <span class="number">34850</span> <span class="number">2015</span>-<span class="number">12</span>-<span class="number">15</span> <span class="number">17</span>:<span class="number">39</span> /flume/events/<span class="number">2015</span>-<span class="number">12</span>-<span class="number">15</span>/FlumeData<span class="number">.1450172340283</span></span><br><span class="line">-rw-r--r--   <span class="number">2</span> mofun_mining supergroup      <span class="number">34850</span> <span class="number">2015</span>-<span class="number">12</span>-<span class="number">15</span> <span class="number">17</span>:<span class="number">39</span> /flume/events/<span class="number">2015</span>-<span class="number">12</span>-<span class="number">15</span>/FlumeData<span class="number">.1450172340284</span></span><br><span class="line">-rw-r--r--   <span class="number">2</span> mofun_mining supergroup      <span class="number">34850</span> <span class="number">2015</span>-<span class="number">12</span>-<span class="number">15</span> <span class="number">17</span>:<span class="number">39</span> /flume/events/<span class="number">2015</span>-<span class="number">12</span>-<span class="number">15</span>/FlumeData<span class="number">.1450172340285</span></span><br><span class="line">-rw-r--r--   <span class="number">2</span> mofun_mining supergroup      <span class="number">34850</span> <span class="number">2015</span>-<span class="number">12</span>-<span class="number">15</span> <span class="number">17</span>:<span class="number">39</span> /flume/events/<span class="number">2015</span>-<span class="number">12</span>-<span class="number">15</span>/FlumeData<span class="number">.1450172340286</span></span><br><span class="line">-rw-r--r--   <span class="number">2</span> mofun_mining supergroup      <span class="number">34850</span> <span class="number">2015</span>-<span class="number">12</span>-<span class="number">15</span> <span class="number">17</span>:<span class="number">39</span> /flume/events/<span class="number">2015</span>-<span class="number">12</span>-<span class="number">15</span>/FlumeData<span class="number">.1450172340287</span></span><br><span class="line">-rw-r--r--   <span class="number">2</span> mofun_mining supergroup      <span class="number">34850</span> <span class="number">2015</span>-<span class="number">12</span>-<span class="number">15</span> <span class="number">17</span>:<span class="number">39</span> /flume/events/<span class="number">2015</span>-<span class="number">12</span>-<span class="number">15</span>/FlumeData<span class="number">.1450172340288</span></span><br><span class="line">-rw-r--r--   <span class="number">2</span> mofun_mining supergroup      <span class="number">34850</span> <span class="number">2015</span>-<span class="number">12</span>-<span class="number">15</span> <span class="number">17</span>:<span class="number">39</span> /flume/events/<span class="number">2015</span>-<span class="number">12</span>-<span class="number">15</span>/FlumeData<span class="number">.1450172340289</span></span><br><span class="line">-rw-r--r--   <span class="number">2</span> mofun_mining supergroup      <span class="number">34850</span> <span class="number">2015</span>-<span class="number">12</span>-<span class="number">15</span> <span class="number">17</span>:<span class="number">39</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>æ­¤æ—¶ï¼Œé€šè¿‡nginxå®æ—¶äº§ç”Ÿçš„æ—¥å¿—ï¼Œå³å¯å®æ—¶æ’å…¥åˆ°hdfsä¸­äº†ã€‚</p>
</li>
</ul>
<h3 id="u53C2_u8003_u6587_u732E"><a href="#u53C2_u8003_u6587_u732E" class="headerlink" title="å‚è€ƒæ–‡çŒ®"></a>å‚è€ƒæ–‡çŒ®</h3><ul>
<li><a href="http://shiyanjun.cn/archives/915.html" target="_blank" rel="external">http://shiyanjun.cn/archives/915.html</a></li>
<li><a href="http://my.oschina.net/leejun2005/blog/288136" target="_blank" rel="external">http://my.oschina.net/leejun2005/blog/288136</a></li>
<li><a href="http://tech.meituan.com/mt-log-system-optimization.html" target="_blank" rel="external">http://tech.meituan.com/mt-log-system-optimization.html</a></li>
<li><a href="http://www.ixirong.com/2015/05/18/how-to-install-flume-ng/" target="_blank" rel="external">http://www.ixirong.com/2015/05/18/how-to-install-flume-ng/</a></li>
<li><a href="https://flume.apache.org/FlumeUserGuide.html#setting-up-an-agent" target="_blank" rel="external">https://flume.apache.org/FlumeUserGuide.html#setting-up-an-agent</a></li>
<li><a href="http://m.blog.csdn.net/blog/xueliang1029/24039459" target="_blank" rel="external">http://m.blog.csdn.net/blog/xueliang1029/24039459</a></li>
</ul>
]]></content>
    <summary type="html">
    <![CDATA[<!--  -->
<!--  -->
<!--  _ __    __     __      ____    ___     ___   _____   __  __    ___     -->
<!-- /\`'__\/'__`\ /'__`\   /',__\  / _]]>
    </summary>
    
      <category term="Apache" scheme="http://reasonpun.com/tags/Apache/"/>
    
      <category term="Flume-NG" scheme="http://reasonpun.com/tags/Flume-NG/"/>
    
      <category term="HDFS" scheme="http://reasonpun.com/tags/HDFS/"/>
    
      <category term="æ•°æ®æŒ–æ˜" scheme="http://reasonpun.com/categories/%E6%95%B0%E6%8D%AE%E6%8C%96%E6%8E%98/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[apache_kafka_structure]]></title>
    <link href="http://reasonpun.com/2015/12/08/apache-kafka-structure/"/>
    <id>http://reasonpun.com/2015/12/08/apache-kafka-structure/</id>
    <published>2015-12-08T08:30:08.000Z</published>
    <updated>2015-12-25T03:33:24.000Z</updated>
    <content type="html"><![CDATA[<!--  -->
<!--  -->
<!--  _ __    __     __      ____    ___     ___   _____   __  __    ___     -->
<!-- /\`'__\/'__`\ /'__`\   /',__\  / __`\ /' _ `\/\ '__`\/\ \/\ \ /' _ `\   -->
<!-- \ \ \//\  __//\ \L\.\_/\__, `\/\ \L\ \/\ \/\ \ \ \L\ \ \ \_\ \/\ \/\ \  -->
<!--  \ \_\\ \____\ \__/.\_\/\____/\ \____/\ \_\ \_\ \ ,__/\ \____/\ \_\ \_\ -->
<!--   \/_/ \/____/\/__/\/_/\/___/  \/___/  \/_/\/_/\ \ \/  \/___/  \/_/\/_/ -->
<!--                                                 \ \_\                   -->
<!--                                                  \/_/                   -->
<!--  -->
<h4 id="Apache_Kafka_u6D88_u606F_u670D_u52A1"><a href="#Apache_Kafka_u6D88_u606F_u670D_u52A1" class="headerlink" title="Apache Kafkaæ¶ˆæ¯æœåŠ¡"></a>Apache Kafkaæ¶ˆæ¯æœåŠ¡</h4><ul>
<li><p>å‚è€ƒåœ°å€ <a href="http://kafka.apache.org/documentation.html#brokerconfigs" target="_blank" rel="external">http://kafka.apache.org/documentation.html</a></p>
</li>
<li><p>æ¶ˆæ¯é˜Ÿåˆ—çš„åˆ†ç±»</p>
<ul>
<li><p>ç‚¹å¯¹ç‚¹</p>
<p>ç”Ÿäº§è€…ç”Ÿäº§æ¶ˆæ¯å‘é€åˆ°Queueä¸­ï¼Œæ¶ˆè´¹è€…æ¶ˆè´¹Queueä¸­çš„æ¶ˆæ¯ï¼Œå…¶ä¸­ï¼š</p>
<ul>
<li>Queueä¸­ä¸å†å­˜å‚¨å·²ç»è¢«æ¶ˆè´¹çš„æ¶ˆæ¯</li>
<li>Queueæ”¯æŒå¤šä¸ªæ¶ˆè´¹è€…ï¼Œä½†æ˜¯åŒä¸€ä¸ªæ¶ˆæ¯ï¼Œåªèƒ½è¢«ä¸€ä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹</li>
</ul>
</li>
<li><p>å‘å¸ƒ/è®¢é˜…</p>
<p>ç”Ÿäº§è€…ï¼ˆç”Ÿäº§ï¼‰å°†æ¶ˆæ¯å‘å¸ƒåˆ°topicä¸­ï¼ŒåŒæ—¶å¤šä¸ªæ¶ˆè´¹è€…ï¼ˆæ¶ˆè´¹ï¼‰è®¢é˜…è¯¥æ¶ˆæ¯ã€‚å’Œç‚¹å¯¹ç‚¹æ–¹å¼ä¸åŒçš„æ˜¯ï¼Œå‘å¸ƒåˆ°topicçš„æ¶ˆæ¯ä¼šè¢«æ‰€æœ‰è®¢é˜…è€…æ¶ˆè´¹</p>
</li>
</ul>
</li>
<li><p>ç®€ä»‹</p>
<p>èƒŒæ™¯ Kafkaä½¿ç”¨Scalaè¯­è¨€ç¼–å†™ï¼Œæ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼ï¼Œåˆ†åŒºçš„ï¼Œæ”¯æŒå¤šå‰¯æœ¬ï¼Œå¤šè®¢é˜…è€…çš„æ—¥å¿—ç³»ç»Ÿã€‚</p>
<p>ç›®å‰æ”¯æŒJavaï¼ŒPythonï¼ŒC++ï¼Œ PHPç­‰</p>
<ul>
<li>æ€»ä½“ç»“æ„</li>
</ul>
<img src="/images/kafka.0.9.0/structure.png" title="kafkaæ€»ä½“ç»“æ„å›¾">
</li>
</ul>
<ul>
<li><p>åè¯è§£é‡Š</p>
<ul>
<li><p>Producer</p>
<p>  æ¶ˆæ¯ç”Ÿäº§è€…ï¼Œå°±æ˜¯å‘kafka brokerå‘æ¶ˆæ¯çš„å®¢æˆ·ç«¯</p>
</li>
<li><p>Consumer</p>
<p>  æ¶ˆæ¯æ¶ˆè´¹è€…ï¼Œå‘kafka brokerå–æ¶ˆæ¯çš„å®¢æˆ·ç«¯</p>
</li>
<li><p>Topic</p>
<p>  æ˜¯ä¸€ä¸ªæ¶ˆæ¯é˜Ÿåˆ—ï¼Ÿ</p>
</li>
<li><p>Consumer Group ï¼ˆCGï¼‰</p>
<ul>
<li>è¿™æ˜¯Kafkaç”¨æ¥å®ç°ä¸€ä¸ªTopicæ¶ˆæ¯çš„å¹¿æ’­ï¼ˆå‘ç»™æ‰€æœ‰çš„Consumerï¼‰å’Œå•æ’­ï¼ˆå‘ç»™ä»»æ„ä¸€ä¸ªConsumerï¼‰çš„æ‰‹æ®µ</li>
<li>ä¸€ä¸ªTopicå¯ä»¥æœ‰å¤šä¸ªCG</li>
<li>Topicçš„æ¶ˆæ¯ä¼šå¤åˆ¶ï¼ˆä¸æ˜¯çœŸçš„å¤åˆ¶ï¼Œæ˜¯æ¦‚å¿µä¸Šçš„ï¼‰åˆ°æ‰€æœ‰çš„CGï¼Œä½†æ¯ä¸ªCGåªä¼šæŠŠæ¶ˆæ¯å‘ç»™è¯¥CGä¸­çš„ä¸€ä¸ªconsumer</li>
<li>å¦‚æœéœ€è¦å®ç°å¹¿æ’­ï¼Œåªè¦æ¯ä¸ªConsumeræœ‰ä¸€ä¸ªç‹¬ç«‹çš„CGå°±å¯ä»¥äº†</li>
<li>è¦å®ç°å•æ’­åªè¦æ‰€æœ‰çš„Consumeråœ¨åŒä¸€ä¸ªCG</li>
<li><p>ç”¨CGè¿˜å¯ä»¥å°†Consumerè¿›è¡Œè‡ªç”±çš„åˆ†ç»„è€Œä¸éœ€è¦å¤šæ¬¡å‘é€æ¶ˆæ¯åˆ°ä¸åŒçš„topic</p>
</li>
<li><p>Broker</p>
<ul>
<li>ä¸€å°KafkaæœåŠ¡å™¨å°±æ˜¯ä¸€ä¸ªBroker</li>
<li>ä¸€ä¸ªé›†ç¾¤ç”±å¤šä¸ªBrokerç»„æˆã€‚ä¸€ä¸ªBrokerå¯ä»¥å®¹çº³å¤šä¸ªTopic</li>
</ul>
</li>
<li><p>Partition</p>
<p>ä¸ºäº†å®ç°æ‰©å±•æ€§ï¼Œä¸€ä¸ªéå¸¸å¤§çš„Topicå¯ä»¥åˆ†å¸ƒåˆ°å¤šä¸ªBrokerï¼ˆå³æœåŠ¡å™¨ï¼‰ä¸Šï¼Œä¸€ä¸ªTopicå¯ä»¥åˆ†ä¸ºå¤šä¸ªPartitionï¼Œæ¯ä¸ªPartitionæ˜¯ä¸€ä¸ªæœ‰åºçš„é˜Ÿåˆ—ã€‚Prtitionä¸­çš„æ¯æ¡æ¶ˆæ¯éƒ½ä¼šè¢«åˆ†é…ä¸€ä¸ªæœ‰åºçš„idï¼ˆOffsetï¼‰ã€‚Kafkaåªä¿è¯æŒ‰ä¸€ä¸ªPartitionä¸­çš„é¡ºåºå°†æ¶ˆæ¯å‘ç»™Consumerï¼Œä¸ä¿è¯ä¸€ä¸ªTopicçš„æ•´ä½“ï¼ˆå¤šä¸ªPartitioné—´ï¼‰çš„é¡ºåºã€‚</p>
</li>
<li><p>Offset</p>
<ul>
<li>kafkaçš„å­˜å‚¨æ–‡ä»¶éƒ½æ˜¯æŒ‰ç…§offset.kafkaæ¥å‘½åï¼Œç”¨offsetåšåå­—çš„å¥½å¤„æ˜¯æ–¹ä¾¿æŸ¥æ‰¾</li>
<li>ä¾‹å¦‚ä½ æƒ³æ‰¾ä½äº2049çš„ä½ç½®ï¼Œåªè¦æ‰¾åˆ°2048.kafkaçš„æ–‡ä»¶å³å¯ï¼Œå½“ç„¶the first offsetå°±æ˜¯00000000000.kafka</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p>ç‰¹æ€§</p>
<ul>
<li>é€šè¿‡O(1)çš„ç£ç›˜æ•°æ®ç»“æ„æä¾›æ¶ˆæ¯çš„æŒä¹…åŒ–ï¼Œè¿™ç§ç»“æ„å¯¹äºå³ä½¿æ•°ä»¥TBçš„æ¶ˆæ¯å­˜å‚¨ä¹Ÿèƒ½å¤Ÿä¿æŒé•¿æ—¶é—´çš„ç¨³å®šæ€§èƒ½</li>
<li>é«˜ååé‡ï¼šå³ä½¿æ˜¯éå¸¸æ™®é€šçš„ç¡¬ä»¶Kafkaä¹Ÿå¯ä»¥æ”¯æŒæ¯ç§’æ•°åä¸‡çš„æ¶ˆæ¯</li>
<li>æ”¯æŒ <em>åŒæ­¥</em> å’Œ <em>å¼‚æ­¥</em> å¤åˆ¶ä¸¤ç§HA</li>
<li>Consumerå®¢æˆ·ç«¯<ul>
<li>pull</li>
<li>éšæœºè¯»</li>
<li>åˆ©ç”¨sendfileç³»ç»Ÿè°ƒç”¨</li>
<li>zero-copy</li>
<li>æ‰¹é‡æ‹‰æ•°æ®</li>
</ul>
</li>
<li>æ¶ˆè´¹çŠ¶æ€ä¿å­˜åœ¨å®¢æˆ·ç«¯</li>
<li>æ¶ˆæ¯å­˜å‚¨é¡ºåºå†™</li>
<li>æ•°æ®è¿ç§»ã€æ‰©å®¹å¯¹ç”¨æˆ·é€æ˜</li>
<li>æ”¯æŒHadoopå¹¶è¡Œæ•°æ®åŠ è½½</li>
<li>æ”¯æŒonlineå’Œofflineçš„åœºæ™¯</li>
<li>æŒä¹…åŒ–ï¼šé€šè¿‡å°†æ•°æ®æŒä¹…åŒ–åˆ°ç¡¬ç›˜ä»¥åŠreplicationé˜²æ­¢æ•°æ®ä¸¢å¤±</li>
<li>scale outï¼šæ— éœ€åœæœºå³å¯æ‰©å±•æœºå™¨</li>
<li>å®šæœŸåˆ é™¤æœºåˆ¶ï¼Œæ”¯æŒè®¾å®špartitionsçš„segment fileä¿ç•™æ—¶é—´</li>
</ul>
</li>
<li><p>å¯é æ€§ï¼ˆä¸€è‡´æ€§)</p>
<p>ä¼ ç»Ÿçš„MQç³»ç»Ÿé€šå¸¸éƒ½æ˜¯é€šè¿‡brokerå’Œconsumeré—´çš„ç¡®è®¤ï¼ˆackï¼‰æœºåˆ¶å®ç°çš„ï¼Œå¹¶åœ¨brokerä¿å­˜æ¶ˆæ¯åˆ†å‘çš„çŠ¶æ€ï¼Œå³ä½¿è¿™æ ·ä¸€è‡´æ€§ä¹Ÿæ˜¯å¾ˆéš¾ä¿è¯çš„ã€‚</p>
<p>Kafkaçš„åšæ³•æ˜¯ç”±consumerè‡ªå·±ä¿å­˜çŠ¶æ€ï¼Œä¹Ÿä¸è¦ä»»ä½•ç¡®è®¤ã€‚è¿™æ ·è™½ç„¶consumerè´Ÿæ‹…æ›´é‡ï¼Œä½†å…¶å®æ›´çµæ´»äº†ã€‚å› ä¸ºä¸ç®¡consumerä¸Šä»»ä½•åŸå› å¯¼è‡´éœ€è¦é‡æ–°å¤„ç†æ¶ˆæ¯ï¼Œéƒ½å¯ä»¥å†æ¬¡ä»brokerè·å¾—ã€‚</p>
</li>
<li><p>å¯æ‰©å±•æ€§</p>
<p>Kafka ä½¿ç”¨Zookeeperå®ç°åŠ¨æ€çš„é›†ç¾¤æ‰©å±•ï¼Œä¸éœ€è¦æ›´æ”¹å®¢æˆ·ç«¯ï¼ˆç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ï¼‰çš„é…ç½®ã€‚brokerä¼šåœ¨ZKæ³¨å†Œå¹¶ä¿æŒç›¸å…³çš„å…ƒæ•°æ®æ›´æ–°ã€‚è€Œå®¢æˆ·ç«¯ä¼šåœ¨ZKä¸Šæ³¨å†Œç›¸å…³çš„watcherï¼Œä¸€æ—¦ZKå‘ç”Ÿå˜åŒ–ï¼Œå®¢æˆ·ç«¯èƒ½åŠæ—¶åšå‡ºç›¸åº”è°ƒæ•´ã€‚è¿™æ ·å¯ä»¥ä¿è¯å˜æ›´brokeræ—¶ï¼Œå„ä¸ªbrokerä¹‹é—´èƒ½è‡ªåŠ¨å®ç°è´Ÿè½½å‡è¡¡ã€‚</p>
</li>
<li><p>è®¾è®¡ç›®æ ‡</p>
<p>é«˜ååé‡</p>
<ul>
<li>æ•°æ®ç£ç›˜æŒä¹…åŒ–ï¼šæ¶ˆæ¯ä¸åœ¨å†…å­˜ä¸­cacheï¼Œç›´æ¥å†™å…¥åˆ°ç£ç›˜ï¼Œå……åˆ†åˆ©ç”¨ç£ç›˜çš„é¡ºåºè¯»å†™æ€§èƒ½</li>
<li>zero-copyï¼šå‡å°‘IOæ“ä½œæ­¥éª¤</li>
<li>æ”¯æŒæ•°æ®æ‰¹é‡å‘é€å’Œæ‹‰å–</li>
<li>æ”¯æŒæ•°æ®å‹ç¼©</li>
<li>Topicåˆ’åˆ†ä¸ºå¤šä¸ªpartitionï¼Œæé«˜å¹¶è¡Œå¤„ç†èƒ½åŠ›</li>
</ul>
</li>
<li><p>Producerè´Ÿè½½å‡è¡¡å’ŒHAæœºåˆ¶</p>
<ul>
<li>produceræ ¹æ®ç”¨æˆ·æŒ‡å®šçš„ç®—æ³•ï¼Œå°†æ¶ˆæ¯å‘é€åˆ°æŒ‡å®šçš„partitionã€‚</li>
<li>å­˜åœ¨å¤šä¸ªpartiitonï¼Œæ¯ä¸ªpartitionæœ‰è‡ªå·±çš„replicaï¼Œæ¯ä¸ªreplicaåˆ†å¸ƒåœ¨ä¸åŒçš„BrokerèŠ‚ç‚¹ä¸Šã€‚</li>
<li>å¤šä¸ªpartitionéœ€è¦é€‰å–å‡ºlead partitionï¼Œlead partitionè´Ÿè´£è¯»å†™ï¼Œå¹¶ç”±zookeeperè´Ÿè´£fail overã€‚</li>
<li>é€šè¿‡zookeeperç®¡ç†brokerä¸consumerçš„åŠ¨æ€åŠ å…¥ä¸ç¦»å¼€ã€‚</li>
</ul>
</li>
<li><p>Consumerçš„pullæœºåˆ¶</p>
<p>ç”±äºbrokerä¼šæŒä¹…åŒ–æ•°æ®ï¼Œbrokeræ²¡æœ‰cacheå‹åŠ›ï¼Œå› æ­¤ï¼Œconsumeræ¯”è¾ƒé€‚åˆæ‰å»pullçš„æ–¹å¼æ¶ˆè´¹æ•°æ®ï¼š</p>
<ul>
<li>ç®€åŒ–kafkaè®¾è®¡ï¼Œé™ä½äº†éš¾åº¦</li>
<li>Consumeræ ¹æ®æ¶ˆè´¹èƒ½åŠ›è‡ªä¸»æ§åˆ¶æ¶ˆæ¯æ‹‰å–é€Ÿåº¦</li>
<li>Consumeræ ¹æ®è‡ªèº«æƒ…å†µè‡ªä¸»é€‰æ‹©æ¶ˆè´¹æ¨¡å¼ï¼Œä¾‹å¦‚æ‰¹é‡ï¼Œé‡å¤æ¶ˆè´¹ï¼Œä»åˆ¶å®špartitionæˆ–ä½ç½®(offset)å¼€å§‹æ¶ˆè´¹ç­‰</li>
</ul>
</li>
<li><p>Consumerä¸Topicå…³ç³»ä»¥åŠæœºåˆ¶</p>
<p>æ¯ä¸ªgroupåŒ…å«å¤šä¸ªconsumerã€‚å¯¹äºtopicä¸­çš„ä¸€æ¡ç‰¹å®šæ¶ˆæ¯ï¼Œåªä¼šè¢«è®¢é˜…æ­¤Topicæ¯ä¸ªgroupä¸­çš„ä¸€ä¸ªconsumeræ¶ˆè´¹ï¼Œé‚£ä¹ˆä¸€ä¸ªgroupä¸­çš„æ‰€æœ‰consumerå°†ä¼šäº¤é”™çš„æ¶ˆè´¹æ•´ä¸ªTopicã€‚</p>
<p>å¦‚æœæ‰€æœ‰çš„consumeréƒ½å…·æœ‰ç›¸åŒçš„groupï¼ˆç±»ä¼¼JMS queueï¼‰ï¼Œæ¶ˆæ¯å°†æœ‰æ‰€æœ‰çš„consumerè´Ÿè½½å‡è¡¡</p>
<p>å¦‚æœæ‰€æœ‰çš„consumeréƒ½å…·æœ‰ä¸åŒçš„groupï¼Œé‚£ä¹ˆè¿™å°±æ˜¯ã€å‘å¸ƒ-è®¢é˜…ã€ï¼Œæ¶ˆæ¯å°†ä¼šå¹¿æ’­ç»™æ‰€æœ‰æ¶ˆè´¹è€…</p>
<p>åœ¨Kafkaä¸­ï¼Œä¸€ä¸ªpartitionä¸­çš„æ¶ˆæ¯åªä¼šè¢«groupä¸­çš„ä¸€ä¸ªconsumeræ¶ˆè´¹ï¼ˆåŒä¸€æ—¶åˆ»ï¼‰ï¼›æ¯ä¸ªgroupä¸­consumeræ¶ˆæ¯æ¶ˆè´¹äº’ç›¸ç‹¬ç«‹ï¼›<br>ä¸€ä¸ªgroupæ˜¯ä¸€ä¸ªã€è®¢é˜…ã€è€…ï¼Œä¸€ä¸ªTopicä¸­çš„æ¯ä¸ªpartitionåªä¼šè¢«ä¸€ä¸ªã€è®¢é˜…ã€è€…ä¸­çš„ä¸€ä¸ªconsumeræ¶ˆè´¹ï¼Œä½†æ˜¯ä¸€ä¸ªconsumerå¯ä»¥åŒäº‹æ¶ˆè´¹å¤šä¸ªpartitionsä¸­çš„æ¶ˆæ¯ã€‚</p>
<p>Kafkaåªèƒ½ä¿è¯ä¸€ä¸ªpartitionä¸­çš„æ¶ˆæ¯è¢«æŸä¸ªconsumeræ¶ˆè´¹æ˜¯é¡ºåºçš„ï¼Œä½†æ˜¯ä»Topicè§’åº¦ï¼Œå½“æœ‰å¤šä¸ªpartitionsæ—¶ï¼Œæ¶ˆæ¯ä»ä¸æ˜¯å…¨å±€æœ‰åºçš„</p>
<p>ä¸€ä¸ªgroupä¸­åŒ…å«å¤šä¸ªconsumerï¼Œè¿™æ ·çš„è¯ä¸ä»…èƒ½æé«˜topicä¸­æ¶ˆæ¯çš„å¹¶å‘æ¶ˆè´¹èƒ½åŠ›ï¼Œè¿˜èƒ½æé«˜ã€æ•…éšœå®¹é”™ã€æ€§ï¼Œå¦‚æœgroupä¸­çš„æŸä¸ªconsumerå¤±æ•ˆï¼Œé‚£ä¹ˆå…¶æ¶ˆè´¹çš„partitionå°†ä¼šè¢«å…¶ä»–consumeræ¥ç®¡</p>
<p>Kafkaçš„è®¾è®¡åŸç†å†³å®šï¼Œå¯¹äºä¸€ä¸ªTopicï¼ŒåŒä¸€ä¸ªgroupä¸­ä¸èƒ½æœ‰å¤šäºpartitionä¸ªæ•°çš„consumeråŒæ—¶æ¶ˆè´¹ï¼Œå¦åˆ™å°†æ„å‘³ç€æŸäº›consumerå°†æ— æ³•å¾—åˆ°æ¶ˆæ¯</p>
</li>
<li><p>Producerå‡è¡¡ç®—æ³•</p>
<p>Kafkaé›†ç¾¤ä¸­çš„ä»»ä½•ä¸€ä¸ªbrokerï¼Œéƒ½å¯ä»¥å‘produceræä¾›metadataï¼Œè¿™äº›metadataä¸­åŒ…å«ã€é›†ç¾¤ä¸­å­˜è´§çš„servers/partition leadersã€ï¼Œå½“producerè·å–åˆ°metadataåï¼Œä¼šå’Œtopicä¸‹æ‰€æœ‰çš„partition leaderä¿æŒsockerè¿æ¥ï¼›æ¶ˆæ¯ç”±producerç›´æ¥é€šè¿‡sockerå‘é€åˆ°broker</p>
<blockquote>
<p>ä¸­é—´ä¸ä¼šç»è¿‡ä»»ä½•ã€è·¯ç”±å±‚ã€ï¼Œå³ï¼Œæ¶ˆæ¯è¢«è·¯ç”±åˆ°å“ªä¸ªpartitionä¸Šï¼Œæ˜¯æœ‰producerå†³å®šçš„<br>åœ¨producerç«¯çš„é…ç½®æ–‡ä»¶ä¸­ï¼Œå¯ä»¥æŒ‡å®špartitionçš„è·¯ç”±æ–¹å¼ï¼šã€randomã€ï¼Œã€key-hashã€ç­‰</p>
</blockquote>
</li>
<li><p>Consumerå‡è¡¡ç®—æ³•</p>
<p>å½“ä¸€ä¸ªgroupä¸­ï¼Œæœ‰consumeråŠ å…¥æˆ–è€…ç¦»å¼€æ—¶ï¼Œä¼šè§¦å‘partitionså‡è¡¡ã€‚å‡è¡¡çš„æœ€ç»ˆç›®çš„ï¼Œæ˜¯æå‡topicçš„å¹¶å‘æ¶ˆè´¹èƒ½åŠ›ã€‚</p>
<ul>
<li>å‡å¦‚topic1,å…·æœ‰å¦‚ä¸‹partitions: P0,P1,P2,P3</li>
<li>åŠ å…¥groupä¸­,æœ‰å¦‚ä¸‹consumer: C0,C1</li>
<li>é¦–å…ˆæ ¹æ®partitionç´¢å¼•å·å¯¹partitionsæ’åº: P0,P1,P2,P3</li>
<li>æ ¹æ®consumer.idæ’åº: C0,C1</li>
<li>è®¡ç®—å€æ•°: M = [P0,P1,P2,P3].size / [C0,C1].size,æœ¬ä¾‹å€¼M=2(å‘ä¸Šå–æ•´)</li>
<li>ç„¶åä¾æ¬¡åˆ†é…partitions: C0 = [P0,P1],C1=[P2,P3],å³Ci = [P(i <em> M),P((i + 1) </em> M -1)]</li>
</ul>
</li>
<li><p>Brokeré›†ç¾¤å†…brokerä¹‹é—´replicaæœºåˆ¶</p>
<p>replicationç­–ç•¥æ˜¯åŸºäºpartitonï¼Œè€Œä¸æ˜¯topic</p>
<blockquote>
<p>kafkaå°†æ¯ä¸ªpartitionå¤åˆ¶åˆ°å¤šä¸ªserverä¸Š<br>ä»»ä½•ä¸€ä¸ªpartitionæœ‰ä¸€ä¸ªleaderå’Œä»»æ„æ•°é‡çš„follower<br>å¤‡ä»½çš„æ•°é‡å¯ä»¥ç”±brokeré…ç½®æ–‡ä»¶è®¾å®š<br>leaderå¤„ç†æ‰€æœ‰çš„read-writeè¯·æ±‚ï¼Œè´Ÿè´£è·Ÿè¸ªæ‰€æœ‰çš„followerçŠ¶æ€ï¼Œ<br>å¦‚æœfollowerã€è½åã€å¤ªå¤šæˆ–è€…å¤±æ•ˆï¼Œleaderä¼šæŠŠå®ƒä»replicasåŒæ­¥åˆ—è¡¨ä¸­åˆ é™¤<br>followeréœ€è¦å’Œleaderä¿æŒåŒæ­¥ï¼Œfollowerå°±åƒä¸€ä¸ªconsumerï¼Œæ¶ˆè´¹ä¿¡æ¯å¹¶ä¿å­˜åœ¨æœ¬åœ°æ—¥å¿—ä¸­<br>å½“æ‰€æœ‰çš„followeréƒ½å°†ä¸€ä¸ªæ¶ˆæ¯ä¿å­˜æˆåŠŸï¼Œæ­¤æ¶ˆæ¯æ‰èƒ½è¢«è®¤ä¸ºæ˜¯ã€committedã€ï¼Œ<br>æ­¤æ—¶consumeræ‰èƒ½æ¶ˆè´¹å®ƒï¼Œè¿™ç§ç­–ç•¥è¦æ±‚leaderå’Œfollowerä¹‹é—´ä¿æŒè‰¯å¥½çš„ç½‘ç»œç¯å¢ƒ<br>åªè¦ZKé›†ç¾¤å­˜æ´»ï¼Œå³ä½¿åªå­˜æ´»ä¸€ä¸ªreplicaï¼Œä»å¯ä»¥ä¿è¯æ¶ˆæ¯çš„æ­£å¸¸å‘é€å’Œæ¥æ”¶</p>
</blockquote>
<ul>
<li>Kafkaåˆ¤å®šä¸€ä¸ªfollowerå­˜æ´»çš„æ¡ä»¶<ul>
<li>å’ŒZKä¿æŒè‰¯å¥½çš„é“¾æ¥</li>
<li>åŠæ—¶è·Ÿè¿›leaderï¼Œä¸èƒ½è½åå¤ªå¤š</li>
</ul>
</li>
</ul>
<blockquote>
<p>å¦‚æœæ­¤replicasè½åå¤ªå¤šï¼Œå®ƒä¼šç»§ç»­åœ¨leaderä¸­fetchæ•°æ®ï¼Œç„¶ååŠ å…¥åŒæ­¥åˆ—è¡¨ä¸­ï¼Œ<br>Kafkaä¸ä¼šæ›´æ¢å®¿ä¸»ï¼Œåªæœ‰è¿™æ ·æ‰èƒ½ä¿è¯replicasè¶³å¤Ÿå¿«ï¼Œæ‰èƒ½ä¿è¯producerå‘å¸ƒæ¶ˆæ¯æ—¶æ¥æ”¶ACKçš„å»¶è¿Ÿè¾ƒå°</p>
</blockquote>
<ul>
<li>å½“leaderå¤±æ•ˆï¼Œéœ€è¦è€ƒè™‘è´Ÿè½½å‡è¡¡ï¼Œpartition leaderè¾ƒå°‘çš„brokeræ›´æœ‰å¯èƒ½æˆä¸ºæ–°çš„leaderï¼Œå› ä¸º<ul>
<li>ä¸èƒ½é‡‡ç”¨ã€æŠ•ç¥¨å¤šæ•°æ´¾ã€çš„ç®—æ³•ï¼Œå› ä¸ºè¿™ç§ç®—æ³•å¯¹äºã€ç½‘ç»œç¨³å®šæ€§/æŠ•ç¥¨å‚ä¸è€…æ•°é‡ã€è¦æ±‚è¾ƒé«˜</li>
<li>Kafkaé›†ç¾¤è®¾è®¡ä¸­ï¼Œå®¹å¿N-1ä¸ªreplicaså¤±æ•ˆ</li>
<li>æ¯ä¸ªpartitonä¸­æ‰€æœ‰çš„replicaä¿¡æ¯éƒ½å¯ä»¥åœ¨ZKä¸­è·å¾—ï¼Œé‚£ä¹ˆé€‰æ‹©leaderæ˜¯éå¸¸ç®€å•çš„</li>
<li>é€‰æ‹©followeræ—¶éœ€è¦æ³¨æ„ï¼šé¿å…æ–°çš„leader serverä¸Šæ‰¿è½½çš„partiton leaderçš„ä¸ªæ•°è¿‡å¤šï¼Œå¦åˆ™æ­¤serverå°†æ‰¿å—æ›´å¤šçš„IOå‹åŠ›</li>
</ul>
</li>
</ul>
</li>
<li><p>æ€»ç»“</p>
<ul>
<li>Producerç«¯ç›´æ¥è¿æ¥brokeråˆ—è¡¨ï¼Œä»åˆ—è¡¨ä¸­è¿”å›TopicMetadataResponseï¼Œè¯¥MetadataåŒ…å«Topicä¸‹æ¯ä¸ªpartition leaderå»ºç«‹socketè¿æ¥å¹¶å‘é€æ¶ˆæ¯ã€‚</li>
<li>Brokerç«¯ä½¿ç”¨ZKç”¨æ¥æ³¨å†Œbrokerä¿¡æ¯ï¼Œä»¥åŠç›‘æ§partition leaderå­˜æ´»æ€§ã€‚</li>
<li>Consumerç«¯ä½¿ç”¨ZKç”¨æ¥æ³¨å†Œconsumerä¿¡æ¯ï¼Œå…¶ä¸­åŒ…æ‹¬consumeræ¶ˆè´¹çš„partitionåˆ—è¡¨ç­‰ï¼ŒåŒæ—¶ä¹Ÿç”¨æ¥å‘ç°brokeråˆ—è¡¨ï¼Œå¹¶å’Œpartition leaderå»ºç«‹socketè¿æ¥ï¼Œå¹¶è·å–æ¶ˆæ¯ã€‚</li>
</ul>
</li>
</ul>
<h4 id="Kafka_u5728Zookeeper_u4E2D_u5B58_u50A8_u7ED3_u6784"><a href="#Kafka_u5728Zookeeper_u4E2D_u5B58_u50A8_u7ED3_u6784" class="headerlink" title="Kafkaåœ¨Zookeeperä¸­å­˜å‚¨ç»“æ„"></a>Kafkaåœ¨Zookeeperä¸­å­˜å‚¨ç»“æ„</h4><ul>
<li><p>ç»“æ„å›¾</p>
<img src="/images/kafka.0.9.0/kafka_in_zk.png" title="kafkaåœ¨ZKä¸­çš„å­˜å‚¨ç»“æ„å›¾">
</li>
</ul>
<h4 id="Kafka__u5B89_u88C5_u548C_u914D_u7F6E"><a href="#Kafka__u5B89_u88C5_u548C_u914D_u7F6E" class="headerlink" title="Kafka å®‰è£…å’Œé…ç½®"></a>Kafka å®‰è£…å’Œé…ç½®</h4><h4 id="u53C2_u8003_u6587_u732E"><a href="#u53C2_u8003_u6587_u732E" class="headerlink" title="å‚è€ƒæ–‡çŒ®"></a>å‚è€ƒæ–‡çŒ®</h4><ul>
<li><a href="http://blog.csdn.net/zhongwen7710/article/details/41252649" target="_blank" rel="external">http://blog.csdn.net/zhongwen7710/article/details/41252649</a></li>
<li><a href="http://kafka.apache.org/documentation.html#brokerconfigs" target="_blank" rel="external">http://kafka.apache.org/documentation.html#brokerconfigs</a></li>
</ul>
]]></content>
    <summary type="html">
    <![CDATA[<!--  -->
<!--  -->
<!--  _ __    __     __      ____    ___     ___   _____   __  __    ___     -->
<!-- /\`'__\/'__`\ /'__`\   /',__\  / _]]>
    </summary>
    
      <category term="Apache" scheme="http://reasonpun.com/tags/Apache/"/>
    
      <category term="HDFS" scheme="http://reasonpun.com/tags/HDFS/"/>
    
      <category term="Kafka" scheme="http://reasonpun.com/tags/Kafka/"/>
    
      <category term="æ•°æ®æŒ–æ˜" scheme="http://reasonpun.com/categories/%E6%95%B0%E6%8D%AE%E6%8C%96%E6%8E%98/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[kafkaæ–‡æ¡£ç®€è¿°]]></title>
    <link href="http://reasonpun.com/2015/12/05/kafa-documentation/"/>
    <id>http://reasonpun.com/2015/12/05/kafa-documentation/</id>
    <published>2015-12-05T08:47:08.000Z</published>
    <updated>2015-12-25T03:33:49.000Z</updated>
    <content type="html"><![CDATA[<!--  -->
<!--  -->
<!--  _ __    __     __      ____    ___     ___   _____   __  __    ___     -->
<!-- /\`'__\/'__`\ /'__`\   /',__\  / __`\ /' _ `\/\ '__`\/\ \/\ \ /' _ `\   -->
<!-- \ \ \//\  __//\ \L\.\_/\__, `\/\ \L\ \/\ \/\ \ \ \L\ \ \ \_\ \/\ \/\ \  -->
<!--  \ \_\\ \____\ \__/.\_\/\____/\ \____/\ \_\ \_\ \ ,__/\ \____/\ \_\ \_\ -->
<!--   \/_/ \/____/\/__/\/_/\/___/  \/___/  \/_/\/_/\ \ \/  \/___/  \/_/\/_/ -->
<!--                                                 \ \_\                   -->
<!--                                                  \/_/                   -->
<!--  -->
<h3 id="u7FFB_u8BD1ing"><a href="#u7FFB_u8BD1ing" class="headerlink" title="ç¿»è¯‘ing"></a>ç¿»è¯‘ing</h3><h2 id="u672F_u8BED_u8868"><a href="#u672F_u8BED_u8868" class="headerlink" title="æœ¯è¯­è¡¨"></a>æœ¯è¯­è¡¨</h2><table>
<thead>
<tr>
<th>åè¯æœ¯è¯­</th>
<th>è§£é‡Š</th>
</tr>
</thead>
<tbody>
<tr>
<td>topic</td>
<td>ä¸»é¢˜</td>
</tr>
<tr>
<td>producer</td>
<td>ç”Ÿäº§è€…</td>
</tr>
<tr>
<td>comsumer</td>
<td>æ¶ˆè´¹è€…</td>
</tr>
<tr>
<td>broker</td>
<td>ä»£ç†</td>
</tr>
<tr>
<td>partition</td>
<td>åˆ†åŒº</td>
</tr>
<tr>
<td>offset</td>
<td>ä¸‹æ ‡</td>
</tr>
<tr>
<td>round-robin</td>
<td>è½®è¯¢</td>
</tr>
<tr>
<td>key</td>
<td>é”®</td>
</tr>
<tr>
<td>queuing</td>
<td>æ’é˜Ÿ</td>
</tr>
<tr>
<td>publish-subscribe</td>
<td>å‘å¸ƒ-è®¢é˜…</td>
</tr>
<tr>
<td>the consumer group</td>
<td>æ¶ˆè´¹è€…ç»„</td>
</tr>
<tr>
<td>subscriber</td>
<td>è®¢é˜…è€…</td>
</tr>
<tr>
<td>guarantee</td>
<td>ä¿è¯ï¼ˆ?ï¼‰</td>
</tr>
</tbody>
</table>
<h2 id="Kafka_0-9-0__u6587_u6863"><a href="#Kafka_0-9-0__u6587_u6863" class="headerlink" title="Kafka 0.9.0 æ–‡æ¡£"></a>Kafka 0.9.0 æ–‡æ¡£</h2><ol>
<li>å¼€å§‹<ul>
<li>1.1 ç®€ä»‹</li>
<li>1.2 ç”¨ä¾‹</li>
<li>1.3 å¿«é€Ÿå…¥é—¨</li>
<li>1.4 ç”Ÿæ€åœˆ</li>
<li>1.5 å‡çº§</li>
</ul>
</li>
<li>API<ul>
<li>2.1 ç”Ÿäº§è€… API</li>
<li>2.2 æ¶ˆè´¹è€… API<ul>
<li>2.2.1 Old High Level Consumer API</li>
<li>2.2.2 Old Simple Consumer API</li>
<li>2.2.3 New Consumer API</li>
</ul>
</li>
</ul>
</li>
<li>é…ç½®<ul>
<li>3.1 ä»£ç†é…ç½®</li>
<li>3.2 ç”Ÿäº§è€…é…ç½®</li>
<li>3.3 æ¶ˆè´¹è€…é…ç½®<ul>
<li>3.3.1 Old Consumer Configs</li>
<li>3.3.2 New Consumer Configs</li>
<li>3.4 Kafka è¿æ¥é…ç½®</li>
</ul>
</li>
</ul>
</li>
<li>è®¾è®¡<ul>
<li>4.1 Motivation</li>
<li>4.2 æŒä¹…åŒ–</li>
<li>4.3 Efficiency</li>
<li>4.4 ç”Ÿäº§è€…</li>
<li>4.5 æ¶ˆè´¹è€…</li>
<li>4.6 Message Delivery Semantics</li>
<li>4.7 Replication</li>
<li>4.8 Log Compaction</li>
<li>4.9 Quotas</li>
</ul>
</li>
<li>å®ç°<ul>
<li>5.1 API è®¾è®¡</li>
<li>5.2 ç½‘ç»œå±‚</li>
<li>5.3 æ¶ˆæ¯</li>
<li>5.4 æ¶ˆæ¯æ ¼å¼</li>
<li>5.5 æ—¥å¿—</li>
<li>5.6 åˆ†å¸ƒå¼</li>
</ul>
</li>
<li>Operations<ul>
<li>6.1 Basic Kafka Operations<ul>
<li>Adding and removing topics</li>
<li>Modifying topics</li>
<li>Graceful shutdown</li>
<li>Balancing leadership</li>
<li>Checking consumer position</li>
<li>Mirroring data between clusters</li>
<li>Expanding your cluster</li>
<li>Decommissioning brokers</li>
<li>Increasing replication factor</li>
</ul>
</li>
<li>6.2 Datacenters</li>
<li>6.3 Important Configs<ul>
<li>Important Server Configs</li>
<li>Important Client Configs</li>
<li>A Production Server Configs</li>
</ul>
</li>
<li>6.4 Java Version</li>
<li>6.5 Hardware and OS<ul>
<li>OS</li>
<li>Disks and Filesystems</li>
<li>Application vs OS Flush Management</li>
<li>Linux Flush Behavior</li>
<li>Ext4 Notes</li>
</ul>
</li>
<li>6.6 Monitoring</li>
<li>6.7 ZooKeeper<ul>
<li>Stable Version</li>
<li>Operationalization</li>
</ul>
</li>
</ul>
</li>
<li>å®‰å…¨æ€§<ul>
<li>7.1 Security Overview</li>
<li>7.2 Encryption and Authentication using SSL</li>
<li>7.3 Authentication using SASL</li>
<li>7.4 Authorization and ACLs</li>
<li>7.5 ZooKeeper Authentication<ul>
<li>New Clusters</li>
<li>Migrating Clusters</li>
<li>Migrating the ZooKeeper Ensemble</li>
</ul>
</li>
</ul>
</li>
<li>Kafka Connect<ul>
<li>8.1 Overview</li>
<li>8.2 User Guide</li>
<li>8.3 Connector Development Guide</li>
</ul>
</li>
</ol>
<h2 id="1-__u5F00_u59CB"><a href="#1-__u5F00_u59CB" class="headerlink" title="1. å¼€å§‹"></a>1. å¼€å§‹</h2><h3 id="1-1__u7B80_u4ECB"><a href="#1-1__u7B80_u4ECB" class="headerlink" title="1.1 ç®€ä»‹"></a>1.1 ç®€ä»‹</h3><p>kafkaæ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼çš„ï¼Œåˆ†åŒºçš„ï¼Œå¤ç”¨çš„æ—¥å¿—æäº¤æœåŠ¡ã€‚å®ƒä»¥ä¸€ç§ç‹¬ç‰¹çš„è®¾è®¡æ–¹å¼æä¾›æ¶ˆæ¯ä¼ é€’ç³»ç»Ÿçš„åŠŸèƒ½ã€‚</p>
<p>è¿™æ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿ</p>
<p>First letâ€™s review some basic messaging terminology:</p>
<ul>
<li>Kafka maintains feeds of messages in categories called topics.</li>
<li>Weâ€™ll call processes that publish messages to a Kafka topic producers.</li>
<li>Weâ€™ll call processes that subscribe to topics and process the feed of published messages consumers..</li>
<li>Kafka is run as a cluster comprised of one or more servers each of which is called a broker.</li>
</ul>
<p>So, at a high level, producers send messages over the network to the Kafka cluster which in turn serves them up to consumers like this:</p>
<img src="/images/kafka.0.9.0/producer_consumer.png" width="258" height="180" title="ç”Ÿäº§è€…æ¶ˆè´¹è€…å…³ç³»">
<p>Communication between the clients and the servers is done with a simple, high-performance, language agnostic TCP protocol. We provide a Java client for Kafka, but clients are available in many languages.</p>
<p>æœåŠ¡å™¨ç«¯å’Œå®¢æˆ·ç«¯çš„é€šè®¯æ˜¯é€šè¿‡ä¸€ä¸ªç®€å•çš„ï¼Œé«˜æ•ˆçš„ï¼ŒTCPåè®®æ— å…³çš„è¯­è¨€å®ç°çš„ã€‚ä¸ä»…æä¾›äº†Javaå®¢æˆ·ç«¯ï¼Œè¿˜æä¾›äº†å…¶ä»–å¾ˆå¤šè¯­è¨€çš„æ”¯æŒã€‚</p>
<h4 id="Topics_and_Logs"><a href="#Topics_and_Logs" class="headerlink" title="Topics and Logs"></a>Topics and Logs</h4><p>Letâ€™s first dive into the high-level abstraction Kafka providesâ€”the topic.<br>A topic is a category or feed name to which messages are published. For each topic, the Kafka cluster maintains a partitioned log that looks like this:</p>
<img src="/images/kafka.0.9.0/producer_consumer.png" width="258" height="180" title="ç”Ÿäº§è€…æ¶ˆè´¹è€…å…³ç³»">
<p>Each partition is an ordered, immutable sequence of messages that is continually appended toâ€”a commit log. The messages in the partitions are each assigned a sequential id number called the offset that uniquely identifies each message within the partition.<br>The Kafka cluster retains all published messagesâ€”whether or not they have been consumedâ€”for a configurable period of time. For example if the log retention is set to two days, then for the two days after a message is published it is available for consumption, after which it will be discarded to free up space. Kafkaâ€™s performance is effectively constant with respect to data size so retaining lots of data is not a problem.</p>
<p>In fact the only metadata retained on a per-consumer basis is the position of the consumer in the log, called the â€œoffsetâ€. This offset is controlled by the consumer: normally a consumer will advance its offset linearly as it reads messages, but in fact the position is controlled by the consumer and it can consume messages in any order it likes. For example a consumer can reset to an older offset to reprocess.</p>
<p>This combination of features means that Kafka consumers are very cheapâ€”they can come and go without much impact on the cluster or on other consumers. For example, you can use our command line tools to â€œtailâ€ the contents of any topic without changing what is consumed by any existing consumers.</p>
<p>The partitions in the log serve several purposes. First, they allow the log to scale beyond a size that will fit on a single server. Each individual partition must fit on the servers that host it, but a topic may have many partitions so it can handle an arbitrary amount of data. Second they act as the unit of parallelismâ€”more on that in a bit.</p>
<h4 id="Distribution"><a href="#Distribution" class="headerlink" title="Distribution"></a>Distribution</h4><p>The partitions of the log are distributed over the servers in the Kafka cluster with each server handling data and requests for a share of the partitions. Each partition is replicated across a configurable number of servers for fault tolerance.<br>Each partition has one server which acts as the â€œleaderâ€ and zero or more servers which act as â€œfollowersâ€. The leader handles all read and write requests for the partition while the followers passively replicate the leader. If the leader fails, one of the followers will automatically become the new leader. Each server acts as a leader for some of its partitions and a follower for others so load is well balanced within the cluster.</p>
<h4 id="Producers"><a href="#Producers" class="headerlink" title="Producers"></a>Producers</h4><p>Producers publish data to the topics of their choice. The producer is responsible for choosing which message to assign to which partition within the topic. This can be done in a round-robin fashion simply to balance load or it can be done according to some semantic partition function (say based on some key in the message). More on the use of partitioning in a second.</p>
<h4 id="Consumers"><a href="#Consumers" class="headerlink" title="Consumers"></a>Consumers</h4><p>Messaging traditionally has two models: queuing and publish-subscribe. In a queue, a pool of consumers may read from a server and each message goes to one of them; in publish-subscribe the message is broadcast to all consumers. Kafka offers a single consumer abstraction that generalizes both of theseâ€”the consumer group.<br>Consumers label themselves with a consumer group name, and each message published to a topic is delivered to one consumer instance within each subscribing consumer group. Consumer instances can be in separate processes or on separate machines.</p>
<p>If all the consumer instances have the same consumer group, then this works just like a traditional queue balancing load over the consumers.</p>
<p>If all the consumer instances have different consumer groups, then this works like publish-subscribe and all messages are broadcast to all consumers.</p>
<p>More commonly, however, we have found that topics have a small number of consumer groups, one for each â€œlogical subscriberâ€. Each group is composed of many consumer instances for scalability and fault tolerance. This is nothing more than publish-subscribe semantics where the subscriber is cluster of consumers instead of a single process.</p>
<p>Kafka has stronger ordering guarantees than a tranditional messageing system, too.</p>
<img src="/images/kafka.0.9.0/kafka_cluster.png" title="kafka_cluster">
<p>A traditional queue retains messages in-order on the server, and if multiple consumers consume from the queue then the server hands out messages in the order they are stored. However, although the server hands out messages in order, the messages are delivered asynchronously to consumers, so they may arrive out of order on different consumers. This effectively means the ordering of the messages is lost in the presence of parallel consumption. Messaging systems often work around this by having a notion of â€œexclusive consumerâ€ that allows only one process to consume from a queue, but of course this means that there is no parallelism in processing.</p>
<p>Kafka does it better. By having a notion of parallelismâ€”the partitionâ€”within the topics, Kafka is able to provide both ordering guarantees and load balancing over a pool of consumer processes. This is achieved by assigning the partitions in the topic to the consumers in the consumer group so that each partition is consumed by exactly one consumer in the group. By doing this we ensure that the consumer is the only reader of that partition and consumes the data in order. Since there are many partitions this still balances the load over many consumer instances. Note however that there cannot be more consumer instances in a consumer group than partitions.</p>
<p>Kafka only provides a total order over messages within a partition, not between different partitions in a topic. Per-partition ordering combined with the ability to partition data by key is sufficient for most applications. However, if you require a total order over messages this can be achieved with a topic that has only one partition, though this will mean only one consumer process per consumer group.</p>
<h4 id="Guarantees"><a href="#Guarantees" class="headerlink" title="Guarantees"></a>Guarantees</h4><p>At a high-level Kafka gives the following guarantees:</p>
<ul>
<li>Messages sent by a producer to a particular topic partition will be appended in the order they are sent. That is, if a message M1 is sent by the same producer as a message M2, and M1 is sent first, then M1 will have a lower offset than M2 and appear earlier in the log.</li>
<li>A consumer instance sees messages in the order they are stored in the log.</li>
<li>For a topic with replication factor N, we will tolerate up to N-1 server failures without losing any messages committed to the log.<br>More details on these guarantees are given in the design section of the documentation.</li>
</ul>
<h3 id="1-2_Use_Cases"><a href="#1-2_Use_Cases" class="headerlink" title="1.2 Use Cases"></a>1.2 Use Cases</h3><p>Here is a description of a few of the popular use cases for Apache Kafka. For an overview of a number of these areas in action, see this blog post.</p>
<h4 id="Messaging"><a href="#Messaging" class="headerlink" title="Messaging"></a>Messaging</h4><p>Kafka works well as a replacement for a more traditional message broker. Message brokers are used for a variety of reasons (to decouple processing from data producers, to buffer unprocessed messages, etc). In comparison to most messaging systems Kafka has better throughput, built-in partitioning, replication, and fault-tolerance which makes it a good solution for large scale message processing applications.<br>In our experience messaging uses are often comparatively low-throughput, but may require low end-to-end latency and often depend on the strong durability guarantees Kafka provides.</p>
<p>In this domain Kafka is comparable to traditional messaging systems such as ActiveMQ or RabbitMQ.</p>
<h4 id="Website_Activity_Tracking"><a href="#Website_Activity_Tracking" class="headerlink" title="Website Activity Tracking"></a>Website Activity Tracking</h4><p>The original use case for Kafka was to be able to rebuild a user activity tracking pipeline as a set of real-time publish-subscribe feeds. This means site activity (page views, searches, or other actions users may take) is published to central topics with one topic per activity type. These feeds are available for subscription for a range of use cases including real-time processing, real-time monitoring, and loading into Hadoop or offline data warehousing systems for offline processing and reporting.<br>Activity tracking is often very high volume as many activity messages are generated for each user page view.</p>
<h4 id="Metrics"><a href="#Metrics" class="headerlink" title="Metrics"></a>Metrics</h4><p>Kafka is often used for operational monitoring data. This involves aggregating statistics from distributed applications to produce centralized feeds of operational data.</p>
<h4 id="Log_Aggregation"><a href="#Log_Aggregation" class="headerlink" title="Log Aggregation"></a>Log Aggregation</h4><p>Many people use Kafka as a replacement for a log aggregation solution. Log aggregation typically collects physical log files off servers and puts them in a central place (a file server or HDFS perhaps) for processing. Kafka abstracts away the details of files and gives a cleaner abstraction of log or event data as a stream of messages. This allows for lower-latency processing and easier support for multiple data sources and distributed data consumption. In comparison to log-centric systems like Scribe or Flume, Kafka offers equally good performance, stronger durability guarantees due to replication, and much lower end-to-end latency.</p>
<h4 id="Stream_Processing"><a href="#Stream_Processing" class="headerlink" title="Stream Processing"></a>Stream Processing</h4><p>Many users end up doing stage-wise processing of data where data is consumed from topics of raw data and then aggregated, enriched, or otherwise transformed into new Kafka topics for further consumption. For example a processing flow for article recommendation might crawl article content from RSS feeds and publish it to an â€œarticlesâ€ topic; further processing might help normalize or deduplicate this content to a topic of cleaned article content; a final stage might attempt to match this content to users. This creates a graph of real-time data flow out of the individual topics. Storm and Samza are popular frameworks for implementing these kinds of transformations.</p>
<h4 id="Event_Sourcing"><a href="#Event_Sourcing" class="headerlink" title="Event Sourcing"></a>Event Sourcing</h4><p>Event sourcing is a style of application design where state changes are logged as a time-ordered sequence of records. Kafkaâ€™s support for very large stored log data makes it an excellent backend for an application built in this style.</p>
<h4 id="Commit_Log"><a href="#Commit_Log" class="headerlink" title="Commit Log"></a>Commit Log</h4><p>Kafka can serve as a kind of external commit-log for a distributed system. The log helps replicate data between nodes and acts as a re-syncing mechanism for failed nodes to restore their data. The log compaction feature in Kafka helps support this usage. In this usage Kafka is similar to Apache BookKeeper project.</p>
<h3 id="1-3_Quick_Start"><a href="#1-3_Quick_Start" class="headerlink" title="1.3 Quick Start"></a>1.3 Quick Start</h3><p>This tutorial assumes you are starting fresh and have no existing Kafka or ZooKeeper data.</p>
<h4 id="Step_1_3A_Download_the_code"><a href="#Step_1_3A_Download_the_code" class="headerlink" title="Step 1: Download the code"></a>Step 1: Download the code</h4><p>Download the 0.9.0.0 release and un-tar it.</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="tag">tar</span> <span class="tag">-xzf</span> <span class="tag">kafka_2</span><span class="class">.11-0</span><span class="class">.9</span><span class="class">.0</span><span class="class">.0</span><span class="class">.tgz</span></span><br><span class="line">&gt; <span class="tag">cd</span> <span class="tag">kafka_2</span><span class="class">.11-0</span><span class="class">.9</span><span class="class">.0</span><span class="class">.0</span></span><br></pre></td></tr></table></figure>
<h4 id="Step_2_3A_Start_the_server"><a href="#Step_2_3A_Start_the_server" class="headerlink" title="Step 2: Start the server"></a>Step 2: Start the server</h4><p>Kafka uses ZooKeeper so you need to first start a ZooKeeper server if you donâ€™t already have one. You can use the convenience script packaged with kafka to get a quick-and-dirty single-node ZooKeeper instance.</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt; bin/zookeeper-server-start<span class="class">.sh</span> config/zookeeper<span class="class">.properties</span></span><br><span class="line">[<span class="number">2013</span>-<span class="number">04</span>-<span class="number">22</span> <span class="number">15</span>:<span class="number">01</span>:<span class="number">37</span>,<span class="number">495</span>] INFO Reading configuration from: config/zookeeper<span class="class">.properties</span> (org<span class="class">.apache</span><span class="class">.zookeeper</span><span class="class">.server</span><span class="class">.quorum</span><span class="class">.QuorumPeerConfig</span>)</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<h4 id="Step_3_3A_Create_a_topic"><a href="#Step_3_3A_Create_a_topic" class="headerlink" title="Step 3: Create a topic"></a>Step 3: Create a topic</h4><p>Letâ€™s create a topic named â€œtestâ€ with a single partition and only one replica:</p>
<figure class="highlight brainfuck"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="comment">bin/kafka</span><span class="literal">-</span><span class="comment">topics</span><span class="string">.</span><span class="comment">sh</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">create</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">zookeeper</span> <span class="comment">localhost:2181</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">replication</span><span class="literal">-</span><span class="comment">factor</span> <span class="comment">1</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">partitions</span> <span class="comment">1</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">topic</span> <span class="comment">test</span></span><br></pre></td></tr></table></figure>
<p>We can now see that topic if we run the list topic command:</p>
<figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt; bin/kafka-topics.sh <span class="comment">--list --zookeeper localhost:2181</span></span><br><span class="line">test</span><br><span class="line">Alternatively, instead <span class="operator">of</span> manually creating topics you can also configure your brokers <span class="built_in">to</span> auto-<span class="built_in">create</span> topics when <span class="operator">a</span> non-existent topic is published <span class="built_in">to</span>.</span><br></pre></td></tr></table></figure>
<h4 id="Step_4_3A_Send_some_messages"><a href="#Step_4_3A_Send_some_messages" class="headerlink" title="Step 4: Send some messages"></a>Step 4: Send some messages</h4><p>Kafka comes with a command line client that will take input from a file or from standard input and send it out as messages to the Kafka cluster. By default each line will be sent as a separate message.<br>Run the producer and then type a few messages into the console to send to the server.</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt; bin/kafka-console-producer.<span class="keyword">sh</span> --broker-<span class="keyword">list</span> localhos<span class="variable">t:9092</span> --topic test</span><br><span class="line">This <span class="keyword">is</span> <span class="keyword">a</span> message</span><br><span class="line">This <span class="keyword">is</span> another message</span><br></pre></td></tr></table></figure>
<h4 id="Step_5_3A_Start_a_consumer"><a href="#Step_5_3A_Start_a_consumer" class="headerlink" title="Step 5: Start a consumer"></a>Step 5: Start a consumer</h4><p>Kafka also has a command line consumer that will dump out messages to standard output.</p>
<figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt; bin/kafka-console-consumer.sh <span class="comment">--zookeeper localhost:2181 --topic test --from-beginning</span></span><br><span class="line">This is <span class="operator">a</span> message</span><br><span class="line">This is another message</span><br><span class="line">If you have <span class="keyword">each</span> <span class="operator">of</span> <span class="operator">the</span> above commands running <span class="operator">in</span> <span class="operator">a</span> different terminal <span class="keyword">then</span> you should now be able <span class="built_in">to</span> type messages <span class="keyword">into</span> <span class="operator">the</span> producer terminal <span class="operator">and</span> see them appear <span class="operator">in</span> <span class="operator">the</span> consumer terminal.</span><br></pre></td></tr></table></figure>
<p>All of the command line tools have additional options; running the command with no arguments will display usage information documenting them in more detail.</p>
<h4 id="Step_6_3A_Setting_up_a_multi-broker_cluster"><a href="#Step_6_3A_Setting_up_a_multi-broker_cluster" class="headerlink" title="Step 6: Setting up a multi-broker cluster"></a>Step 6: Setting up a multi-broker cluster</h4><p>So far we have been running against a single broker, but thatâ€™s no fun. For Kafka, a single broker is just a cluster of size one, so nothing much changes other than starting a few more broker instances. But just to get feel for it, letâ€™s expand our cluster to three nodes (still all on our local machine).<br>First we make a config file for each of the brokers:</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; cp config/server<span class="class">.properties</span> config/server-<span class="number">1</span><span class="class">.properties</span></span><br><span class="line">&gt; cp config/server<span class="class">.properties</span> config/server-<span class="number">2</span>.properties</span><br></pre></td></tr></table></figure>
<p>Now edit these new files and set the following properties:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">config/server-<span class="number">1.</span>properties:</span><br><span class="line">    broker.id=<span class="number">1</span></span><br><span class="line">    port=<span class="number">9093</span></span><br><span class="line">    <span class="built_in">log</span>.dir=/tmp/kafka-logs-<span class="number">1</span></span><br><span class="line"></span><br><span class="line">config/server-<span class="number">2.</span>properties:</span><br><span class="line">    broker.id=<span class="number">2</span></span><br><span class="line">    port=<span class="number">9094</span></span><br><span class="line">    <span class="built_in">log</span>.dir=/tmp/kafka-logs-<span class="number">2</span></span><br></pre></td></tr></table></figure>
<p>The broker.id property is the unique and permanent name of each node in the cluster. We have to override the port and log directory only because we are running these all on the same machine and we want to keep the brokers from all trying to register on the same port or overwrite each others data.</p>
<p>We already have Zookeeper and our single node started, so we just need to start the two new nodes:</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt; bin/kafka-server-start<span class="class">.sh</span> config/server-<span class="number">1</span><span class="class">.properties</span> &amp;</span><br><span class="line">...</span><br><span class="line">&gt; bin/kafka-server-start<span class="class">.sh</span> config/server-<span class="number">2</span><span class="class">.properties</span> &amp;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>Now create a new topic with a replication factor of three:</p>
<figure class="highlight brainfuck"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="comment">bin/kafka</span><span class="literal">-</span><span class="comment">topics</span><span class="string">.</span><span class="comment">sh</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">create</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">zookeeper</span> <span class="comment">localhost:2181</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">replication</span><span class="literal">-</span><span class="comment">factor</span> <span class="comment">3</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">partitions</span> <span class="comment">1</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">topic</span> <span class="comment">my</span><span class="literal">-</span><span class="comment">replicated</span><span class="literal">-</span><span class="comment">topic</span></span><br></pre></td></tr></table></figure>
<p>Okay but now that we have a cluster how can we know which broker is doing what? To see that run the â€œdescribe topicsâ€ command:</p>
<figure class="highlight brainfuck"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="comment">bin/kafka</span><span class="literal">-</span><span class="comment">topics</span><span class="string">.</span><span class="comment">sh</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">describe</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">zookeeper</span> <span class="comment">localhost:2181</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">topic</span> <span class="comment">my</span><span class="literal">-</span><span class="comment">replicated</span><span class="literal">-</span><span class="comment">topic</span></span><br></pre></td></tr></table></figure>
<p>Topic:my-replicated-topic    PartitionCount:1    ReplicationFactor:3    Configs:</p>
<pre><code>Topic: my-replicated-topic    Partition: 0    Leader: 1    Replicas: 1,2,0    Isr: 1,2,0
</code></pre><p>Here is an explanation of output. The first line gives a summary of all the partitions, each additional line gives information about one partition. Since we have only one partition for this topic there is only one line.</p>
<ul>
<li>â€œleaderâ€ is the node responsible for all reads and writes for the given partition. Each node will be the leader for a randomly selected portion of the partitions.</li>
<li>â€œreplicasâ€ is the list of nodes that replicate the log for this partition regardless of whether they are the leader or even if they are currently alive.</li>
<li>â€œisrâ€ is the set of â€œin-syncâ€ replicas. This is the subset of the replicas list that is currently alive and caught-up to the leader.</li>
</ul>
<p>Note that in my example node 1 is the leader for the only partition of the topic.</p>
<p>We can run the same command on the original topic we created to see where it is:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt; bin/kafka-topics.sh --describe --zookeeper <span class="string">localhost:</span><span class="number">2181</span> --topic test</span><br><span class="line"><span class="label"></span><br><span class="line">Topic:</span>test	<span class="string">PartitionCount:</span><span class="number">1</span>	<span class="string">ReplicationFactor:</span><span class="number">1</span>	<span class="string">Configs:</span></span><br><span class="line"><span class="label">	Topic:</span> test	<span class="string">Partition:</span> <span class="number">0</span>	<span class="string">Leader:</span> <span class="number">0</span>	<span class="string">Replicas:</span> <span class="number">0</span>	<span class="string">Isr:</span> <span class="number">0</span></span><br></pre></td></tr></table></figure>
<p>So there is no surprise thereâ€”the original topic has no replicas and is on server 0, the only server in our cluster when we created it.</p>
<p>Letâ€™s publish a few messages to our new topic:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt; bin/kafka-console-producer.sh --broker-<span class="built_in">list</span> localhost:<span class="number">9092</span> --topic my-replicated-topic</span><br><span class="line">...</span><br><span class="line">my test message <span class="number">1</span></span><br><span class="line">my test message <span class="number">2</span></span><br><span class="line">^C</span><br></pre></td></tr></table></figure>
<p>Now letâ€™s consume these messages:</p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt; bin/kafka-console-consumer.sh <span class="comment">--zookeeper localhost:2181 --from-beginning --topic my-replicated-topic</span></span><br><span class="line">...</span><br><span class="line"><span class="keyword">my</span> test message <span class="number">1</span></span><br><span class="line"><span class="keyword">my</span> test message <span class="number">2</span></span><br><span class="line">^C</span><br></pre></td></tr></table></figure>
<p>Now letâ€™s test out fault-tolerance. Broker 1 was acting as the leader so letâ€™s kill it:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt; ps | grep server-<span class="number">1.</span>properties</span><br><span class="line"><span class="number">7564</span> ttys002    <span class="number">0</span>:<span class="number">15.91</span> /System/Library/Frameworks/JavaVM.framework/Versions/<span class="number">1.6</span>/Home/bin/java...</span><br><span class="line">&gt; kill -<span class="number">9</span> <span class="number">7564</span></span><br></pre></td></tr></table></figure>
<p>Leadership has switched to one of the slaves and node 1 is no longer in the in-sync replica set:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt; bin/kafka-topics.sh --describe --zookeeper localhost:<span class="number">2181</span> --topic my-replicated-topic</span><br><span class="line">Topic:my-replicated-topic	PartitionCount:<span class="number">1</span>	ReplicationFactor:<span class="number">3</span>	Configs:</span><br><span class="line">	Topic: my-replicated-topic	Partition: <span class="number">0</span>	Leader: <span class="number">2</span>	Replicas: <span class="number">1</span>,<span class="number">2</span>,<span class="number">0</span>	Isr: <span class="number">2</span>,<span class="number">0</span></span><br></pre></td></tr></table></figure>
<p>But the messages are still be available for consumption even though the leader that took the writes originally is down:</p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt; bin/kafka-console-consumer.sh <span class="comment">--zookeeper localhost:2181 --from-beginning --topic my-replicated-topic</span></span><br><span class="line">...</span><br><span class="line"><span class="keyword">my</span> test message <span class="number">1</span></span><br><span class="line"><span class="keyword">my</span> test message <span class="number">2</span></span><br><span class="line">^C</span><br></pre></td></tr></table></figure>
<h4 id="Step_7_3A_Use_Kafka_Connect_to_import/export_data"><a href="#Step_7_3A_Use_Kafka_Connect_to_import/export_data" class="headerlink" title="Step 7: Use Kafka Connect to import/export data"></a>Step 7: Use Kafka Connect to import/export data</h4><p>Writing data from the console and writing it back to the console is a convenient place to start, but youâ€™ll probably want to use data from other sources or export data from Kafka to other systems. For many systems, instead of writing custom integration code you can use Kafka Connect to import or export data. Kafka Connect is a tool included with Kafka that imports and exports data to Kafka. It is an extensible tool that runs connectors, which implement the custom logic for interacting with an external system. In this quickstart weâ€™ll see how to run Kafka Connect with simple connectors that import data from a file to a Kafka topic and export data from a Kafka topic to a file. First, weâ€™ll start by creating some seed data to test with:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="built_in">echo</span> <span class="operator">-e</span> <span class="string">"foo\nbar"</span> &gt; test.txt</span><br></pre></td></tr></table></figure>
<p>Next, weâ€™ll start two connectors running in standalone mode, which means they run in a single, local, dedicated process. We provide three configuration files as parameters. The first is always the configuration for the Kafka Connect process, containing common configuration such as the Kafka brokers to connect to and the serialization format for data. The remaining configuration files each specify a connector to create. These files include a unique connector name, the connector class to instantiate, and any other configuration required by the connector.</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; bin/connect-standalone<span class="class">.sh</span> config/connect-standalone<span class="class">.properties</span> config/connect-file-source<span class="class">.properties</span> config/connect-file-sink.properties</span><br></pre></td></tr></table></figure>
<p>These sample configuration files, included with Kafka, use the default local cluster configuration you started earlier and create two connectors: the first is a source connector that reads lines from an input file and produces each to a Kafka topic and the second is a sink connector that reads messages from a Kafka topic and produces each as a line in an output file. During startup youâ€™ll see a number of log messages, including some indicating that the connectors are being instantiated. Once the Kafka Connect process has started, the source connector should start reading lines from</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">test</span><span class="class">.txt</span></span><br></pre></td></tr></table></figure>
<p>and producing them to the topic</p>
<figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">connect</span>-test</span><br></pre></td></tr></table></figure>
<p>, and the sink connector should start reading messages from the topic</p>
<figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">connect</span>-test</span><br></pre></td></tr></table></figure>
<p>and write them to the file</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">test<span class="class">.sink</span><span class="class">.txt</span></span><br></pre></td></tr></table></figure>
<p>. We can verify the data has been delivered through the entire pipeline by examining the contents of the output file:</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt; cat test<span class="class">.sink</span><span class="class">.txt</span></span><br><span class="line">foo</span><br><span class="line">bar</span><br></pre></td></tr></table></figure>
<p>Note that the data is being stored in the Kafka topic</p>
<figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">connect</span>-test</span><br></pre></td></tr></table></figure>
<p>, so we can also run a console consumer to see the data in the topic (or use custom consumer code to process it):</p>
<figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt; bin/kafka-<span class="built_in">console</span>-consumer.sh --zookeeper <span class="attribute">localhost</span>:<span class="number">2181</span> --topic connect-test --<span class="keyword">from</span>-beginning</span><br><span class="line">&#123;<span class="string">"schema"</span>:&#123;<span class="string">"type"</span>:<span class="string">"string"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>&#125;,<span class="string">"payload"</span>:<span class="string">"foo"</span>&#125;</span><br><span class="line">&#123;<span class="string">"schema"</span>:&#123;<span class="string">"type"</span>:<span class="string">"string"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>&#125;,<span class="string">"payload"</span>:<span class="string">"bar"</span>&#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>The connectors continue to process data, so we can add data to the file and see it move through the pipeline:</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; echo <span class="string">"Another line"</span> <span class="prompt">&gt;&gt; </span>test.txt</span><br></pre></td></tr></table></figure>
<p>You should see the line appear in the console consumer output and in the sink file.</p>
<h3 id="1-4_Ecosystem"><a href="#1-4_Ecosystem" class="headerlink" title="1.4 Ecosystem"></a>1.4 Ecosystem</h3><p>There are a plethora of tools that integrate with Kafka outside the main distribution. The ecosystem page lists many of these, including stream processing systems, Hadoop integration, monitoring, and deployment tools.</p>
<h2 id="2-_API"><a href="#2-_API" class="headerlink" title="2. API"></a>2. API</h2><p>Apache Kafka includes new java clients (in the org.apache.kafka.clients package). These are meant to supplant the older Scala clients, but for compatability they will co-exist for some time. These clients are available in a seperate jar with minimal dependencies, while the old Scala clients remain packaged with the server.</p>
<h3 id="2-1_Producer_API"><a href="#2-1_Producer_API" class="headerlink" title="2.1 Producer API"></a>2.1 Producer API</h3><p>We encourage all new development to use the new Java producer. This client is production tested and generally both faster and more fully featured than the previous Scala client. You can use this client by adding a dependency on the client jar using the following example maven co-ordinates (you can change the version numbers with new releases):</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"> <span class="tag">&lt;<span class="title">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">groupId</span>&gt;</span>org.apache.kafka<span class="tag">&lt;/<span class="title">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">artifactId</span>&gt;</span>kafka-clients<span class="tag">&lt;/<span class="title">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">version</span>&gt;</span>0.9.0.0<span class="tag">&lt;/<span class="title">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>Examples showing how to use the producer are given in the <a href="http://kafka.apache.org/090/javadoc/index.html?org/apache/kafka/clients/producer/KafkaProducer.html" target="_blank" rel="external">javadocs</a>.<br>For those interested in the legacy Scala producer api, information can be found <a href="http://kafka.apache.org/081/documentation.html#producerapi" target="_blank" rel="external">here</a>.</p>
<h3 id="2-2_Consumer_API"><a href="#2-2_Consumer_API" class="headerlink" title="2.2 Consumer API"></a>2.2 Consumer API</h3><p>As of the 0.9.0 release we have added a new Java consumer to replace our existing high-level ZooKeeper-based consumer and low-level consumer APIs. This client is considered beta quality. To ensure a smooth upgrade paths for users, we still maintain the old 0.8 consumer clients that continue to work on an 0.9 Kafka cluster. In the following sections we introduce both the old 0.8 consumer APIs (both high-level ConsumerConnector and low-level SimpleConsumer) and the new Java consumer API respectively.</p>
<h4 id="2-2-1_Old_High_Level_Consumer_API"><a href="#2-2-1_Old_High_Level_Consumer_API" class="headerlink" title="2.2.1 Old High Level Consumer API"></a>2.2.1 Old High Level Consumer API</h4><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">class Consumer &#123;</span><br><span class="line">  /<span class="keyword">*</span><span class="keyword">*</span></span><br><span class="line">   <span class="keyword">*</span>  Create a ConsumerConnector</span><br><span class="line">   <span class="keyword">*</span></span><br><span class="line">   <span class="keyword">*</span>  <span class="comment">@param config  at the minimum, need to specify the groupid of the consumer and the zookeeper</span></span><br><span class="line">   <span class="keyword">*</span>                 connection string zookeeper.connect.</span><br><span class="line">   <span class="keyword">*</span>/</span><br><span class="line">  public static kafka.javaapi.consumer.ConsumerConnector createJavaConsumerConnector(ConsumerConfig config);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/<span class="keyword">*</span><span class="keyword">*</span></span><br><span class="line"> <span class="keyword">*</span>  V: type of the message</span><br><span class="line"> <span class="keyword">*</span>  K: type of the optional key assciated with the message</span><br><span class="line"> <span class="keyword">*</span>/</span><br><span class="line">public interface kafka.javaapi.consumer.ConsumerConnector &#123;</span><br><span class="line">  /<span class="keyword">*</span><span class="keyword">*</span></span><br><span class="line">   <span class="keyword">*</span>  Create a list of message streams of type T for each topic.</span><br><span class="line">   <span class="keyword">*</span></span><br><span class="line">   <span class="keyword">*</span>  <span class="comment">@param topicCountMap  a map of (topic, #streams) pair</span></span><br><span class="line">   <span class="keyword">*</span>  <span class="comment">@param decoder a decoder that converts from Message to T</span></span><br><span class="line">   <span class="keyword">*</span>  <span class="comment">@return a map of (topic, list of  KafkaStream) pairs.</span></span><br><span class="line">   <span class="keyword">*</span>          The number of items in the list is <span class="comment">#streams. Each stream supports</span></span><br><span class="line">   <span class="keyword">*</span>          an iterator over message/metadata pairs.</span><br><span class="line">   <span class="keyword">*</span>/</span><br><span class="line">  public <span class="variable">&lt;K,V&gt;</span> Map<span class="variable">&lt;String, List&lt;KafkaStream&lt;K,V&gt;</span>&gt;&gt;</span><br><span class="line">    createMessageStreams(Map<span class="variable">&lt;String, Integer&gt;</span> topicCountMap, Decoder<span class="variable">&lt;K&gt;</span> keyDecoder, Decoder<span class="variable">&lt;V&gt;</span> valueDecoder);</span><br><span class="line"></span><br><span class="line">  /<span class="keyword">*</span><span class="keyword">*</span></span><br><span class="line">   <span class="keyword">*</span>  Create a list of message streams of type T for each topic, using the default decoder.</span><br><span class="line">   <span class="keyword">*</span>/</span><br><span class="line">  public Map<span class="variable">&lt;String, List&lt;KafkaStream&lt;byte[], byte[]&gt;</span>&gt;&gt; createMessageStreams(Map<span class="variable">&lt;String, Integer&gt;</span> topicCountMap);</span><br><span class="line"></span><br><span class="line">  /<span class="keyword">*</span><span class="keyword">*</span></span><br><span class="line">   <span class="keyword">*</span>  Create a list of message streams for topics matching a wildcard.</span><br><span class="line">   <span class="keyword">*</span></span><br><span class="line">   <span class="keyword">*</span>  <span class="comment">@param topicFilter a TopicFilter that specifies which topics to</span></span><br><span class="line">   <span class="keyword">*</span>                    subscribe to (encapsulates a whitelist or a blacklist).</span><br><span class="line">   <span class="keyword">*</span>  <span class="comment">@param numStreams the number of message streams to return.</span></span><br><span class="line">   <span class="keyword">*</span>  <span class="comment">@param keyDecoder a decoder that decodes the message key</span></span><br><span class="line">   <span class="keyword">*</span>  <span class="comment">@param valueDecoder a decoder that decodes the message itself</span></span><br><span class="line">   <span class="keyword">*</span>  <span class="comment">@return a list of KafkaStream. Each stream supports an</span></span><br><span class="line">   <span class="keyword">*</span>          iterator over its MessageAndMetadata elements.</span><br><span class="line">   <span class="keyword">*</span>/</span><br><span class="line">  public <span class="variable">&lt;K,V&gt;</span> List<span class="variable">&lt;KafkaStream&lt;K,V&gt;</span>&gt;</span><br><span class="line">    createMessageStreamsByFilter(TopicFilter topicFilter, int numStreams, Decoder<span class="variable">&lt;K&gt;</span> keyDecoder, Decoder<span class="variable">&lt;V&gt;</span> valueDecoder);</span><br><span class="line"></span><br><span class="line">  /<span class="keyword">*</span><span class="keyword">*</span></span><br><span class="line">   <span class="keyword">*</span>  Create a list of message streams for topics matching a wildcard, using the default decoder.</span><br><span class="line">   <span class="keyword">*</span>/</span><br><span class="line">  public List<span class="variable">&lt;KafkaStream&lt;byte[], byte[]&gt;</span>&gt; createMessageStreamsByFilter(TopicFilter topicFilter, int numStreams);</span><br><span class="line"></span><br><span class="line">  /<span class="keyword">*</span><span class="keyword">*</span></span><br><span class="line">   <span class="keyword">*</span>  Create a list of message streams for topics matching a wildcard, using the default decoder, with one stream.</span><br><span class="line">   <span class="keyword">*</span>/</span><br><span class="line">  public List<span class="variable">&lt;KafkaStream&lt;byte[], byte[]&gt;</span>&gt; createMessageStreamsByFilter(TopicFilter topicFilter);</span><br><span class="line"></span><br><span class="line">  /<span class="keyword">*</span><span class="keyword">*</span></span><br><span class="line">   <span class="keyword">*</span>  Commit the offsets of all topic/partitions connected by this connector.</span><br><span class="line">   <span class="keyword">*</span>/</span><br><span class="line">  public void commitOffsets();</span><br><span class="line"></span><br><span class="line">  /<span class="keyword">*</span><span class="keyword">*</span></span><br><span class="line">   <span class="keyword">*</span>  Shut down the connector</span><br><span class="line">   <span class="keyword">*</span>/</span><br><span class="line">  public void shutdown();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>You can follow this <a href="https://cwiki.apache.org/confluence/display/KAFKA/Consumer+Group+Example" target="_blank" rel="external">example</a> to learn how to use the high level consumer api.</p>
<h4 id="2-2-2_Old_Simple_Consumer_API"><a href="#2-2-2_Old_Simple_Consumer_API" class="headerlink" title="2.2.2 Old Simple Consumer API"></a>2.2.2 Old Simple Consumer API</h4><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">class kafka.javaapi.consumer.SimpleConsumer &#123;</span><br><span class="line">  /<span class="keyword">*</span><span class="keyword">*</span></span><br><span class="line">   <span class="keyword">*</span>  Fetch a set of messages from a topic.</span><br><span class="line">   <span class="keyword">*</span></span><br><span class="line">   <span class="keyword">*</span>  <span class="comment">@param request specifies the topic name, topic partition, starting byte offset, maximum bytes to be fetched.</span></span><br><span class="line">   <span class="keyword">*</span>  <span class="comment">@return a set of fetched messages</span></span><br><span class="line">   <span class="keyword">*</span>/</span><br><span class="line">  public FetchResponse fetch(kafka.javaapi.FetchRequest request);</span><br><span class="line"></span><br><span class="line">  /<span class="keyword">*</span><span class="keyword">*</span></span><br><span class="line">   <span class="keyword">*</span>  Fetch metadata for a sequence of topics.</span><br><span class="line">   <span class="keyword">*</span></span><br><span class="line">   <span class="keyword">*</span>  <span class="comment">@param request specifies the versionId, clientId, sequence of topics.</span></span><br><span class="line">   <span class="keyword">*</span>  <span class="comment">@return metadata for each topic in the request.</span></span><br><span class="line">   <span class="keyword">*</span>/</span><br><span class="line">  public kafka.javaapi.TopicMetadataResponse send(kafka.javaapi.TopicMetadataRequest request);</span><br><span class="line"></span><br><span class="line">  /<span class="keyword">*</span><span class="keyword">*</span></span><br><span class="line">   <span class="keyword">*</span>  Get a list of valid offsets (up to maxSize) before the given time.</span><br><span class="line">   <span class="keyword">*</span></span><br><span class="line">   <span class="keyword">*</span>  <span class="comment">@param request a [[kafka.javaapi.OffsetRequest]] object.</span></span><br><span class="line">   <span class="keyword">*</span>  <span class="comment">@return a [[kafka.javaapi.OffsetResponse]] object.</span></span><br><span class="line">   <span class="keyword">*</span>/</span><br><span class="line">  public kafka.javaapi.OffsetResponse getOffsetsBefore(OffsetRequest request);</span><br><span class="line"></span><br><span class="line">  /<span class="keyword">*</span><span class="keyword">*</span></span><br><span class="line">   <span class="keyword">*</span> Close the SimpleConsumer.</span><br><span class="line">   <span class="keyword">*</span>/</span><br><span class="line">  public void close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>For most applications, the high level consumer Api is good enough. Some applications want features not exposed to the high level consumer yet (e.g., set initial offset when restarting the consumer). They can instead use our low level SimpleConsumer Api. The logic will be a bit more complicated and you can follow the example in <a href="https://cwiki.apache.org/confluence/display/KAFKA/0.8.0+SimpleConsumer+Example" target="_blank" rel="external">here</a>.</p>
<h4 id="2-2-3_New_Consumer_API"><a href="#2-2-3_New_Consumer_API" class="headerlink" title="2.2.3 New Consumer API"></a>2.2.3 New Consumer API</h4><p>This new unified consumer API removes the distinction between the 0.8 high-level and low-level consumer APIs. You can use this client by adding a dependency on the client jar using the following example maven co-ordinates (you can change the version numbers with new releases):</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"> <span class="tag">&lt;<span class="title">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">groupId</span>&gt;</span>org.apache.kafka<span class="tag">&lt;/<span class="title">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">artifactId</span>&gt;</span>kafka-clients<span class="tag">&lt;/<span class="title">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">version</span>&gt;</span>0.9.0.0<span class="tag">&lt;/<span class="title">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>Examples showing how to use the consumer are given in the <a href="http://kafka.apache.org/090/javadoc/index.html?org/apache/kafka/clients/consumer/KafkaConsumer.html" target="_blank" rel="external">javadocs</a>.</p>
<h2 id="3-_Configuration"><a href="#3-_Configuration" class="headerlink" title="3. Configuration"></a>3. Configuration</h2><p>Kafka uses key-value pairs in the <a href="http://en.wikipedia.org/wiki/.properties" target="_blank" rel="external">property file format</a> for configuration. These values can be supplied either from a file or programmatically.</p>
<h3 id="3-1_Broker_Configs"><a href="#3-1_Broker_Configs" class="headerlink" title="3.1 Broker Configs"></a>3.1 Broker Configs</h3><p>The essential configurations are the following:</p>
<ul>
<li>broker.id</li>
<li>log.dirs</li>
<li>zookeeper.connect</li>
</ul>
<p>Topic-level configurations and defaults are discussed in more detail</p>
<p>Configurations pertinent to topics have both a global default as well an optional per-topic override. If no per-topic configuration is given the global default is used. The override can be set at topic creation time by giving one or more â€“config options. This example creates a topic named my-topic with a custom max message size and flush rate:</p>
<figure class="highlight brainfuck"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="comment">bin/kafka</span><span class="literal">-</span><span class="comment">topics</span><span class="string">.</span><span class="comment">sh</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">zookeeper</span> <span class="comment">localhost:2181</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">create</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">topic</span> <span class="comment">my</span><span class="literal">-</span><span class="comment">topic</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">partitions</span> <span class="comment">1</span></span><br><span class="line">        <span class="literal">-</span><span class="literal">-</span><span class="comment">replication</span><span class="literal">-</span><span class="comment">factor</span> <span class="comment">1</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">config</span> <span class="comment">max</span><span class="string">.</span><span class="comment">message</span><span class="string">.</span><span class="comment">bytes=64000</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">config</span> <span class="comment">flush</span><span class="string">.</span><span class="comment">messages=1</span></span><br></pre></td></tr></table></figure>
<p>Overrides can also be changed or set later using the alter topic command. This example updates the max message size for my-topic:</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; bin/kafka-topics<span class="class">.sh</span> --zookeeper localhost:<span class="number">2181</span> --alter --topic my-topic</span><br><span class="line">    --config max<span class="class">.message</span><span class="class">.bytes</span>=<span class="number">128000</span></span><br></pre></td></tr></table></figure>
<p>To remove an override you can do</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; bin/kafka-topics<span class="class">.sh</span> --zookeeper localhost:<span class="number">2181</span> --alter --topic my-topic</span><br><span class="line">    --deleteConfig max<span class="class">.message</span><span class="class">.bytes</span></span><br></pre></td></tr></table></figure>
<p>The following are the topic-level configurations. The serverâ€™s default configuration for this property is given under the Server Default Property heading, setting this default in the server config allows you to change the default given to topics that have no override specified.</p>
<h2 id="4-_Design"><a href="#4-_Design" class="headerlink" title="4. Design"></a>4. Design</h2><h3 id="4-1_Motivation"><a href="#4-1_Motivation" class="headerlink" title="4.1 Motivation"></a>4.1 Motivation</h3><p>We designed Kafka to be able to act as a unified platform for handling all the real-time data feeds a large company might have. To do this we had to think through a fairly broad set of use cases.</p>
<p>It would have to have high-throughput to support high volume event streams such as real-time log aggregation.</p>
<p>It would need to deal gracefully with large data backlogs to be able to support periodic data loads from offline systems.</p>
<p>It also meant the system would have to handle low-latency delivery to handle more traditional messaging use-cases.</p>
<p>We wanted to support partitioned, distributed, real-time processing of these feeds to create new, derived feeds. This motivated our partitioning and consumer model.</p>
<p>Finally in cases where the stream is fed into other data systems for serving we knew the system would have to be able to guarantee fault-tolerance in the presence of machine failures.</p>
<p>Supporting these uses led use to a design with a number of unique elements, more akin to a database log then a traditional messaging system. We will outline some elements of the design in the following sections.</p>
<h3 id="4-2_Persistence"><a href="#4-2_Persistence" class="headerlink" title="4.2 Persistence"></a>4.2 Persistence</h3><p><em>Donâ€™t fear the filesystem!</em></p>
<p>Kafka relies heavily on the filesystem for storing and caching messages. There is a general perception that â€œdisks are slowâ€ which makes people skeptical that a persistent structure can offer competitive performance. In fact disks are both much slower and much faster than people expect depending on how they are used; and a properly designed disk structure can often be as fast as the network.</p>
<p>The key fact about disk performance is that the throughput of hard drives has been diverging from the latency of a disk seek for the last decade. As a result the performance of linear writes on a <a href="http://en.wikipedia.org/wiki/Non-RAID_drive_architectures" target="_blank" rel="external">JBOD</a> configuration with six 7200rpm SATA RAID-5 array is about 600MB/sec but the performance of random writes is only about 100k/secâ€”a difference of over 6000X. These linear reads and writes are the most predictable of all usage patterns, and are heavily optimized by the operating system. A modern operating system provides read-ahead and write-behind techniques that prefetch data in large block multiples and group smaller logical writes into large physical writes. A further discussion of this issue can be found in this <a href="http://queue.acm.org/detail.cfm?id=1563874" target="_blank" rel="external">ACM Queue article</a>; they actually find that <a href="http://deliveryimages.acm.org/10.1145/1570000/1563874/jacobs3.jpg" target="_blank" rel="external">sequential disk access can in some cases be faster than random memory access</a>!</p>
<p>To compensate for this performance divergence modern operating systems have become increasingly aggressive in their use of main memory for disk caching. A modern OS will happily divert all free memory to disk caching with little performance penalty when the memory is reclaimed. All disk reads and writes will go through this unified cache. This feature cannot easily be turned off without using direct I/O, so even if a process maintains an in-process cache of the data, this data will likely be duplicated in OS pagecache, effectively storing everything twice.</p>
<p>Furthermore we are building on top of the JVM, and anyone who has spent any time with Java memory usage knows two things:</p>
<ol>
<li>The memory overhead of objects is very high, often doubling the size of the data stored (or worse).</li>
<li>Java garbage collection becomes increasingly fiddly and slow as the in-heap data increases.</li>
</ol>
<p>As a result of these factors using the filesystem and relying on pagecache is superior to maintaining an in-memory cache or other structureâ€”we at least double the available cache by having automatic access to all free memory, and likely double again by storing a compact byte structure rather than individual objects. Doing so will result in a cache of up to 28-30GB on a 32GB machine without GC penalties. Furthermore this cache will stay warm even if the service is restarted, whereas the in-process cache will need to be rebuilt in memory (which for a 10GB cache may take 10 minutes) or else it will need to start with a completely cold cache (which likely means terrible initial performance). This also greatly simplifies the code as all logic for maintaining coherency between the cache and filesystem is now in the OS, which tends to do so more efficiently and more correctly than one-off in-process attempts. If your disk usage favors linear reads then read-ahead is effectively pre-populating this cache with useful data on each disk read.</p>
<p>This suggests a design which is very simple: rather than maintain as much as possible in-memory and flush it all out to the filesystem in a panic when we run out of space, we invert that. All data is immediately written to a persistent log on the filesystem without necessarily flushing to disk. In effect this just means that it is transferred into the kernelâ€™s pagecache.</p>
<p>This style of pagecache-centric design is described in an article on the design of Varnish here (along with a healthy dose of arrogance).</p>
<p>Intuitively a persistent queue could be built on simple reads and appends to files as is commonly the case with logging solutions. This structure has the advantage that all operations are O(1) and reads do not block writes or each other. This has obvious performance advantages since the performance is completely decoupled from the data sizeâ€”one server can now take full advantage of a number of cheap, low-rotational speed 1+TB SATA drives. Though they have poor seek performance, these drives have acceptable performance for large reads and writes and come at 1/3 the price and 3x the capacity.</p>
<p>Having access to virtually unlimited disk space without any performance penalty means that we can provide some features not usually found in a messaging system. For example, in Kafka, instead of attempting to deleting messages as soon as they are consumed, we can retain messages for a relative long period (say a week). This leads to a great deal of flexibility for consumers, as we will describe.</p>
<h2 id="u53C2_u8003_u6587_u732E"><a href="#u53C2_u8003_u6587_u732E" class="headerlink" title="å‚è€ƒæ–‡çŒ®"></a>å‚è€ƒæ–‡çŒ®</h2><ul>
<li><a href="https://github.com/docs2cn/apache-kafka-docs/blob/master/index.md" target="_blank" rel="external">https://github.com/docs2cn/apache-kafka-docs/blob/master/index.md</a></li>
<li><a href="http://kafka.apache.org/documentation.html" target="_blank" rel="external">http://kafka.apache.org/documentation.html</a></li>
<li><a href="http://www.cnblogs.com/lzqhss/p/4434901.html" target="_blank" rel="external">http://www.cnblogs.com/lzqhss/p/4434901.html</a></li>
<li><a href="http://gfstart.blog.51cto.com/5081306/1414597" target="_blank" rel="external">http://gfstart.blog.51cto.com/5081306/1414597</a></li>
<li><a href="http://yclod.com/kafka-jie-shao/" target="_blank" rel="external">http://yclod.com/kafka-jie-shao/</a></li>
<li><a href="http://www.oschina.net/translate/kafka-design" target="_blank" rel="external">http://www.oschina.net/translate/kafka-design</a></li>
<li><a href="http://blog.csdn.net/beitiandijun/article/details/40582541" target="_blank" rel="external">http://blog.csdn.net/beitiandijun/article/details/40582541</a></li>
<li><a href="http://www.infoq.com/cn/articles/apache-kafka" target="_blank" rel="external">http://www.infoq.com/cn/articles/apache-kafka</a></li>
<li><a href="http://www.doczj.com/doc/20781790b52acfc788ebc955.html" target="_blank" rel="external">http://www.doczj.com/doc/20781790b52acfc788ebc955.html</a></li>
<li><a href="https://baniuyao.gitbooks.io/kafka-0-8-docs-chinese/content/1.1-introduction.html" target="_blank" rel="external">https://baniuyao.gitbooks.io/kafka-0-8-docs-chinese/content/1.1-introduction.html</a></li>
<li><a href="http://www.infoq.com/cn/articles/kafka-analysis-part-1" target="_blank" rel="external">http://www.infoq.com/cn/articles/kafka-analysis-part-1</a></li>
</ul>
]]></content>
    <summary type="html">
    <![CDATA[<!--  -->
<!--  -->
<!--  _ __    __     __      ____    ___     ___   _____   __  __    ___     -->
<!-- /\`'__\/'__`\ /'__`\   /',__\  / _]]>
    </summary>
    
      <category term="Documentation" scheme="http://reasonpun.com/tags/Documentation/"/>
    
      <category term="HDFS" scheme="http://reasonpun.com/tags/HDFS/"/>
    
      <category term="Kafka" scheme="http://reasonpun.com/tags/Kafka/"/>
    
      <category term="æ•°æ®æŒ–æ˜" scheme="http://reasonpun.com/categories/%E6%95%B0%E6%8D%AE%E6%8C%96%E6%8E%98/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[linux shell è·å¾—ä»¥å‰æ—¥æœŸ]]></title>
    <link href="http://reasonpun.com/2015/12/05/linux-shell-%E8%8E%B7%E5%BE%97%E4%BB%A5%E5%89%8D%E6%97%A5%E6%9C%9F/"/>
    <id>http://reasonpun.com/2015/12/05/linux-shell-è·å¾—ä»¥å‰æ—¥æœŸ/</id>
    <published>2015-12-05T07:26:55.000Z</published>
    <updated>2016-01-18T03:06:13.000Z</updated>
    <content type="html"><![CDATA[<!--  -->
<!--  -->
<!--  _ __    __     __      ____    ___     ___   _____   __  __    ___     -->
<!-- /\`'__\/'__`\ /'__`\   /',__\  / __`\ /' _ `\/\ '__`\/\ \/\ \ /' _ `\   -->
<!-- \ \ \//\  __//\ \L\.\_/\__, `\/\ \L\ \/\ \/\ \ \ \L\ \ \ \_\ \/\ \/\ \  -->
<!--  \ \_\\ \____\ \__/.\_\/\____/\ \____/\ \_\ \_\ \ ,__/\ \____/\ \_\ \_\ -->
<!--   \/_/ \/____/\/__/\/_/\/___/  \/___/  \/_/\/_/\ \ \/  \/___/  \/_/\/_/ -->
<!--                                                 \ \_\                   -->
<!--                                                  \/_/                   -->
<!--  -->
<p>åœ¨linux shellé‡Œï¼Œæˆ‘æƒ³è·å¾—ä»¥å‰çš„æ—¥æœŸï¼Œ<br>1ã€æ¯”å¦‚ï¼Œå»å¹´çš„ä¸Šä¸ªæœˆçš„æ˜¨å¤©çš„æ—¥æœŸï¼šï¼ˆä»Šå¤©æ˜¯2009å¹´2æœˆ2æ—¥ï¼Œä¹Ÿå°±æ˜¯2008å¹´1æœˆ1æ—¥ï¼‰</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">reasonpun<span class="variable">@reasonpun</span><span class="symbol">:~</span><span class="variable">$ </span>logRecordDate=<span class="string">"`date -d "</span>-<span class="number">1</span> year -<span class="number">1</span> month -<span class="number">1</span> day<span class="string">" "</span>+%<span class="constant">Y_%</span>m<span class="constant">_</span>%d<span class="string">"`"</span></span><br><span class="line">reasonpun<span class="variable">@reasonpun</span><span class="symbol">:~</span><span class="variable">$ </span>echo <span class="variable">$logRecordDate</span></span><br><span class="line"><span class="number">2008_01_01</span></span><br><span class="line">reasonpun<span class="variable">@reasonpun</span><span class="symbol">:~</span>$</span><br></pre></td></tr></table></figure>
<p>2ã€ä¸Šä¸ªæœˆçš„ä»Šå¤©ï¼š</p>
<figure class="highlight xquery"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">reasonpun@reasonpun:~$ logRecordDate=<span class="string">"`date -d "</span>-<span class="number">1</span> month<span class="string">" "</span>+<span class="decorator">%Y_</span><span class="decorator">%m_</span><span class="decorator">%d</span><span class="string">"`"</span></span><br><span class="line">reasonpun@reasonpun:~$ echo <span class="variable">$logRecordDate</span></span><br><span class="line"><span class="number">2009_01_02</span></span><br></pre></td></tr></table></figure>
<p>3ã€å»å¹´çš„ä»Šå¤©ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">reasonpun@reasonpun:~$ logRecordDate=<span class="string">"`date -d "</span>-<span class="number">1</span> yea<span class="string">r" "</span>+%Y_%m_%d<span class="string">"`"</span></span><br><span class="line">reasonpun@reasonpun:~$ echo $logRecordDate</span><br><span class="line"><span class="number">2008</span>_02_02</span><br></pre></td></tr></table></figure>
<p>4ã€ä¸Šä¸ªæœˆçš„æ˜¨å¤©ï¼š</p>
<figure class="highlight xquery"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">reasonpun@reasonpun:~$ logRecordDate=<span class="string">"`date -d "</span>-<span class="number">1</span> month -<span class="number">1</span> day<span class="string">" "</span>+<span class="decorator">%Y_</span><span class="decorator">%m_</span><span class="decorator">%d</span><span class="string">"`"</span></span><br><span class="line">reasonpun@reasonpun:~$ echo <span class="variable">$logRecordDate</span></span><br><span class="line"><span class="number">2009_01_01</span></span><br></pre></td></tr></table></figure>
<p>5ã€æ ¹æ®æ—¶é—´æˆ³è½¬æ¢æˆæ—¥æœŸ</p>
<figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[mofun_mining<span class="variable">@i</span>-qe32ajmq ~]$ date -d <span class="variable">@1434847028</span> <span class="string">"+<span class="variable">%Y</span>-<span class="variable">%m</span>-<span class="variable">%d</span>"</span></span><br><span class="line"><span class="number">2015</span>-<span class="number">06</span>-<span class="number">21</span></span><br></pre></td></tr></table></figure>
<p>å…¶ä»–çš„ç±»æ¨ï½ï½å‘µå‘µï¼Œè¿˜æ˜¯å¸Œæœ›å¤§å®¶ç»™æµ‹æµ‹å…¶ä»–æ—¥æœŸä¼šä¸ä¼šå‡ºé”™å‘µå‘µã€‚å¤šè°¢ï½ï½ï½<br>é¼“æ£ä¹‹ç¯å¢ƒï¼šubuntu8.04</p>
<p>å¦é™„ä¸Šwindowsä¸‹è·å¾—å‰ä¸€å¤©çš„æ—¥æœŸï¼š</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line">@echo off</span><br><span class="line"><span class="built_in">set</span> td=%date:~<span class="number">2</span>,<span class="number">2</span>%%date:~<span class="number">5</span>,<span class="number">2</span>%%date:~<span class="number">8</span>,<span class="number">2</span>%</span><br><span class="line"><span class="built_in">set</span> dy=%date:~<span class="number">0</span>,<span class="number">4</span>%</span><br><span class="line"><span class="built_in">set</span> dm=%date:~<span class="number">5</span>,<span class="number">2</span>%</span><br><span class="line"><span class="built_in">set</span> dd=%date:~<span class="number">8</span>,<span class="number">2</span>%</span><br><span class="line"><span class="built_in">set</span> da=%date:~<span class="number">8</span>,<span class="number">2</span>%</span><br><span class="line"><span class="keyword">if</span> %dm%%dd%==<span class="number">0101</span> <span class="keyword">goto</span> L01</span><br><span class="line"><span class="keyword">if</span> %dm%%dd%==<span class="number">0201</span> <span class="keyword">goto</span> L02</span><br><span class="line"><span class="keyword">if</span> %dm%%dd%==<span class="number">0301</span> <span class="keyword">goto</span> L07</span><br><span class="line"><span class="keyword">if</span> %dm%%dd%==<span class="number">0401</span> <span class="keyword">goto</span> L02</span><br><span class="line"><span class="keyword">if</span> %dm%%dd%==<span class="number">0501</span> <span class="keyword">goto</span> L04</span><br><span class="line"><span class="keyword">if</span> %dm%%dd%==<span class="number">0601</span> <span class="keyword">goto</span> L02</span><br><span class="line"><span class="keyword">if</span> %dm%%dd%==<span class="number">0701</span> <span class="keyword">goto</span> L04</span><br><span class="line"><span class="keyword">if</span> %dm%%dd%==<span class="number">0801</span> <span class="keyword">goto</span> L02</span><br><span class="line"><span class="keyword">if</span> %dm%%dd%==<span class="number">0901</span> <span class="keyword">goto</span> L02</span><br><span class="line"><span class="keyword">if</span> %dm%%dd%==<span class="number">1001</span> <span class="keyword">goto</span> L05</span><br><span class="line"><span class="keyword">if</span> %dm%%dd%==<span class="number">1101</span> <span class="keyword">goto</span> L03</span><br><span class="line"><span class="keyword">if</span> %dm%%dd%==<span class="number">1201</span> <span class="keyword">goto</span> L06</span><br><span class="line"><span class="keyword">if</span> %dd%==<span class="number">02</span> <span class="keyword">goto</span> L10</span><br><span class="line"><span class="keyword">if</span> %dd%==<span class="number">03</span> <span class="keyword">goto</span> L10</span><br><span class="line"><span class="keyword">if</span> %dd%==<span class="number">04</span> <span class="keyword">goto</span> L10</span><br><span class="line"><span class="keyword">if</span> %dd%==<span class="number">05</span> <span class="keyword">goto</span> L10</span><br><span class="line"><span class="keyword">if</span> %dd%==<span class="number">06</span> <span class="keyword">goto</span> L10</span><br><span class="line"><span class="keyword">if</span> %dd%==<span class="number">07</span> <span class="keyword">goto</span> L10</span><br><span class="line"><span class="keyword">if</span> %dd%==<span class="number">08</span> <span class="keyword">goto</span> L10</span><br><span class="line"><span class="keyword">if</span> %dd%==<span class="number">09</span> <span class="keyword">goto</span> L10</span><br><span class="line"><span class="keyword">if</span> %dd%==<span class="number">10</span> <span class="keyword">goto</span> L11</span><br><span class="line"><span class="built_in">set</span> /A dd=dd-<span class="number">1</span></span><br><span class="line"><span class="built_in">set</span> dt=%dy%-%dm%-%dd%</span><br><span class="line"><span class="keyword">goto</span> END</span><br><span class="line">:L10</span><br><span class="line"><span class="built_in">set</span> /A dd=%dd:~<span class="number">1</span>,<span class="number">1</span>%-<span class="number">1</span></span><br><span class="line"><span class="built_in">set</span> dt=%dy%-%dm%-<span class="number">0</span>%dd%</span><br><span class="line"><span class="keyword">goto</span> END</span><br><span class="line">:L11</span><br><span class="line"><span class="built_in">set</span> dt=%dy%-%dm%-<span class="number">09</span></span><br><span class="line"><span class="keyword">goto</span> END</span><br><span class="line">:L02</span><br><span class="line"><span class="built_in">set</span> /A dm=%dm:~<span class="number">1</span>,<span class="number">1</span>%-<span class="number">1</span></span><br><span class="line"><span class="built_in">set</span> dt=%dy%-<span class="number">0</span>%dm%-<span class="number">31</span></span><br><span class="line"><span class="keyword">goto</span> END</span><br><span class="line">:L04</span><br><span class="line"><span class="built_in">set</span> /A dm=dm-<span class="number">1</span></span><br><span class="line"><span class="built_in">set</span> dt=%dy%-<span class="number">0</span>%dm%-<span class="number">30</span></span><br><span class="line"><span class="keyword">goto</span> END</span><br><span class="line">:L05</span><br><span class="line"><span class="built_in">set</span> dt=%dy%-<span class="number">09</span>-<span class="number">30</span></span><br><span class="line"><span class="keyword">goto</span> END</span><br><span class="line">:L03</span><br><span class="line"><span class="built_in">set</span> dt=%dy%-<span class="number">10</span>-<span class="number">31</span></span><br><span class="line"><span class="keyword">goto</span> END</span><br><span class="line">:L06</span><br><span class="line"><span class="built_in">set</span> dt=%dy%-<span class="number">11</span>-<span class="number">30</span></span><br><span class="line"><span class="keyword">goto</span> END</span><br><span class="line">:L01</span><br><span class="line"><span class="built_in">set</span> /A dy=dy-<span class="number">1</span></span><br><span class="line"><span class="built_in">set</span> dt=%dy%-<span class="number">12</span>-<span class="number">31</span></span><br><span class="line"><span class="keyword">goto</span> END</span><br><span class="line">:L07</span><br><span class="line"><span class="built_in">set</span> /A <span class="string">"dd=dy%%4"</span></span><br><span class="line"><span class="keyword">if</span> not %dd%==<span class="number">0</span> <span class="keyword">goto</span> L08</span><br><span class="line"><span class="built_in">set</span> /A <span class="string">"dd=dy%%100"</span></span><br><span class="line"><span class="keyword">if</span> not %dd%==<span class="number">0</span> <span class="keyword">goto</span> L09</span><br><span class="line"><span class="built_in">set</span> /A <span class="string">"dd=dy%%400"</span></span><br><span class="line"><span class="keyword">if</span> %dd%==<span class="number">0</span> <span class="keyword">goto</span> L09</span><br><span class="line">:L08</span><br><span class="line"><span class="built_in">set</span> dt=%dy%-<span class="number">02</span>-<span class="number">28</span></span><br><span class="line"><span class="keyword">goto</span> END</span><br><span class="line">:L09</span><br><span class="line"><span class="built_in">set</span> dt=%dy%-<span class="number">02</span>-<span class="number">29</span></span><br><span class="line"><span class="keyword">goto</span> END</span><br><span class="line">:END</span><br><span class="line"><span class="built_in">set</span> dateTime=<span class="number">20</span>%dt:~<span class="number">2</span>,<span class="number">2</span>%%dt:~<span class="number">5</span>,<span class="number">2</span>%%dt:~<span class="number">8</span>,<span class="number">2</span>%</span><br></pre></td></tr></table></figure>
]]></content>
    <summary type="html">
    <![CDATA[<!--  -->
<!--  -->
<!--  _ __    __     __      ____    ___     ___   _____   __  __    ___     -->
<!-- /\`'__\/'__`\ /'__`\   /',__\  / _]]>
    </summary>
    
      <category term="Linux" scheme="http://reasonpun.com/tags/Linux/"/>
    
      <category term="Shell" scheme="http://reasonpun.com/tags/Shell/"/>
    
      <category term="ç³»ç»Ÿç»´æŠ¤" scheme="http://reasonpun.com/categories/%E7%B3%BB%E7%BB%9F%E7%BB%B4%E6%8A%A4/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[Dockerä¸­æ­å»ºSparkè®¡ç®—æ¡†æ¶]]></title>
    <link href="http://reasonpun.com/2015/12/04/spark-in-docker/"/>
    <id>http://reasonpun.com/2015/12/04/spark-in-docker/</id>
    <published>2015-12-04T09:48:17.000Z</published>
    <updated>2016-01-25T03:17:11.000Z</updated>
    <content type="html"><![CDATA[<!--  -->
<!--  -->
<!--  _ __    __     __      ____    ___     ___   _____   __  __    ___     -->
<!-- /\`'__\/'__`\ /'__`\   /',__\  / __`\ /' _ `\/\ '__`\/\ \/\ \ /' _ `\   -->
<!-- \ \ \//\  __//\ \L\.\_/\__, `\/\ \L\ \/\ \/\ \ \ \L\ \ \ \_\ \/\ \/\ \  -->
<!--  \ \_\\ \____\ \__/.\_\/\____/\ \____/\ \_\ \_\ \ ,__/\ \____/\ \_\ \_\ -->
<!--   \/_/ \/____/\/__/\/_/\/___/  \/___/  \/_/\/_/\ \ \/  \/___/  \/_/\/_/ -->
<!--                                                 \ \_\                   -->
<!--                                                  \/_/                   -->
<!--  -->
<h4 id="u5B89_u88C5_u597DDocker_u4E4B_u540E"><a href="#u5B89_u88C5_u597DDocker_u4E4B_u540E" class="headerlink" title="å®‰è£…å¥½Dockerä¹‹å"></a>å®‰è£…å¥½Dockerä¹‹å</h4><h4 id="u5148_u62C9_u53D6_u4E00_u4E2A_u5B98_u65B9_u7684_u57FA_u672C_u955C_u50CFubuntu"><a href="#u5148_u62C9_u53D6_u4E00_u4E2A_u5B98_u65B9_u7684_u57FA_u672C_u955C_u50CFubuntu" class="headerlink" title="å…ˆæ‹‰å–ä¸€ä¸ªå®˜æ–¹çš„åŸºæœ¬é•œåƒubuntu"></a>å…ˆæ‹‰å–ä¸€ä¸ªå®˜æ–¹çš„åŸºæœ¬é•œåƒubuntu</h4><p>docker pull ubuntu</p>
<p>æˆ‘ä»¬å°†åœ¨è¿™ä¸ªåŸºç¡€é•œåƒä¸Šè¿è¡Œå®¹å™¨ï¼Œå°†è¿™ä¸ªå®¹å™¨å½“æˆä¸€ä¸ªæ™®é€šçš„ubuntuè™šæ‹Ÿæœºæ¥æ“ä½œéƒ¨ç½²sparkï¼Œæœ€åå°†é…ç½®å¥½çš„å®¹å™¨commitä¸ºä¸€ä¸ªé•œåƒï¼Œä¹‹åå°±å¯ä»¥é€šè¿‡è¿™ä¸ªé•œåƒè¿è¡Œnä¸ªèŠ‚ç‚¹æ¥å®Œæˆé›†ç¾¤çš„æ­å»º</p>
<h4 id="u4E0B_u8F7D_u5B8Cubuntu_u955C_u50CF_u4E4B_u540E_u8FD0_u884C"><a href="#u4E0B_u8F7D_u5B8Cubuntu_u955C_u50CF_u4E4B_u540E_u8FD0_u884C" class="headerlink" title="ä¸‹è½½å®Œubuntué•œåƒä¹‹åè¿è¡Œ"></a>ä¸‹è½½å®Œubuntué•œåƒä¹‹åè¿è¡Œ</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[reason@localhost ~]$ docker images</span><br><span class="line">REPOSITORY          TAG                 IMAGE ID            CREATED             VIRTUAL SIZE</span><br><span class="line">mofun/spark         v2<span class="number">.0</span>                b2dacac3e132        About an hour ago   <span class="number">1.508</span> GB</span><br><span class="line">mofun/spark         v1<span class="number">.3</span>                <span class="number">4</span>d2f33ca61ee        <span class="number">18</span> hours ago        <span class="number">1.506</span> GB</span><br><span class="line">ubuntu              latest              <span class="number">0</span>a17decee413        <span class="number">6</span> days ago          <span class="number">188.3</span> MB</span><br><span class="line">docker/whalesay     latest              ded5e192a685        <span class="number">4</span> months ago        <span class="number">247</span> MB</span><br><span class="line">[reason@localhost ~]$</span><br></pre></td></tr></table></figure>
<h4 id="u8FD0_u884Cubuntu_u5BB9_u5668"><a href="#u8FD0_u884Cubuntu_u5BB9_u5668" class="headerlink" title="è¿è¡Œubuntuå®¹å™¨"></a>è¿è¡Œubuntuå®¹å™¨</h4><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[reason<span class="variable">@localhost</span> ~]<span class="variable">$ </span>docker run -v /home/docker/software/<span class="symbol">:/software</span> -it ubuntu</span><br><span class="line">root<span class="variable">@f4c0a9d42852</span><span class="symbol">:/</span><span class="comment">#</span></span><br></pre></td></tr></table></figure>
<h4 id="u5728_u5BB9_u5668_u4E2D_u5B89_u88C5ssh"><a href="#u5728_u5BB9_u5668_u4E2D_u5B89_u88C5ssh" class="headerlink" title="åœ¨å®¹å™¨ä¸­å®‰è£…ssh"></a>åœ¨å®¹å™¨ä¸­å®‰è£…ssh</h4><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">[reason<span class="comment">@localhost ~]$ docker run -v /home/docker/software/:/software -it ubuntu</span></span><br><span class="line">root<span class="comment">@3970c1e5466e:/# apt-get install ssh</span></span><br><span class="line">Reading package lists... Done</span><br><span class="line">Building dependency tree</span><br><span class="line">Reading state information... Done</span><br><span class="line"></span><br><span class="line"><span class="comment"># sshé»˜è®¤é…ç½®rootæ— æ³•ç™»é™†</span></span><br><span class="line">root<span class="comment">@3970c1e5466e:~/.ssh# vim /etc/ssh/sshd_config</span></span><br><span class="line">root<span class="comment">@3970c1e5466e:~/.ssh#</span></span><br><span class="line"><span class="comment"># å°† /etc/ssh/sshd_configä¸­PermitRootLogin no/without_passwd æ”¹ä¸ºyes</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç”Ÿæˆè®¿é—®å¯†é’¥</span></span><br><span class="line">root<span class="comment">@3970c1e5466e:~# ssh-keygen -t rsa -P '' -f ~/.ssh/id_rsa</span></span><br><span class="line">Generating public/private rsa key pair.</span><br><span class="line">Created directory '/root/.ssh'.</span><br><span class="line">Your identification has been saved in /root/.ssh/id_rsa.</span><br><span class="line">Your public key has been saved in /root/.ssh/id_rsa.pub.</span><br><span class="line">The key fingerprint is:</span><br><span class="line">b5:d1:e1:dd:98:7d:be:cc:55:69:c6:e7:67:80:d8:d3 root<span class="comment">@3970c1e5466e</span></span><br><span class="line">The key's randomart image is:</span><br><span class="line">+--[ RSA 2048]----+</span><br><span class="line">|<span class="string">            .    </span>|</span><br><span class="line">|<span class="string">           = =.=.</span>|</span><br><span class="line">|<span class="string">          + * E=*</span>|</span><br><span class="line">|<span class="string">         . o .o++</span>|</span><br><span class="line">|<span class="string">        S .     *</span>|</span><br><span class="line">|<span class="string">              o.+</span>|</span><br><span class="line">|<span class="string">               + </span>|</span><br><span class="line">|<span class="string">                 </span>|</span><br><span class="line">|<span class="string">                 </span>|</span><br><span class="line">+-----------------+</span><br><span class="line">root<span class="comment">@3970c1e5466e:~#</span></span><br><span class="line">root<span class="comment">@3970c1e5466e:~# cd ~/.ssh/</span></span><br><span class="line">root<span class="comment">@3970c1e5466e:~/.ssh# cat id_rsa.pub &gt;&gt; authorized_keys</span></span><br><span class="line">root<span class="comment">@3970c1e5466e:~/.ssh#</span></span><br><span class="line">root<span class="comment">@3970c1e5466e:~/.ssh# vim ~/.bashrc</span></span><br><span class="line"><span class="comment">#åŠ å…¥/usr/sbin/sshd</span></span><br><span class="line"><span class="comment">#å¦‚æœåœ¨å¯åŠ¨å®¹å™¨çš„æ—¶å€™è¿˜æ˜¯æ— æ³•å¯åŠ¨sshçš„è¯ï¼Œ</span></span><br><span class="line"><span class="comment"># åœ¨/etc/rc.localæ–‡ä»¶ä¸­ä¹ŸåŠ å…¥</span></span><br><span class="line">root<span class="comment">@3970c1e5466e:~/.ssh# vim /etc/rc.local</span></span><br><span class="line"><span class="comment">#åŠ å…¥</span></span><br><span class="line">root<span class="comment">@3970c1e5466e:~/.ssh# /usr/sbin/sshd</span></span><br><span class="line">Missing privilege separation directory: /var/run/sshd</span><br><span class="line">root<span class="comment">@3970c1e5466e:~/.ssh# mkdir /var/run/sshd</span></span><br><span class="line">root<span class="comment">@3970c1e5466e:~/.ssh# /usr/sbin/sshd</span></span><br><span class="line">root<span class="comment">@3970c1e5466e:~/.ssh#</span></span><br><span class="line"><span class="comment"># å¼€å¯sshæœåŠ¡åéªŒè¯æ˜¯å¦å¯ä»¥ä½¿ç”¨ï¼Œæ‰“å°å‡ºå½“å‰æ—¶é—´</span></span><br><span class="line">root<span class="comment">@3970c1e5466e:~/.ssh# ssh localhost date</span></span><br><span class="line">The authenticity of host 'localhost (::1)' can't be established.</span><br><span class="line">ECDSA key fingerprint is ab:43:27:e6:1c:44:be:2c:f1:17:27:90:6d:2c:68:86.</span><br><span class="line">Are you sure you want to continue connecting (yes/no)? yes</span><br><span class="line">Warning: Permanently added 'localhost' (ECDSA) to the list of known hosts.</span><br><span class="line">Mon Oct 19 05:57:44 UTC 2015</span><br><span class="line">root<span class="comment">@3970c1e5466e:~/.ssh#</span></span><br><span class="line"><span class="comment"># sshå®‰è£…å®Œæ¯•</span></span><br></pre></td></tr></table></figure>
<h4 id="u5B89_u88C5JDK"><a href="#u5B89_u88C5JDK" class="headerlink" title="å®‰è£…JDK"></a>å®‰è£…JDK</h4><p>å¯ä»¥ä½¿ç”¨apt-getæ–¹å¼ç›´æ¥ä¸‹è½½å®‰è£…jdkï¼ˆä¸æ¨èï¼Œä¸‹è½½é€Ÿåº¦æ…¢ï¼Œæœ‰å¯èƒ½è¿˜ä¼šå¤±è´¥ï¼‰<br>è¿™é‡Œé€‰æ‹©ä»ç½‘ä¸Šä¸‹è½½å®Œjdk-8u60-linux-xx.binä¹‹å<br>å°†å…¶ä¼ åˆ°Ubuntuå®¿ä¸»æœºä¸­ï¼Œåœ¨è¿è¡Œå®¹å™¨çš„æ—¶å€™ä½¿ç”¨-vå‚æ•°å°†å®¿ä¸»æœºä¸Šçš„ç›®å½•æ˜ å°„åˆ°å®¹å™¨ä¸­ï¼Œè¿™æ ·åœ¨å®¹å™¨ä¸­å°±å¯ä»¥è®¿é—®åˆ°å®¿ä¸»æœºä¸­çš„æ–‡ä»¶äº†</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">å¦‚æœæç¤ºä¸èƒ½å®‰è£….binæ–‡ä»¶ï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å³å¯è§£å†³</span><br><span class="line">root<span class="variable">@3970c1e5466e</span><span class="symbol">:~/</span>.ssh<span class="comment"># apt-get update</span></span><br><span class="line">root<span class="variable">@3970c1e5466e</span><span class="symbol">:~/</span>.ssh<span class="comment"># apt-getinstall g++-multilib</span></span><br></pre></td></tr></table></figure>
<h4 id="u5B89_u88C5Zookeeper"><a href="#u5B89_u88C5Zookeeper" class="headerlink" title="å®‰è£…Zookeeper"></a>å®‰è£…Zookeeper</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">å°†ä¸‹è½½å¥½çš„zookeeper-<span class="number">3.4</span><span class="number">.6</span>.tar.gzä¸Šä¼ </span><br><span class="line">root@<span class="number">3970</span>c1e5466e:~/.ssh<span class="preprocessor"># mv /software/zookeeper-<span class="number">3.4</span><span class="number">.6</span>.tar.gz /usr/local/zookeeper-<span class="number">3.4</span><span class="number">.6</span></span></span><br><span class="line">root@<span class="number">3970</span>c1e5466e:~/.ssh<span class="preprocessor"># tar -zxvf zookeeper-<span class="number">3.4</span><span class="number">.6</span>.tar.gz</span></span><br><span class="line">root@<span class="number">3970</span>c1e5466e:~/.ssh<span class="preprocessor"># cd /usr/local/zookeeper-<span class="number">3.4</span><span class="number">.6</span>/conf/</span></span><br><span class="line">root@<span class="number">3970</span>c1e5466e:~/.ssh<span class="preprocessor"># cp zoo_sample.cfgzoo.cfgvim zoo.cfg</span></span><br><span class="line">root@<span class="number">3970</span>c1e5466e:~/.ssh<span class="preprocessor"># vim zoo.cfg</span></span><br><span class="line"><span class="preprocessor">#ä¿®æ”¹ï¼šdataDir=/root/zookeeper/tmp</span></span><br><span class="line"><span class="preprocessor">#åœ¨æœ€åæ·»åŠ ï¼š</span></span><br><span class="line">server<span class="number">.1</span>=cloud4:<span class="number">2888</span>:<span class="number">3888</span></span><br><span class="line">server<span class="number">.2</span>=cloud5:<span class="number">2888</span>:<span class="number">3888</span></span><br><span class="line">server<span class="number">.3</span>=cloud6:<span class="number">2888</span>:<span class="number">3888</span></span><br><span class="line"></span><br><span class="line"><span class="preprocessor">#ä¿å­˜é€€å‡ºï¼Œç„¶ååˆ›å»ºä¸€ä¸ªtmpæ–‡ä»¶å¤¹</span></span><br><span class="line">root@<span class="number">3970</span>c1e5466e:~/.ssh<span class="preprocessor"># mkdir /data/zookeeper/tmp</span></span><br><span class="line"><span class="preprocessor">#å†åˆ›å»ºä¸€ä¸ªç©ºæ–‡ä»¶</span></span><br><span class="line">root@<span class="number">3970</span>c1e5466e:~/.ssh<span class="preprocessor"># touch /data/zookeeper/tmp/myid</span></span><br><span class="line"><span class="preprocessor">#æœ€åå‘è¯¥æ–‡ä»¶å†™å…¥ID</span></span><br><span class="line">root@<span class="number">3970</span>c1e5466e:~/.ssh<span class="preprocessor"># echo <span class="number">1</span>&gt; /data/zookeeper/tmp/myid</span></span><br></pre></td></tr></table></figure>
<h4 id="u5B89_u88C5Hadoop"><a href="#u5B89_u88C5Hadoop" class="headerlink" title="å®‰è£…Hadoop"></a>å®‰è£…Hadoop</h4><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root<span class="variable">@3970c1e5466e</span><span class="symbol">:~/</span>.ssh<span class="comment"># mv /software/hadoop-2.6.1.tar.gz /usr/local/</span></span><br><span class="line">root<span class="variable">@3970c1e5466e</span><span class="symbol">:~/</span>.ssh<span class="comment"># tar -zxvf hadoop-2.2.0-64bit.tar.gz</span></span><br><span class="line">root<span class="variable">@3970c1e5466e</span><span class="symbol">:~/</span>.ssh<span class="comment"># cd /usr/local/hadoop/etc/hadoop</span></span><br></pre></td></tr></table></figure>
<p>æ›´æ”¹hadoop-env.sh</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">root<span class="variable">@3970c1e5466e</span><span class="symbol">:/data/test</span><span class="comment"># cd /usr/local/hadoop-2.6.1/</span></span><br><span class="line">root<span class="variable">@3970c1e5466e</span><span class="symbol">:/usr/local/hadoop-</span><span class="number">2.6</span>.<span class="number">1</span><span class="comment"># ls</span></span><br><span class="line"><span class="constant">LICENSE</span>.txt  <span class="constant">NOTICE</span>.txt  <span class="constant">README</span>.txt  bin  etc  <span class="keyword">include</span>  lib  libexec  logs  sbin  share</span><br><span class="line">root<span class="variable">@3970c1e5466e</span><span class="symbol">:/usr/local/hadoop-</span><span class="number">2.6</span>.<span class="number">1</span><span class="comment"># cd etc/hadoop/</span></span><br><span class="line">root<span class="variable">@3970c1e5466e</span><span class="symbol">:/usr/local/hadoop-</span><span class="number">2.6</span>.<span class="number">1</span>/etc/hadoop<span class="comment"># vim hadoop-env.sh</span></span><br><span class="line"><span class="comment">#åŠ å…¥javaç¯å¢ƒå˜é‡</span></span><br><span class="line">export <span class="constant">JAVA_HOME</span>=<span class="regexp">/usr/local</span><span class="regexp">/jdk1.8.0_60</span></span><br></pre></td></tr></table></figure>
<p>ä¿®æ”¹core-site.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">root@3970c1e5466e:/usr/local/hadoop-2.6.1/etc/hadoop# vim core-site.xml</span><br><span class="line"></span><br><span class="line"><span class="pi">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="pi">&lt;?xml-stylesheet type="text/xsl" href="configuration.xsl"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">configuration</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="title">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">name</span>&gt;</span>fs.defaultFS<span class="tag">&lt;/<span class="title">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">value</span>&gt;</span>hdfs://ns1<span class="tag">&lt;/<span class="title">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">name</span>&gt;</span>hadoop.tmp.dir<span class="tag">&lt;/<span class="title">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">value</span>&gt;</span>/data/hadoop/tmp<span class="tag">&lt;/<span class="title">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">name</span>&gt;</span>ha.zookeeper.quorum<span class="tag">&lt;/<span class="title">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">value</span>&gt;</span>cloud4:2181,cloud5:2182,cloud6:2183<span class="tag">&lt;/<span class="title">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>ä¿®æ”¹hdfs-site.xml, mapred-site.xml, yarn-site.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line">root@3970c1e5466e:/usr/local/hadoop-2.6.1/etc/hadoop# vim hdfs-site.xml</span><br><span class="line"><span class="pi">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="pi">&lt;?xml-stylesheet type="text/xsl" href="configuration.xsl"?&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="title">configuration</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">name</span>&gt;</span>dfs.nameservices<span class="tag">&lt;/<span class="title">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">value</span>&gt;</span>ns1<span class="tag">&lt;/<span class="title">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">name</span>&gt;</span>dfs.ha.namenodes.ns1<span class="tag">&lt;/<span class="title">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">value</span>&gt;</span>nn1,nn2<span class="tag">&lt;/<span class="title">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">name</span>&gt;</span>dfs.namenode.rpc-address.ns1.nn1<span class="tag">&lt;/<span class="title">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">value</span>&gt;</span>cloud1:9000<span class="tag">&lt;/<span class="title">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">name</span>&gt;</span>dfs.namenode.http-address.ns1.nn1<span class="tag">&lt;/<span class="title">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">value</span>&gt;</span>cloud1:50070<span class="tag">&lt;/<span class="title">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">name</span>&gt;</span>dfs.namenode.rpc-address.ns1.nn2<span class="tag">&lt;/<span class="title">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">value</span>&gt;</span>cloud2:9000<span class="tag">&lt;/<span class="title">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">name</span>&gt;</span>dfs.namenode.http-address.ns1.nn2<span class="tag">&lt;/<span class="title">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">value</span>&gt;</span>cloud2:50070<span class="tag">&lt;/<span class="title">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">name</span>&gt;</span>dfs.namenode.shared.edits.dir<span class="tag">&lt;/<span class="title">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">value</span>&gt;</span>qjournal://cloud4:8485;cloud5:8485;cloud6:8485/ns1<span class="tag">&lt;/<span class="title">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">name</span>&gt;</span>dfs.journalnode.edits.dir<span class="tag">&lt;/<span class="title">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">value</span>&gt;</span>/data/hadoop/journal<span class="tag">&lt;/<span class="title">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">name</span>&gt;</span>dfs.ha.automatic-failover.enabled<span class="tag">&lt;/<span class="title">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">value</span>&gt;</span>true<span class="tag">&lt;/<span class="title">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">name</span>&gt;</span>dfs.client.failover.proxy.provider.ns1<span class="tag">&lt;/<span class="title">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">value</span>&gt;</span></span><br><span class="line">org.apache.hadoop.hdfs.server.namenode.ha.ConfiguredFailoverProxyProvider</span><br><span class="line"><span class="tag">&lt;/<span class="title">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">name</span>&gt;</span>dfs.ha.fencing.methods<span class="tag">&lt;/<span class="title">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">value</span>&gt;</span></span><br><span class="line">sshfence</span><br><span class="line"><span class="tag">&lt;/<span class="title">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">name</span>&gt;</span>dfs.ha.fencing.ssh.private-key-files<span class="tag">&lt;/<span class="title">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">value</span>&gt;</span>/root/.ssh/id_rsa<span class="tag">&lt;/<span class="title">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">name</span>&gt;</span>dfs.ha.fencing.ssh.connect-timeout<span class="tag">&lt;/<span class="title">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">value</span>&gt;</span>30000<span class="tag">&lt;/<span class="title">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">name</span>&gt;</span>dfs.namenode.name.dir<span class="tag">&lt;/<span class="title">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">value</span>&gt;</span>file:///data/hadoop/workspace/hdfs/name<span class="tag">&lt;/<span class="title">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="title">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">name</span>&gt;</span>dfs.datanode.data.dir<span class="tag">&lt;/<span class="title">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">value</span>&gt;</span>file:///data/hadoop/workspace/hdfs/data<span class="tag">&lt;/<span class="title">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="title">property</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="title">name</span>&gt;</span>dfs.replication<span class="tag">&lt;/<span class="title">name</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="title">value</span>&gt;</span>2<span class="tag">&lt;/<span class="title">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">root@3970c1e5466e:/usr/local/hadoop-2.6.1/etc/hadoop# mv mapred-site.xml.template mapred-site.xml</span><br><span class="line">root@3970c1e5466e:/usr/local/hadoop-2.6.1/etc/hadoop# vim mapred-site.xml</span><br><span class="line"><span class="pi">&lt;?xml version="1.0"?&gt;</span></span><br><span class="line"><span class="pi">&lt;?xml-stylesheet type="text/xsl" href="configuration.xsl"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">configuration</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="title">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">name</span>&gt;</span>mapreduce.framework.name<span class="tag">&lt;/<span class="title">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">value</span>&gt;</span>yarn<span class="tag">&lt;/<span class="title">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">root@3970c1e5466e:/usr/local/hadoop-2.6.1/etc/hadoop# vim yarn-site.xml</span><br><span class="line"><span class="pi">&lt;?xml version="1.0"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">configuration</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="title">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">name</span>&gt;</span>yarn.resourcemanager.hostname<span class="tag">&lt;/<span class="title">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">value</span>&gt;</span>cloud3<span class="tag">&lt;/<span class="title">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">name</span>&gt;</span>yarn.nodemanager.aux-services<span class="tag">&lt;/<span class="title">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">value</span>&gt;</span>mapreduce_shuffle<span class="tag">&lt;/<span class="title">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="title">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">root<span class="variable">@3970c1e5466e</span><span class="symbol">:/usr/local/hadoop-</span><span class="number">2.6</span>.<span class="number">1</span>/etc/hadoop<span class="comment"># vim slaves</span></span><br><span class="line">cloud1</span><br><span class="line">cloud2</span><br><span class="line">cloud3</span><br><span class="line">cloud4</span><br><span class="line">cloud5</span><br><span class="line">cloud6</span><br></pre></td></tr></table></figure>
<h4 id="u5B89_u88C5Spark"><a href="#u5B89_u88C5Spark" class="headerlink" title="å®‰è£…Spark"></a>å®‰è£…Spark</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">root@<span class="number">3970</span>c1e5466e:~/.ssh<span class="preprocessor"># mv /software/scala-<span class="number">2.11</span><span class="number">.7</span> /usr/local/</span></span><br><span class="line">root@<span class="number">3970</span>c1e5466e:~/.ssh<span class="preprocessor"># tar -zxvf scala-<span class="number">2.11</span><span class="number">.7</span>.tgz</span></span><br><span class="line">root@<span class="number">3970</span>c1e5466e:~/.ssh<span class="preprocessor"># vim ~/.bashrc</span></span><br><span class="line"><span class="keyword">export</span> JAVA_HOME=/usr/local/jdk1<span class="number">.8</span><span class="number">.0</span>_60</span><br><span class="line"><span class="keyword">export</span> HADOOP_HOME=/usr/local/hadoop-<span class="number">2.6</span><span class="number">.1</span></span><br><span class="line"><span class="keyword">export</span> SCALA_HOME=/usr/local/scala-<span class="number">2.11</span><span class="number">.7</span></span><br><span class="line"><span class="keyword">export</span> SPARK_HOME=/usr/local/spark-<span class="number">1.5</span><span class="number">.1</span>-bin-hadoop2<span class="number">.6</span></span><br><span class="line"><span class="keyword">export</span> PATH=$PATH:$JAVA_HOME/bin:$HADOOP_HOME/bin:$SCALA_HOME/bin:$SPARK_HOME/bin</span><br><span class="line"></span><br><span class="line">root@<span class="number">3970</span>c1e5466e:~/.ssh<span class="preprocessor"># mv /software/spark-<span class="number">1.5</span><span class="number">.1</span>-bin-hadoop2<span class="number">.6</span>.tgz /usr/local/</span></span><br><span class="line">root@<span class="number">3970</span>c1e5466e:~/.ssh<span class="preprocessor"># tar -zxvf spark-<span class="number">1.5</span><span class="number">.1</span>-bin-hadoop2<span class="number">.6</span></span></span><br></pre></td></tr></table></figure>
<p>ç¼–è¾‘é…ç½®æ–‡ä»¶</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">root@<span class="number">3970</span>c1e5466e:~/.ssh<span class="preprocessor"># cd /usr/local/spark-<span class="number">1.5</span><span class="number">.1</span>-bin-hadoop2<span class="number">.6</span>/</span></span><br><span class="line">root@<span class="number">3970</span>c1e5466e:/usr/local/spark-<span class="number">1.5</span><span class="number">.1</span>-bin-hadoop2<span class="number">.6</span><span class="preprocessor"># cd conf/</span></span><br><span class="line">root@<span class="number">3970</span>c1e5466e:/usr/local/spark-<span class="number">1.5</span><span class="number">.1</span>-bin-hadoop2<span class="number">.6</span><span class="preprocessor"># vim slaves</span></span><br><span class="line">cloud1</span><br><span class="line">cloud2</span><br><span class="line">cloud3</span><br><span class="line">cloud4</span><br><span class="line">cloud5</span><br><span class="line">cloud6</span><br><span class="line">root@<span class="number">3970</span>c1e5466e:/usr/local/spark-<span class="number">1.5</span><span class="number">.1</span>-bin-hadoop2<span class="number">.6</span><span class="preprocessor"># mv spark-env.sh.template spark-env.sh</span></span><br><span class="line">root@<span class="number">3970</span>c1e5466e:/usr/local/spark-<span class="number">1.5</span><span class="number">.1</span>-bin-hadoop2<span class="number">.6</span><span class="preprocessor"># vim ~/spark/conf/spark-env.sh</span></span><br><span class="line"><span class="keyword">export</span> SPARK_MASTER_IP=cloud1</span><br><span class="line"><span class="keyword">export</span> SPARK_WORKER_MEMORY=<span class="number">128</span>m</span><br><span class="line"><span class="keyword">export</span> JAVA_HOME=/usr/local/jdk1<span class="number">.8</span><span class="number">.0</span>_60</span><br><span class="line"><span class="keyword">export</span> SCALA_HOME=/usr/local/scala-<span class="number">2.11</span><span class="number">.7</span></span><br><span class="line"><span class="keyword">export</span> SPARK_HOME=/usr/local/spark-<span class="number">1.5</span><span class="number">.1</span>-bin-hadoop2<span class="number">.6</span></span><br><span class="line"><span class="keyword">export</span> HADOOP_CONF_DIR=/usr/local/hadoop-<span class="number">2.6</span><span class="number">.1</span>/etc/hadoop</span><br><span class="line"><span class="keyword">export</span> SPARK_LIBRARY_PATH=$$SPARK_HOME/lib</span><br><span class="line"><span class="keyword">export</span> SCALA_LIBRARY_PATH=$SPARK_LIBRARY_PATH</span><br><span class="line"><span class="keyword">export</span> SPARK_WORKER_CORES=<span class="number">1</span></span><br><span class="line"><span class="keyword">export</span> SPARK_WORKER_INSTANCES=<span class="number">1</span></span><br><span class="line"><span class="keyword">export</span> SPARK_MASTER_PORT=<span class="number">7077</span></span><br></pre></td></tr></table></figure>
<p>æ­¤æ—¶é…ç½®å·²ç»åŸºæœ¬å®Œæˆï¼Œæ‰€ä»¥éœ€è¦<strong>ä¿å­˜é•œåƒ</strong></p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[reason<span class="variable">@localhost</span> ~]<span class="variable">$ </span>sudo docker commit -m <span class="string">"mofun spark first commit"</span> -a <span class="string">"reason"</span> cloud1 mofun/<span class="symbol">spark:</span>v1.<span class="number">0</span></span><br></pre></td></tr></table></figure>
<p>æŸ¥çœ‹æ‰§è¡Œè¿‡çš„é•œåƒ</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[reason@localhost ~]$ sudo docker ps -a</span><br><span class="line">CONTAINER ID        IMAGE                 COMMAND                  CREATED             STATUS                         PORTS               NAMES</span><br><span class="line">d4e581ba6af8        mofun/spark:v1<span class="number">.0</span>   <span class="string">"/bin/bash"</span>              <span class="number">11</span> <span class="function">seconds ago      <span class="title">Exited</span> <span class="params">(<span class="number">0</span>)</span> 7 seconds ago                           hungry_pasteur</span></span><br></pre></td></tr></table></figure>
<p>å¯åŠ¨å®¹å™¨</p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åå°æ¨¡å¼è¿è¡Œ</span></span><br><span class="line">[reason@localhost ~]$ docker <span class="command">run</span> -d <span class="comment">--name cloud2 -h cloud2 -it mofun/spark:v2.0 /bin/bash</span></span><br><span class="line"></span><br><span class="line">éœ€è¦ä½¿ç”¨åˆšæ‰åˆ¶ä½œçš„é•œåƒå¯åŠ¨<span class="number">6</span>ä¸ªå®¹å™¨</span><br><span class="line">[reason@localhost ~]$ docker <span class="command">run</span> <span class="comment">--name cloud1 -h cloud1 -it mofun/spark:v2.0 /bin/bash</span></span><br><span class="line">[reason@localhost ~]$ docker <span class="command">run</span> <span class="comment">--name cloud2 -h cloud2 -it mofun/spark:v2.0 /bin/bash</span></span><br><span class="line">[reason@localhost ~]$ docker <span class="command">run</span> <span class="comment">--name cloud3 -h cloud3 -it mofun/spark:v2.0 /bin/bash</span></span><br><span class="line">[reason@localhost ~]$ docker <span class="command">run</span> <span class="comment">--name cloud4 -h cloud4 -it mofun/spark:v2.0 /bin/bash</span></span><br><span class="line">[reason@localhost ~]$ docker <span class="command">run</span> <span class="comment">--name cloud5 -h cloud5 -it mofun/spark:v2.0 /bin/bash</span></span><br><span class="line">[reason@localhost ~]$ docker <span class="command">run</span> <span class="comment">--name cloud6 -h cloud6 -it mofun/spark:v2.0 /bin/bash</span></span><br></pre></td></tr></table></figure>
<p>åšæœ€åçš„ä¿®æ”¹</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">#åœ¨cloud5~cloud6ä¸­åˆ†åˆ«æ‰‹åŠ¨ä¿®æ”¹myid</span></span><br><span class="line">root@cloud5:~<span class="preprocessor"># echo <span class="number">2</span> &gt;  /data/zookeeper/myid</span></span><br><span class="line">root@cloud5:~<span class="preprocessor"># echo <span class="number">2</span> &gt; /usr/local/zookeeper-<span class="number">3.4</span><span class="number">.6</span>/tmp/myid</span></span><br><span class="line">root@cloud6:~<span class="preprocessor"># echo <span class="number">3</span> &gt;  /data/zookeeper/myid</span></span><br><span class="line">root@cloud6:~<span class="preprocessor"># echo <span class="number">3</span> &gt; /usr/local/zookeeper-<span class="number">3.4</span><span class="number">.6</span>/tmp/myid</span></span><br></pre></td></tr></table></figure>
<p>å¯åŠ¨zookeeperé›†ç¾¤</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor"># å¯åŠ¨zookeeperé›†ç¾¤ï¼ˆåˆ†åˆ«åœ¨cloud4ã€cloud5ã€cloud6ä¸Šå¯åŠ¨zkï¼‰</span></span><br><span class="line"><span class="preprocessor"># å…¨éƒ¨èŠ‚ç‚¹å¯åŠ¨åï¼Œå†æ‰§è¡ŒzkServer.sh status</span></span><br><span class="line"><span class="preprocessor"># è¿”å›æ­£å¸¸</span></span><br><span class="line"><span class="preprocessor"># root@cloud6:/usr/local/zookeeper-<span class="number">3.4</span><span class="number">.6</span>/bin# ./zkServer.sh status</span></span><br><span class="line"><span class="preprocessor"># JMX enabled by default</span></span><br><span class="line"><span class="preprocessor"># Using config: /usr/local/zookeeper-<span class="number">3.4</span><span class="number">.6</span>/bin/../conf/zoo.cfg</span></span><br><span class="line"><span class="preprocessor"># Mode: follower</span></span><br><span class="line">root@cloud5:~<span class="preprocessor"># /usr/local/zookeeper-<span class="number">3.4</span><span class="number">.6</span>/bin/zkServer.sh start</span></span><br><span class="line"><span class="preprocessor"># å½“<span class="number">3</span>ä¸ªèŠ‚ç‚¹æœåŠ¡æ­£å¸¸å¯åŠ¨å</span></span><br><span class="line"><span class="preprocessor"># ä½¿ç”¨statusæŸ¥çœ‹æ˜¯å¦å¯åŠ¨</span></span><br><span class="line">root@cloud5:~<span class="preprocessor"># /usr/local/zookeeper-<span class="number">3.4</span><span class="number">.6</span>/bin/zkServer.sh status</span></span><br><span class="line">JMX enabled by <span class="keyword">default</span></span><br><span class="line">Using config: /usr/local/zookeeper-<span class="number">3.4</span><span class="number">.6</span>/bin/../conf/zoo.cfg</span><br><span class="line">Mode: follower</span><br><span class="line">root@cloud5:~<span class="preprocessor">#</span></span><br></pre></td></tr></table></figure>
<p>è¿›å…¥cloud1ï¼Œå¼€å¯hadoopå’ŒsparkæœåŠ¡</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¯åŠ¨journalnodeï¼ˆåœ¨cloud1ä¸Šå¯åŠ¨æ‰€æœ‰journalnodeï¼Œæ³¨æ„ï¼šæ˜¯è°ƒç”¨çš„hadoop-daemons.shè¿™ä¸ªè„šæœ¬ï¼Œæ³¨æ„æ˜¯å¤æ•°sçš„é‚£ä¸ªè„šæœ¬ï¼‰</span></span><br><span class="line"><span class="comment"># è¿è¡Œjpså‘½ä»¤æ£€éªŒï¼Œcloud4ã€cloud5ã€cloud6ä¸Šå¤šäº†JournalNodeè¿›ç¨‹</span></span><br><span class="line">root<span class="variable">@cloud1</span><span class="symbol">:/usr/local/hadoop-</span><span class="number">2.6</span>.<span class="number">1</span>/sbin<span class="comment"># pwd</span></span><br><span class="line">/usr/local/hadoop-<span class="number">2.6</span>.<span class="number">1</span>/sbin</span><br><span class="line">root<span class="variable">@cloud1</span><span class="symbol">:/usr/local/hadoop-</span><span class="number">2.6</span>.<span class="number">1</span>/sbin<span class="comment">#</span></span><br><span class="line">root<span class="variable">@cloud1</span><span class="symbol">:/usr/local/hadoop-</span><span class="number">2.6</span>.<span class="number">1</span>/sbin<span class="comment"># hadoop-daemons.sh start journalnode</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ ¼å¼åŒ–ZK(åœ¨cloud1ä¸Šæ‰§è¡Œå³å¯ï¼Œåœ¨binç›®å½•ä¸‹)</span></span><br><span class="line">root<span class="variable">@cloud1</span><span class="symbol">:/usr/local/hadoop-</span><span class="number">2.6</span>.<span class="number">1</span>/bin<span class="comment"># hdfs zkfc -formatZK</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿›å…¥èŠ‚ç‚¹cloud4ï¼ŒæŸ¥çœ‹zookeeperä¿¡æ¯</span></span><br><span class="line">root<span class="variable">@cloud4</span><span class="symbol">:/usr/local/zookeeper-</span><span class="number">3.4</span>.<span class="number">6</span>/bin<span class="comment"># pwd</span></span><br><span class="line">/usr/local/zookeeper-<span class="number">3.4</span>.<span class="number">6</span>/bin</span><br><span class="line">root<span class="variable">@cloud4</span><span class="symbol">:/usr/local/zookeeper-</span><span class="number">3.4</span>.<span class="number">6</span>/bin<span class="comment"># ls</span></span><br><span class="line"><span class="constant">README</span>.txt  zkCleanup.sh  zkCli.cmd  zkCli.sh  zkEnv.cmd  zkEnv.sh  zkServer.cmd  zkServer.sh  zookeeper.out</span><br><span class="line">root<span class="variable">@cloud4</span><span class="symbol">:/usr/local/zookeeper-</span><span class="number">3.4</span>.<span class="number">6</span>/bin<span class="comment">#</span></span><br><span class="line">root<span class="variable">@cloud4</span><span class="symbol">:/usr/local/zookeeper-</span><span class="number">3.4</span>.<span class="number">6</span>/bin<span class="comment"># ./zkCli.sh</span></span><br><span class="line"><span class="constant">Connecting</span> to <span class="symbol">localhost:</span><span class="number">2181</span></span><br><span class="line"><span class="number">2015</span>-<span class="number">10</span>-<span class="number">21</span> 09<span class="symbol">:</span><span class="number">34</span><span class="symbol">:</span><span class="number">34</span>,<span class="number">485</span> [<span class="symbol">myid:</span>] - <span class="constant">INFO</span>  [<span class="symbol">main:</span><span class="constant">Environment</span><span class="variable">@100</span>] - <span class="constant">Client</span> <span class="symbol">environment:</span>zookeeper.version=<span class="number">3.4</span>.<span class="number">6</span>-<span class="number">1569965</span>, built on <span class="number">02</span>/<span class="number">20</span>/<span class="number">2014</span> 09<span class="symbol">:</span>09 <span class="constant">GMT</span></span><br><span class="line"><span class="number">2015</span>-<span class="number">10</span>-<span class="number">21</span> 09<span class="symbol">:</span><span class="number">34</span><span class="symbol">:</span><span class="number">34</span>,<span class="number">487</span> [<span class="symbol">myid:</span>] - <span class="constant">INFO</span>  [<span class="symbol">main:</span><span class="constant">Environment</span><span class="variable">@100</span>] - <span class="constant">Client</span> <span class="symbol">environment:</span>host.name=cloud4</span><br><span class="line"><span class="number">2015</span>-<span class="number">10</span>-<span class="number">21</span> 09<span class="symbol">:</span><span class="number">34</span><span class="symbol">:</span><span class="number">34</span>,<span class="number">487</span> [<span class="symbol">myid:</span>] - <span class="constant">INFO</span>  [<span class="symbol">main:</span><span class="constant">Environment</span><span class="variable">@100</span>] - <span class="constant">Client</span> <span class="symbol">environment:</span>java.version=<span class="number">1.8</span>.<span class="number">0_</span>...</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">[<span class="symbol">zk:</span> <span class="symbol">localhost:</span><span class="number">2181</span>(<span class="constant">CONNECTED</span>) <span class="number">2</span>] ls /hadoop-ha</span><br><span class="line">[ns1]</span><br><span class="line">[<span class="symbol">zk:</span> <span class="symbol">localhost:</span><span class="number">2181</span>(<span class="constant">CONNECTED</span>) <span class="number">3</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ ¼å¼åŒ–HDFS(åœ¨binç›®å½•ä¸‹),åœ¨cloud1ä¸Šæ‰§è¡Œå‘½ä»¤:</span></span><br><span class="line">root<span class="variable">@cloud1</span><span class="symbol">:/usr/local/hadoop-</span><span class="number">2.6</span>.<span class="number">1</span>/bin<span class="comment"># hdfs namenode -format</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># é¦–å…ˆå¯åŠ¨activeèŠ‚ç‚¹ï¼Œæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤(åœ¨cloud1ä¸Šæ‰§è¡Œ)</span></span><br><span class="line">root<span class="variable">@cloud1</span><span class="symbol">:/usr/local/hadoop-</span><span class="number">2.6</span>.<span class="number">1</span>/sbin<span class="comment"># hadoop-daemon.sh start namenode  </span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿›å…¥cloud2ï¼Œéœ€è¦å¯åŠ¨standyæ¨¡å¼</span></span><br><span class="line">root<span class="variable">@cloud2</span><span class="symbol">:/usr/local/hadoop-</span><span class="number">2.6</span>.<span class="number">1</span>/bin<span class="comment"># pwd</span></span><br><span class="line">/usr/local/hadoop-<span class="number">2.6</span>.<span class="number">1</span>/bin</span><br><span class="line">root<span class="variable">@cloud2</span><span class="symbol">:/usr/local/hadoop-</span><span class="number">2.6</span>.<span class="number">1</span>/bin<span class="comment"># ./hdfs namenode -bootstrapStandby</span></span><br><span class="line">root<span class="variable">@cloud2</span><span class="symbol">:/usr/local/hadoop-</span><span class="number">2.6</span>.<span class="number">1</span>/sbin<span class="comment"># pwd</span></span><br><span class="line">/usr/local/hadoop-<span class="number">2.6</span>.<span class="number">1</span>/sbin</span><br><span class="line"><span class="comment"># è¿™æ¡å‘½ä»¤å¯ä»¥ç­‰åˆ°hadoop-daemons.sh start zkfc æˆåŠŸä»¥åæ‰§è¡Œ</span></span><br><span class="line"><span class="comment"># è²Œä¼¼æ˜¯zkfcçš„å¯åŠ¨æ…¢å¯¼è‡´standbyæ¨¡å¼å¯åŠ¨å‡ºé”™ï¼Ÿ</span></span><br><span class="line"></span><br><span class="line">root<span class="variable">@cloud1</span><span class="symbol">:/usr/local/spark-</span><span class="number">1.5</span>.<span class="number">1</span>-bin-hadoop2.<span class="number">6</span>/bin<span class="comment"># jps</span></span><br><span class="line"><span class="number">1522</span> <span class="constant">NameNode</span></span><br><span class="line"><span class="number">2546</span> <span class="constant">Jps</span></span><br><span class="line"><span class="number">1859</span> <span class="constant">DFSZKFailoverController</span></span><br><span class="line"><span class="number">1109</span> <span class="constant">Worker</span></span><br><span class="line"><span class="number">104</span> <span class="constant">JournalNode</span></span><br><span class="line"><span class="number">426</span> <span class="constant">DataNode</span></span><br><span class="line"><span class="number">558</span> <span class="constant">NodeManager</span></span><br><span class="line"><span class="number">943</span> <span class="constant">Master</span></span><br><span class="line"><span class="comment"># ä»”ç»†è§‚å¯ŸDFSZKFailoverController è¿™ä¸ªè¿›ç¨‹çš„å­˜åœ¨æƒ…å†µ</span></span><br><span class="line"></span><br><span class="line">root<span class="variable">@cloud2</span><span class="symbol">:/usr/local/hadoop-</span><span class="number">2.6</span>.<span class="number">1</span>/sbin<span class="comment"># ./hadoop-daemon.sh start namenode</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># é‡æ–°è¿›å…¥cloud1 ï¼Œå¯åŠ¨datanode</span></span><br><span class="line">root<span class="variable">@cloud4</span><span class="symbol">:/usr/local/hadoop-</span><span class="number">2.6</span>.<span class="number">1</span>/sbin<span class="comment"># pwd</span></span><br><span class="line">/usr/local/hadoop-<span class="number">2.6</span>.<span class="number">1</span>/sbin</span><br><span class="line">root<span class="variable">@cloud4</span><span class="symbol">:/usr/local/hadoop-</span><span class="number">2.6</span>.<span class="number">1</span>/sbin<span class="comment"># ./hadoop-daemons.sh start datanode</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># åœ¨cloud3ä¸Šæ‰§è¡Œstart-yarn.sh</span></span><br><span class="line">root<span class="variable">@cloud3</span><span class="symbol">:/usr/local/hadoop-</span><span class="number">2.6</span>.<span class="number">1</span>/sbin<span class="comment"># start-yarn.sh</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯åŠ¨ZKFC</span></span><br><span class="line">root<span class="variable">@cloud1</span><span class="symbol">:/usr/local/hadoop-</span><span class="number">2.6</span>.<span class="number">1</span>/sbin<span class="comment"># ./hadoop-daemons.sh start zkfc</span></span><br><span class="line"><span class="comment"># å¯åŠ¨sparké›†ç¾¤</span></span><br><span class="line">root<span class="variable">@cloud1</span><span class="symbol">:/usr/local/hadoop-</span><span class="number">2.6</span>.<span class="number">1</span>/sbin<span class="comment"># cd /usr/local/spark-1.5.1-bin-hadoop2.6/sbin/</span></span><br><span class="line">root<span class="variable">@cloud1</span><span class="symbol">:/usr/local/spark-</span><span class="number">1.5</span>.<span class="number">1</span>-bin-hadoop2.<span class="number">6</span>/sbin<span class="comment"># start-all.sh</span></span><br></pre></td></tr></table></figure>
<p>æ­¤æ—¶å¯ä»¥é€šè¿‡CURLè®¿é—®æœåŠ¡äº†ï¼Œå¦‚æœå®¿ä¸»æœºä¸­çš„hostsæ–‡ä»¶æ²¡æœ‰é…ç½®dockerå®¹å™¨çš„ä¸»æœºåå’ŒIPåœ°å€æ˜ å°„å…³ç³»çš„è¯è¦æ¢æˆç”¨IPè®¿é—®</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[reason<span class="annotation">@localhost</span> ~]$ curl <span class="string">http:</span><span class="comment">//172.17.0.56:50070</span></span><br><span class="line">[reason<span class="annotation">@localhost</span> ~]$</span><br></pre></td></tr></table></figure>
<h4 id="u5176_u4ED6"><a href="#u5176_u4ED6" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor"># åˆ é™¤é•œåƒ</span></span><br><span class="line">[reason@localhost ~]$ docker images</span><br><span class="line">REPOSITORY          TAG                 IMAGE ID            CREATED             VIRTUAL SIZE</span><br><span class="line">mofun/spark         v2<span class="number">.0</span>                b2dacac3e132        <span class="number">3</span> hours ago         <span class="number">1.508</span> GB</span><br><span class="line">mofun/spark         v1<span class="number">.3</span>                <span class="number">4</span>d2f33ca61ee        <span class="number">21</span> hours ago        <span class="number">1.506</span> GB</span><br><span class="line">ubuntu              latest              <span class="number">0</span>a17decee413        <span class="number">6</span> days ago          <span class="number">188.3</span> MB</span><br><span class="line">docker/whalesay     latest              ded5e192a685        <span class="number">4</span> months ago        <span class="number">247</span> MB</span><br><span class="line">[reason@localhost ~]$ sudo docker rmi <span class="number">4</span>d2f</span><br></pre></td></tr></table></figure>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ é™¤å®¹å™¨</span></span><br><span class="line">[reason<span class="variable">@localhost</span> ~]<span class="variable">$ </span>docker ps -a</span><br><span class="line"><span class="constant">CONTAINER ID </span>       <span class="constant">IMAGE </span>              <span class="constant">COMMAND </span>            <span class="constant">CREATED </span>            <span class="constant">STATUS </span>                       <span class="constant">PORTS </span>              <span class="constant">NAMES</span></span><br><span class="line"><span class="number">8258875263</span>be        ubuntu              <span class="string">"/bin/bash"</span>         <span class="number">3</span> minutes ago       <span class="constant">Exited </span>(<span class="number">127</span>) <span class="number">3</span> minutes ago                        mad_mestorf</span><br><span class="line">[reason<span class="variable">@localhost</span> ~]<span class="variable">$ </span>sudo docker rm <span class="number">8258875263</span>be</span><br><span class="line"><span class="number">8258875263</span>be</span><br><span class="line">[reason<span class="variable">@localhost</span> ~]$</span><br></pre></td></tr></table></figure>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ é™¤(NULL) å®¹å™¨</span></span><br><span class="line">root<span class="variable">@iZ28ikebrg6Z</span><span class="symbol">:/var/run</span><span class="comment"># docker images  </span></span><br><span class="line"><span class="constant">REPOSITORY </span>            <span class="constant">TAG </span>                <span class="constant">IMAGE ID </span>           <span class="constant">CREATED </span>            <span class="constant">VIRTUAL SIZE </span> </span><br><span class="line">&lt;none&gt;                 &lt;none&gt;              def2e0b08cbc        <span class="constant">About </span>an hour ago   <span class="number">1.37</span> <span class="constant">GB </span> </span><br><span class="line">sameersbn/redmine      latest              f0bec095f291        <span class="number">2</span> hours ago         <span class="number">614.6</span> <span class="constant">MB </span> </span><br><span class="line">root<span class="variable">@iZ28ikebrg6Z</span><span class="symbol">:/var/run</span><span class="comment"># docker ps -a  </span></span><br><span class="line"><span class="constant">CONTAINER ID </span>       <span class="constant">IMAGE </span>                   <span class="constant">COMMAND </span>               <span class="constant">CREATED </span>            <span class="constant">STATUS </span>                    <span class="constant">PORTS </span>              <span class="constant">NAMES </span> </span><br><span class="line"><span class="number">5</span>d6373cb79e6        <span class="number">224</span>b40d4b89f             <span class="string">"/bin/sh -c 'apt-get   25 hours ago        Exited (0) 25 hours ago                        distracted_blackwell    </span><br><span class="line">root@iZ28ikebrg6Z:/var/run# docker rm 5d63  </span><br><span class="line">5d63</span></span><br></pre></td></tr></table></figure>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é•œåƒå¯¼å‡º</span></span><br><span class="line">[reason<span class="variable">@localhost</span> ~]<span class="variable">$ </span>sudo docker ps -a</span><br><span class="line"><span class="constant">CONTAINER ID </span>       <span class="constant">IMAGE </span>                <span class="constant">COMMAND </span>                 <span class="constant">CREATED </span>            <span class="constant">STATUS </span>                        <span class="constant">PORTS </span>              <span class="constant">NAMES</span></span><br><span class="line">d4e581ba6af8        mofun/<span class="symbol">spark_rc:</span>v1.<span class="number">0</span>   <span class="string">"/bin/bash"</span>              <span class="number">11</span> seconds ago      <span class="constant">Exited </span>(<span class="number">0</span>) <span class="number">7</span> seconds ago                           hungry_pasteur</span><br><span class="line">[reason<span class="variable">@localhost</span> ~]<span class="variable">$ </span>sudo docker export d4e581ba6af8 &gt; mofunspark_v1.<span class="number">0</span>.tar</span><br><span class="line"></span><br><span class="line"><span class="comment"># å’Œå¯¼å…¥æ¢å¤</span></span><br><span class="line">[reason<span class="variable">@localhost</span> ~]<span class="variable">$ </span>cat mofunspark_v1.<span class="number">0</span>.tar | sudo docker import - mofun/<span class="symbol">spark:</span>v1.<span class="number">0</span></span><br></pre></td></tr></table></figure>
<p>æ‰§è¡ŒScalaäº¤äº’æ¨¡å¼æ—¶å‡ºé”™æ—¶ï¼Œéœ€è¦æ£€æŸ¥</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">root@cloud1:/usr/local/jdk1<span class="number">.8</span><span class="number">.0</span>_60/jre/lib/ext<span class="preprocessor"># ls -la</span></span><br><span class="line">total <span class="number">25632</span></span><br><span class="line">drwxr-xr-x.  <span class="number">3</span>  <span class="number">501</span> staff     <span class="number">4096</span> Oct <span class="number">19</span> <span class="number">02</span>:<span class="number">35</span> .</span><br><span class="line">drwxr-xr-x. <span class="number">15</span>  <span class="number">501</span> staff     <span class="number">4096</span> Oct <span class="number">18</span> <span class="number">03</span>:<span class="number">34</span> ..</span><br><span class="line">-rw-r--r--.  <span class="number">1</span>  <span class="number">501</span> staff  <span class="number">3860522</span> Aug  <span class="number">4</span> <span class="number">19</span>:<span class="number">29</span> cldrdata.jar</span><br><span class="line">-rw-r--r--.  <span class="number">1</span>  <span class="number">501</span> staff     <span class="number">8286</span> Aug  <span class="number">4</span> <span class="number">19</span>:<span class="number">29</span> dnsns.jar</span><br><span class="line">-rw-r--r--.  <span class="number">1</span>  <span class="number">501</span> staff    <span class="number">44516</span> Aug  <span class="number">4</span> <span class="number">19</span>:<span class="number">29</span> jaccess.jar</span><br><span class="line">-rwxr-xr-x.  <span class="number">1</span>  <span class="number">501</span> staff <span class="number">18464934</span> Aug  <span class="number">3</span> <span class="number">17</span>:<span class="number">58</span> jfxrt.jar</span><br><span class="line">-rw-r--r--.  <span class="number">1</span>  <span class="number">501</span> staff  <span class="number">1178935</span> Aug  <span class="number">4</span> <span class="number">19</span>:<span class="number">29</span> localedata.jar</span><br><span class="line">-rw-r--r--.  <span class="number">1</span>  <span class="number">501</span> staff     <span class="number">1269</span> Aug  <span class="number">4</span> <span class="number">19</span>:<span class="number">29</span> meta-index</span><br><span class="line">-rw-r--r--.  <span class="number">1</span>  <span class="number">501</span> staff  <span class="number">2014239</span> Aug  <span class="number">4</span> <span class="number">19</span>:<span class="number">29</span> nashorn.jar</span><br><span class="line">-rw-r--r--.  <span class="number">1</span>  <span class="number">501</span> staff    <span class="number">39771</span> Aug  <span class="number">4</span> <span class="number">19</span>:<span class="number">29</span> sunec.jar</span><br><span class="line">-rw-r--r--.  <span class="number">1</span>  <span class="number">501</span> staff   <span class="number">278680</span> Aug  <span class="number">4</span> <span class="number">19</span>:<span class="number">29</span> sunjce_provider.jar</span><br><span class="line">-rw-r--r--.  <span class="number">1</span>  <span class="number">501</span> staff   <span class="number">250826</span> Aug  <span class="number">4</span> <span class="number">19</span>:<span class="number">29</span> sunpkcs11.jar</span><br><span class="line">drwxr-xr-x.  <span class="number">2</span> root root      <span class="number">4096</span> Oct <span class="number">19</span> <span class="number">02</span>:<span class="number">35</span> tmp</span><br><span class="line">-rw-r--r--.  <span class="number">1</span>  <span class="number">501</span> staff    <span class="number">68848</span> Aug  <span class="number">4</span> <span class="number">19</span>:<span class="number">29</span> zipfs.jar</span><br><span class="line">root@cloud1:/usr/local/jdk1<span class="number">.8</span><span class="number">.0</span>_60/jre/lib/ext<span class="preprocessor">#</span></span><br><span class="line"><span class="preprocessor"># è¯¥ç›®å½•ä¸‹å‡ºç°äº†å¾ˆå¤šç±»ä¼¼._jfxrt.jar çš„åŒ…ï¼Œç›´æ¥äºˆä»¥åˆ é™¤å³å¯ã€‚</span></span><br></pre></td></tr></table></figure>
<h4 id="u53C2_u8003_u6587_u732E"><a href="#u53C2_u8003_u6587_u732E" class="headerlink" title="å‚è€ƒæ–‡çŒ®"></a>å‚è€ƒæ–‡çŒ®</h4><ul>
<li><a href="http://eksliang.iteye.com/blog/2226986" target="_blank" rel="external">http://eksliang.iteye.com/blog/2226986</a></li>
<li><a href="http://dockerpool.com/static/books/docker_practice/container/daemon.html" target="_blank" rel="external">http://dockerpool.com/static/books/docker_practice/container/daemon.html</a></li>
<li><a href="http://dockerpool.com/static/books/docker_practice/install/ubuntu.html" target="_blank" rel="external">http://dockerpool.com/static/books/docker_practice/install/ubuntu.html</a></li>
<li><a href="http://dockerpool.com/static/books/docker_practice/image/create.html" target="_blank" rel="external">http://dockerpool.com/static/books/docker_practice/image/create.html</a></li>
<li><a href="http://dockerpool.com/static/books/docker_practice/image/save_load.html" target="_blank" rel="external">http://dockerpool.com/static/books/docker_practice/image/save_load.html</a></li>
<li><a href="http://dockerpool.com/static/books/docker_practice/container/rm.html" target="_blank" rel="external">http://dockerpool.com/static/books/docker_practice/container/rm.html</a></li>
<li><a href="http://blog.csdn.net/qq1010885678/article/details/46353101" target="_blank" rel="external">http://blog.csdn.net/qq1010885678/article/details/46353101</a></li>
<li><a href="http://cn.soulmachine.me/blog/20131027/" target="_blank" rel="external">http://cn.soulmachine.me/blog/20131027/</a></li>
<li><a href="http://my.oschina.net/zjzhai/blog/225112" target="_blank" rel="external">http://my.oschina.net/zjzhai/blog/225112</a></li>
<li><a href="http://blog.csdn.net/minimicall/article/details/40188251" target="_blank" rel="external">http://blog.csdn.net/minimicall/article/details/40188251</a></li>
<li><a href="http://www.scala-lang.org/documentation/" target="_blank" rel="external">http://www.scala-lang.org/documentation/</a>  </li>
<li><a href="https://github.com/apache/spark/blob/master/examples/src/main/scala/org/apache/spark/examples/streaming/NetworkWordCount.scala" target="_blank" rel="external">https://github.com/apache/spark/blob/master/examples/src/main/scala/org/apache/spark/examples/streaming/NetworkWordCount.scala</a></li>
<li><a href="http://spark.apache.org/docs/latest/" target="_blank" rel="external">http://spark.apache.org/docs/latest/</a></li>
<li><a href="https://docs.sigmoidanalytics.com/index.php/Error:_Failed_to_initialize_compiler:_object_scala_not_found." target="_blank" rel="external">https://docs.sigmoidanalytics.com/index.php/Error:_Failed_to_initialize_compiler:_object_scala_not_found.</a></li>
<li><a href="http://docs.docker.com/linux/step_one/" target="_blank" rel="external">http://docs.docker.com/linux/step_one/</a></li>
<li><a href="http://blog.sequenceiq.com/blog/2015/01/09/spark-1-2-0-docker/" target="_blank" rel="external">http://blog.sequenceiq.com/blog/2015/01/09/spark-1-2-0-docker/</a></li>
</ul>
]]></content>
    <summary type="html">
    <![CDATA[<!--  -->
<!--  -->
<!--  _ __    __     __      ____    ___     ___   _____   __  __    ___     -->
<!-- /\`'__\/'__`\ /'__`\   /',__\  / _]]>
    </summary>
    
      <category term="Docker" scheme="http://reasonpun.com/tags/Docker/"/>
    
      <category term="HDFS" scheme="http://reasonpun.com/tags/HDFS/"/>
    
      <category term="Spark" scheme="http://reasonpun.com/tags/Spark/"/>
    
      <category term="æ•°æ®æŒ–æ˜" scheme="http://reasonpun.com/categories/%E6%95%B0%E6%8D%AE%E6%8C%96%E6%8E%98/"/>
    
      <category term="å®æ—¶è®¡ç®—" scheme="http://reasonpun.com/categories/%E6%95%B0%E6%8D%AE%E6%8C%96%E6%8E%98/%E5%AE%9E%E6%97%B6%E8%AE%A1%E7%AE%97/"/>
    
      <category term="è™šæ‹ŸåŒ–" scheme="http://reasonpun.com/categories/%E6%95%B0%E6%8D%AE%E6%8C%96%E6%8E%98/%E5%AE%9E%E6%97%B6%E8%AE%A1%E7%AE%97/%E8%99%9A%E6%8B%9F%E5%8C%96/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[nginx-logrotate]]></title>
    <link href="http://reasonpun.com/2015/12/04/nginx-logrotate/"/>
    <id>http://reasonpun.com/2015/12/04/nginx-logrotate/</id>
    <published>2015-12-04T08:11:51.000Z</published>
    <updated>2015-12-25T03:34:28.000Z</updated>
    <content type="html"><![CDATA[<!--  -->
<!--  -->
<!--  _ __    __     __      ____    ___     ___   _____   __  __    ___     -->
<!-- /\`'__\/'__`\ /'__`\   /',__\  / __`\ /' _ `\/\ '__`\/\ \/\ \ /' _ `\   -->
<!-- \ \ \//\  __//\ \L\.\_/\__, `\/\ \L\ \/\ \/\ \ \ \L\ \ \ \_\ \/\ \/\ \  -->
<!--  \ \_\\ \____\ \__/.\_\/\____/\ \____/\ \_\ \_\ \ ,__/\ \____/\ \_\ \_\ -->
<!--   \/_/ \/____/\/__/\/_/\/___/  \/___/  \/_/\/_/\ \ \/  \/___/  \/_/\/_/ -->
<!--                                                 \ \_\                   -->
<!--                                                  \/_/                   -->
<!--  -->
<h3 id="Centos_Logrotate"><a href="#Centos_Logrotate" class="headerlink" title="Centos Logrotate"></a>Centos Logrotate</h3><h4 id="u5173_u4E8E"><a href="#u5173_u4E8E" class="headerlink" title="å…³äº"></a>å…³äº</h4><p><em>logrotate</em> is  designed to ease administration of systems that generatelarge numbers of log files.  It allows automatic rotation, compression,removal, and mailing of log files.  Each log file may be handled daily,weekly, monthly, or when it grows too large. (<a href="http://linuxcommand.org/man_pages/logrotate8.html" target="_blank" rel="external">Logrotate man page</a>)</p>
<h4 id="u914D_u7F6E_u6587_u4EF6"><a href="#u914D_u7F6E_u6587_u4EF6" class="headerlink" title="é…ç½®æ–‡ä»¶"></a>é…ç½®æ–‡ä»¶</h4><h5 id="u5185_u5BB9_u793A_u4F8B"><a href="#u5185_u5BB9_u793A_u4F8B" class="headerlink" title="å†…å®¹ç¤ºä¾‹"></a>å†…å®¹ç¤ºä¾‹</h5><figure class="highlight vala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[reason@online_http:/etc/logrotate.d]$ cat nginx.logrotate.d</span><br><span class="line"><span class="preprocessor">#</span></span><br><span class="line"><span class="preprocessor"># author: reason@mofunsky.com</span></span><br><span class="line"><span class="preprocessor"># date:   2015-03-31 10:15</span></span><br><span class="line"><span class="preprocessor"># cron:</span></span><br><span class="line"><span class="preprocessor">#       59 23 * * * /usr/sbin/logrotate /etc/logrotate.conf &gt; /dev/null</span></span><br><span class="line"><span class="preprocessor">#</span></span><br><span class="line"><span class="preprocessor"># location:</span></span><br><span class="line"><span class="preprocessor">#       /etc/logrotate.d/nginx.logrotate.d</span></span><br><span class="line"><span class="preprocessor">#</span></span><br><span class="line">/local/nginx*.log &#123;</span><br><span class="line">    daily</span><br><span class="line">    rotate <span class="number">10</span></span><br><span class="line">    missingok</span><br><span class="line">    compress</span><br><span class="line">    notifempty</span><br><span class="line">    sharedscripts</span><br><span class="line">    postrotate</span><br><span class="line">        /bin/kill -USR1 $(cat /<span class="keyword">var</span>/nginx.pid <span class="number">2</span>&gt;/dev/<span class="literal">null</span>) <span class="number">2</span>&gt;/dev/<span class="literal">null</span> || :</span><br><span class="line">    endscript</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="u5B58_u653E_u4F4D_u7F6E"><a href="#u5B58_u653E_u4F4D_u7F6E" class="headerlink" title="å­˜æ”¾ä½ç½®"></a>å­˜æ”¾ä½ç½®</h5><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[reason<span class="variable">@online_http</span><span class="symbol">:/etc/logrotate</span>.d]<span class="variable">$ </span>pwd</span><br><span class="line">/etc/logrotate.d</span><br><span class="line">[reason<span class="variable">@online_http</span><span class="symbol">:/etc/logrotate</span>.d]$</span><br></pre></td></tr></table></figure>
<h5 id="u6267_u884C_u65B9_u5F0F_u548C_u65F6_u95F4"><a href="#u6267_u884C_u65B9_u5F0F_u548C_u65F6_u95F4" class="headerlink" title="æ‰§è¡Œæ–¹å¼å’Œæ—¶é—´"></a>æ‰§è¡Œæ–¹å¼å’Œæ—¶é—´</h5><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor"># add by reason @ <span class="number">2015</span>-<span class="number">04</span>-<span class="number">05</span> <span class="number">20</span>:<span class="number">41</span></span></span><br><span class="line"><span class="preprocessor"># logrotate nginx log daily</span></span><br><span class="line"><span class="number">59</span>      <span class="number">23</span>      *       *       *       root /usr/sbin/logrotate /etc/logrotate.conf &gt;/dev/null <span class="number">2</span>&gt;&amp;<span class="number">1</span></span><br></pre></td></tr></table></figure>
<h5 id="u6267_u884C_u6548_u679C"><a href="#u6267_u884C_u6548_u679C" class="headerlink" title="æ‰§è¡Œæ•ˆæœ"></a>æ‰§è¡Œæ•ˆæœ</h5><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor"># ä¼šæŒ‰ç…§æ—¥æœŸï¼Œåœ¨æ¯å¤©çš„<span class="number">23</span>ï¼š<span class="number">59</span>åˆ†å°†æ”¹å¤©æ—¥å¿—è½¬å‚¨å‹ç¼©ä¸º*.gzæ–‡ä»¶</span></span><br><span class="line">[reason@online_http:/local/nginx_access_log]$ ls -lsh</span><br><span class="line">total <span class="number">5.1</span>G</span><br><span class="line"><span class="number">427</span>M -rwxrwxrwx <span class="number">1</span> nginx nginx <span class="number">427</span>M Oct <span class="number">11</span> <span class="number">12</span>:<span class="number">01</span> nginx_me_access.<span class="built_in">log</span></span><br><span class="line"><span class="number">259</span>M -rwxrwxrwx <span class="number">1</span> nginx nginx <span class="number">259</span>M Oct  <span class="number">1</span> <span class="number">23</span>:<span class="number">59</span> nginx_me_access.<span class="built_in">log</span>-<span class="number">20151001.</span>gz</span><br><span class="line"><span class="number">233</span>M -rwxrwxrwx <span class="number">1</span> nginx nginx <span class="number">233</span>M Oct  <span class="number">2</span> <span class="number">23</span>:<span class="number">59</span> nginx_me_access.<span class="built_in">log</span>-<span class="number">20151002.</span>gz</span><br><span class="line"><span class="number">228</span>M -rwxrwxrwx <span class="number">1</span> nginx nginx <span class="number">228</span>M Oct  <span class="number">3</span> <span class="number">23</span>:<span class="number">59</span> nginx_me_access.<span class="built_in">log</span>-<span class="number">20151003.</span>gz</span><br><span class="line"><span class="number">225</span>M -rwxrwxrwx <span class="number">1</span> nginx nginx <span class="number">225</span>M Oct  <span class="number">4</span> <span class="number">23</span>:<span class="number">59</span> nginx_me_access.<span class="built_in">log</span>-<span class="number">20151004.</span>gz</span><br><span class="line"><span class="number">232</span>M -rwxrwxrwx <span class="number">1</span> nginx nginx <span class="number">232</span>M Oct  <span class="number">5</span> <span class="number">23</span>:<span class="number">59</span> nginx_me_access.<span class="built_in">log</span>-<span class="number">20151005.</span>gz</span><br></pre></td></tr></table></figure>
<h5 id="u53E6_u5916_u4E00_u79CD_u6267_u884C_u65B9_u5F0F"><a href="#u53E6_u5916_u4E00_u79CD_u6267_u884C_u65B9_u5F0F" class="headerlink" title="å¦å¤–ä¸€ç§æ‰§è¡Œæ–¹å¼"></a>å¦å¤–ä¸€ç§æ‰§è¡Œæ–¹å¼</h5><p>logrotate æ˜¯linuxç³»ç»Ÿçš„ç¼ºçœå®‰è£…å‘½ä»¤ï¼Œåˆå§‹åŒ–çŠ¶æ€ä¸‹å³å­˜åœ¨ç¼ºçœçš„é…ç½®ä¿¡æ¯ï¼Œå…¶ä¸­åŒ…æ‹¬æ‰§è¡Œæ–‡ä»¶å’Œæ—¶é—´</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[reason<span class="variable">@online_http</span><span class="symbol">:/local/nginx_access_log</span>]<span class="variable">$ </span>cd /etc/logrotate.d/</span><br><span class="line">[reason<span class="variable">@online_http</span><span class="symbol">:/etc/logrotate</span>.d]<span class="variable">$ </span>ls</span><br><span class="line">nginx.logrotate.d</span><br><span class="line">[reason<span class="variable">@online_http</span><span class="symbol">:/etc/logrotate</span>.d]<span class="variable">$ </span>pwd</span><br><span class="line">/etc/logrotate.d</span><br><span class="line">[reason<span class="variable">@online_http</span><span class="symbol">:/etc/logrotate</span>.d]$</span><br></pre></td></tr></table></figure>
<p>æ¯”å¦‚åœ¨/etc/logrotate.dç›®å½•ä¸‹ä¼šç¼ºçœæ”¾ç½®ä¸€æ‰¹éœ€è¦è½¬å‚¨çš„æ—¥å¿—æœåŠ¡å¯¹åº”çš„é…ç½®æ–‡ä»¶ï¼Œæ¯”å¦‚httpdï¼Œeximç­‰ï¼Œlogrotateä¼šæŒ‰ç…§é…ç½®æ–‡ä»¶ä¿¡æ¯æŒ‰ç…§æ—¢å®šæ—¶é—´å¯¹å…¶äº§ç”Ÿçš„æ—¥å¿—æ•°æ®è¿›è¡Œè½¬å‚¨æ“ä½œã€‚</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[reason<span class="variable">@online_http</span><span class="symbol">:/etc/logrotate</span>.d]<span class="variable">$ </span>pwd</span><br><span class="line">/etc/logrotate.d</span><br><span class="line">[reason<span class="variable">@online_http</span><span class="symbol">:/etc/logrotate</span>.d]<span class="variable">$ </span>cat yum</span><br><span class="line">/var/log/yum.log &#123;</span><br><span class="line">    missingok</span><br><span class="line">    notifempty</span><br><span class="line">    size <span class="number">30</span>k</span><br><span class="line">    yearly</span><br><span class="line">    create <span class="number">0600</span> root root</span><br><span class="line">&#125;</span><br><span class="line">[reason<span class="variable">@online_http</span><span class="symbol">:/etc/logrotate</span>.d]$</span><br></pre></td></tr></table></figure>
<p>å…·ä½“å‚æ•°æ¶µä¹‰å¯å‚è€ƒ<a href="http://linuxcommand.org/man_pages/logrotate8.html" target="_blank" rel="external">Logrotate man page</a></p>
<p>ç¼ºçœçŠ¶æ€ä¸‹ï¼Œlogrotateçš„è‡ªåŠ¨æ‰§è¡Œåˆ†åˆ«è¢«æ”¾å…¥äº†å¦‚ä¸‹å‡ ä¸ªæ–‡ä»¶ä¸­</p>
<ul>
<li>cron.daily</li>
<li>cron.weekly</li>
<li>cron.monthly</li>
</ul>
<p>è€Œå¯¹äºä¸åŒçš„linuxå‘è¡Œç‰ˆæœ¬ä»¥ä¸Šè„šæœ¬å¯èƒ½è¢«æ”¾ç½®åœ¨/etc/crontabä¸­<br>æˆ–è€…</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="variable">@i</span>-bntub2bp logrotate.d]<span class="comment"># cat /etc/anacrontab</span></span><br><span class="line"><span class="comment"># /etc/anacrontab: configuration file for anacron</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># See anacron(8) and anacrontab(5) for details.</span></span><br><span class="line"></span><br><span class="line"><span class="constant">SHELL</span>=<span class="regexp">/bin/sh</span></span><br><span class="line"><span class="constant">PATH</span>=<span class="regexp">/sbin:/bin</span><span class="symbol">:/usr/sbin</span><span class="symbol">:/usr/bin</span></span><br><span class="line"><span class="constant">MAILTO</span>=root</span><br><span class="line"><span class="comment"># the maximal random delay added to the base delay of the jobs</span></span><br><span class="line"><span class="constant">RANDOM_DELAY</span>=<span class="number">45</span></span><br><span class="line"><span class="comment"># the jobs will be started during the following hours only</span></span><br><span class="line"><span class="constant">START_HOURS_RANGE</span>=<span class="number">3</span>-<span class="number">22</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#period in days   delay in minutes   job-identifier   command</span></span><br><span class="line"><span class="number">1</span>       <span class="number">5</span>       cron.daily              nice run-parts /etc/cron.daily</span><br><span class="line"><span class="number">7</span>       <span class="number">25</span>      cron.weekly             nice run-parts /etc/cron.weekly</span><br><span class="line"><span class="variable">@monthly</span> <span class="number">45</span>     cron.monthly            nice run-parts /etc/cron.monthly</span><br><span class="line">[root<span class="variable">@i</span>-bntub2bp logrotate.d]<span class="comment">#</span></span><br></pre></td></tr></table></figure>
<p>é’ˆå¯¹</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@i-bntub2bp logrotate.d]# cat /etc/redhat-<span class="operator"><span class="keyword">release</span></span><br><span class="line">CentOS <span class="keyword">release</span> <span class="number">6.6</span> (<span class="keyword">Final</span>)</span><br><span class="line">[root@<span class="keyword">i</span>-bntub2bp logrotate.<span class="keyword">d</span>]#</span></span><br></pre></td></tr></table></figure>
<p>è€Œè¨€ï¼Œå¯ä»¥ç›´æ¥åœ¨/etc/<a href="https://www.centos.org/docs/2/rhl-cg-en-7.2/anacron.html" target="_blank" rel="external">anacrontab</a>ä¸­æ‰¾åˆ°å¦‚ä¸Šä¿¡æ¯ã€‚</p>
<p>å¤§ä½“è§£é‡Šä¸‹anacrontabçš„éƒ¨åˆ†å‚æ•°æ¶µä¹‰</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">START_HOURS_RANGE=<span class="number">3</span>-<span class="number">22</span>  <span class="preprocessor"># æ‰§è¡Œæ—¶é—´ä¸º<span class="number">3</span>ç‚¹åˆ°<span class="number">22</span>ç‚¹ä¹‹é—´</span></span><br><span class="line">RANDOM_DELAY=<span class="number">45</span> <span class="preprocessor"># æ—¶é—´å¤„äºå¯æ‰§è¡ŒåŒºé—´å†…éšæœºå»¶è¿Ÿ<span class="number">45</span>åˆ†é’Ÿä¹‹å†…ä»»æ„æ—¶é—´</span></span><br><span class="line"><span class="number">1</span>       <span class="number">5</span>       cron.daily              nice run-parts /etc/cron.daily</span><br><span class="line"><span class="preprocessor"># æ‰§è¡Œæ—¶é—´ä¸º<span class="number">3</span>ç‚¹åˆ°<span class="number">22</span>ç‚¹ä¹‹é—´æ‰§è¡Œ/etc/cron.dailyè„šæœ¬ (after reboot and after the machine has been up for <span class="number">5</span> minutes^^), å¦‚æœæ²¡æœ‰é‡å¯æœåŠ¡ï¼Œåˆ™ä¼šåœ¨<span class="number">3</span>ï¼š<span class="number">05</span>ä¹‹åæ‰§è¡Œã€‚</span></span><br></pre></td></tr></table></figure>
<h4 id="u53C2_u8003_u6587_u732E"><a href="#u53C2_u8003_u6587_u732E" class="headerlink" title="å‚è€ƒæ–‡çŒ®"></a>å‚è€ƒæ–‡çŒ®</h4><ul>
<li><a href="http://huoding.com/2013/04/21/246" target="_blank" rel="external">http://huoding.com/2013/04/21/246</a></li>
<li><a href="http://serverfault.com/questions/135906/when-does-cron-daily-run" target="_blank" rel="external">http://serverfault.com/questions/135906/when-does-cron-daily-run</a></li>
<li><a href="http://www.cyberciti.biz/faq/linux-when-does-cron-daily-weekly-monthly-run/" target="_blank" rel="external">http://www.cyberciti.biz/faq/linux-when-does-cron-daily-weekly-monthly-run/</a></li>
<li><a href="http://linuxcommand.org/man_pages/logrotate8.html" target="_blank" rel="external">http://linuxcommand.org/man_pages/logrotate8.html</a></li>
<li><a href="https://www.centos.org/docs/2/rhl-cg-en-7.2/anacron.html" target="_blank" rel="external">https://www.centos.org/docs/2/rhl-cg-en-7.2/anacron.html</a></li>
</ul>
]]></content>
    <summary type="html">
    <![CDATA[<!--  -->
<!--  -->
<!--  _ __    __     __      ____    ___     ___   _____   __  __    ___     -->
<!-- /\`'__\/'__`\ /'__`\   /',__\  / _]]>
    </summary>
    
      <category term="Logrorate" scheme="http://reasonpun.com/tags/Logrorate/"/>
    
      <category term="Nginx" scheme="http://reasonpun.com/tags/Nginx/"/>
    
      <category term="ç³»ç»Ÿç»´æŠ¤" scheme="http://reasonpun.com/categories/%E7%B3%BB%E7%BB%9F%E7%BB%B4%E6%8A%A4/"/>
    
      <category term="æ—¥å¿—å¤„ç†" scheme="http://reasonpun.com/categories/%E7%B3%BB%E7%BB%9F%E7%BB%B4%E6%8A%A4/%E6%97%A5%E5%BF%97%E5%A4%84%E7%90%86/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[spark æºç åˆ†æ]]></title>
    <link href="http://reasonpun.com/2015/12/04/spark-source-1/"/>
    <id>http://reasonpun.com/2015/12/04/spark-source-1/</id>
    <published>2015-12-04T02:59:14.000Z</published>
    <updated>2016-01-25T03:17:11.000Z</updated>
    <content type="html"><![CDATA[<!--  -->
<!--  -->
<!--  _ __    __     __      ____    ___     ___   _____   __  __    ___     -->
<!-- /\`'__\/'__`\ /'__`\   /',__\  / __`\ /' _ `\/\ '__`\/\ \/\ \ /' _ `\   -->
<!-- \ \ \//\  __//\ \L\.\_/\__, `\/\ \L\ \/\ \/\ \ \ \L\ \ \ \_\ \/\ \/\ \  -->
<!--  \ \_\\ \____\ \__/.\_\/\____/\ \____/\ \_\ \_\ \ ,__/\ \____/\ \_\ \_\ -->
<!--   \/_/ \/____/\/__/\/_/\/___/  \/___/  \/_/\/_/\ \ \/  \/___/  \/_/\/_/ -->
<!--                                                 \ \_\                   -->
<!--                                                  \/_/                   -->
<!--  -->
<h3 id="fork_git"><a href="#fork_git" class="headerlink" title="fork git"></a>fork git</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">clone</span> https://github.com/apache/spark.git</span><br></pre></td></tr></table></figure>
]]></content>
    <summary type="html">
    <![CDATA[<!--  -->
<!--  -->
<!--  _ __    __     __      ____    ___     ___   _____   __  __    ___     -->
<!-- /\`'__\/'__`\ /'__`\   /',__\  / _]]>
    </summary>
    
      <category term="Kernel" scheme="http://reasonpun.com/tags/Kernel/"/>
    
      <category term="Source" scheme="http://reasonpun.com/tags/Source/"/>
    
      <category term="Spark" scheme="http://reasonpun.com/tags/Spark/"/>
    
      <category term="æ•°æ®æŒ–æ˜" scheme="http://reasonpun.com/categories/%E6%95%B0%E6%8D%AE%E6%8C%96%E6%8E%98/"/>
    
      <category term="å®æ—¶è®¡ç®—" scheme="http://reasonpun.com/categories/%E6%95%B0%E6%8D%AE%E6%8C%96%E6%8E%98/%E5%AE%9E%E6%97%B6%E8%AE%A1%E7%AE%97/"/>
    
      <category term="æºç åˆ†æ" scheme="http://reasonpun.com/categories/%E6%95%B0%E6%8D%AE%E6%8C%96%E6%8E%98/%E5%AE%9E%E6%97%B6%E8%AE%A1%E7%AE%97/%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/"/>
    
  </entry>
  
</feed>
