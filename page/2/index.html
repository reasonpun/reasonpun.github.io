<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://example.com/page/2/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 6.0.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-2016-04-07-Oryx2-performance-doc" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2022/01/30/2016-04-07-Oryx2-performance-doc/" class="article-date">
  <time class="dt-published" datetime="2022-01-30T04:24:01.506Z" itemprop="datePublished">2022-01-30</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2022/01/30/2016-04-07-Oryx2-performance-doc/">Oryx2 æ€§èƒ½ä¼˜åŒ–æ–‡æ¡£</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>è¿™é‡Œæ”¶é›†äº†å„ç§æ„è§ï¼Œç»éªŒæ³•åˆ™å’ŒåŸºå‡†æµ‹è¯•ç›¸å…³çš„æ€§èƒ½ï¼šåšè¿™äº›ä¸åŒçš„å·¥ä½œéœ€è¦å¤šå°‘èµ„æºã€‚</p>
<h2 id="ç¡¬ä»¶å’Œé›†ç¾¤è®¾è®¡"><a href="#ç¡¬ä»¶å’Œé›†ç¾¤è®¾è®¡" class="headerlink" title="ç¡¬ä»¶å’Œé›†ç¾¤è®¾è®¡"></a>ç¡¬ä»¶å’Œé›†ç¾¤è®¾è®¡</h2><p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå¯¹ç¡¬ä»¶æˆ–è€…é›†ç¾¤æ²¡æœ‰ç‰¹åˆ«çš„è¦æ±‚ã€‚é›†ç¾¤èµ„æºçš„éœ€æ±‚ä¸»è¦å–å†³äºåŸºäºSparkçš„ä½œä¸šï¼Œè¿™äº›å¾€å¾€æ˜¯å†…å­˜å¯†é›†å‹å’ŒCPUå¯†é›†å‹çš„ï¼Œä½†æ˜¯ä¸€èˆ¬ä¸ä¼šæ˜¯I/Oç»‘å®šçš„ã€‚å¦‚æœæ•°æ®çš„é‡‡é›†ç‡éå¸¸çš„é«˜ï¼ŒKafkaå¯èƒ½éœ€è¦ä¸€äº›ç‰¹æ®Šçš„è€ƒè™‘ã€‚åœ¨è¿™ä¸¤ç§æƒ…å†µä¸‹ï¼Œé’ˆå¯¹å…¶ä»–ä»»ä½•çš„Kafkaæˆ–è€…Sparkä½œä¸šå¹¶æ²¡æœ‰ä¸åŒçš„æ ‡å‡†ã€‚</p>
<h3 id="æ•°æ®ä¼ è¾“"><a href="#æ•°æ®ä¼ è¾“" class="headerlink" title="æ•°æ®ä¼ è¾“"></a>æ•°æ®ä¼ è¾“</h3><p>å› ä¸ºKafkaæ˜¯åº•å±‚ä¼ è¾“æ•°æ®çš„ï¼Œå­˜å‚¨è¦æ±‚çš„é‡‡é›†å’Œå­˜æ”¾æ•°æ®å¯¹äºKafkaä¹Ÿå°±æ˜¯è¿™æ ·çš„ã€‚æŸ¥çœ‹<a target="_blank" rel="noopener" href="http://kafka.apache.org/performance.html">Kafka æ€§èƒ½</a>ä¸­æåˆ°çš„å†…å®¹ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼ŒKafkaå¹¶ä¸ä¼šæ¥è¿‘ç“¶é¢ˆï¼Œä¹Ÿèƒ½å¤Ÿåƒå…¶ä»–Kafkaçš„ä½¿ç”¨ä¸€æ ·è°ƒæ•´èµ„æºå ç”¨å¤§å°ã€‚</p>
<h3 id="æ‰¹å¤„ç†å±‚"><a href="#æ‰¹å¤„ç†å±‚" class="headerlink" title="æ‰¹å¤„ç†å±‚"></a>æ‰¹å¤„ç†å±‚</h3><p>æ‰¹å¤„ç†å±‚ç‹¬ç‰¹çš„åœ°æ–¹æ˜¯æ¨¡å‹çš„æ„å»º, and the element that is of most interest to benchmark are likely the model building processes implemented in the app tier, on top of MLlib. Here again, the resources required to build a model over a certain amount of data are just that of the underlying MLlib implementations of ALS, k-means and decision forests.</p>
<p>MLlibçš„ä»»ä½•æ€§èƒ½ä¼˜åŒ–æˆ–è€…æ˜¯åŸºå‡†æµ‹è¯•éƒ½é€‚ç”¨äºè¿™äº›åŸºäºMLlibé¢„åˆ¶çš„å®ç°çš„æ‰¹å¤„ç†å±‚ï¼Œè¿™å¯¹äºOryxä¹Ÿæ˜¯ä¸€æ ·çš„ã€‚</p>
<h3 id="JVM-ä¼˜åŒ–"><a href="#JVM-ä¼˜åŒ–" class="headerlink" title="JVM ä¼˜åŒ–"></a>JVM ä¼˜åŒ–</h3><p>Choosing the number of Spark executors, cores and memory is a topic in its own right.</p>
<p>å¾ˆè‡ªç„¶çš„ï¼Œæ›´å¤šçš„executorsæ„å‘³ç€æ›´å¤šçš„æ ¸å¿ƒå’Œå†…å­˜ã€‚ä½†æ˜¯æ•°é‡æ˜¯ä¸èƒ½è¶…å¤šé›†ç¾¤ä¸Šæœºå™¨çš„æ€»æ•°é‡çš„ï¼›è¯·æŸ¥çœ‹ï¼šoryx.batch.streaming.num-executorsã€‚</p>
<p>æ›´å¤šçš„æ ¸ï¼Œæ„å‘³ç€å¯èƒ½ä¼šæœ‰æ›´å¤šçš„å¹¶å‘è¿›ç¨‹ã€‚åœ¨å…¸å‹çš„æ¨¡å‹æ„å»ºè¿›ç¨‹ä¸­ï¼Œå¦‚æœèƒ½è¾¾åˆ°ä»»åŠ¡æ€»æ•°çš„ä¸‰åˆ†ä¹‹ä¸€æˆ–è€…2åˆ†ä¹‹ä¸€çš„è¯ï¼Œè¿™å°†æ˜¯éå¸¸æœ‰ç”¨çš„ã€‚ä½ å¯ä»¥è§‚å¯Ÿåˆ°ä»»åŠ¡çš„æ•°é‡ï¼Œä»¥åŠSpark UIä¸­æ‰¹å¤„ç†å±‚å›ºæœ‰çš„å¹¶å‘æƒ…å†µã€‚åœ¨è¿™æ•°é‡ä¹‹ä¸‹ï¼Œæ ¸æ•°å†å¤šä¹Ÿæ— æ³•å¢åŠ æ›´å¤šçš„å¹¶å‘äº†ã€‚å°‘ä¸€äº›æ˜¯å¯ä»¥çš„ï¼Œæ— éå°±æ˜¯å¢åŠ äº†ç‚¹è¿è¡Œæ—¶é—´ã€‚å½“ç„¶ï¼Œåœ¨æ‰¹å¤„ç†çš„æ—¶é—´é—´éš”å†…ï¼Œå……è¶³çš„æ ¸æ•°å¯ä»¥ä¿è¯æ‰¹å¤„ç†çš„é¡ºåˆ©å®Œæˆã€‚æ ¸çš„æ•°é‡å¯ä»¥é€šè¿‡oryx.batch.streaming.executor-coresè¿›è¡Œé…ç½®ã€‚</p>
<p>å¦‚æœä½ çš„ä½œä¸šå‘ç”Ÿäº†å†…å­˜æº¢å‡ºï¼Œé©±åŠ¨å™¨å’Œexecutorså¯èƒ½éœ€è¦æ›´å¤šçš„å†…å­˜ã€‚å¦‚æœä½ æ³¨æ„åˆ°åœ¨æ‰¹å¤„ç†å±‚çš„â€å­˜å‚¨â€æ ‡ç­¾é¡µä¸­å¹¶ä¸æ˜¯100%çš„RDDè¢«ç¼“å­˜ä½äº†ï¼Œé‚£ä¹ˆæ›´å¤šçš„å†…å­˜å¯èƒ½ä¼šæœ‰æ‰€å¸®åŠ©ã€‚æŸ¥çœ‹ï¼šoryx.batch.streaming.executor-memoryã€‚</p>
<p>oryx-run.shè„šæœ¬çš„â€“jvm-argså‚æ•°æ˜¯ç”¨æ¥ä¸ºæ‰€æœ‰çš„JVMè¿›ç¨‹è®¾ç½®å†…å­˜å‚æ•°çš„ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œé€šè¿‡è®¾ç½® -XX:+UseG1GC ï¼Œä¼šè¾¾åˆ°ä¸€ä¸ªæ¯”è¾ƒåˆç†çš„æ•ˆæœã€‚</p>
<h3 id="æœåŠ¡å±‚"><a href="#æœåŠ¡å±‚" class="headerlink" title="æœåŠ¡å±‚"></a>æœåŠ¡å±‚</h3><p>REST API åç«¯æœåŠ¡å™¨æ˜¯Tomcatã€‚é…ç½®æ–‡ä»¶æ˜¯æ²¡æœ‰æš´éœ²ç»™ç”¨æˆ·çš„ï¼Œä½†æ˜¯å¯¹äºä»–çš„è´Ÿè½½å·²ç»åšäº†åˆç†çš„è°ƒæ•´ã€‚Tomcatå®¹å™¨æœ¬èº«å¼€é”€å¾ˆå°ï¼Œä¸éœ€è¦æ‹…å¿ƒæ€§èƒ½é—®é¢˜ã€‚</p>
<p>æœ€å¯èƒ½æ„Ÿå…´è¶£çš„æ˜¯é¡¹ç›®ä¸­æä¾›çš„å…³äºCPUå¯†é›†å‹ç¨‹åºå®ç°çš„æ€§èƒ½é—®é¢˜ï¼Œè€Œä¸æ˜¯æ¡†æ¶æœ¬èº«ã€‚</p>
<h3 id="åŸºå‡†æµ‹è¯•-äº¤æ›¿æœ€å°äºŒä¹˜æ³•æ¨è"><a href="#åŸºå‡†æµ‹è¯•-äº¤æ›¿æœ€å°äºŒä¹˜æ³•æ¨è" class="headerlink" title="åŸºå‡†æµ‹è¯•: äº¤æ›¿æœ€å°äºŒä¹˜æ³•æ¨è"></a>åŸºå‡†æµ‹è¯•: äº¤æ›¿æœ€å°äºŒä¹˜æ³•æ¨è</h3><p>ç”±äºALSå®ç°çš„ç¨‹åºçš„æœåŠ¡å±‚çš„å¤§å¤šæ•°çš„æ“ä½œæ˜¯ï¼Œä¼šåœ¨å†…å­˜ä¸­å®æ—¶çš„è®¡ç®—ä¸€ä¸ªéå¸¸å¤§çš„çŸ©é˜µï¼Œæ‰€ä»¥è¿™ä¸ªç¨‹åºæ˜¯æœ€å…·æœ‰æŒ‘æˆ˜æ€§çš„äº†ã€‚å¤§æ¦‚å…¶çš„è§„åˆ™å¦‚ä¸‹ï¼š</p>
<p>å¦‚æœéœ€è¦è¿è¡Œç±»ä¼¼çš„åŸºå‡†æµ‹è¯•ï¼Œå¯ä»¥ä½¿ç”¨LoadBenchmarkï¼Œå¯ä»¥æŒ‰ç…§å¦‚ä¸‹çš„é…ç½®ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">mvn -DskipTests clean install</span><br><span class="line">cd app/oryx-app-serving</span><br><span class="line">...</span><br><span class="line">mvn -Pbenchmark \</span><br><span class="line"> -Doryx.test.als.benchmark.users=1000000 \</span><br><span class="line"> -Doryx.test.als.benchmark.items=5000000 \</span><br><span class="line"> -Doryx.test.als.benchmark.features=250 \</span><br><span class="line"> -Doryx.test.als.benchmark.lshSampleRate=0.3 \</span><br><span class="line"> -Doryx.test.als.benchmark.workers=2 \</span><br><span class="line"> integration-test</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="å†…å­˜"><a href="#å†…å­˜" class="headerlink" title="å†…å­˜"></a>å†…å­˜</h3><ul>
<li>å†…å­˜éœ€æ±‚æ˜¯æˆçº¿æ€§çš„ï¼š(users + items) x features</li>
<li>-XX:+UseStringDeduplication åœ¨ Java 8ä¸­æ˜¯éå¸¸æœ‰ç”¨çš„ (reflected below)</li>
<li>At scale, 1M users or items ~= 500-1000M of heap required, depending on features</li>
</ul>
<p>  Example steady-state heap usage (Java 8):</p>
<table>
<thead>
<tr>
<th>Features</th>
<th>Users+Items (M)</th>
<th>Heap (MB)</th>
</tr>
</thead>
<tbody><tr>
<td>50</td>
<td>2</td>
<td>1400</td>
</tr>
<tr>
<td>50</td>
<td>6</td>
<td>2600</td>
</tr>
<tr>
<td>50</td>
<td>21</td>
<td>7500</td>
</tr>
<tr>
<td>250</td>
<td>2</td>
<td>3000</td>
</tr>
<tr>
<td>250</td>
<td>6</td>
<td>7500</td>
</tr>
<tr>
<td>250</td>
<td>21</td>
<td>25800</td>
</tr>
</tbody></table>
<h3 id="è¯·æ±‚å»¶è¿Ÿï¼Œååé‡"><a href="#è¯·æ±‚å»¶è¿Ÿï¼Œååé‡" class="headerlink" title="è¯·æ±‚å»¶è¿Ÿï¼Œååé‡"></a>è¯·æ±‚å»¶è¿Ÿï¼Œååé‡</h3><ul>
<li>Recommend and similarity computation time scales linearly with items x features</li>
<li>A single request is parallelized across CPUs; max throughput and minimum latency is already achieved at about 1-2 concurrent requests</li>
<li>Locality sensitive hashing decreases processing time roughly linearly; 0.33 ~= 1/0.33 ~= 3x faster (setting too low adversely affects result quality)</li>
</ul>
<p>  Below are representative throughput / latency measurements for the /recommend endpoint using<br>  a 32-core Intel Xeon 2.3GHz (Haswell), OpenJDK 8 and flags -XX:+UseG1GC -XX:+UseStringDeduplication. Heap size was comfortably large enough for the data set in each case. The tests were run with 1-3 concurrent request at a time, as necessary to achieve near-full CPU utilization.</p>
<p><em>With LSH (sample rate = 0.3)</em></p>
<table>
<thead>
<tr>
<th>Features</th>
<th>Items (M)</th>
<th>Throughput (qps)</th>
<th>Latency (ms)</th>
</tr>
</thead>
<tbody><tr>
<td>50</td>
<td>1</td>
<td>437</td>
<td>7</td>
</tr>
<tr>
<td>250</td>
<td>1</td>
<td>151</td>
<td>13</td>
</tr>
<tr>
<td>50</td>
<td>5</td>
<td>84</td>
<td>24</td>
</tr>
<tr>
<td>250</td>
<td>5</td>
<td>36</td>
<td>56</td>
</tr>
<tr>
<td>50</td>
<td>20</td>
<td>14</td>
<td>69</td>
</tr>
<tr>
<td>250</td>
<td>20</td>
<td>6</td>
<td>162</td>
</tr>
</tbody></table>
<p><em>Without LSH (sample rate = 1.0)</em></p>
<table>
<thead>
<tr>
<th>Features</th>
<th>Items (M)</th>
<th>Throughput (qps)</th>
<th>Latency (ms)</th>
</tr>
</thead>
<tbody><tr>
<td>50</td>
<td>1</td>
<td>74</td>
<td>27</td>
</tr>
<tr>
<td>250</td>
<td>1</td>
<td>23</td>
<td>44</td>
</tr>
<tr>
<td>50</td>
<td>5</td>
<td>13</td>
<td>80</td>
</tr>
<tr>
<td>250</td>
<td>5</td>
<td>5</td>
<td>191</td>
</tr>
<tr>
<td>50</td>
<td>20</td>
<td>4</td>
<td>282</td>
</tr>
<tr>
<td>250</td>
<td>20</td>
<td>1</td>
<td>708</td>
</tr>
</tbody></table>
<h3 id="JVM-ä¼˜åŒ–-1"><a href="#JVM-ä¼˜åŒ–-1" class="headerlink" title="JVM ä¼˜åŒ–"></a>JVM ä¼˜åŒ–</h3><p>æœºå™¨ä¸Šè¿è¡Œï¼ˆå¤šä¸ªï¼‰æœåŠ¡å±‚ï¼Œä½¿ç”¨è¶Šå¤šçš„å¯ç”¨çš„æ ¸ï¼Œæ„å‘³ç€å¯ä»¥æä¾›æ›´å¤šçš„å¹¶å‘è¯·æ±‚å¤„ç†èƒ½åŠ›ã€‚åœ¨ALSä¸­ï¼Œä¸€äº›è¯·æ±‚ï¼Œæ¯”å¦‚/recommend å¯ä»¥åœ¨ä¸€ä¸ªè¯·æ±‚ä¸­é€šè¿‡å¤šæ ¸è®¡ç®—å®Œæˆã€‚</p>
<p>å†…å­˜çš„éœ€æ±‚ä¸»è¦æ˜¯ç”±åŠ è½½è¿›å†…å­˜çš„æ¨¡å‹çš„éœ€æ±‚æ§åˆ¶çš„ã€‚å¯¹äºå¤§çš„æ¨¡å‹ï¼Œæ¯”å¦‚ALSï¼Œè¿™å°±æ„å‘³ç€éœ€è¦ç¡®ä¿æœåŠ¡å±‚æœ‰è¶³å¤Ÿçš„å†…å­˜ä»¥ä¿è¯ä¸ä¼šå¯¼è‡´GCå´©æºƒã€‚æŸ¥çœ‹oryx.serving.memoryã€‚</p>
<p>-XX:+UseG1GC remains a good garbage collection setting to supply with â€“jvm-args. In Java 8, -XX:+UseStringDeduplication can reduce memory requirements by about 20%.</p>
<h3 id="å®æ—¶è®¡ç®—å±‚"><a href="#å®æ—¶è®¡ç®—å±‚" class="headerlink" title="å®æ—¶è®¡ç®—å±‚"></a>å®æ—¶è®¡ç®—å±‚</h3><p>å®æ—¶è®¡ç®—å±‚é©±åŠ¨è¿›ç¨‹ç±»ä¼¼æœåŠ¡å±‚é‚£æ ·ä¹Ÿæ˜¯éœ€è¦å¤§é‡å†…å­˜çš„ï¼Œå› ä¸ºä»–ä¹Ÿæ˜¯éœ€è¦åŠ è½½ä¸€ä¸ªæ¨¡å‹åˆ°å†…å­˜ä¸­çš„ã€‚é©±åŠ¨è¿›ç¨‹çš„å†…å­˜æ˜¯é€šè¿‡oryx.speed.streaming.driver-memoryæ§åˆ¶çš„ï¼Œä¹Ÿéœ€è¦å’ŒæœåŠ¡å±‚å†…å­˜ä¸€æ ·è®¾ç½®ï¼Œå¹¶ä¸”ä¹Ÿéœ€è¦JVMçš„ä¸€äº›flagsæ”¯æŒã€‚</p>
<p>è¿™ä¹Ÿæ˜¯ä¸€ä¸ªSpark Streaming ä½œä¸šï¼Œä¹Ÿéœ€è¦æƒ³æ‰¹å¤„ç†å±‚é‚£æ ·é…ç½®executorsã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œéœ€è¦æ›´å°‘çš„å¤„ç†å’Œæ›´ä½çš„æ—¶é—´å»¶è¿Ÿã€‚</p>
<p>Executors will have to be sized to consume input Kafka partitions fully in parallel; the number of cores times number of executors should be at least the number of Kafka partitions.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2022/01/30/2016-04-07-Oryx2-performance-doc/" data-id="ckz0rdm4g000m94ut2vsvcqgi" data-title="Oryx2 æ€§èƒ½ä¼˜åŒ–æ–‡æ¡£" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-2016-04-06-Oryx2-end-user-doc" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2022/01/30/2016-04-06-Oryx2-end-user-doc/" class="article-date">
  <time class="dt-published" datetime="2022-01-30T04:24:01.505Z" itemprop="datePublished">2022-01-30</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2022/01/30/2016-04-06-Oryx2-end-user-doc/">Oryx2 ç»ˆç«¯ç”¨æˆ·æ–‡æ¡£</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h3 id="è¿è¡Œ"><a href="#è¿è¡Œ" class="headerlink" title="è¿è¡Œ"></a>è¿è¡Œ</h3><p>æ³¨æ„ï¼šä½ å¿…é¡»å·²ç»æŒ‰ç…§<a target="_blank" rel="noopener" href="http://reasonpun.com/2015/12/21/Oryx2-Admin-Docs/">ç®¡ç†å‘˜æ–‡æ¡£</a>ä¸­æåˆ°çš„é…ç½®å¥½äº†ä½ çš„é›†ç¾¤ã€‚</p>
<p>ä¸‹è½½æœ€æ–°çš„Oryxç‰ˆæœ¬ï¼ŒåŒ…æ‹¬æ‰¹å¤„ç†å±‚ï¼Œå®æ—¶è®¡ç®—å±‚å’ŒæœåŠ¡å±‚çš„jaræ–‡ä»¶å’Œshè„šæœ¬ã€‚</p>
<p>æˆ–è€…ï¼Œæºç ç¼–è¯‘ä»–ä»¬å¹¶ä»deploy/bin/è·å–æœ€æ–°çš„è„šæœ¬ã€‚</p>
<p>æ‹·è´äºŒè¿›åˆ¶å’Œè„šæœ¬åˆ°hadoopé›†ç¾¤çš„æœºå™¨ä¸Šã€‚ä»–ä»¬å¯ä»¥ä¼šè¢«éƒ¨ç½²åˆ°ä¸åŒçš„æœºå™¨ï¼Œæˆ–è€…æ˜¯è¢«éƒ¨ç½²åˆ°ä¸€ä¸ªæµ‹è¯•æœºå™¨ä¸Šã€‚å®æ—¶å’Œæ‰¹å¤„ç†å±‚åº”è¯¥è¿è¡Œä¸”åªèƒ½è¿è¡Œåœ¨ä¸€å°æœºå™¨ä¸Šï¼ˆThe Speed and Batch Layers should run on at most one machine, eachï¼‰ï¼ŒæœåŠ¡å±‚åˆ™å¯ä»¥è¿è¡Œäºå¤šä¸ªèŠ‚ç‚¹ä¸Šã€‚</p>
<p>åˆ›å»ºä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼Œå¯ä»¥ç®€å•çš„æ‹·è´ä¾‹å­ä¸­çš„conf/als-example.confã€‚å¹¶ä¿®æ”¹hoståç§°ï¼Œç«¯å£å’Œç›®å½•ã€‚å®é™…ä¸Šï¼Œé€‰æ‹©hdfsä¸Šå·²ç»å­˜åœ¨çš„æ•°æ®å’Œæ¨¡å‹ç›®å½•ä¾¿äºç”¨æˆ·è¿è¡ŒOryx äºŒè¿›åˆ¶å‘½ä»¤ã€‚</p>
<p>æ‹·è´è¯¥é…ç½®æ–‡ä»¶ï¼Œå¹¶é‡å‘½åä¸ºoryx.confï¼Œå°†ä»–æ”¾åˆ°æ¯ä¸ªæœºå™¨çš„ä¸ŠäºŒè¿›åˆ¶å‘½ä»¤å’Œè„šæœ¬ç›¸åŒçš„ç›®å½•ä¸‹ã€‚</p>
<p>æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤å¼€å§‹è¿™3ä¸ªå±‚çš„è¿è¡Œï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">./oryx-run.sh batch</span><br><span class="line">./oryx-run.sh speed</span><br><span class="line">./oryx-run.sh serving</span><br></pre></td></tr></table></figure>

<p>å‚æ•°â€“layer-jar your-layer.jar and â€“conf your-config.confå¯ä»¥æŒ‡å®šæŸä¸€å±‚ç‰¹å®šä½ç½®çš„jaræ–‡ä»¶å’Œé…ç½®æ–‡ä»¶ã€‚ä¹Ÿå¯ä»¥ä½¿ç”¨â€“jvm-argsç›´æ¥ä¼ é€’æ›´å¤šçš„å‚æ•°ç»™Sparké©±åŠ¨ç¨‹åºï¼Œæ¯”å¦‚ï¼šâ€“jvm-args=â€-Dkey=valueâ€</p>
<p>è¿™éƒ½ä¸éœ€è¦åœ¨åŒä¸€å°æœºå™¨ä¸Šï¼Œä½†æ˜¯ä¹Ÿä¸ä¸€å®šï¼ˆå¦‚æœé…ç½®ç‰¹æ®ŠæŒ‡å®šæ‰¹å¤„ç†å’Œå®æ—¶å¤„ç†å±‚ï¼ŒæœåŠ¡å±‚APIä¸åŒçš„ç«¯å£ï¼‰ã€‚æœåŠ¡å±‚å¯ä»¥è¿è¡Œåœ¨å¤šä¸ªæœºå™¨ä¸Šã€‚</p>
<p>ä¸¾ä¸ªä¾‹å­ï¼Œæ‰¹å¤„ç†å±‚SparkUIè¿è¡Œåœ¨å¯åŠ¨è„šæœ¬æ‰€åœ¨çš„æœºå™¨çš„4040ç«¯å£ï¼ˆé™¤éé€šè¿‡é…ç½®æ›´æ”¹ï¼‰ã€‚ä¸€ä¸ªç®€å•çš„åŸºäºwebç«¯çš„æ§åˆ¶å°çš„æœåŠ¡å±‚é»˜è®¤æ˜¯è¿è¡Œåœ¨8080ç«¯å£çš„ã€‚</p>
<p>å®Œç¾ï¼</p>
<h3 id="å°è¯•ä¸‹ALSçš„ä¾‹å­å§"><a href="#å°è¯•ä¸‹ALSçš„ä¾‹å­å§" class="headerlink" title="å°è¯•ä¸‹ALSçš„ä¾‹å­å§"></a>å°è¯•ä¸‹ALSçš„ä¾‹å­å§</h3><p>å¦‚æœä½ å·²ç»ä½¿ç”¨äº†ä¸Šè¿°çš„é…ç½®ï¼Œä½ å°±å·²ç»å¯ä»¥è¿è¡Œä¸€ä¸ªåŸºäºALSçš„æ¨èç¨‹åºå®ä¾‹ã€‚<br>è‡ªè·å–GroupLens 100Kçš„æ•°æ®é›†ï¼Œå¹¶ä¸”æ‰¾åˆ°u.dataæ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶çš„å†…å®¹éœ€è¦è½¬æ¢æˆcsvæ ¼å¼ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tr &#x27;\t&#x27; &#x27;,&#x27; &lt; u.data &gt; data.csv</span><br></pre></td></tr></table></figure>

<p>å°†è¿™äº›æ•°æ®æ”¾å…¥æœåŠ¡å±‚ï¼Œä½¿ç”¨æœ¬åœ°çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wget --quiet --post-file data.csv --output-document - \</span><br><span class="line">  --header &quot;Content-Type: text/csv&quot; \</span><br><span class="line">  http://your-serving-layer:8080/ingest</span><br></pre></td></tr></table></figure>

<p>å¦‚æœä½ ä½¿ç”¨tailå‘½ä»¤æŸ¥çœ‹è¾“å…¥çš„å†…å®¹ï¼Œå¯ä»¥çœ‹åˆ°å¦‚ä¸‹æ•°æ®ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">196,242,3.0,881250949186</span><br><span class="line">196,242,3.0,881250949</span><br><span class="line">186,302,3.0,891717742</span><br><span class="line">22,377,1.0,878887116</span><br><span class="line">244,51,2.0,880606923</span><br><span class="line">166,346,1.0,886397596</span><br><span class="line">298,474,4.0,884182806</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>å¾ˆå¿«çš„ï¼Œä½ ä¹Ÿå¯ä»¥çœ‹åˆ°æ‰¹å¤„ç†å±‚å·²ç»å¼€å§‹è§¦å‘ä¸€ä¸ªæ–°çš„è®¡ç®—äº†ã€‚è¿™ä¸ªä¾‹å­è¢«é…ç½®ä¸º5åˆ†é’Ÿä¸€ä¸ªå‘¨æœŸã€‚</p>
<p>æ•°æ®é¦–å…ˆä¼šè¢«å†™å…¥HDFSã€‚é»˜è®¤é…ç½®è¢«å†™å…¥hdfs:///user/example/Oryx/data/ç›®å½•ä¸‹ã€‚ä¸”ç›®å½•ä»¥æ—¶é—´æˆ³å‘½åï¼Œæ¯ä¸€éƒ¨åˆ†éƒ½åŒ…å«Hadoop part-r-* æ–‡ä»¶ï¼Œéƒ½æ˜¯ä»¥æ–‡æœ¬çš„åºåˆ—è¯æ–‡ä»¶çš„æ–¹å¼å­˜å‚¨ã€‚è™½ç„¶ä¸æ˜¯çº¯æ–‡æœ¬ï¼Œæ‰“å°å‡ºæ¥çš„è¯ï¼Œè¿˜æ˜¯æœ‰ä¸€éƒ¨åˆ†æ˜¯å¯ä»¥è¯†åˆ«çš„ï¼Œå› ä¸ºè¿™å…¶å®çœŸçš„æ˜¯æ–‡æœ¬ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SEQorg.apache.hadoop.io.Textorg.apache.hadoop.io.Textï¿½ï¿½ï¿½ï¿½^ï¿½]ï¿½XØ³Nï¿½22,377,1.0,87888711662...</span><br></pre></td></tr></table></figure>

<p>æ¨¡å‹è®¡ç®—å¼€å§‹ã€‚è¿™äº›æ‰¹å¤„ç†å±‚ä¼šä»¥å¤§é‡çš„æ–°çš„åˆ†å¸ƒå¼çš„ä½œä¸šå½¢å¼å±•ç°ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼ŒSpark UIå¯ä»¥é€šè¿‡<a href="http://your-batch-layer:4040è®¿é—®ã€‚">http://your-batch-layer:4040è®¿é—®ã€‚</a></p>
<p>æ¨¡å‹è®¡ç®—æ˜¯éå¸¸å¿«çš„ï¼Œæ‰§è¡Œå®Œæ¯•ä»¥åä¼šåˆå¹¶PMMLå’Œæ”¯æŒæ•°æ®æ–‡ä»¶å¹¶å­˜å‚¨åˆ°ç›®å½•hdfs:///user/example/Oryx/model/ä¸‹ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œmodel.pmml çš„å†…å®¹å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; standalone=&quot;yes&quot;?&gt;</span><br><span class="line">&lt;PMML xmlns=&quot;http://www.dmg.org/PMML-4_2&quot; version=&quot;4.2.1&quot;&gt;</span><br><span class="line">    &lt;Header&gt;</span><br><span class="line">        &lt;Application name=&quot;Oryx&quot;/&gt;</span><br><span class="line">        &lt;Timestamp&gt;2014-12-18T04:48:54-0800&lt;/Timestamp&gt;</span><br><span class="line">    &lt;/Header&gt;</span><br><span class="line">    &lt;Extension name=&quot;X&quot; value=&quot;X/&quot;/&gt;</span><br><span class="line">    &lt;Extension name=&quot;Y&quot; value=&quot;Y/&quot;/&gt;</span><br><span class="line">    &lt;Extension name=&quot;features&quot; value=&quot;10&quot;/&gt;</span><br><span class="line">    &lt;Extension name=&quot;lambda&quot; value=&quot;0.001&quot;/&gt;</span><br><span class="line">    &lt;Extension name=&quot;implicit&quot; value=&quot;true&quot;/&gt;</span><br><span class="line">    &lt;Extension name=&quot;alpha&quot; value=&quot;1.0&quot;/&gt;</span><br><span class="line">    &lt;Extension name=&quot;XIDs&quot;&gt;56 168 222 343 397 ...</span><br><span class="line">     ...</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>The X/ and Y/ subdirectories next to it contain feature vectors, like:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[56,[0.5746282834154238,-0.08896614131333057,-0.029456222765775263,</span><br><span class="line">  0.6039821219690552,0.1497901814774658,-0.018654312114339863,</span><br><span class="line">  -0.37342063488340266,-0.2370768843521807,1.148260034028485,</span><br><span class="line">  1.0645643656769153]]</span><br><span class="line">[168,[0.8722769882777296,0.4370416943031704,0.27402044461549885,</span><br><span class="line">  -0.031252701117490456,-0.7241385753098256,0.026079081002582338,</span><br><span class="line">  0.42050973702065714,0.27766923396205817,0.6241033215856671,</span><br><span class="line">  -0.48530795198811266]]</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>å¦‚æœä½¿ç”¨tailå‘½ä»¤æŸ¥çœ‹æ›´æ–°çš„å†…å®¹ã€‚<br>è¿™äº›æ•°æ®ä¼šå¾ˆå¿«æ”¾å…¥æœåŠ¡å±‚ï¼Œæ­¤æ—¶è®¿é—®/readyä¼šè¿”å›200 OKã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">wget --quiet --output-document - --server-response \</span><br><span class="line">  http://your-serving-layer:8080/ready</span><br><span class="line">...</span><br><span class="line">  HTTP/1.1 200 OK</span><br><span class="line">  Content-Length: 0</span><br><span class="line">  Date: Tue, 1 Sep 2015 13:26:53 GMT</span><br><span class="line">  Server: Oryx</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">wget --quiet --output-document -  http://your-serving-layer:8080/recommend/17</span><br><span class="line">...</span><br><span class="line">50,0.7749542842056966</span><br><span class="line">275,0.7373013861581563</span><br><span class="line">258,0.731818692628511</span><br><span class="line">181,0.7049967175706345</span><br><span class="line">127,0.704518989947498</span><br><span class="line">121,0.7014631029793741</span><br><span class="line">15,0.6954683387287907</span><br><span class="line">288,0.6774889711024022</span><br><span class="line">25,0.6663619887033064</span><br><span class="line">285,0.6398968471343595</span><br></pre></td></tr></table></figure>

<p>æ­å–œï¼å®æ—¶æ¨èç³»ç»Ÿæ­å»ºå®Œæ¯•ï¼å¯ä»¥é€šè¿‡Ctrl-Cå…³é—­ã€‚</p>
<h3 id="APIæ‰‹å†Œ"><a href="#APIæ‰‹å†Œ" class="headerlink" title="APIæ‰‹å†Œ"></a>APIæ‰‹å†Œ</h3><p>Oryx æ”¯æŒå¤šç§ç«¯åˆ°ç«¯çš„ç¨‹åºï¼ŒåŒ…æ‹¬æœåŠ¡å±‚çš„REST æ¥å£ã€‚</p>
<h3 id="ååŒè¿‡æ»¤å’Œæ¨è"><a href="#ååŒè¿‡æ»¤å’Œæ¨è" class="headerlink" title="ååŒè¿‡æ»¤å’Œæ¨è"></a>ååŒè¿‡æ»¤å’Œæ¨è</h3><ul>
<li><a target="_blank" rel="noopener" href="http://oryx.io/apidocs/com/cloudera/oryx/app/serving/als/Recommend.html">/recommend</a></li>
<li><a target="_blank" rel="noopener" href="http://oryx.io/apidocs/com/cloudera/oryx/app/serving/als/RecommendToMany.html">/recommendToMany</a></li>
<li><a target="_blank" rel="noopener" href="http://oryx.io/apidocs/com/cloudera/oryx/app/serving/als/RecommendToAnonymous.html">/recommendToAnonymous</a></li>
<li><a target="_blank" rel="noopener" href="http://oryx.io/apidocs/com/cloudera/oryx/app/serving/als/RecommendWithContext.html">/recommendWithContext</a></li>
<li><a target="_blank" rel="noopener" href="http://oryx.io/apidocs/com/cloudera/oryx/app/serving/als/Similarity.html">/similarity</a></li>
<li><a target="_blank" rel="noopener" href="http://oryx.io/apidocs/com/cloudera/oryx/app/serving/als/SimilarityToItem.html">/similarityToItem</a></li>
<li><a target="_blank" rel="noopener" href="http://oryx.io/apidocs/com/cloudera/oryx/app/serving/als/KnownItems.html">/knownItems</a></li>
<li><a target="_blank" rel="noopener" href="http://oryx.io/apidocs/com/cloudera/oryx/app/serving/als/Estimate.html">/estimate</a></li>
<li><a target="_blank" rel="noopener" href="http://oryx.io/apidocs/com/cloudera/oryx/app/serving/als/EstimateForAnonymous.html">/estimateForAnonymous</a></li>
<li><a target="_blank" rel="noopener" href="http://oryx.io/apidocs/com/cloudera/oryx/app/serving/als/Because.html">/because</a></li>
<li><a target="_blank" rel="noopener" href="http://oryx.io/apidocs/com/cloudera/oryx/app/serving/als/MostSurprising.html">/mostSurprising</a></li>
<li><a target="_blank" rel="noopener" href="http://oryx.io/apidocs/com/cloudera/oryx/app/serving/als/PopularRepresentativeItems.html">/popularRepresentativeItems</a></li>
<li><a target="_blank" rel="noopener" href="http://oryx.io/apidocs/com/cloudera/oryx/app/serving/als/MostActiveUsers.html">/mostActiveUsers</a></li>
<li><a target="_blank" rel="noopener" href="http://oryx.io/apidocs/com/cloudera/oryx/app/serving/als/MostPopularItems.html">/mostPopularItems</a></li>
<li><a target="_blank" rel="noopener" href="http://oryx.io/apidocs/com/cloudera/oryx/app/serving/als/MostActiveUsers.html">/mostActiveUsers</a></li>
<li><a target="_blank" rel="noopener" href="http://oryx.io/apidocs/com/cloudera/oryx/app/serving/als/AllItemIDs.html">/item/allIDs</a></li>
<li><a target="_blank" rel="noopener" href="http://oryx.io/apidocs/com/cloudera/oryx/app/serving/als/Ready.html">/ready</a></li>
<li><a target="_blank" rel="noopener" href="http://oryx.io/apidocs/com/cloudera/oryx/app/serving/als/Preference.html">/pref</a></li>
<li><a target="_blank" rel="noopener" href="http://oryx.io/apidocs/com/cloudera/oryx/app/serving/als/Ingest.html">/ingest</a></li>
</ul>
<h3 id="åˆ†ç±»-å›å½’"><a href="#åˆ†ç±»-å›å½’" class="headerlink" title="åˆ†ç±» / å›å½’"></a>åˆ†ç±» / å›å½’</h3><ul>
<li><a target="_blank" rel="noopener" href="http://oryx.io/apidocs/com/cloudera/oryx/app/serving/rdf/Predict.html">/predict</a></li>
<li><a target="_blank" rel="noopener" href="http://oryx.io/apidocs/com/cloudera/oryx/app/serving/rdf/ClassificationDistribution.html">/classificationDistribution</a></li>
<li><a target="_blank" rel="noopener" href="http://oryx.io/apidocs/com/cloudera/oryx/app/serving/rdf/Ready.html">/ready</a></li>
<li><a target="_blank" rel="noopener" href="http://oryx.io/apidocs/com/cloudera/oryx/app/serving/rdf/Train.html">/train</a></li>
</ul>
<h3 id="èšç±»"><a href="#èšç±»" class="headerlink" title="èšç±»"></a>èšç±»</h3><ul>
<li><a target="_blank" rel="noopener" href="http://oryx.io/apidocs/com/cloudera/oryx/app/serving/kmeans/Assign.html">/assign</a></li>
<li><a target="_blank" rel="noopener" href="http://oryx.io/apidocs/com/cloudera/oryx/app/serving/kmeans/DistanceToNearest.html">/distanceToNearest</a></li>
<li><a target="_blank" rel="noopener" href="http://oryx.io/apidocs/com/cloudera/oryx/app/serving/kmeans/Ready.html">/ready</a></li>
<li><a target="_blank" rel="noopener" href="http://oryx.io/apidocs/com/cloudera/oryx/app/serving/kmeans/Add.html">/add</a></li>
</ul>
<h3 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h3><ul>
<li><a target="_blank" rel="noopener" href="https://github.com/OryxProject/oryx/blob/master/app/conf/als-example.conf">app/conf/als-example.conf</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/OryxProject/oryx/blob/master/app/conf/kmeans-example.conf">app/conf/kmeans-example.conf</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/OryxProject/oryx/blob/master/app/conf/rdf-example.conf">app/conf/rdf-example.conf</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2022/01/30/2016-04-06-Oryx2-end-user-doc/" data-id="ckz0rdm4g000j94utctuq4x3a" data-title="Oryx2 ç»ˆç«¯ç”¨æˆ·æ–‡æ¡£" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-2016-04-06-Oryx2-developer-doc" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2022/01/30/2016-04-06-Oryx2-developer-doc/" class="article-date">
  <time class="dt-published" datetime="2022-01-30T04:24:01.502Z" itemprop="datePublished">2022-01-30</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2022/01/30/2016-04-06-Oryx2-developer-doc/">Oryx2 å¼€å‘è€…æ–‡æ¡£</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h3 id="ç¯å¢ƒéœ€æ±‚"><a href="#ç¯å¢ƒéœ€æ±‚" class="headerlink" title="ç¯å¢ƒéœ€æ±‚"></a>ç¯å¢ƒéœ€æ±‚</h3><ul>
<li><a target="_blank" rel="noopener" href="http://git-scm.com/">git</a>, æˆ–è€…ä¸€ä¸ªæ”¯æŒgitçš„IDE</li>
<li><a target="_blank" rel="noopener" href="http://maven.apache.org/">Apache Maven</a> 3.2.1 æˆ–è€…æ›´æ–°ç‰ˆæœ¬</li>
<li><a target="_blank" rel="noopener" href="http://www.oracle.com/technetwork/java/javase/downloads/index.html">Java JDK</a> (ä¸èƒ½åªæœ‰JRE) 7 æˆ–è€…æ›´æ–°ç‰ˆæœ¬</li>
</ul>
<p>ä»¥ä¸Šéœ€è¦å·²ç»å®‰è£…åˆ°äº†ä½ çš„å¼€å‘ç¯å¢ƒä¸­ã€‚</p>
<h2 id="Building"><a href="#Building" class="headerlink" title="Building"></a>Building</h2><p>å…‹éš†ä»£ç åˆ°ä½ æœ¬åœ°ï¼Œå¹¶ä¸”ç¼–è¯‘ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/OryxProject/oryx.git oryx</span><br><span class="line">cd oryx</span><br><span class="line">mvn -DskipTests package</span><br></pre></td></tr></table></figure>

<p>ä¼šç¼–è¯‘å‡ºå¦‚ä¸‹çš„äºŒè¿›åˆ¶çš„jaræ–‡ä»¶ï¼š</p>
<ul>
<li>æ‰¹å¤„ç†å±‚: deploy/oryx-batch/target/oryx-batch-2.1.2.jar</li>
<li>å®æ—¶å¤„ç†å±‚: deploy/oryx-speed/target/oryx-speed-2.1.2.jar</li>
<li>æœåŠ¡å±‚: deploy/oryx-serving/target/oryx-serving-2.1.2.jar</li>
</ul>
<p>å‹æƒ…æé†’ï¼Œå¦‚æœä½ å¯¹å¼€å‘Oryxæ„Ÿå…´è¶£ï¼Œå¯ä»¥æ ¹æ®è¿™ä¸ª<a target="_blank" rel="noopener" href="https://help.github.com/articles/fork-a-repo">åˆ†æ”¯</a>å…‹éš†è‡ªå·±çš„åˆ†æ”¯ï¼Œç„¶åå°±å¯ä»¥æäº¤ä¿®æ”¹äº†ã€‚</p>
<h3 id="Java-8"><a href="#Java-8" class="headerlink" title="Java 8"></a>Java 8</h3><p>å¦‚æœä½¿ç”¨Java8ç¼–è¯‘ï¼Œéœ€è¦æ·»åŠ å‚æ•°-Pjava8 å¹¶ä¸”æµ‹è¯•è¿™é‡Œçš„æŒ‡ä»¤ã€‚</p>
<h3 id="Platform-Only"><a href="#Platform-Only" class="headerlink" title="Platform Only"></a>Platform Only</h3><p>é»˜è®¤çš„ç¼–è¯‘åŒ…æ‹¬åŸºäºSpark MLlibå’Œå…¶ä»–åº“çš„ç«¯åˆ°ç«¯çš„MLç¨‹åºã€‚å¦‚æœåªæ˜¯ç¼–è¯‘lambdaå’ŒMLå±‚ï¼Œéœ€è¦é€šè¿‡å‚æ•°-P!app-tierå…³é—­å…¶ä»–çš„é€‰é¡¹ã€‚æ³¨æ„ï¼Œåœ¨bashä¸­ï¼Œï¼éœ€è¦è½¬ä¹‰ï¼š -P!app-tierã€‚</p>
<h3 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h3><p>mvn æµ‹è¯•ä¼šæ‰§è¡Œæ‰€æœ‰çš„ä½†æ„¿æµ‹è¯•ç”¨ä¾‹ã€‚ä¹ŸåŒæ—¶ä¼šæ‰§è¡Œæ‰€æœ‰çš„é›†æˆæµ‹è¯•ï¼Œè¿™ä¸ªå¯èƒ½ä¼šéœ€è¦ç¨å¾®é•¿ç‚¹çš„æ—¶é—´ã€‚</p>
<h2 id="æ¨¡å‹å¯¹åº”è¡¨"><a href="#æ¨¡å‹å¯¹åº”è¡¨" class="headerlink" title="æ¨¡å‹å¯¹åº”è¡¨"></a>æ¨¡å‹å¯¹åº”è¡¨</h2><p>ä¸»è¦çš„æ¨¡å‹å’Œä»–ä»¬å¯¹åº”çš„å±‚ï¼š</p>
<table>
<thead>
<tr>
<th></th>
<th>Serving</th>
<th>Speed</th>
<th>Batch</th>
</tr>
</thead>
<tbody><tr>
<td>Binary</td>
<td>oryx-serving</td>
<td>oryx-speed</td>
<td>oryx-batch</td>
</tr>
<tr>
<td>App</td>
<td>oryx-app-serving</td>
<td>oryx-app-mllib oryx-app</td>
<td>oryx-app-mllib oryx-app</td>
</tr>
<tr>
<td>ML</td>
<td></td>
<td>oryx-ml</td>
<td>oryx-ml</td>
</tr>
<tr>
<td>Lambda</td>
<td>oryx-lambda-serving</td>
<td>oryx-lambda</td>
<td>oryx-lambda</td>
</tr>
</tbody></table>
<p>æ”¯æŒçš„æ¨¡å‹ï¼Œæ¯”å¦‚ï¼š<a target="_blank" rel="noopener" href="https://github.com/OryxProject/oryx/tree/master/framework/oryx-common">oryx-common</a>, <a target="_blank" rel="noopener" href="https://github.com/OryxProject/oryx/tree/master/app/oryx-app-common">oryx-app-common</a>, <a target="_blank" rel="noopener" href="https://github.com/OryxProject/oryx/tree/master/framework/oryx-api">oryx-api</a>, and <a target="_blank" rel="noopener" href="https://github.com/OryxProject/oryx/tree/master/app/oryx-app-api">oryx-app-api</a> æ²¡æœ‰åœ¨è¿™é‡Œåˆ—å‡ºäº†ã€‚</p>
<h2 id="å®ç°ä¸€ä¸ªOryx-ç¨‹åº"><a href="#å®ç°ä¸€ä¸ªOryx-ç¨‹åº" class="headerlink" title="å®ç°ä¸€ä¸ªOryx ç¨‹åº"></a>å®ç°ä¸€ä¸ªOryx ç¨‹åº</h2><p>Oryx ä¸­çš„â€œapp å±‚â€ï¼Œæ˜¯å®ç°äº†æ¨èçš„çœŸå®çš„æ‰¹å¤„ç†ï¼Œå®æ—¶ï¼ŒæœåŠ¡å±‚é€»è¾‘ï¼Œé›†ç¾¤å’Œåˆ†ç±»ã€‚ç„¶è€Œï¼Œä»»ä½•å®ç°éƒ½éœ€è¦ä½¿ç”¨åˆ°Oryxã€‚ä»–ä»¬ä¹Ÿå¯ä»¥æ··åˆå’ŒåŒ¹é…ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œä½ å¯ä»¥é‡æ–°å®ç°ALS-relatedæ¨èçš„æ‰¹å¤„ç†å±‚ï¼Œä½†æ˜¯ä»ç„¶ä½¿ç”¨åŸæ¥çš„ALSçš„æœåŠ¡å±‚å’Œå®æ—¶è®¡ç®—å±‚ã€‚</p>
<h3 id="åˆ›å»ºä¸€ä¸ªç¨‹åº"><a href="#åˆ›å»ºä¸€ä¸ªç¨‹åº" class="headerlink" title="åˆ›å»ºä¸€ä¸ªç¨‹åº"></a>åˆ›å»ºä¸€ä¸ªç¨‹åº</h3><p>åœ¨æ¯ä¸ªä¾‹å­ä¸­ï¼Œåˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰çš„æ‰¹å¤„ç†å±‚ï¼Œå®æ—¶è®¡ç®—å±‚æˆ–è€…æœåŠ¡å±‚çš„ç¨‹åºéƒ½éœ€è¦å®ç°com.cloudera.oryx.apiä¸­çš„å‡ ä¸ªå…³é”®çš„Javaæ¥å£æˆ–è€…Scalaçš„ç‰¹æ€§ã€‚è¿™äº›æ¥å£/ç‰¹æ€§å¯ä»¥åœ¨é¡¹ç›®çš„oryx-apiæ¨¡å‹ä¸­æ‰¾åˆ°ã€‚</p>
<table>
<thead>
<tr>
<th></th>
<th>Java</th>
<th>Scala</th>
</tr>
</thead>
<tbody><tr>
<td>Batch</td>
<td>batch.BatchLayerUpdate</td>
<td>batch.ScalaBatchLayerUpdate</td>
</tr>
<tr>
<td>Speed</td>
<td>speed.SpeedModelManager</td>
<td>speed.ScalaSpeedModelManager</td>
</tr>
<tr>
<td>Serving</td>
<td>serving.ServingModelManager</td>
<td>serving.ScalaServingModelManager</td>
</tr>
</tbody></table>
<p>com.cloudera.oryx.apiä¹ŸåŒ…å«å¤§é‡çš„å…³é”®çš„ç±»å’Œæ¥å£ï¼Œä¸¾ä¸ªä¾‹å­ï¼Œ<a target="_blank" rel="noopener" href="https://github.com/OryxProject/oryx/blob/master/framework/oryx-api/src/main/java/com/cloudera/oryx/api/serving/OryxResource.java">serving.OryxResource</a>  æ˜¯ä¸€ä¸ªå…¥å£ï¼Œç”¨æ¥ç¼–è¯‘è‡ªå®šä¹‰çš„JAX-RS ç«¯ç‚¹ï¼Œä½†æ˜¯ä¸éœ€è¦ä½¿ç”¨ã€‚</p>
<h3 id="ç¼–è¯‘ç¨‹åº"><a href="#ç¼–è¯‘ç¨‹åº" class="headerlink" title="ç¼–è¯‘ç¨‹åº"></a>ç¼–è¯‘ç¨‹åº</h3><p>è¿›å…¥ä½ çš„ç¨‹åºçš„è¿™äº›æ¥å£/ç‰¹æ€§ï¼Œæ·»åŠ ä¸€ä¸ªcom.cloudera.oryx:oryx-apiçš„ä¾èµ–ï¼Œscopeå­—æ®µéœ€è¦å¡«å†™â€œprovidedâ€ï¼Œåœ¨Mavenä¸­ï¼Œéœ€è¦æ·»åŠ å¦‚ä¸‹ä¾èµ–ï¼š<br>In Maven, this would mean adding a dependency like:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependencies&gt;</span><br><span class="line">  &lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;com.cloudera.oryx&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;oryx-api&lt;/artifactId&gt;</span><br><span class="line">    &lt;scope&gt;provided&lt;/scope&gt;</span><br><span class="line">    &lt;version&gt;2.1.2&lt;/version&gt;</span><br><span class="line">  &lt;/dependency&gt;</span><br><span class="line">&lt;/dependencies&gt;</span><br></pre></td></tr></table></figure>

<p>è¿™äº›artifactsè¢«æ”¾åœ¨äº†<a target="_blank" rel="noopener" href="https://repository.cloudera.com/artifactory/cloudera-repos/">Cloudera</a>è¿™ä¸ªåˆ†æ”¯ä¸‹ï¼Œå› æ­¤åœ¨ç¼–è¯‘çš„æ—¶å€™éœ€è¦å¼•ç”¨è¿™ä¸ªåˆ†æ”¯ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;repositories&gt;</span><br><span class="line">  &lt;repository&gt;</span><br><span class="line">    &lt;id&gt;cloudera&lt;/id&gt;</span><br><span class="line">    &lt;url&gt;https://repository.cloudera.com/artifactory/cloudera-repos/&lt;/url&gt;</span><br><span class="line">  &lt;/repository&gt;</span><br><span class="line">&lt;/repositories&gt;</span><br></pre></td></tr></table></figure>

<p>ä¸€ä¸ªæœ€å°çš„å®ä¾‹å¯ä»¥è®¿é—®<a target="_blank" rel="noopener" href="https://github.com/OryxProject/oryx/tree/master/app/example">example/</a> è¿™é‡Œã€‚</p>
<p>â€Word Countâ€ è¿™ä¸ªç¨‹åºæ˜¯æŒ‰ç…§ç©ºæ ¼å°†è¡Œåˆ†å‰²æˆç‹¬ç«‹çš„å•è¯ï¼Œç„¶åç»Ÿè®¡å‡ºæ’é‡åçš„å•è¯å‡ºç°çš„æ¬¡æ•°ã€‚</p>
<p>ç¼–è¯‘ä»£ç åç”Ÿæˆä¸€ä¸ªJARæ–‡ä»¶ï¼ŒåŒ…å«äº†ç¨‹åºå®ç°å’Œæ‰€æœ‰ç¬¬ä¸‰æ–¹çš„diamï¼Œå¦‚æœä½¿ç”¨Mavenï¼Œå¯ä»¥é€šè¿‡mvn packageå‘½ä»¤ã€‚</p>
<h3 id="ç¼–è¯‘-Word-Count-ä¾‹å­"><a href="#ç¼–è¯‘-Word-Count-ä¾‹å­" class="headerlink" title="ç¼–è¯‘ Word Count ä¾‹å­"></a>ç¼–è¯‘ Word Count ä¾‹å­</h3><p>ä¸¾ä¾‹ï¼šç¼–è¯‘æ ·ä¾‹ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd app/example</span><br><span class="line">mvn package</span><br></pre></td></tr></table></figure>

<p>ç”Ÿæˆçš„JARåŒ…åœ¨target/example-2.1.2.jarã€‚</p>
<h3 id="è‡ªå®šä¹‰Oryxç¨‹åº"><a href="#è‡ªå®šä¹‰Oryxç¨‹åº" class="headerlink" title="è‡ªå®šä¹‰Oryxç¨‹åº"></a>è‡ªå®šä¹‰Oryxç¨‹åº</h3><p>å½“å‘å¸ƒä¸€ä¸ªæºè‡ªOryxçš„é¢„æ‰“åŒ…ç¨‹åºï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæœ‰å¯èƒ½ä¼šæä¾›ä¸€ä¸ªæ‰©å±•çš„å®ç°ï¼Œä»è€Œå¯ä»¥è‡ªå®šä¹‰ä»–ä»¬çš„è¡Œä¸ºã€‚ä¸¾ä¾‹ï¼ŒALSæ¨èç¨‹åºæš´éœ²äº†com.cloudera.oryx.app.als.RescorerProvideræ¥å£ã€‚è¿™äº›ç‰¹å®šç¨‹åºAPIç±»å¯ä»¥åœ¨æ¨¡å—oryx-app-apiä¸­æ‰¾åˆ°ã€‚è¿™äº›æ¥å£çš„å®ç°ä¹Ÿå¯ä»¥åœ¨ç‹¬ç«‹æ¨¡å¼ä¸‹è¢«ç¼–è¯‘ï¼Œæ‰“åŒ…ï¼Œéƒ¨ç½²ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependencies&gt;</span><br><span class="line">  &lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;com.cloudera.oryx&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;oryx-app-api&lt;/artifactId&gt;</span><br><span class="line">    &lt;scope&gt;provided&lt;/scope&gt;</span><br><span class="line">    &lt;version&gt;2.1.2&lt;/version&gt;</span><br><span class="line">  &lt;/dependency&gt;</span><br><span class="line">&lt;/dependencies&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="å‘å¸ƒç¨‹åº"><a href="#å‘å¸ƒç¨‹åº" class="headerlink" title="å‘å¸ƒç¨‹åº"></a>å‘å¸ƒç¨‹åº</h2><p>æ‹·è´ç”Ÿæˆçš„JARæ–‡ä»¶â€“myapp.jarï¼Œæ”¾åˆ°éœ€è¦æ‰§è¡Œçš„Oryx äºŒè¿›åˆ¶JARæ–‡ä»¶ç›¸åŒçš„ç›®å½•ä¸‹ã€‚</p>
<p>ä¿®æ”¹Oryxçš„é…ç½®æ–‡ä»¶ï¼Œä»¥ä¾¿äºå¼•ç”¨è‡ªå®šä¹‰çš„æ‰¹å¤„ç†ï¼Œå®æ—¶è®¡ç®—å’ŒæœåŠ¡å±‚çš„å®ç°ã€‚<br>å½“æ‰§è¡Œæ‰¹å¤„ç†ï¼Œå®æ—¶è®¡ç®—å’ŒæœåŠ¡å±‚æ—¶ï¼Œéœ€è¦æ·»åŠ â€“app-jar myapp.jaråˆ°oryx-run.shå‘½ä»¤è¡Œä¸­ã€‚</p>
<h3 id="å‘å¸ƒ-Word-Count-ä¾‹å­"><a href="#å‘å¸ƒ-Word-Count-ä¾‹å­" class="headerlink" title="å‘å¸ƒ Word Count ä¾‹å­"></a>å‘å¸ƒ Word Count ä¾‹å­</h3><p>ä¸¾ä¾‹ï¼Œå¦‚æœå·²ç»ç¼–è¯‘å¥½äº†ä¸Šè¿°çš„â€œword countâ€çš„ç¨‹åºï¼Œä½ å¯ä»¥æ‰§è¡Œè¿™ä¸ªç¨‹åºï¼Œç›´æ¥å¼•ç”¨wordcount-example.confè¿™ä¸ªé…ç½®æ–‡ä»¶ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./oryx-run.sh batch --conf wordcount-example.conf --app-jar example-2.1.2.jar</span><br></pre></td></tr></table></figure>

<p>â€¦ å¯¹äºå®æ—¶è®¡ç®—å’ŒæœåŠ¡å±‚ä¹Ÿæ˜¯åŒæ ·çš„ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">curl -X POST http://.../add/foo%20bar%20baz</span><br><span class="line">...</span><br><span class="line">curl http://.../distinct</span><br><span class="line">&#123;&quot;foo&quot;:2,&quot;bar&quot;:2,&quot;baz&quot;:2&#125;</span><br></pre></td></tr></table></figure>

<p>é…ç½®æ–‡ä»¶æœ¬èº«å·²ç»é…ç½®å¥½äº†ä¸»æœºåç§°å’Œ<a target="_blank" rel="noopener" href="http://www.cloudera.com/content/www/en-us/downloads/quickstart_vms.html">Cloudera Quickstart VM</a>çš„å‚æ•°ã€‚äº‹å®ä¸Šï¼Œè¿™ä¸ªä¾‹å­å¯ä»¥ä½œä¸ºä¸€ä¸ªé›†ç¾¤é…ç½®çš„ä¾‹å­ï¼š<a target="_blank" rel="noopener" href="http://oryx.io/docs/admin.html#cloudera_quickstart_vm_setup">Cloudera Quickstart VM Setup</a>ã€‚</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2022/01/30/2016-04-06-Oryx2-developer-doc/" data-id="ckz0rdm4e000g94ut9pbj318h" data-title="Oryx2 å¼€å‘è€…æ–‡æ¡£" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-2016-03-08-Java-keyword-volatile" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2022/01/30/2016-03-08-Java-keyword-volatile/" class="article-date">
  <time class="dt-published" datetime="2022-01-30T04:24:01.500Z" itemprop="datePublished">2022-01-30</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2022/01/30/2016-03-08-Java-keyword-volatile/">Javaå…³é”®å­—volatile</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        Javaå…³é”®å­—volatileæ ‡è¯†ä¸€ä¸ªå˜é‡â€œè¢«å­˜å‚¨åœ¨ä¸»å†…å­˜ä¸­â€ã€‚æ›´å‡†ç¡®çš„è¯´æ³•æ˜¯ï¼šæ¯æ¬¡volatileå˜é‡ä¼šä»ä¸»å†…å­˜ä¸­è¯»å–ï¼Œè€Œä¸æ˜¯ä»CPUç¼“å­˜ï¼›æ¯æ¬¡volatileå˜é‡çš„å†™æ“ä½œä¼šå†™å…¥ä¸»å†…å­˜ï¼Œè€Œä¸ä»…ä»…æ˜¯CPUç¼“å­˜ã€‚
        
          <p class="article-more-link">
            <a href="/2022/01/30/2016-03-08-Java-keyword-volatile/#more">Read More</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2022/01/30/2016-03-08-Java-keyword-volatile/" data-id="ckz0rdm4f000h94utagh3dif3" data-title="Javaå…³é”®å­—volatile" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Java/" rel="tag">Java</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-2016-01-24-Reg-Nginx" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2022/01/30/2016-01-24-Reg-Nginx/" class="article-date">
  <time class="dt-published" datetime="2022-01-30T04:24:01.498Z" itemprop="datePublished">2022-01-30</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2022/01/30/2016-01-24-Reg-Nginx/">æ­£åˆ™è¡¨è¾¾å¼å¤„ç†Nginx</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="Nginx-æ—¥å¿—é…ç½®æ ¼å¼"><a href="#Nginx-æ—¥å¿—é…ç½®æ ¼å¼" class="headerlink" title="Nginx æ—¥å¿—é…ç½®æ ¼å¼"></a>Nginx æ—¥å¿—é…ç½®æ ¼å¼</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">log_format  main</span><br><span class="line">        &#x27;[$upstream_addr] $remote_addr [$time_local] &quot;$request&quot; $status &#x27;</span><br><span class="line">        &#x27;&quot;$request_body&quot; $body_bytes_sent &quot;$http_referer&quot; &quot;$http_user_agent&quot; &#x27;</span><br><span class="line">        &#x27;RESP:$upstream_response_time &#x27;</span><br><span class="line">        &#x27;REQ:$request_time&#x27;;</span><br></pre></td></tr></table></figure>

<h1 id="æ ·ä¾‹"><a href="#æ ·ä¾‹" class="headerlink" title="æ ·ä¾‹"></a>æ ·ä¾‹</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[192.168.1.5:80] 19.78.22.51 [31/Dec/2015:13:59:02 +0800] &quot;POST /api/mbbb/dup_msg_send?pallow_dubbing=0&amp;partner_msgs_id=279&amp;roles_id=23&amp;score=6700&amp;section_id=512&amp;whole_audio=200.m4a&amp;d</span><br><span class="line">evice_id=112222f0fc3&amp;lang=zh-CN&amp;trigger=user&amp;user_id=516487&amp;v=ios_7.0.3 HTTP/1.1&quot; 200 &quot;audio_fragment=00280%22%3A%7B%22pitch%22%3A47%2C%22rhythm%22%3A95%2C%22tone%22%3A75%7D%2C%226800278%22%3A%7B%22pitch%22%3A70%2C%22rhythm%22%3A90%2%7D%2C%226800276%22</span><br><span class="line">%3A%7B%22pitch%22%3A60%2C%22rhythm%22%3A82%2C%22tone%22D&amp;content=hhhhhh%E5%B0%8F%E5%AB%A9%E8%8D%89&quot; 51 &quot;-&quot; &quot;paipao/7.0.3 (iPhone; iOS 9.2; Scale/2.00)&quot; RESP:0.166 REQ:0.167</span><br><span class="line">[192.168.1.5:80, 192.169.1.33:88] 60.12.246.5 [31/Dec/2015:23:59:02 +0800] &quot;GET /api/mppb/notice/list?device_id=112233fe6a6d991f&amp;lang=zh-CN&amp;user_id=6120&amp;v=ios_7.0.3 HTTP/1.1&quot; 200 &quot;-&quot; 54 &quot;-&quot; &quot;paipao/7.0.3 (iPhone; iOS 9.2; Scale/2.00)&quot; RESP:0.006 REQ:0.006</span><br></pre></td></tr></table></figure>

<h1 id="æ­£åˆ™è¡¨è¾¾å¼"><a href="#æ­£åˆ™è¡¨è¾¾å¼" class="headerlink" title="æ­£åˆ™è¡¨è¾¾å¼"></a>æ­£åˆ™è¡¨è¾¾å¼</h1><h2 id="Pythonç‰ˆæœ¬"><a href="#Pythonç‰ˆæœ¬" class="headerlink" title="Pythonç‰ˆæœ¬"></a>Pythonç‰ˆæœ¬</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">p = re.compile(</span><br><span class="line">            r&quot;\[\-?[\d.\:]*[\ \,]*?.*?\]\ [\d.\:]*\ \[(\d+)/(\w+)/(\d+)\:(\S+)\ [\S]+\]\ \&quot;(\S+)\ (\S+)\ .*?\&quot;\ (\d+)\ \&quot;(.*?)\&quot;\ (\d+)\ \&quot;([^\&quot;]*)\&quot;\ \&quot;.*?\&quot; .*?&quot;)</span><br><span class="line">m = re.findall(p, line)</span><br><span class="line">day = m[0][0]</span><br><span class="line">month = m[0][1]</span><br><span class="line">year = m[0][2]</span><br><span class="line">ttime = m[0][3]</span><br><span class="line">method = m[0][4]</span><br><span class="line">request = m[0][5]</span><br><span class="line">status = m[0][6]</span><br></pre></td></tr></table></figure>

<h2 id="Scalaç‰ˆæœ¬"><a href="#Scalaç‰ˆæœ¬" class="headerlink" title="Scalaç‰ˆæœ¬"></a>Scalaç‰ˆæœ¬</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">val regex = new Regex( &quot;&quot;&quot;\[\-?[\d.\:]*[\ \,]*?.*?\]\ [\d.\:]*\ \[(\d+)/(\w+)/(\d+)\:(\S+)\ [\S]+\]\ \&quot;(\S+)\ (\S+)\ .*?\&quot;\ (\d+)\ \&quot;(.*?)\&quot;\ (\d+)\ \&quot;([^\&quot;]*)\&quot;\ \&quot;.*?\&quot; .*?&quot;&quot;&quot;)</span><br><span class="line">val regex(day, month, year, time, method, request, status, postData, bytes, refer) = line</span><br></pre></td></tr></table></figure>

<h1 id="å‚è€ƒæ–‡çŒ®"><a href="#å‚è€ƒæ–‡çŒ®" class="headerlink" title="å‚è€ƒæ–‡çŒ®"></a>å‚è€ƒæ–‡çŒ®</h1><ul>
<li><a target="_blank" rel="noopener" href="http://www.jianshu.com/p/5d8c802be13d">http://www.jianshu.com/p/5d8c802be13d</a></li>
<li><a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000002727070">https://segmentfault.com/a/1190000002727070</a></li>
<li><a target="_blank" rel="noopener" href="http://desert3.iteye.com/blog/1001568">http://desert3.iteye.com/blog/1001568</a></li>
<li><a target="_blank" rel="noopener" href="http://stackoverflow.com/questions/996536/regex-in-python">http://stackoverflow.com/questions/996536/regex-in-python</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2022/01/30/2016-01-24-Reg-Nginx/" data-id="ckz0rdm4d000c94uthi6t66ay" data-title="æ­£åˆ™è¡¨è¾¾å¼å¤„ç†Nginx" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-2016-01-04-Spark-tuning" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2022/01/30/2016-01-04-Spark-tuning/" class="article-date">
  <time class="dt-published" datetime="2022-01-30T04:24:01.496Z" itemprop="datePublished">2022-01-30</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2022/01/30/2016-01-04-Spark-tuning/">Sparkä¼˜åŒ–</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="Spark-ä¼˜åŒ–"><a href="#Spark-ä¼˜åŒ–" class="headerlink" title="Spark ä¼˜åŒ–"></a>Spark ä¼˜åŒ–</h2><p>ç”±äºSparkå†…å­˜è®¡ç®—ç‰¹æ€§ï¼ŒSparkç¨‹åºä¼šç”±é›†ç¾¤ä¸Šçš„å¦‚ä¸‹å› ç´ å†³å®šå…¶æ€§èƒ½</p>
<ul>
<li>CPU</li>
<li>ç½‘ç»œå¸¦å®½</li>
<li>å†…å­˜</li>
</ul>
<p>é€šå¸¸æ¥è¯´ï¼Œå¦‚æœé…ç½®é€‚å½“çš„å†…å­˜ï¼Œé‚£ä¹ˆç“¶é¢ˆå°±æ˜¯å¸¦å®½ã€‚ä½†æ˜¯æœ‰äº›æ—¶å€™ï¼Œæœ‰éœ€è¦åšäº›ä¼˜åŒ–ï¼Œæ¯”å¦‚ä»¥åºåˆ—åŒ–çš„å½¢å¼å­˜å‚¨RDDï¼Œä»è€Œé™ä½å†…å­˜çš„å ç”¨ã€‚</p>
<p>æ­¤ä¼šä»ä¸¤æ–¹é¢åˆ†æ</p>
<ul>
<li>æ•°æ®åºåˆ—åŒ–</li>
<li>å†…å­˜ä¼˜åŒ–</li>
</ul>
<h3 id="Data-Serialization"><a href="#Data-Serialization" class="headerlink" title="Data Serialization"></a>Data Serialization</h3><p>åºåˆ—åŒ–åœ¨åˆ†å¸ƒå¼è®¡ç®—ç¨‹åºä¸­å æœ‰éå¸¸é‡è¦çš„åœ°ä½ã€‚è¿Ÿç¼“çš„åºåˆ—åŒ–æ ¼å¼ï¼Œæˆ–è€…æ¶ˆè´¹ä¸€ä¸ªè¶…å¤§çš„å­—èŠ‚æ•°æ®ï¼Œéƒ½ä¼šå¤§å¤§çš„å‡ç¼“è®¡ç®—é€Ÿåº¦ã€‚æ‰€ä»¥ï¼Œç¬¬ä¸€ä»¶äº‹åº”è¯¥å…ˆå°è¯•ä¼˜åŒ–Sparkç¨‹åºã€‚Sparkè¯•å›¾è¾¾åˆ°åœ¨æ˜“ç”¨æ€§ï¼ˆå…è®¸ä½ å®šä¹‰ä»»ä½•çš„Javaç±»å‹ï¼‰å’Œæ€§èƒ½ä¸¤æ–¹é¢è¾¾åˆ°ä¸€ç§å¹³è¡¡ï¼Œå¹¶ä¸”æä¾›ä¸¤ç§åºåˆ—åŒ–åº“ï¼š</p>
<ul>
<li><p>Javaåºåˆ—åŒ–ï¼šç¼ºçœæƒ…å†µä¸‹ï¼ŒSparkä½¿ç”¨Javaçš„ObjectOutputStreamæ¡†æ¶åºåˆ—åŒ–å¯¹è±¡ï¼Œ<br>ä»è€Œå¯ä»¥å’Œä»»ä½•å®ç°äº†java.io.Serializableæ¥å£çš„ç±»ä¸€èµ·ç©è€ã€‚ä¹Ÿå¯ä»¥æ›´ç´§å¯†çš„æ§åˆ¶æ‰©å±•äº†java.io.Externalizableçš„åºåˆ—åŒ–çš„æ€§èƒ½ã€‚Javaçš„åºåˆ—åŒ–æ˜¯éå¸¸ä¸°å¯Œçš„ï¼Œä½†æ˜¯é€Ÿåº¦å¥‡æ…¢ï¼Œå¹¶ä¸”ä¼šå¯¼è‡´å¾ˆå¤šç±»äº§ç”Ÿå¤§é‡çš„åºåˆ—åŒ–æ ¼å¼ã€‚</p>
</li>
<li><p>Kryoåºåˆ—åŒ–ï¼šSparkä¹Ÿå¯ä»¥ä½¿ç”¨Kryoåº“ï¼ˆVersion2ï¼‰éå¸¸è¿…é€Ÿçš„åºåˆ—åŒ–å¯¹è±¡ã€‚Kryoæ¯”Javaåºåˆ—åŒ–å¿«å¾ˆå¤šå¹¶ä¸”æ›´å¤§çš„å‹ç¼©ç‡ï¼ˆé€šå¸¸æ˜¯10xï¼‰ï¼Œä½†æ˜¯å¹¶ä¸æ”¯æŒæ‰€æœ‰çš„ç±»å‹ï¼Œå¦å¤–ä¹Ÿéœ€è¦ä½ åœ¨ç¨‹åºä¸­æ³¨å†Œç±»ä»¥è·å¾—æœ€å¥½çš„æ€§èƒ½ã€‚</p>
</li>
</ul>
<p>ä½ å¯ä»¥é€‰æ‹©é€šè¿‡è®¾ç½®SparkConfæˆ–è€…è°ƒç”¨conf.set(â€œspark.serializerâ€, â€œorg.apache.spark.serializer.KryoSerializerâ€)æ¥ä½¿ç”¨Kryoåˆå§‹åŒ–Jobã€‚è¿™æ ·è®¾ç½®çš„è¯ï¼Œä¸ä»…å¯ä»¥é…ç½®é€šè¿‡workerèŠ‚ç‚¹é—´shufflingæ•°æ®ï¼Œè¿˜èƒ½å°†RDDåºåˆ—åŒ–åˆ°ç£ç›˜ä¸Šã€‚Kryoä¸æ˜¯ç¼ºçœé…ç½®çš„åŸå› æ˜¯ç”±äºè‡ªå®šä¹‰æ³¨å†Œçš„è¦æ±‚å†³å®šçš„ï¼ŒåŒæ—¶æˆ‘ä»¬ä¹Ÿæƒ³åœ¨ç½‘ç»œå¯†é›†å‹åº”ç”¨ä¸­ä½¿ç”¨å®ƒã€‚</p>
<p>Spark automatically includes Kryo serializers for the many commonly-used core Scala classes covered in the AllScalaRegistrar from the Twitter chill library.</p>
<p>ä½¿ç”¨Kryoæ³¨å†Œè‡ªå®šä¹‰ç±»ï¼Œéœ€è¦ä½¿ç”¨registerKryoClassesæ–¹æ³•ã€‚</p>
  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">val conf = new SparkConf().setMaster(...).setAppName(...)</span><br><span class="line">conf.registerKryoClasses(Array(classOf[MyClass1], classOf[MyClass2]))</span><br><span class="line">val sc = new SparkContext(conf)</span><br></pre></td></tr></table></figure>

<p>Kryoæ–‡æ¡£æè¿°äº†æ›´å¤šé«˜çº§çš„æ³¨å†Œé€‰é¡¹ï¼Œæ¯”å¦‚æ·»åŠ è‡ªå®šä¹‰åºåˆ—ä»£ç ã€‚</p>
<p>å¦‚æœä½ çš„å¯¹è±¡éå¸¸å¤§ï¼Œåˆ™éœ€è¦å¢åŠ spark.kryoserializer.bufferé…ç½®å‚æ•°ã€‚è¿™ä¸ªå€¼ç¼ºçœä¸º2ï¼Œä½†æ˜¯è¿™ä¸ªå€¼éœ€è¦è¶³å¤Ÿå¤§è¶³ä»¥ä¿å­˜åºåˆ—å·çš„å¯¹è±¡ã€‚</p>
<p>æœ€åï¼Œå¦‚æœä½ æ²¡æœ‰æ³¨å†Œè‡ªå®šä¹‰ç±»ï¼ŒKryoä»ç„¶ä¼šèµ·ä½œç”¨ï¼Œä½†æ˜¯å®ƒä¸å¾—ä¸å­˜å‚¨æ¯ä¸ªå¯¹è±¡çš„å…¨éƒ¨ç±»ï¼Œè¿™æ ·æ˜¯éå¸¸æµªè´¹çš„ã€‚</p>
<h3 id="å†…å­˜ä¼˜åŒ–"><a href="#å†…å­˜ä¼˜åŒ–" class="headerlink" title="å†…å­˜ä¼˜åŒ–"></a>å†…å­˜ä¼˜åŒ–</h3><p>å†…å­˜ä¼˜åŒ–çš„æ–¹æ³•æœ‰3ä¸ªæ–¹é¢éœ€è¦è€ƒè™‘çš„ï¼šä½ çš„å¯¹è±¡ä½¿ç”¨çš„æ€»å†…å­˜é‡ï¼ˆä½ å¯èƒ½å¸Œæœ›å…¨éƒ¨æ•°æ®éƒ½æ”¾åˆ°å†…å­˜é‡Œï¼‰ï¼Œå¯¹è±¡å­˜å–æˆæœ¬ï¼ŒGCçš„å¼€é”€ï¼ˆå¦‚æœä½ æœ‰éå¸¸é«˜çš„å¯¹è±¡äº¤æ¢é¢‘ç‡ï¼‰</p>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒJavaå¯¹è±¡å¯ä»¥è¢«å¿«é€Ÿçš„è®¿é—®ï¼Œä½†æ˜¯ä¼šè½»æ˜“çš„è€—å°½å®ƒä»¬å­—æ®µä¸­æ¯”â€œrawâ€æ•°æ®å¤š2åˆ°5å€çš„ç©ºé—´çš„å› å­ã€‚è¿™å–å†³äºå¤šä¸ªå› ç´ ï¼š</p>
<ul>
<li>æ¯ä¸ªç‹¬ç«‹çš„Javaå¯¹è±¡åŒ…å«ä¸€ä¸ªâ€œå¯¹è±¡å¤´â€ï¼Œ16å­—èŠ‚é•¿åº¦å¹¶åŒ…å«è¯¸å¦‚åªæƒ³å®ƒçš„ç±»çš„ä¸€äº›ä¿¡æ¯ã€‚<br>å¯¹äºä¸€ä¸ªéå¸¸å°çš„æ•°æ®æ¥è¯´ï¼ˆæ¯”å¦‚Intï¼‰ï¼Œè¿™ä¸ªå¯èƒ½æ¯”æ•°æ®æœ¬èº«éƒ½è¦å¤§ä¸€äº›ã€‚</li>
<li>Javaå­—ç¬¦ä¸²æœ‰å¤§çº¦40å­—èŠ‚çš„å¯¹è±¡å¤´ï¼Œæ¯”â€œrawâ€æ•°æ®è¦å¤šï¼ˆå› ä¸ºå®ƒä»¬æŒ‰ç…§å­—ç¬¦ä¸²æ•°ç»„çš„å½¢å¼ä¿å­˜ï¼Œå¹¶ä¸”è¿˜åŒ…å«æ‰©å±•æ•°æ®ï¼Œæ¯”å¦‚è¯´æ•°æ®çš„é•¿åº¦ï¼‰ï¼Œ<br>ç”±äºé‡‡ç”¨äº†UTF-16ç¼–ç æ ¼å¼ï¼Œæ‰€ä»¥åœ¨å­—ç¬¦ä¸²å†…éƒ¨ï¼Œå­˜å‚¨ä¸€ä¸ªå­—ç¬¦éœ€è¦å ç”¨2ä¸ªå­—èŠ‚çš„ç©ºé—´ã€‚å› æ­¤10ä¸ªå­—ç¬¦å°±å¯ä»¥è½»æ˜“çš„æ¶ˆè€—æ‰60å­—èŠ‚ç©ºé—´ã€‚</li>
<li>æ™®é€šçš„é›†åˆå¯¹è±¡ï¼Œæ¯”å¦‚è¯´HashMapå’ŒLinkedListï¼Œä½¿ç”¨çš„æ˜¯é“¾å¼æ•°æ®ç»“æ„ï¼Œå¯¹äºæ¯ä¸ªå®ä½“éƒ½å­˜åœ¨ä¸€ä¸ªâ€œwrapperâ€å¯¹è±¡ï¼ˆæ¯”å¦‚ Map.Entryï¼‰ã€‚è¿™ä¸ªå¯¹è±¡ä¸ä»…åŒ…å«å¤´ï¼Œé“¾è¡¨ä¸­è¿˜æœ‰æŒ‡å‘ä¸‹ä¸€ä¸ªå¯¹è±¡çš„æŒ‡é’ˆï¼ˆé€šå¸¸éœ€è¦8ä¸ªå­—èŠ‚ï¼‰ã€‚</li>
<li>ç§æœ‰ç±»å‹çš„é›†åˆç»å¸¸ä»¥â€œè£…ç®±â€å¯¹è±¡çš„å½¢å¼å­˜å‚¨ï¼Œæ¯”å¦‚java.lang.Integerã€‚</li>
</ul>
<p>è¿™ä¸€ç« è®¨è®ºçš„æ˜¯å¦‚ä½•ç¡®å®šå¯¹è±¡çš„å†…å­˜å ç”¨æƒ…å†µï¼Œå’Œæ”¹è¿›çš„æ–¹æ³•ï¼ä¸æ­¢ä¿æŠ¤æ”¹å˜ä½ çš„æ•°æ®ç»“æ„ï¼Œå¦å¤–è¿˜éœ€è¦ä»¥ä¸€ç§åºåˆ—å·çš„å½¢å¼å­˜å‚¨æ•°æ®ã€‚ç„¶åæˆ‘ä»¬å°±å¯ä»¥è¦†ç›–åˆ°ä¼˜åŒ–Sparkç¼“å­˜å’ŒJava GCçš„çŸ¥è¯†äº†ã€‚</p>
<h4 id="ææ¸…æ¥šå†…å­˜æ¶ˆè€—"><a href="#ææ¸…æ¥šå†…å­˜æ¶ˆè€—" class="headerlink" title="ææ¸…æ¥šå†…å­˜æ¶ˆè€—"></a>ææ¸…æ¥šå†…å­˜æ¶ˆè€—</h4><p>æµ‹è¯•ä¸€ä¸ªæ•°æ®é›†æ¶ˆè€—å†…å­˜çš„æ€»é‡æœ€å¥½çš„æ–¹å¼åˆ›å»ºä¸€ä¸ªRDDï¼Œå¹¶æ”¾åˆ°ç¼“å†²ä¸­ï¼Œé€šè¿‡webé¡µé¢æŸ¥çœ‹å­˜å‚¨æƒ…å†µã€‚è¿™ä¸ªé¡µé¢çš„å†…å®¹å¯ä»¥æ˜¾ç¤ºRDDåˆ°åº•å æœ‰äº†å¤šå°‘å†…å­˜ã€‚</p>
<p>ä¼°ç®—ä¸€ä¸ªåˆ†åŒºæ•°æ®æ¶ˆè€—çš„å†…å­˜ï¼Œå¯ä»¥ä½¿ç”¨SizeEstimatorâ€™s estimateçš„æ–¹æ³•ï¼Œè¿™æ˜¯ä¸€ç§éå¸¸æœ‰ç”¨çš„æ–¹å¼å»è¯•éªŒä¸åŒçš„æ•°æ®ç»“æ„å»å‡å°‘å†…å­˜çš„ä½¿ç”¨ï¼Œå³å¯ä»¥ç¡®å®šå¹¿æ’­å˜é‡å ç”¨ç©ºé—´å¯ä»¥æ¶ˆè€—æ¯ä¸ªå¯æ‰§è¡Œå †çš„æƒ…å†µã€‚</p>
<h4 id="ä¼˜åŒ–æ•°æ®ç»“æ„"><a href="#ä¼˜åŒ–æ•°æ®ç»“æ„" class="headerlink" title="ä¼˜åŒ–æ•°æ®ç»“æ„"></a>ä¼˜åŒ–æ•°æ®ç»“æ„</h4><p>é¦–é€‰çš„é™ä½å†…å­˜æ¶ˆè€—çš„æ–¹æ³•æ˜¯é¿å…ä½¿ç”¨å…·æœ‰Javaçš„ç‰¹æ€§å¯¼è‡´çš„å¼€é”€ï¼Œæ¯”å¦‚åŸºäºæŒ‡é’ˆçš„æ•°æ®ç»“æ„æ ¸åŒ…è£…ç±»ã€‚æœ‰å¤šç§æ–¹å¼å¯ä»¥åšåˆ°ï¼š</p>
<ul>
<li>è®¾è®¡ä½ çš„æ•°æ®ç»“æ„ä»¥æå‡å¯¹è±¡æ•°ç»„å’ŒåŸå§‹ç±»å‹ï¼Œç”¨æ¥æ›¿æ¢æ ‡å‡†çš„Javaæˆ–è€…Scalaçš„é›†åˆç±»ï¼ˆæ¯”å¦‚ï¼šHashMapï¼‰ã€‚<br>fastutilç±»åº“ä¸ºåŸå§‹ç±»å‹æä¾›äº†é€‚å½“çš„é›†åˆç±»å‹ï¼Œå¯ä»¥å…¼å®¹Javaçš„æ ‡å‡†åº“ã€‚</li>
<li>å°½é‡é¿å…åŒ…å«å¤§é‡å°å¯¹è±¡æ ¸æŒ‡é’ˆçš„åµŒå¥—æ•°æ®ç»“æ„ã€‚</li>
<li>è€ƒè™‘ä½¿ç”¨æ•°å­—ç±»å‹çš„IDæˆ–è€…æšä¸¾å¯¹è±¡æ¥æ›¿ä»£å­—ç¬¦ä¸²è¡Œçš„keyã€‚</li>
<li>å¦‚æœä½ çš„RAMä¸è¶³32GBï¼Œå¯ä»¥é€šè¿‡è®¾ç½®JVMçš„-XX:+UseCompressedOopså‚æ•°ï¼Œä¿®æ”¹æŒ‡é’ˆé»˜è®¤å ç”¨8å­—èŠ‚ä¸º4ä¸ªå­—èŠ‚ã€‚ä¹Ÿå¯ä»¥è®²è¿™äº›å‚æ•°åŠ åˆ°spaspark-env.shä¸­ã€‚</li>
</ul>
<h4 id="åºåˆ—åŒ–çš„RDDå­˜å‚¨"><a href="#åºåˆ—åŒ–çš„RDDå­˜å‚¨" class="headerlink" title="åºåˆ—åŒ–çš„RDDå­˜å‚¨"></a>åºåˆ—åŒ–çš„RDDå­˜å‚¨</h4><p>é€šè¿‡ä»¥ä¸Šçš„ä¼˜åŒ–ï¼Œä½ çš„å¯¹è±¡ä»ç„¶å¾ˆå¤§ä»è€Œå½±å“åˆ°é«˜æ•ˆçš„å­˜å‚¨çš„è¯ï¼Œä¸€ç§æ›´åŠ ç®€å•çš„å‡å°‘å†…å­˜ä½¿ç”¨çš„æ–¹æ³•æ˜¯é€šè¿‡RDDçš„æŒä¹…åŒ–APIåºåˆ—åŒ–StorageLevelsï¼Œä»è€Œä½¿ä»–ä»¬ä»¥åºåˆ—åŒ–çš„æ–¹å¼å­˜å‚¨ï¼Œæ¯”å¦‚MEMORY_ONLY_SERã€‚Sparkè¿™æ—¶å°±å¯ä»¥å°†æ¯ä¸ªRDDä½œä¸ºä¸€ä¸ªå¤§å­—èŠ‚æ•°ç»„åˆ†åŒºå­˜å‚¨ã€‚å”¯ä¸€çš„ä¸è¶³æ˜¯ï¼Œåºåˆ—åŒ–å­˜å‚¨çš„æ•°æ®æ¯æ¬¡è¯»å–çš„æ—¶å€™ä¼šå¾ˆæ…¢ï¼Œè¿™ä¸ªå–å†³äºæ¯ä¸ªå¯¹è±¡çš„ååºåˆ—åŒ–ï¼ˆon the flyï¼‰ã€‚æˆ‘ä»¬å¼ºçƒˆå»ºè®®ä½¿ç”¨Kryoä½œä¸ºç¼“å­˜åºåˆ—åŒ–æ•°æ®çš„æ–¹æ³•ï¼Œè¿™æ ·å¯ä»¥æ¯”Javaåºåˆ—åŒ–å ç”¨æ›´å°‘çš„ç©ºé—´ï¼ˆç”šè‡³æ˜¯åŸå§‹çš„Javaå¯¹è±¡ï¼‰</p>
<h4 id="GCä¼˜åŒ–"><a href="#GCä¼˜åŒ–" class="headerlink" title="GCä¼˜åŒ–"></a>GCä¼˜åŒ–</h4><p>JVM çš„GCå¯èƒ½ä¼šæ˜¯ä¸€ä¸ªé—®é¢˜ï¼Œå½“ä½ çš„ç¨‹åºåœ¨å­˜å‚¨ä¸€ä¸ªRDDæ–¹é¢å­˜åœ¨ä¸€ä¸ªå¾ˆå¤§çš„ã€churnã€ã€‚ï¼ˆä»–ä¸ä¼šæ˜¯ä¸€ä¸ªå¤§é—®é¢˜ï¼Œå¦‚æœåªæ˜¯æ¯æ¬¡è¯»å–ä¸€ä¸ªRDDï¼Œå¹¶å¤šæ¬¡æ“ä½œï¼‰å½“Javaéœ€è¦é€æ¸çš„ç”¨æ–°å¯¹è±¡æ›¿æ¢æ—§å¯¹è±¡æ—¶ï¼ŒGCå°±ä¼šè¿½è¸ªä½ çš„æ‰€æœ‰Javaå¯¹è±¡ï¼Œæ‰¾åˆ°å¹¶æ›¿æ¢æ‰ã€‚è¿™é‡Œçš„é‡ç‚¹æŒ‡å‡ºçš„ï¼ŒGCçš„æ‰§è¡Œæˆæœ¬æ˜¯ä¸Javaå¯¹è±¡çš„ä¸ªæ•°æˆæ­£æ¯”çš„ï¼Œå› æ­¤ä½¿ç”¨æ›´å°‘å¯¹è±¡çš„æ•°æ®ç»“æ„å¯ä»¥å¤§å¤§é™ä½GCçš„æˆæœ¬ï¼ˆæ¯”å¦‚ä¸€ä¸ªIntç±»å‹çš„æ•°ç»„æ›¿æ¢LinkedListçš„æ•°ç»„ï¼‰ã€‚æ›´å¥½çš„æ–¹æ³•æ˜¯æŒä¹…åŒ–è¢«åºåˆ—åŒ–ä¹‹åçš„å¯¹è±¡ï¼Œå¦‚ä¸Šè¿°ï¼Œåœ¨æ¯ä¸ªRDDåˆ†åŒºé‡Œåªä¼šå­˜åœ¨ä¸€ä¸ªå¯¹è±¡ï¼ˆä¸€ä¸ªå­—èŠ‚æ•°ç»„ï¼‰ã€‚åœ¨å°è¯•å…¶ä»–æŠ€æœ¯ä¹‹å‰ï¼Œå¦‚æœGCæ˜¯ä¸€ä¸ªé—®é¢˜ï¼Œé‚£ä¹ˆç¬¬ä¸€ä»¶äº‹å°±æ˜¯å°è¯•åºåˆ—åŒ–çš„ç¼“å­˜ã€‚</p>
<p>ä½ çš„ä»»åŠ¡çš„å ç”¨çš„æ´»åŠ¨å†…å­˜æ ¸ç¼“å­˜åœ¨ä½ èŠ‚ç‚¹ä¸Šçš„RDDä¹‹é—´çš„å¹²æ‰°ä¹Ÿä¼šå¯¼è‡´GCå‡ºç°é—®é¢˜ï¼ˆéœ€è¦æ‰§è¡Œä»»åŠ¡æ‰€éœ€çš„å†…å®¹æ€»é‡ï¼‰ã€‚æˆ‘ä»¬å°†ä¼šè®¨è®ºæ€æ ·æ§åˆ¶åˆ†é…ç»™RDDç¼“å­˜çš„ç©ºé—´ä»¥å‡å°‘è¿™ç§å½±å“ã€‚</p>
<h5 id="è¡¡é‡GCçš„å½±å“"><a href="#è¡¡é‡GCçš„å½±å“" class="headerlink" title="è¡¡é‡GCçš„å½±å“"></a>è¡¡é‡GCçš„å½±å“</h5><p>GCä¼˜åŒ–çš„ç¬¬ä¸€æ­¥éœ€è¦å…ˆæ‰‹æœºç»Ÿè®¡æ•°æ®ï¼šGCå‘ç”Ÿçš„é¢‘ç‡å’Œå‘è´¹çš„æ—¶é—´ã€‚è¿™ä¸ªå¯ä»¥é€šè¿‡æ·»åŠ è®¾ç½®javaå‚æ•°-verbose:gc -XX:+PrintGCDetails -XX:+PrintGCTimeStampså®ç°ã€‚ï¼ˆè¯¦æƒ…è§ä¼ é€’Javaå‚æ•°åˆ°Sparkä»»åŠ¡çš„æŒ‡å—ï¼‰ä¸‹ä¸€æ¬¡ä½ çš„Sparkä»»åŠ¡æ‰§è¡Œæ—¶ï¼Œä½ å°±å¯ä»¥åœ¨æ¯ä¸ªworkerçš„æ—¥å¿—ä¸­çœ‹åˆ°å…³äºGCäº‹ä»¶çš„ä¿¡æ¯ã€‚æ³¨æ„ï¼Œè¿™äº›æ—¥å¿—æ—¶å­˜æ”¾åˆ°workerèŠ‚ç‚¹ä¸Šçš„ï¼Œå¹¶ä¸æ˜¯åœ¨driver ç¨‹åºä¸Šã€‚</p>
<h5 id="ç¼“å†²å¤§å°ä¼˜åŒ–"><a href="#ç¼“å†²å¤§å°ä¼˜åŒ–" class="headerlink" title="ç¼“å†²å¤§å°ä¼˜åŒ–"></a>ç¼“å†²å¤§å°ä¼˜åŒ–</h5><p>GCä¸€ä¸ªé‡è¦çš„é…ç½®å‚æ•°æ˜¯åˆ†é…ç»™ç¼“å­˜RDDä½¿ç”¨çš„å†…å­˜æ€»é‡ã€‚ç¼ºçœæƒ…å†µä¸‹ï¼ŒSparkä¼šä½¿ç”¨é…ç½®ç»™executor memory (spark.executor.memory) 60%çš„å†…å­˜é‡ç¼“å†²RDDã€‚ä¹Ÿå°±æ˜¯è¯´40%çš„å†…å­˜æ˜¯ç”¨äºåœ¨ä»»åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­ä»»ä½•å…¶å®ƒçš„å¯¹è±¡ã€‚</p>
<p>å½“ä½ çš„ä»»åŠ¡é€Ÿåº¦ç¼“æ…¢ï¼Œå¹¶ä¸”å‘ç°JVM GCé¢‘ç‡ç‰¹åˆ«é¢‘ç¹æˆ–è€…å‡ºç°å†…å­˜æº¢å‡ºçš„é—®é¢˜æ—¶ï¼Œé™ä½è¿™ä¸ªå€¼ä¼šå¯¹é™ä½å†…å­˜æ¶ˆè€—æä¾›å¸®åŠ©ã€‚ä¿®æ”¹è¿™ä¸ªå€¼å¯ä»¥é€šè¿‡è®¾ç½®spark.storage.memoryFractionï¼Œæ¯”å¦‚ä¿®æ”¹æˆ50%ï¼Œåˆ™å¯ä»¥conf.set(â€œspark.storage.memoryFractionâ€, â€œ0.5â€)ã€‚ç»“åˆä½¿ç”¨åºåˆ—åŒ–ç¼“å­˜ï¼Œä½¿ç”¨æ›´å°‘çš„ç¼“å­˜å°±å¯ä»¥å……åˆ†çš„å‡è½»å¤§éƒ¨åˆ†çš„GCé—®é¢˜ã€‚</p>
<h5 id="é«˜çº§GCä¼˜åŒ–"><a href="#é«˜çº§GCä¼˜åŒ–" class="headerlink" title="é«˜çº§GCä¼˜åŒ–"></a>é«˜çº§GCä¼˜åŒ–</h5><p>æ›´è¿›ä¸€æ­¥çš„GCä¼˜åŒ–ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦ç†è§£ä¸€äº›åŸºæœ¬çš„JVMç®¡ç†å†…å­˜ç®¡ç†çŸ¥è¯†ï¼š</p>
<ul>
<li>Javaå †ç©ºé—´è¢«åˆ’åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†Young å’Œ Oldã€‚Young generationç”¨æ¥ä¿å­˜çŸ­å‘¨æœŸçš„å¯¹è±¡ï¼ŒåŒæ—¶Old generationæ˜¯ç”¨æ¥ä¿æŒé•¿å‘¨æœŸå¯¹è±¡ã€‚</li>
<li>Young generationè¢«è¿›ä¸€æ­¥åˆ’åˆ†ä¸º3éƒ¨åˆ†ï¼šEden, Survivor1, Survivor2ã€‚</li>
<li>ä¸€ä¸ªç®€å•çš„å…³äºåƒåœ¾å›æ”¶ç¨‹åºçš„æè¿°ï¼šå½“Edenæ»¡äº†çš„æ—¶å€™ï¼Œa minor GC is run on Eden and objects that are alive from Eden and Survivor1 are copied to Survivor2ã€‚Survivoréƒ¨åˆ†æ˜¯å¯ä»¥äº¤æ¢çš„ã€‚å¦‚æœä¸€ä¸ªå¯¹è±¡å·²ç»æ—§äº†æˆ–è€…Survivor2æ»¡äº†ï¼Œä»–å°±ä¼šè¢«ç§»åŠ¨åˆ°æ—§çš„éƒ¨åˆ†ã€‚æœ€åï¼Œå½“æ—§çš„éƒ¨åˆ†æ¥è¿‘æ»¡çš„æ—¶å€™ï¼Œä¸€ä¸ªæ»¡çš„GCå°±ä¼šè¢«å”¤èµ·ã€‚</li>
</ul>
<p>Sparkä¸­GCä¼˜åŒ–çš„ç›®æ ‡æ˜¯ç¡®ä¿åªæœ‰éœ€è¦é•¿ä¹…å­˜åœ¨çš„RDDæ‰ä¼šè¢«å­˜å‚¨åœ¨Old generationï¼ŒYoung generationæœ‰è¶³å¤Ÿçš„ç©ºé—´å¤„å¤„çŸ­å‘¨æœŸçš„å¯¹è±¡ã€‚è¿™å°±å¯ä»¥å¸®åŠ©é¿å…full GCsåœ¨ä»»åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­æ”¶é›†ä¸´æ—¶ä»»åŠ¡ã€‚è¿™é‡Œçš„ä¸€äº›æ­¥éª¤å¯èƒ½ä¼šæ¯”è¾ƒæœ‰ç”¨ï¼š</p>
<ul>
<li>é€šè¿‡æ£€æŸ¥GCçš„çŠ¶æ€æ£€æŸ¥æ˜¯å¦å­˜åœ¨å¤šä¸ªåƒåœ¾å›æ”¶ã€‚å¦‚æœä¸€ä¸ªfull GCåœ¨ä¸€ä¸ªä»»åŠ¡ç»“æŸä¹‹å‰è¢«å¤šæ¬¡å”¤é†’ï¼Œè¿™å°±æ„å‘³ç€æ²¡æœ‰è¶³å¤Ÿçš„å¯ç”¨å†…å­˜æ¶Œæ¥æ‰§è¡Œä»»åŠ¡ã€‚</li>
<li>In the GC stats that are printedï¼Œå¦‚æœOldGenæ¥è¿‘æ»¡çš„çŠ¶æ€çš„è¯ï¼Œå°±å‡å°‘ç¼“å­˜çš„å†…å­˜æ€»é‡ã€‚è¿™ä¸ªå¯ä»¥é€šè¿‡è®¾ç½®spark.storage.memoryFraction propertyæ¥è¾¾æˆã€‚ç¼“å­˜æ›´å°‘çš„å¯¹è±¡æ€»æ¯”å‡æ…¢ä»»åŠ¡æ‰§è¡Œé€Ÿåº¦è¦å¥½çš„å¤šï¼</li>
<li>å¦‚æœå­˜åœ¨å¾ˆå¤šçš„æ¬¡è¦collectionsè€Œä¸æ˜¯å¾ˆå¤šçš„ä¸»è¦çš„GCsï¼Œç»™Edenåˆ†é…æ›´å¤šçš„å†…å­˜ä¼šæœ‰æ‰€å¸®åŠ©ã€‚ä½ å¯ä»¥è®¾ç½®Edenç¨å¾®é«˜äº›çš„å†…å­˜ç»™æ¯ä¸ªä»»åŠ¡ã€‚å¦‚æœEdenè¡¨ç¤ºæˆEï¼Œé‚£ä¹ˆå¯ä»¥é€šè¿‡è®¾ç½®Young generationçš„å‚æ•°å¤§å°ä¸º-Xmn=4/3*Eã€‚ï¼ˆThe scaling up by 4/3 is to account for space used by survivor regions as well.ï¼‰</li>
<li>ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æœä½ çš„ä»»åŠ¡æ­£åœ¨ä»HDFSä¸­è¯»å–æ•°æ®ï¼Œä»»åŠ¡ä½¿ç”¨çš„å†…å­˜è¢«æ ‡è®°ä¸ºæ•°æ®çš„å—å¤§å°ã€‚<br>æ³¨æ„ï¼Œè§£å‹åçš„æ•°æ®å—å¤§çº¦æ˜¯ä¹‹å‰æ•°æ®çš„2ï½3å€ã€‚å› æ­¤æˆ‘ä»¬å¸Œæœ›æœ‰3æˆ–è€…4ä¸ªä»»åŠ¡çš„å·¥ä½œç©ºé—´ï¼Œå¹¶ä¸”HDFSå—çš„å¤§å°æ˜¯64Mï¼Œæˆ‘ä»¬å°±å¯ä»¥ä¼°ç®—å‡ºEdenå¤§å°å¤§çº¦æ˜¯4<em>3</em>64MBã€‚</li>
<li>é€šè¿‡ä¿®æ”¹æ–°çš„è®¾ç½®æ¥ç›‘æµ‹åƒåœ¾å›æ”¶çš„é¢‘ç‡å’Œæ—¶é—´</li>
</ul>
<p>æˆ‘çš„ç»éªŒå¾—å‡ºGCä¼˜åŒ–çš„æ”¹è¿›å–å†³äºä½ çš„ç¨‹åºå’Œå¯ç”¨çš„å†…å­˜æ€»é‡ã€‚åœ¨ç½‘ä¸Šæœ‰å¾ˆå¤šä¼˜åŒ–é€‰é¡¹çš„æè¿°ï¼Œä½†æ˜¯å†è¿›ä¸€æ­¥ï¼Œç®¡ç†full GCçš„é¢‘ç‡å¯ä»¥æœ‰åŠ©äºé™ä½é¡¶å±‚é™åˆ¶ã€‚</p>
<h3 id="å…¶å®ƒéœ€è¦è€ƒè™‘çš„äº‹æƒ…"><a href="#å…¶å®ƒéœ€è¦è€ƒè™‘çš„äº‹æƒ…" class="headerlink" title="å…¶å®ƒéœ€è¦è€ƒè™‘çš„äº‹æƒ…"></a>å…¶å®ƒéœ€è¦è€ƒè™‘çš„äº‹æƒ…</h3><h4 id="å¹¶è¡Œçš„æ°´å¹³"><a href="#å¹¶è¡Œçš„æ°´å¹³" class="headerlink" title="å¹¶è¡Œçš„æ°´å¹³"></a>å¹¶è¡Œçš„æ°´å¹³</h4><p>èŠ‚ç‚¹ä¸ä¼šè¢«å……åˆ†åˆ©ç”¨ï¼Œé™¤éå–‚æ¯ä¸ªæ“ä½œè®¾ç½®äº†è¶³å¤Ÿé«˜çš„å¹¶è¡Œæ°´å¹³ã€‚Sparkä¼šè‡ªåŠ¨è®¾ç½®â€œmapâ€ä»»åŠ¡çš„æ•°é‡æ‰§è¡Œæ¯ä¸ªæ–‡ä»¶ä»¥å’Œä»–çš„å¤§å°ä¿æŒä¸€è‡´ï¼ˆå°½ç®¡ä½ å¯ä»¥é€šè¿‡SparkContext.textFileçš„å¯é€‰å‚æ•°æ§åˆ¶ï¼‰ï¼Œå¹¶ä¸”å¯¹äºåˆ†å¸ƒå¼çš„â€œreduceâ€æ“ä½œï¼Œæ¯”å¦‚groupByKey å’Œ reduceByKeyï¼Œä¼šä½¿ç”¨æœ€å¤§çš„çˆ¶RDDçš„åˆ†åŒºæ•°ã€‚ä½ å¯ä»¥ä¼ é€’å¹¶è¡Œçš„levelä½œä¸ºç¬¬äºŒä¸ªå‚æ•°ï¼Œæ´»ç€è®¾ç½®spark.default.parallelismé…ç½®å±æ€§æ”¹å˜é»˜è®¤å€¼ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å»ºè®®åœ¨èŠ‚ç‚¹ä¸Šæ¯ä¸ªCPUå†…æ ¸æ‰§è¡Œ2ï½3ä¸ªä»»åŠ¡ã€‚</p>
<h4 id="é™ä½ä»»åŠ¡çš„å†…å­˜ä½¿ç”¨"><a href="#é™ä½ä»»åŠ¡çš„å†…å­˜ä½¿ç”¨" class="headerlink" title="é™ä½ä»»åŠ¡çš„å†…å­˜ä½¿ç”¨"></a>é™ä½ä»»åŠ¡çš„å†…å­˜ä½¿ç”¨</h4><p>æœ‰æ—¶ï¼Œä½ å¯èƒ½å¾—åˆ°OutOfMemoryErroré”™è¯¯ï¼Œä½†æ˜¯è¿™å¹¶ä¸æ˜¯å› ä¸ºä½ çš„Rddä¸é€‚åˆä½ çš„å†…å­˜ï¼Œè€Œæ˜¯å› ä¸ºä»»åŠ¡ä¸­çš„å…¶ä¸­ä¸€ä¸ªçš„è®¾ç½®ï¼Œæ¯”å¦‚å…¶ä¸­ä¸€ä¸ªreduceä»»åŠ¡æ‰§è¡ŒgroupByKeyæ—¶å¤ªå¤§ã€‚Sparkçš„shuffleæ“ä½œï¼ˆsortByKey, groupByKey, reduceByKey, joinç­‰ï¼‰ä¼šåˆ›å»ºä¸€ä¸ªå“ˆå¸Œè¡¨å¹¶ä¸”æ¯ä¸ªä»»åŠ¡ä¼šæ‰§è¡Œgroupingæ“ä½œï¼Œè¿™ä¸ªé€šå¸¸æƒ…å†µä¸‹ä¹Ÿä¼šå¾ˆå¤§ã€‚æ­¤æ—¶æœ€ç®€å•çš„è§£å†³åŠæ³•æ˜¯å¢åŠ å¹¶è¡Œçš„æ°´å¹³ï¼Œä»¥é™ä½ä»»åŠ¡çš„è¾“å…¥é›†å¤§å°ã€‚Sparkå¯ä»¥é«˜æ•ˆçš„æ”¯æŒä»»åŠ¡ï¼Œå› ä¸ºå®ƒå¯ä»¥é‡å¤åˆ©ç”¨ä¸€ä¸ªexecutor JVMï¼Œå¹¶ä¸”æœ‰å¾ˆä½çš„ä»»åŠ¡åŠ è½½æ¶ˆè€—ï¼Œæ‰€ä»¥ä½ å¯ä»¥å®‰å…¨çš„å¢åŠ å¹¶å‘æ°´å¹³ï¼Œç”šè‡³è¶…è¿‡ä½ èŠ‚ç‚¹ä¸Šæ ¸å¿ƒçš„æ•°ç›®ã€‚</p>
<h4 id="å¹¿æ’­å¤§å˜é‡"><a href="#å¹¿æ’­å¤§å˜é‡" class="headerlink" title="å¹¿æ’­å¤§å˜é‡"></a>å¹¿æ’­å¤§å˜é‡</h4><p>ä½¿ç”¨SparkContextä¸Šå¯ç”¨çš„å¹¿æ’­åŠŸèƒ½å¯ä»¥æ˜æ˜¾çš„å‡å°‘æ¯ä¸ªåºåˆ—åŒ–ä»»åŠ¡çš„å¤§å°ï¼Œå’Œé€šè¿‡èŠ‚ç‚¹åŠ è½½ä»»åŠ¡çš„æ¶ˆè€—ã€‚å¦‚æœä½ çš„ä»»åŠ¡ä½¿ç”¨æ¥è‡ªdriverç¨‹åºçš„å¤§çš„å¯¹è±¡ï¼ˆæ¯”å¦‚ï¼šé™æ€æŸ¥æ‰¾è¡¨ï¼‰ï¼Œè¯•ç€è½¬åŒ–æˆä¸€ä¸ªå¹¿æ’­å˜é‡ã€‚Sparkæ‰“å°å‡ºä¸»èŠ‚ç‚¹ä¸Šæ¯ä¸ªä»»åŠ¡çš„åºåˆ—åŒ–åçš„å¤§å°ï¼Œä»è€Œä½ å¯ä»¥é€šè¿‡è¿™ä¸ªå†³å®šä½ çš„ä»»åŠ¡æ˜¯å¦è¿‡å¤§ï¼›é€šå¸¸çš„ä»»åŠ¡å¤§äº20KBå°±å€¼å¾—ä¼˜åŒ–äº†ã€‚</p>
<h4 id="æ•°æ®çš„ä½ç½®"><a href="#æ•°æ®çš„ä½ç½®" class="headerlink" title="æ•°æ®çš„ä½ç½®"></a>æ•°æ®çš„ä½ç½®</h4><p>æ•°æ®çš„ä½ç½®å¯èƒ½æ˜¯å½±å“Sparkä½œä¸šçš„æœ€ä¸»è¦çš„ä¸€ä¸ªå½±å“å› ç´ ã€‚å¦‚æœæ•°æ®å’Œä»£ç è¢«æ”¾ç½®åœ¨ä¸€èµ·çš„è¯ï¼Œè®¡ç®—é€Ÿåº¦ä¼šæ˜æ˜¾åŠ å¿«ã€‚ä½†æ˜¯å¦‚æœä»£ç å’Œæ•°æ®æ˜¯åˆ†å¼€çš„ï¼Œä¸åŒçš„ä¸¤å—æ•°æ®ä¼šè¢«ç§»åŠ¨åˆ°ä¸€èµ·ã€‚ç‰¹åˆ«æ˜¯ï¼Œä¼ è¾“åºåˆ—åŒ–çš„ä»£ç æ¯”æ•°æ®å—è¦å¿«å¾ˆå¤šï¼Œè¿™æ˜¯å› ä¸ºä»£ç çš„å¤§å°æ¯”æ•°æ®å°å¾ˆå¤šã€‚Sparkæ„å»ºè°ƒåº¦çš„ä¸»è¦åŸåˆ™å°±æ˜¯ç”±æ•°æ®çš„ä½ç½®å†³å®šçš„ã€‚</p>
<p>æ•°æ®çš„ä½ç½®åˆ°åº•è·ç¦»æ“ä½œä»–çš„ä»£ç å¤šè¿‘çš„è·ç¦»æ‰åˆé€‚å‘¢ï¼Ÿè¿™é‡Œå­˜åœ¨å¤šä¸ªçº§åˆ«ï¼ˆè‡ªè¿‘åŠè¿œï¼‰ï¼š</p>
<ul>
<li>PROCESS_LOCAL  æ•°æ®å’Œä»£ç åœ¨åŒä¸€ä¸ªJVMä¸­ï¼Œè¿™ç§æ–¹å¼æ˜¯æœ€å¥½çš„ä¸€ç§æƒ…å†µ</li>
<li>NODE_LOCAL æ•°æ®åœ¨åŒä¸€ä¸ªèŠ‚ç‚¹ã€‚æ¯”å¦‚è¯´åœ¨HDFSçš„åŒä¸€ä¸ªèŠ‚ç‚¹ï¼Œæˆ–è€…ç›¸åŒèŠ‚ç‚¹çš„ä¸åŒexecutorã€‚<br>è¿™ç§æ–¹å¼æ¯”PROCESS_LOCALç¨å¾®æ…¢äº›ï¼Œå› ä¸ºè¿™ç§æƒ…å†µä¸‹ï¼Œæ•°æ®éœ€è¦åœ¨ä¸åŒè¿›ç¨‹ä¸­ä¼ è¾“</li>
<li>NO_PREF data is accessed equally quickly from anywhere and has no locality preference</li>
<li>RACK_LOCAL æ•°æ®åœ¨åŒä¸€ä¸ªæœåŠ¡å™¨æœºæ¶ã€‚æ•°æ®åœ¨åŒä¸€ä¸ªæœºæ¶çš„ä¸åŒçš„æœåŠ¡å™¨ä¸Šçš„è¯ï¼Œæ•°æ®éœ€è¦é€šè¿‡ç½‘ç»œè¿›è¡Œä¼ è¾“ï¼Œtypically through a single switch</li>
<li>ANY æ•°æ®åˆ†å¸ƒåœ¨ç½‘ç»œçš„å„ä¸ªåœ°æ–¹ï¼Œå¹¶ä¸”ä¸åœ¨åŒä¸€ä¸ªæœºæ¶</li>
</ul>
<p>Sparkæ›´å€¾å‘äºè°ƒåº¦æœ€å¥½çš„localityçº§åˆ«çš„æ‰€æœ‰ä»»åŠ¡ï¼Œä½†æ˜¯è¿™å¹¶ä¸æ˜¯ç»å¸¸å‘ç”Ÿçš„ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä¸åœ¨å¤„ç†æ•°æ®çš„ä»»ä½•ç©ºé—²executorï¼ŒSparkéƒ½ä¼šé€‰æ‹©æ›´ä½çš„localityçº§åˆ«ã€‚è¿™æœ‰ä¸¤ç§é€‰æ‹©ï¼š</p>
<ul>
<li>ç­‰å¾…åŒä¸€ä¸ªæœåŠ¡å™¨ä¸Šçš„ä»»åŠ¡ï¼Œç›´åˆ°å¯¹åº”çš„CPUé—²ä¸‹æ¥æ‰æ‰§è¡Œ</li>
<li>ç«‹å³æ‰§è¡Œä¸€ä¸ªæ–°ä»»åŠ¡ï¼Œå¹¶é€šè¿‡ç§»åŠ¨æ•°æ®åˆ°æ›´è¿œçš„èŠ‚ç‚¹æ‰§è¡Œ</li>
</ul>
<p>Sparké€šå¸¸ä¼šç¨å¾®ç­‰ä¸€ä¸‹ï¼Œä»¥ç­‰å¾…CPUæ‰§è¡Œå®Œæ¯•ã€‚ä¸€æ—¦è¶…æ—¶ï¼Œä»–å°±ä¼šå°†è¿œç«¯çš„æ•°æ®ä¼ é€’ç»™ç©ºé—²çš„CPUã€‚ä¸åŒçº§åˆ«çš„ç­‰å¾…è¶…æ—¶å›é€€å¯ä»¥å•ç‹¬é…ç½®ï¼Œæˆ–è€…åœ¨ä¸€ä¸ªå‚æ•°ä¸­é›†ä¸­ä¿®æ”¹ï¼›å‰å¾€é…ç½®é¡µæŸ¥çœ‹spark.localityå‚æ•°è¯¦æƒ…ã€‚å¦‚æœä½ çš„ä»»åŠ¡are long and see poor localityï¼Œä½ ä¹Ÿå¯ä»¥ä¿®æ”¹è®¾ç½®ï¼Œä½†æ˜¯ç¼ºçœå€¼æ˜¯å®Œå…¨å¯ä»¥æ»¡è¶³è¦æ±‚çš„ã€‚</p>
<h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>è¿™æ˜¯ä¸€ä¸ªç®€çŸ­çš„ä»‹ç»ï¼Œå…¶ä¸­æŒ‡å‡ºäº†ä½ å¯èƒ½éœ€è¦äº†è§£çš„ä¼˜åŒ–Sparkåº”ç”¨çš„æœ€ä¸»è¦çš„è¦ç‚¹ï¼Œæ•°æ®åºåˆ—åŒ–å’Œå†…å­˜ä¼˜åŒ–ã€‚å¯¹äºå¤§å¤šæ•°çš„ç¨‹åºæ¥è¯´ï¼Œé€‰æ‹©Kryoåºåˆ—åŒ–ï¼Œå¹¶ä¸”ä»¥åºåˆ—åŒ–å½¢å¼ä¿å­˜æ•°æ®å¯ä»¥è§£å†³å¤§éƒ¨åˆ†ä¸€èˆ¬çš„æ€§èƒ½é—®é¢˜ã€‚Feel free to ask on the Spark mailing list about other tuning best practices.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2022/01/30/2016-01-04-Spark-tuning/" data-id="ckz0rdm4c000a94uthecg166h" data-title="Sparkä¼˜åŒ–" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-2016-01-02-Python-keyword-yield" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2022/01/30/2016-01-02-Python-keyword-yield/" class="article-date">
  <time class="dt-published" datetime="2022-01-30T04:24:01.494Z" itemprop="datePublished">2022-01-30</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2022/01/30/2016-01-02-Python-keyword-yield/">Pythonå…³é”®å­—:yield</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>æ³¨ï¼šä»¥ä¸‹ä»£ç å®éªŒç¯å¢ƒå‡ä¸º</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">âœ  ~  python</span><br><span class="line">Python 2.7.10 (default, Oct 23 2015, 18:05:06)</span><br><span class="line">[GCC 4.2.1 Compatible Apple LLVM 7.0.0 (clang-700.0.59.5)] on darwin</span><br><span class="line">Type &quot;help&quot;, &quot;copyright&quot;, &quot;credits&quot; or &quot;license&quot; for more information.</span><br></pre></td></tr></table></figure>

<h3 id="Yieldå…³é”®å­—"><a href="#Yieldå…³é”®å­—" class="headerlink" title="Yieldå…³é”®å­—"></a>Yieldå…³é”®å­—</h3><p>ç†è§£yieldå…³é”®å­—ä¹‹å‰éœ€è¦å…ˆæ˜ç™½ä»€ä¹ˆæ˜¯è¿­ä»£ã€‚</p>
<h4 id="å¯è¿­ä»£å¯¹è±¡"><a href="#å¯è¿­ä»£å¯¹è±¡" class="headerlink" title="å¯è¿­ä»£å¯¹è±¡"></a>å¯è¿­ä»£å¯¹è±¡</h4><p>å»ºç«‹ä¸€ä¸ªåˆ—è¡¨ä¹‹åï¼Œå¯ä»¥é€é¡¹çš„è¯»å–åˆ—è¡¨ä¸­çš„å…ƒç´ ï¼Œè¿™å°±æ˜¯ä¸€ä¸ªå¯è¿­ä»£çš„å¯¹è±¡ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; list = [1, 2, 3, 4]</span><br><span class="line">&gt;&gt;&gt; for i in list:</span><br><span class="line">...     print i</span><br><span class="line">...</span><br><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">&gt;&gt;&gt;</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨åˆ—è¡¨ç”Ÿæˆå™¨å»ºç«‹ä¸€ä¸ªåˆ—è¡¨ï¼ŒåŒæ ·ä¹Ÿæ˜¯åˆ›å»ºäº†ä¸€ä¸ªå¯è¿­ä»£çš„å¯¹è±¡ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; list = [x * 2 for x in range(3)]</span><br><span class="line">&gt;&gt;&gt; list</span><br><span class="line">[0, 2, 4]</span><br><span class="line">&gt;&gt;&gt; for i in list:</span><br><span class="line">...     print i</span><br><span class="line">...</span><br><span class="line">0</span><br><span class="line">2</span><br><span class="line">4</span><br><span class="line">&gt;&gt;&gt;</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥ä½¿ç”¨for .. in .. çš„æ–¹å¼å¤„ç†ï¼šé“¾è¡¨ï¼Œå­—ç¬¦ä¸²ç­‰ï¼Œè¿™å°±å«åšä¸€ä¸ªè¿­ä»£å™¨ã€‚ä½†æ˜¯è¿™æ ·ä¼šå°†æ•°æ®å­˜æ”¾åˆ°å†…å­˜ä¸­ï¼Œå¦‚æœæ•°æ®é‡è¿‡å¤§çš„è¯ï¼Œå°±éå¸¸ä¸é€‚åˆäº†ã€‚</p>
<h4 id="ç”Ÿæˆå™¨"><a href="#ç”Ÿæˆå™¨" class="headerlink" title="ç”Ÿæˆå™¨"></a>ç”Ÿæˆå™¨</h4><p><a target="_blank" rel="noopener" href="http://pyzh.readthedocs.org/en/latest/the-python-yield-keyword-explained.html">ç”Ÿæˆå™¨æ˜¯å¯ä»¥è¿­ä»£çš„ï¼Œä½†æ˜¯ä½  åªå¯ä»¥è¯»å–å®ƒä¸€æ¬¡ ï¼Œå› ä¸ºå®ƒå¹¶ä¸æŠŠæ‰€æœ‰çš„å€¼æ”¾åœ¨å†…å­˜ä¸­ï¼Œå®ƒæ˜¯å®æ—¶åœ°ç”Ÿæˆæ•°æ®</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; g = (x * 2 for x in range(3))</span><br><span class="line">&gt;&gt;&gt; g</span><br><span class="line">&lt;generator object &lt;genexpr&gt; at 0x10978ca00&gt;</span><br><span class="line">&gt;&gt;&gt; for i in g:</span><br><span class="line">...     print i</span><br><span class="line">...</span><br><span class="line">0</span><br><span class="line">2</span><br><span class="line">4</span><br><span class="line">&gt;&gt;&gt; for i in g:</span><br><span class="line">...     print i</span><br><span class="line">...</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">&gt;&gt;&gt;</span><br></pre></td></tr></table></figure>

<h4 id="yieldå…³é”®å­—"><a href="#yieldå…³é”®å­—" class="headerlink" title="yieldå…³é”®å­—"></a>yieldå…³é”®å­—</h4><p>yield æ˜¯ä¸€ä¸ªç±»ä¼¼returnçš„å…³é”®å­—ï¼Œä½†æ˜¯è¿™ä¸ªå‡½æ•°è¿”å›çš„æ˜¯ç”Ÿæˆå™¨ã€‚</p>
<p>åŒæ—¶æˆ‘ä»¬å¯ä»¥åˆ©ç”¨ isgeneratorfunction åˆ¤æ–­ä¸€ä¸ªç‰¹æ®Šçš„ generator å‡½æ•°</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; mg = createGenerator()</span><br><span class="line">&gt;&gt;&gt; print (mg)</span><br><span class="line">&lt;generator object createGenerator at 0x10978c9b0&gt;</span><br><span class="line">&gt;&gt;&gt; for i in mg:</span><br><span class="line">...     print i</span><br><span class="line">...</span><br><span class="line">0</span><br><span class="line">2</span><br><span class="line">4</span><br><span class="line">&gt;&gt;&gt; from inspect import isgeneratorfunction</span><br><span class="line">&gt;&gt;&gt; isgeneratorfunction(mg)</span><br><span class="line">False</span><br><span class="line">&gt;&gt;&gt; isgeneratorfunction(createGenerator)</span><br><span class="line">True</span><br><span class="line">&gt;&gt;&gt;</span><br></pre></td></tr></table></figure>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼š<em>å½“ä½ è°ƒç”¨è¿™ä¸ªå‡½æ•°çš„æ—¶å€™ï¼Œå‡½æ•°å†…éƒ¨çš„ä»£ç å¹¶ä¸ç«‹é©¬æ‰§è¡Œ</em> ï¼Œè€Œæ˜¯è¿”å›ä¸€ä¸ªç”Ÿæˆå™¨å¯¹è±¡ã€‚åªæœ‰å½“ä½¿ç”¨forè¿›è¡Œè¿­ä»£çš„æ—¶å€™ï¼Œå‡½æ•°å†…çš„ä»£ç æ‰ä¼šæ‰§è¡Œã€‚</p>
<h4 id="æ§åˆ¶èµ„æºè®¿é—®"><a href="#æ§åˆ¶èµ„æºè®¿é—®" class="headerlink" title="æ§åˆ¶èµ„æºè®¿é—®"></a>æ§åˆ¶èµ„æºè®¿é—®</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; class Bank():</span><br><span class="line">...     crisis = False</span><br><span class="line">...     def createAtm(self):</span><br><span class="line">...             while not self.crisis:</span><br><span class="line">...                     yield &quot;$100&quot;</span><br><span class="line">...</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">&gt;&gt;&gt; bank = Bank()</span><br><span class="line">&gt;&gt;&gt; atm = bank.createAtm()</span><br><span class="line">&gt;&gt;&gt; print(atm.next())</span><br><span class="line">$100</span><br><span class="line">&gt;&gt;&gt; print(atm.next())</span><br><span class="line">$100</span><br><span class="line">&gt;&gt;&gt; print(atm.next())</span><br><span class="line">$100</span><br><span class="line">&gt;&gt;&gt; print(atm.next())</span><br><span class="line">$100</span><br><span class="line">&gt;&gt;&gt; atm.crisis = True</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;</span><br><span class="line">AttributeError: &#x27;generator&#x27; object has no attribute &#x27;crisis&#x27;</span><br><span class="line">&gt;&gt;&gt; bank.crisis = True</span><br><span class="line">&gt;&gt;&gt; print (atm.next())</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;</span><br><span class="line">StopIteration</span><br><span class="line">&gt;&gt;&gt;</span><br></pre></td></tr></table></figure>
<p>å¦‚æœä¸ä½¿ç”¨yieldçš„è¯ï¼Œè¿™ä¸ªç±»æ‰§è¡ŒcreateAtmä¹‹åå°±ä¼šå¯¼è‡´ç³»ç»Ÿèµ„æºè€—å°½ï¼ˆæˆ–è€…è¯´æ˜¯æ— é™å¾ªç¯ï¼‰</p>
<h4 id="ä½¿ç”¨yieldå¯ä»¥æ˜¯ç¨‹åºéå¸¸ä¼˜ç¾ï¼Œè™½ç„¶pythonç¨‹åºæœ¬èº«å°±ä¼šå¾ˆä¼˜ç¾"><a href="#ä½¿ç”¨yieldå¯ä»¥æ˜¯ç¨‹åºéå¸¸ä¼˜ç¾ï¼Œè™½ç„¶pythonç¨‹åºæœ¬èº«å°±ä¼šå¾ˆä¼˜ç¾" class="headerlink" title="ä½¿ç”¨yieldå¯ä»¥æ˜¯ç¨‹åºéå¸¸ä¼˜ç¾ï¼Œè™½ç„¶pythonç¨‹åºæœ¬èº«å°±ä¼šå¾ˆä¼˜ç¾"></a>ä½¿ç”¨yieldå¯ä»¥æ˜¯ç¨‹åºéå¸¸ä¼˜ç¾ï¼Œè™½ç„¶pythonç¨‹åºæœ¬èº«å°±ä¼šå¾ˆä¼˜ç¾</h4><h5 id="ç”Ÿæˆæ–æ³¢é‚£å¥‘ï¼ˆFibonacciï¼‰æ•°åˆ—"><a href="#ç”Ÿæˆæ–æ³¢é‚£å¥‘ï¼ˆFibonacciï¼‰æ•°åˆ—" class="headerlink" title="ç”Ÿæˆæ–æ³¢é‚£å¥‘ï¼ˆFibonacciï¼‰æ•°åˆ—"></a>ç”Ÿæˆæ–æ³¢é‚£å¥‘ï¼ˆFibonacciï¼‰æ•°åˆ—</h5><p>è®¸å¤šåˆå­¦è€…éƒ½ä¼šè¿™ä¹ˆå†™</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; def fab(max):</span><br><span class="line">...     n, a, b = 0, 0, 1</span><br><span class="line">...     while n &lt; max:</span><br><span class="line">...             print b</span><br><span class="line">...             a, b = b, a + b</span><br><span class="line">...             n = n + 1</span><br><span class="line">...</span><br><span class="line">&gt;&gt;&gt; fab(5)</span><br><span class="line">1</span><br><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">5</span><br><span class="line">&gt;&gt;&gt;</span><br></pre></td></tr></table></figure>
<p>ä½¿ç”¨yieldæ”¹å†™ä¸€ä¸ªç‰ˆæœ¬</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; def fab(max):</span><br><span class="line">...     n, a, b = 0, 0, 1</span><br><span class="line">...     while n &lt; max:</span><br><span class="line">...             yield b</span><br><span class="line">...             a, b = b, a + b</span><br><span class="line">...             n = n + 1</span><br><span class="line">...</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">&gt;&gt;&gt; for n in fab(5):</span><br><span class="line">...     print n</span><br><span class="line">...</span><br><span class="line">1</span><br><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">5</span><br><span class="line">&gt;&gt;&gt;</span><br></pre></td></tr></table></figure>
<h4 id="ç®€å•æè¿°ä¸‹"><a href="#ç®€å•æè¿°ä¸‹" class="headerlink" title="ç®€å•æè¿°ä¸‹"></a>ç®€å•æè¿°ä¸‹</h4><p>for è¯­å¥åœ¨ç¢°åˆ°ç”Ÿæˆå™¨ generator çš„æ—¶å€™ï¼Œ</p>
<p>è°ƒç”¨</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">generator.__next__()</span><br></pre></td></tr></table></figure>

<p>è·å–ç”Ÿæˆå™¨çš„è¿”å›å€¼ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">__next__()</span><br></pre></td></tr></table></figure>

<p>ä»¥Fibonacciä¸ºä¾‹ï¼šforæ¯æ¬¡è°ƒç”¨ï¼Œå¯ä»¥ç†è§£ä¸ºæ‰§è¡Œäº†ä¸€æ¬¡generator() æ‰§è¡Œåˆ° yield çš„æ—¶å€™ï¼Œç”Ÿæˆå™¨è¿”å›äº†nçš„å€¼å¹¶åœæ­¢ã€‚<br>è¿™å°±åƒæ™®é€šå‡½æ•°ç¢°åˆ° return æ—¶ä¸€æ ·ï¼Œå‰©ä¸‹çš„ä»£ç éƒ½è¢«å¿½ç•¥äº†ã€‚</p>
<p>ä¸åŒçš„åœ°æ–¹åœ¨äºï¼Œpython ä¼šè®°å½•è¿™ä¸ªåœæ­¢çš„ä½ç½®ã€‚ å½“å†æ¬¡æ‰§è¡Œgenerator()çš„æ—¶å€™ï¼Œpython ä»è¿™ä¸ªåœæ­¢ä½ç½®å¼€å§‹æ‰§è¡Œè€Œä¸æ˜¯å¼€å¤´ï¼Œ ä¹Ÿå°±æ˜¯è¯´è¿™æ¬¡è¿”å›äº†1ã€‚å†æ‰§è¡Œgenerator()ï¼Œåˆ™è¿”å›2ï¼Œå½“æ‰§è¡Œåˆ°è¿”å›5çš„æ—¶å€™ï¼Œå·²ç»æ²¡æœ‰ yield è¯­å¥äº†ï¼Œ å°±æŠ›å‡ºäº† StopIteration ã€‚è¿™å’Œå…¶ä»–è¿­ä»£å™¨æ˜¯ç±»ä¼¼çš„ï¼Œå½“ç„¶åœ¨forä¸­æ˜¯ä¸ä¼šæŠ›å‡ºå¼‚å¸¸çš„ã€‚</p>
<h4 id="è¿›é˜¶"><a href="#è¿›é˜¶" class="headerlink" title="è¿›é˜¶"></a>è¿›é˜¶</h4><p>åœ¨<a target="_blank" rel="noopener" href="https://www.python.org/dev/peps/pep-0342/">PEP 342</a>ä¸­åŠ å…¥äº†å°†å€¼ä¼ ç»™ç”Ÿæˆå™¨çš„æ”¯æŒã€‚PEP 342åŠ å…¥äº†æ–°çš„ç‰¹æ€§ï¼Œèƒ½è®©ç”Ÿæˆå™¨åœ¨å•ä¸€è¯­å¥ä¸­å®ç°ï¼Œç”Ÿæˆä¸€ä¸ªå€¼ï¼ˆåƒä»å‰ä¸€æ ·ï¼‰ï¼Œæ¥å—ä¸€ä¸ªå€¼ï¼Œæˆ–åŒæ—¶ç”Ÿæˆä¸€ä¸ªå€¼å¹¶æ¥å—ä¸€ä¸ªå€¼ã€‚<br>æˆ‘ä»¬ç”¨å‰é¢é‚£ä¸ªå…³äºç´ æ•°çš„å‡½æ•°æ¥å±•ç¤ºå¦‚ä½•å°†ä¸€ä¸ªå€¼ä¼ ç»™ç”Ÿæˆå™¨ã€‚è¿™ä¸€æ¬¡ï¼Œæˆ‘ä»¬ä¸å†ç®€å•åœ°ç”Ÿæˆæ¯”æŸä¸ªæ•°å¤§çš„ç´ æ•°ï¼Œè€Œæ˜¯æ‰¾å‡ºæ¯”æŸä¸ªæ•°çš„ç­‰æ¯”çº§æ•°å¤§çš„æœ€å°ç´ æ•°ï¼ˆä¾‹å¦‚10ï¼Œ æˆ‘ä»¬è¦ç”Ÿæˆæ¯”10ï¼Œ100ï¼Œ1000ï¼Œ10000 â€¦ å¤§çš„æœ€å°ç´ æ•°ï¼‰ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; import math</span><br><span class="line">&gt;&gt;&gt; def getPrimes(number):</span><br><span class="line">...     while True:</span><br><span class="line">...             if isPrime(number):</span><br><span class="line">&gt;&gt;&gt;                     &#x27;&#x27;&#x27;</span><br><span class="line">...                     yieldå…³é”®å­—è¿”å›numberçš„å€¼ï¼Œ</span><br><span class="line">...                     è€Œother = yield foo &quot;è¿”å›fooçš„å€¼ï¼Œ</span><br><span class="line">...                     è¿™ä¸ªå€¼è¿”å›ç»™è°ƒç”¨è€…çš„åŒæ—¶ï¼Œå°†otherçš„å€¼ä¹Ÿè®¾ç½®ä¸ºé‚£ä¸ªå€¼&quot;ã€‚</span><br><span class="line">...                     å¯ä»¥é€šè¿‡sendæ–¹æ³•æ¥å°†ä¸€ä¸ªå€¼â€å‘é€â€œç»™ç”Ÿæˆå™¨ã€‚</span><br><span class="line">&gt;&gt;&gt;                     &#x27;&#x27;&#x27;</span><br><span class="line">...                     number = yield number</span><br><span class="line">...             number += 1</span><br><span class="line">...</span><br><span class="line">&gt;&gt;&gt; def printSuccessivePrimes(iterations, base=10):</span><br><span class="line">...     printGenerator = getPrimes(base)</span><br><span class="line">&gt;&gt;&gt;     &#x27;&#x27;&#x27;</span><br><span class="line">...     ç”¨sendæ¥â€œå¯åŠ¨â€ä¸€ä¸ªç”Ÿæˆå™¨æ—¶ï¼ˆå°±æ˜¯ä»ç”Ÿæˆå™¨å‡½æ•°çš„ç¬¬ä¸€è¡Œä»£ç æ‰§è¡Œåˆ°ç¬¬ä¸€ä¸ªyieldè¯­å¥çš„ä½ç½®ï¼‰ï¼Œå¿…é¡»å‘é€Noneã€‚å› ä¸ºæ­¤æ—¶ç”Ÿæˆå™¨è¿˜æ²¡æœ‰èµ°åˆ°ç¬¬ä¸€ä¸ªyieldè¯­å¥ï¼Œå¦‚æœsendä¸€ä¸ªçœŸå®çš„å€¼ï¼Œè¿™æ—¶æ˜¯æ²¡æœ‰äººå»â€œæ¥æ”¶â€å®ƒçš„ã€‚ä¸€æ—¦ç”Ÿæˆå™¨å¯åŠ¨äº†ï¼Œæˆ‘ä»¬å°±å¯ä»¥åƒä¸Šé¢é‚£æ ·å‘é€æ•°æ®äº†</span><br><span class="line">&gt;&gt;&gt;     &#x27;&#x27;&#x27;</span><br><span class="line">...     printGenerator.send(None)</span><br><span class="line">...     for power in range(iterations):</span><br><span class="line">&gt;&gt;&gt;             &#x27;&#x27;&#x27;</span><br><span class="line">...             æ‰“å°çš„æ˜¯generator.sendçš„ç»“æœï¼Œsendåœ¨å‘é€æ•°æ®ç»™ç”Ÿæˆå™¨çš„åŒæ—¶è¿˜è¿”å›ç”Ÿæˆå™¨é€šè¿‡yieldç”Ÿæˆçš„å€¼</span><br><span class="line">&gt;&gt;&gt;             &#x27;&#x27;&#x27;</span><br><span class="line">...             print(printGenerator.send(base ** power))</span><br><span class="line">...</span><br><span class="line">&gt;&gt;&gt; def isPrime(number):</span><br><span class="line">...     if number &gt; 1:</span><br><span class="line">...             if number == 2:</span><br><span class="line">...                     return True</span><br><span class="line">...             if number % 2 == 0:</span><br><span class="line">...                     return False</span><br><span class="line">...             for current in range(3, int(math.sqrt(number) + 1), 2):</span><br><span class="line">...                     if number % current == 0:</span><br><span class="line">...                             return False</span><br><span class="line">...             return True</span><br><span class="line">...     return False</span><br><span class="line">...</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">&gt;&gt;&gt; printSuccessivePrimes(10)</span><br><span class="line">2</span><br><span class="line">11</span><br><span class="line">101</span><br><span class="line">1009</span><br><span class="line">10007</span><br><span class="line">100003</span><br><span class="line">1000003</span><br><span class="line">10000019</span><br><span class="line">100000007</span><br><span class="line">1000000007</span><br><span class="line">&gt;&gt;&gt;</span><br></pre></td></tr></table></figure>
<p>Python ä½¿ç”¨yieldçš„å…³é”®æ€æƒ³</p>
<ul>
<li>generatoræ˜¯ç”¨æ¥äº§ç”Ÿä¸€ç³»åˆ—å€¼çš„</li>
<li>yieldåˆ™åƒæ˜¯generatorå‡½æ•°çš„è¿”å›ç»“æœ</li>
<li>yieldå”¯ä¸€æ‰€åšçš„å¦ä¸€ä»¶äº‹å°±æ˜¯ä¿å­˜ä¸€ä¸ªgeneratorå‡½æ•°çš„çŠ¶æ€</li>
<li>generatorå°±æ˜¯ä¸€ä¸ªç‰¹æ®Šç±»å‹çš„è¿­ä»£å™¨ï¼ˆiteratorï¼‰</li>
<li>å’Œè¿­ä»£å™¨ç›¸ä¼¼ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä½¿ç”¨next()æ¥ä»generatorä¸­è·å–ä¸‹ä¸€ä¸ªå€¼</li>
<li>é€šè¿‡éšå¼åœ°è°ƒç”¨next()æ¥å¿½ç•¥ä¸€äº›å€¼</li>
</ul>
<h3 id="å‚è€ƒæ–‡çŒ®"><a href="#å‚è€ƒæ–‡çŒ®" class="headerlink" title="å‚è€ƒæ–‡çŒ®"></a>å‚è€ƒæ–‡çŒ®</h3><ul>
<li><a target="_blank" rel="noopener" href="http://pyzh.readthedocs.org/en/latest/the-python-yield-keyword-explained.html">http://pyzh.readthedocs.org/en/latest/the-python-yield-keyword-explained.html</a></li>
<li><a target="_blank" rel="noopener" href="http://www.dabeaz.com/coroutines/index.html">http://www.dabeaz.com/coroutines/index.html</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.python.org/2/tutorial/classes.html">https://docs.python.org/2/tutorial/classes.html</a></li>
<li><a target="_blank" rel="noopener" href="http://stackoverflow.com/questions/231767/what-does-the-yield-keyword-do-in-python">http://stackoverflow.com/questions/231767/what-does-the-yield-keyword-do-in-python</a></li>
<li><a target="_blank" rel="noopener" href="http://www.pydanny.com/python-yields-are-fun.html">http://www.pydanny.com/python-yields-are-fun.html</a></li>
<li><a target="_blank" rel="noopener" href="http://dhcmrlchtdj.github.io/sia/post/2012-11-20/python_yield.html">http://dhcmrlchtdj.github.io/sia/post/2012-11-20/python_yield.html</a></li>
<li><a target="_blank" rel="noopener" href="http://www.oschina.net/translate/improve-your-python-yield-and-generators-explained">http://www.oschina.net/translate/improve-your-python-yield-and-generators-explained</a></li>
<li><a target="_blank" rel="noopener" href="http://www.pythonclub.org/python-basic/yield">http://www.pythonclub.org/python-basic/yield</a></li>
<li><a target="_blank" rel="noopener" href="https://www.ibm.com/developerworks/cn/opensource/os-cn-python-yield/">https://www.ibm.com/developerworks/cn/opensource/os-cn-python-yield/</a></li>
<li><a target="_blank" rel="noopener" href="https://www.jeffknupp.com/blog/2013/04/07/improve-your-python-yield-and-generators-explained/">https://www.jeffknupp.com/blog/2013/04/07/improve-your-python-yield-and-generators-explained/</a></li>
<li><a target="_blank" rel="noopener" href="http://pythontips.com/2013/09/29/the-python-yield-keyword-explained/">http://pythontips.com/2013/09/29/the-python-yield-keyword-explained/</a></li>
<li><a target="_blank" rel="noopener" href="http://blog.jobbole.com/28506/">http://blog.jobbole.com/28506/</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2022/01/30/2016-01-02-Python-keyword-yield/" data-id="ckz0rdm4e000f94uthv6p0pfh" data-title="Pythonå…³é”®å­—:yield" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-2015-12-21-Oryx2-Overview" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2022/01/30/2015-12-21-Oryx2-Overview/" class="article-date">
  <time class="dt-published" datetime="2022-01-30T04:24:01.492Z" itemprop="datePublished">2022-01-30</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2022/01/30/2015-12-21-Oryx2-Overview/">Oryx2 ç®€ä»‹</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h3 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h3><p>![Oryx2](/assets/images/posts/oryx/OryxLogoMedium.png)</p>
<p>Oryx2æ˜¯ä¸“æ³¨äºè¿›è¡Œå¤§è§„æ¨¡ï¼Œå®æ—¶æœºå™¨å­¦ä¹ æ¡†æ¶ï¼Œéµå¾ªlambdaè§„åˆ™ï¼ŒåŸºäºApache Sparkå’ŒApache Kafkaæ„å»ºã€‚</p>
<p>Oryx ä¸ä»…æ˜¯æ„å»ºåº”ç”¨ç¨‹åºçš„æ¡†æ¶ï¼Œè€Œä¸”åŒ…å« ååŒè¿‡æ»¤ï¼Œåˆ†ç±»ï¼Œå›å½’å’Œèšç±»çš„æ‰“åŒ…çš„ç«¯åˆ°ç«¯çš„åº”ç”¨ã€‚</p>
<p>åŒ…å«3å±‚</p>
<ul>
<li>lambdaå±‚<ul>
<li>æ‰¹é‡å¤„ç†</li>
<li>å¿«é€Ÿå¤„ç†</li>
<li>æœåŠ¡</li>
</ul>
</li>
<li>MLæŠ½è±¡å±‚</li>
<li>ç«¯åˆ°ç«¯å®ç°å±‚</li>
</ul>
<p>ä»å¦ä¸€ä¸ªè§’åº¦ï¼Œå¯ä»¥çœ‹æˆæ˜¯ä¸€ç³»åˆ—é“¾æ¥çš„å…ƒç´ </p>
<ul>
<li>æ‰¹å¤„ç†å±‚ï¼šä¾æ®å†å²æ•°æ®è¿›è¡Œç¦»çº¿å¤„ç†</li>
<li>å®æ—¶å¤„ç†å±‚ï¼šé€šè¿‡å¢é‡æ•°æ®æµï¼Œå®æ—¶æ›´æ–°ç»“æœ</li>
<li>æœåŠ¡å±‚ï¼šé€šè¿‡æ¨¡å‹çš„ä¼ é€’å®ç°å¼‚æ­¥æŸ¥è¯¢API</li>
<li>æ•°æ®ä¼ è¾“å±‚ï¼šåœ¨å¤–éƒ¨æ•°æ®æºä¸å¤„ç†å±‚ä¹‹é—´ä¼ è¾“æ•°æ®</li>
</ul>
<p>The project</p>
<ul>
<li>may be reused tier by tier for example, the packaged app tier can be ignored, and it can be a framework for building new ML applications.</li>
<li>It can be reused layer by layer too: for example, the Speed Layer can be omitted if a deployment does not need incremental updates.</li>
<li>It can be modified piece-by-piece too: the collaborative filtering applicationâ€™s model-building batch layer could be swapped for a custom implementation based on a new algorithm outside Spark MLlib while retaining the serving and speed layer implementations.</li>
</ul>
<p>![Architecture](/assets/images/posts/oryx/Architecture.png)</p>
<h3 id="Lambdaå±‚å®ç°"><a href="#Lambdaå±‚å®ç°" class="headerlink" title="Lambdaå±‚å®ç°"></a>Lambdaå±‚å®ç°</h3><h4 id="æ•°æ®ä¼ è¾“"><a href="#æ•°æ®ä¼ è¾“" class="headerlink" title="æ•°æ®ä¼ è¾“"></a>æ•°æ®ä¼ è¾“</h4><p>  æ•°æ®ä¼ è¾“æœºåˆ¶å…¶å®å°±æ˜¯ä¸€ä¸ªKafkaçš„Topicã€‚ä»»ä½•ä¸€ä¸ªè¿›ç¨‹ï¼ˆåŒ…å«ä¸”ä¸å±€é™ä¸æœåŠ¡å±‚ï¼‰éƒ½å¯ä»¥å‘topicä¸­å†™å…¥æ•°æ®ï¼Œå¹¶é€šè¿‡å®æ—¶å¤„ç†å’Œæ‰¹å¤„ç†å±‚æŸ¥çœ‹ã€‚<br>  Kafka Topicä¹Ÿå¯ä»¥ç”¨æ¥æ¨¡å‹å’Œæ¨¡å‹ä¹‹é—´çš„æ›´æ–°ï¼Œå¹¶è¢«å®æ—¶å¤„ç†å±‚å’ŒæœåŠ¡å±‚æ¶ˆè´¹ã€‚</p>
<h4 id="æ‰¹å¤„ç†å±‚"><a href="#æ‰¹å¤„ç†å±‚" class="headerlink" title="æ‰¹å¤„ç†å±‚"></a>æ‰¹å¤„ç†å±‚</h4><p>  æ‰¹å¤„ç†å±‚æ˜¯ä»¥Spark Streamingè¿›ç¨‹çš„æ–¹å¼å®ç°çš„ï¼Œè¿è¡Œåœ¨Hadoop ClusterèŠ‚ç‚¹ä¸Šï¼Œå¹¶è¯»å–æ¥è‡ªKafka topicçš„è¾“å…¥æ•°æ®ã€‚ Streaming è¿›ç¨‹ä¼šæœ‰ä¸€ä¸ªå¾ˆé•¿çš„è¿è¡Œå‘¨æœŸ-è‹¥å¹²å°æ—¶ç”šè‡³ä¸€å¤©ã€‚ä¼šä½¿ç”¨Sparkå­˜å‚¨å½“å‰ä¼šè¯æ•°æ®åˆ°HDFSä¸­ï¼Œç„¶ååˆå¹¶HDFSä¸Šçš„æ‰€æœ‰å†å²æ•°æ®ï¼Œä¹‹åé‡æ–°åˆå§‹åŒ–æ„å»ºæ–°çš„ç»“æœæ•°æ®ã€‚å¹¶å°†æ–°çš„ç»“æœé‡æ–°å†™å…¥HDFSï¼ŒåŒæ—¶å‘ä¸åˆ°Kafkaæ›´æ–°topicä¸­ã€‚</p>
<h4 id="å®æ—¶å¤„ç†å±‚"><a href="#å®æ—¶å¤„ç†å±‚" class="headerlink" title="å®æ—¶å¤„ç†å±‚"></a>å®æ—¶å¤„ç†å±‚</h4><p>  å®æ—¶å¤„ç†å±‚ä¹Ÿæ˜¯ç”±Spark Streamingè¿›ç¨‹å®ç°çš„ï¼ŒåŒæ ·è¯»å–Kafka topicè¾“å…¥æ•°æ®ã€‚ä½†æ˜¯ä»–å­˜åœ¨æ¯”è¾ƒçŸ­çš„è¿è¡Œå‘¨æœŸï¼Œæ¯”å¦‚ç§’çº§åˆ«ã€‚ä¼šæŒç»­æ¶ˆè´¹æ›´æ–°topicä¸­çš„æ–°æ¨¡å‹ï¼Œå¹¶ç”Ÿäº§æ–°çš„æ¨¡å‹ã€‚ä¹Ÿä¼šå›å†™æ›´æ–°topicã€‚</p>
<h4 id="æœåŠ¡å±‚"><a href="#æœåŠ¡å±‚" class="headerlink" title="æœåŠ¡å±‚"></a>æœåŠ¡å±‚</h4><p>  æœåŠ¡å±‚ç›‘å¬æ›´æ–°topicä¸Šçš„æ¨¡å‹ä»¥åŠæ¨¡å‹æ›´æ–°ã€‚åœ¨å†…å­˜ä¸­æŒä¹…åŒ–æ¨¡å‹çŠ¶æ€ã€‚<br>  ä¼šæš´éœ²é¡¶å±‚æ–¹æ³•çš„ HTTP REST API ç”¨äºæŸ¥è¯¢å†…å­˜ä¸­çš„æ¨¡å‹ã€‚å¤§éƒ¨åˆ†æ¥å£éƒ½æ”¯æŒå¤§è§„æ¨¡çš„éƒ¨ç½²ã€‚<br>  æ¯ä¸ªæ¥å£éƒ½å¯ä»¥æ¥æ”¶æ–°çš„æ•°æ®å¹¶å†™å…¥Kafkaï¼Œä»¥æ­¤åœ¨å®æ—¶å¤„ç†å±‚å’Œæ‰¹å¤„ç†å±‚å¯è§ã€‚</p>
<h4 id="é…ç½®å’Œéƒ¨ç½²"><a href="#é…ç½®å’Œéƒ¨ç½²" class="headerlink" title="é…ç½®å’Œéƒ¨ç½²"></a>é…ç½®å’Œéƒ¨ç½²</h4><p>  ç¨‹åºæ˜¯åŸºäºJavaå®ç°çš„ï¼Œä¾èµ–<br>    * Spark 1.3.x+<br>    * Hadoop 2.6.x+<br>    * Tomcat 8.x+<br>    * Kafka 0.8.2+<br>    * Zookeeper ç­‰ã€‚</p>
<p>  é…ç½®æ–‡ä»¶é€šè¿‡ <a target="_blank" rel="noopener" href="https://github.com/typesafehub/config">Typesafe Config</a> çš„æ–¹å¼å®ç°æ•´ä¸ªç³»ç»Ÿçš„éƒ¨ç½²é…ç½®ã€‚<br>  åŒ…æ‹¬ï¼š æ‰¹å¤„ç†ï¼Œå®æ—¶å¤„ç†ï¼ŒæœåŠ¡å±‚é€»è¾‘å…³é”®çš„æ¥å£ç±»çš„å®ç°</p>
<p>  æ¯ä¸ªå±‚çš„äºŒè¿›åˆ¶å½¢å¼åˆ†å¼€è¿›è¡Œæ‰“åŒ…å’Œéƒ¨ç½²çš„ï¼Œæ¯ä¸ªéƒ½æ˜¯ä»¥å¯æ‰§è¡Œçš„Javaçš„jaråŒ…çš„å½¢å¼å­˜åœ¨å¹¶åŒ…å«æ‰€æœ‰å¿…é¡»çš„æœåŠ¡ã€‚</p>
<h3 id="MLå±‚å®ç°"><a href="#MLå±‚å®ç°" class="headerlink" title="MLå±‚å®ç°"></a>MLå±‚å®ç°</h3><p>  MLå±‚å¯¹ä¸Šè¿°é€šç”¨æ¥å£æ–¹æ³•åšäº†ç®€å•çš„ä¸“ä¸€è¯çš„å®ç°ï¼Œå®ç°äº†é€šç”¨MLéœ€æ±‚ï¼Œå¹¶ä¸”å¯¹åº”ç”¨æš´éœ²äº†æœºå™¨å­¦ä¹ ç‰¹æœ‰çš„æ¥å…¥æ¥å£ã€‚</p>
<p>  ä¸¾ä¸ªä¾‹å­ï¼Œå®ç°äº†æ‰¹é‡å¤„ç†å±‚ï¼Œç”¨äºè‡ªåŠ¨æ›´æ–°æµ‹è¯•é›†å’Œè®­ç»ƒé›†è¿›ç¨‹ã€‚å¯ä»¥è°ƒç”¨åº”ç”¨æä¾›çš„å‡½æ•°æ¥è¯„ä¼°æµ‹è¯•æœºæ¨¡å‹ã€‚é€šè¿‡å°è¯•ä¸åŒçš„è¶…å‚æ•°å€¼ï¼Œé€‰æ‹©å‡ºæœ€ä½³ç»“æœã€‚é€šè¿‡PMMLç®¡ç†æ¨¡å‹çš„åºåˆ—å·ã€‚</p>
<h3 id="ç«¯åˆ°ç«¯åº”ç”¨å®ç°"><a href="#ç«¯åˆ°ç«¯åº”ç”¨å®ç°" class="headerlink" title="ç«¯åˆ°ç«¯åº”ç”¨å®ç°"></a>ç«¯åˆ°ç«¯åº”ç”¨å®ç°</h3><p>  é™¤äº†ä½œä¸ºä¸€ç§æ¡†æ¶ï¼ŒOryx2 åŒ…å«å®Œæ•´çš„ä¸‰ä¸­æœºå™¨å­¦ä¹ éœ€è¦çš„æ‰¹å¤„ç†å±‚ï¼Œå®æ—¶å¤„ç†å±‚ï¼ŒæœåŠ¡å±‚ã€‚<br>  å¼€ç®±å³ç”¨ï¼Œæˆ–è€…ä½œä¸ºè‡ªå®šä¹‰ç¨‹åºçš„åŸºç¡€ï¼š</p>
<pre><code>* åŸºäºæœ€å°äºŒä¹˜æ³•çš„ååŒè¿‡æ»¤/æ¨è
* åŸºäºk-meansçš„èšç±»
* åŸºäºéšæœºå†³ç­–æ£®æ—çš„åˆ†ç±»å’Œå›å½’
</code></pre>
<h3 id="å‚è€ƒæ–‡çŒ®"><a href="#å‚è€ƒæ–‡çŒ®" class="headerlink" title="å‚è€ƒæ–‡çŒ®"></a>å‚è€ƒæ–‡çŒ®</h3><ul>
<li><a target="_blank" rel="noopener" href="http://oryx.io/index.html">http://oryx.io/index.html</a></li>
<li><a target="_blank" rel="noopener" href="http://www.ivanopt.com/oryx-document%E7%BF%BB%E8%AF%91/">http://www.ivanopt.com/oryx-document%E7%BF%BB%E8%AF%91/</a></li>
<li><a target="_blank" rel="noopener" href="http://jameskinley.tumblr.com/post/37398560534/the-lambda-architecture-principles-for">http://jameskinley.tumblr.com/post/37398560534/the-lambda-architecture-principles-for</a></li>
<li><a target="_blank" rel="noopener" href="http://dmg.org/pmml/v4-1/GeneralStructure.html">http://dmg.org/pmml/v4-1/GeneralStructure.html</a></li>
<li><a target="_blank" rel="noopener" href="http://blog.csdn.net/nxcjh321/article/details/24796879">http://blog.csdn.net/nxcjh321/article/details/24796879</a></li>
<li><a target="_blank" rel="noopener" href="http://youngfor.me/post/recsys/oryx-tui-jian-xi-tong-chu-ti-yan">http://youngfor.me/post/recsys/oryx-tui-jian-xi-tong-chu-ti-yan</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/OryxProject/oryx">https://github.com/OryxProject/oryx</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2022/01/30/2015-12-21-Oryx2-Overview/" data-id="ckz0rdm49000594ut49hlaahd" data-title="Oryx2 ç®€ä»‹" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-2015-12-21-Oryx2-Admin-Docs" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2022/01/30/2015-12-21-Oryx2-Admin-Docs/" class="article-date">
  <time class="dt-published" datetime="2022-01-30T04:24:01.490Z" itemprop="datePublished">2022-01-30</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2022/01/30/2015-12-21-Oryx2-Admin-Docs/">Oryx2 ç®¡ç†å‘˜æ–‡æ¡£</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h3 id="Oryx-2-1-0-ç³»ç»Ÿè¦æ±‚"><a href="#Oryx-2-1-0-ç³»ç»Ÿè¦æ±‚" class="headerlink" title="Oryx 2.1.0 ç³»ç»Ÿè¦æ±‚"></a>Oryx 2.1.0 ç³»ç»Ÿè¦æ±‚</h3><ul>
<li>Java 7 or later (JRE only is required)</li>
<li>A Hadoop cluster running the following components:<ul>
<li>Apache Hadoop 2.6.0 or later</li>
<li>Apache Zookeeper 3.4.5 or later</li>
<li>Apache Kafka 0.8.2 or later (in 0.8.x line)</li>
<li>Apache Spark 1.5.0 or later</li>
</ul>
</li>
</ul>
<h3 id="æœåŠ¡"><a href="#æœåŠ¡" class="headerlink" title="æœåŠ¡"></a>æœåŠ¡</h3><p>Hadoop cluster æœåŠ¡</p>
<ul>
<li>HDFS</li>
<li>YARN</li>
<li>Zookeeper</li>
<li>Kafka</li>
<li>Spark (on YARN)</li>
</ul>
<p>Note that for CDH, Kafka is available as a parcel from <a target="_blank" rel="noopener" href="http://www.cloudera.com/content/cloudera/en/developers/home/cloudera-labs/apache-kafka.html">Cloudera Labs</a>.</p>
<p>Kafka brokers éœ€è¦é…ç½®åœ¨é›†ç¾¤ä¸­ï¼Œæ ¹æ®å®ä¾‹ï¼Œéœ€è¦æ³¨æ„hostså’Œç«¯å£ã€‚ç«¯å£ä¸€èˆ¬ä¼šè®¾ç½®ä¸º9092ï¼Œæ­¤å¤„å’ŒZK serverçš„ç«¯å£ä¿æŒä¸€è‡´ï¼Œç¼ºçœè®¾ç½®ä¸º2181ã€‚ç¼ºçœç«¯å£ä¼šåœ¨éšåçš„ä¾‹å­ä¸­ä½¿ç”¨ã€‚</p>
<p>å¤šä¸ªhostséœ€è¦é€šè¿‡é€—å·åˆ†å‰²ï¼Œå¹¶éœ€è¦æä¾›host:port è¿™ç§æ–¹å¼ï¼Œæ¯”å¦‚ ï¼š your-zk-1:2181,your-zk-2:2181ã€‚</p>
<p>åŒæ—¶éœ€è¦æ³¨æ„ï¼Œä½ çš„ZKå®ä¾‹æ˜¯å¦ä½¿ç”¨äº†chroot pathã€‚è¿™æ˜¯ä¸€ä¸ªç®€å•çš„è·¯å¾„å‰ç¼€ï¼Œæ¯”å¦‚ your-zk:2181/your-chroot<br>/kafka æ˜¯ç»å¸¸ç”¨åˆ°ä½œä¸ºå‰ç¼€çš„ã€‚å¦‚æœæ²¡æœ‰ä½¿ç”¨chrootï¼Œå°±å¯ä»¥å¿½ç•¥è¿™ä¸ªã€‚æ³¨æ„ï¼šå¦‚æœå­˜åœ¨å¤šä¸ªZK serverï¼Œå’Œä¸€ä¸ªchrootï¼Œåªéœ€è¦åœ¨æœ€åæ·»åŠ ä¸€æ¬¡chrootå³å¯ï¼Œæ¯”å¦‚ your-zk-1:2181,your-zk-2:2181/kafka</p>
<h3 id="é…ç½®Kafka"><a href="#é…ç½®Kafka" class="headerlink" title="é…ç½®Kafka"></a>é…ç½®Kafka</h3><p>Oryx ä½¿ç”¨2ä¸ªKafka topics åšæ•°æ®ä¼ è¾“ã€‚</p>
<ul>
<li>ä¸€ä¸ªä¼ è¾“è¾“å…¥æ•°æ®åˆ°æ‰¹é‡å¤„ç†ï¼Œå’Œå®æ—¶è®¡ç®—å±‚</li>
<li>å¦ä¸€ä¸ªåŒæ­¥æ¨¡å‹æ›´æ–°åˆ°æœåŠ¡å±‚</li>
</ul>
<p>ç¼ºçœçš„topicsçš„åç§°åˆ†åˆ«ä¸ºOryxInput å’Œ OryxUpdateï¼Œåªæœ‰OryxæœåŠ¡å¯åŠ¨åæ‰èƒ½åˆ›å»ºè¿™ä¸¤ä¸ªtopicsã€‚</p>
<p>è¾“å…¥topicçš„åˆ†åŒºæ•°ç›®ä¼šå½±å“æ¶ˆè´¹æ•°æ®çš„Spark Streaming ä½œä¸šçš„åˆ†åŒºæ•°ï¼Œç”šè‡³æ˜¯å¹¶å‘æ•°ã€‚æ¯”å¦‚ï¼Œæ‰¹é‡å¤„ç†å±‚è¯»å–HDFSä¸Šçš„å†å²æ•°æ®åˆ†åŒºå’ŒKafkaæ•°æ®ã€‚</p>
<p>å¦‚æœè¾“å…¥topicåªæœ‰ä¸€ä¸ªåˆ†åŒºï¼Œä¸”åœ¨æ¯ä¸ªæ—¶é—´é—´éš”å†…æœ‰å¤§é‡çš„æ•°æ®æ¶Œå…¥ï¼Œè¿™æ—¶KafkaåŸºäºçš„è¾“å…¥åˆ†åŒºç›¸å¯¹çš„éœ€è¦å¾ˆé•¿çš„æ—¶é—´å»å¤„ç†ã€‚ä¸€ä¸ªæ¯”è¾ƒåˆé€‚çš„ç»éªŒå€¼æ˜¯é€‰æ‹©ä¸€äº›topicåˆ†åŒºï¼Œåœ¨ä¸€ä¸ªæ‰¹å¤„ç†æ—¶é—´é—´éš”å†…åˆ°è¾¾çš„å¤§é‡æ•°æ®ï¼Œå¤§çº¦æ˜¯ä¸€ä¸ªHDFSå—å¤§å°ï¼Œç¼ºçœå€¼æ˜¯128MBã€‚</p>
<p>æä¾›çš„oryx-run.sh kafkaè®¾ç½®è„šæœ¬ï¼Œç¼ºçœè®¾ç½®ä¸º4ä¸ªåˆ†åŒºï¼Œå½“ç„¶äº†ï¼Œè¿™ä¸ªå€¼ä¹‹åæ˜¯å¯ä»¥ä¿®æ”¹çš„ã€‚å¿…é¡»æ³¨æ„ä¸èƒ½è®¾ç½®æ›´æ–°topicå¤šäº1ä¸ªåˆ†åŒºã€‚</p>
<p>é‡å¤å› å­å¯ä»¥è®¾ç½®ä¸ºä»»ä½•å€¼ï¼Œä½†æ˜¯å»ºè®®æœ€å°‘æ˜¯2ã€‚æ³¨æ„ï¼šé‡å¤å› å­æ•°ç›®ä¸èƒ½è¶…è¿‡Kafka brokersåœ¨é›†ç¾¤ä¸Šçš„æ•°ç›®ã€‚æ‰€ä»¥æä¾›çš„è®¾ç½®è„šæœ¬é‡Œç¼ºçœè®¾ç½®é‡å¤å› å­ä¸º1. ä¹‹åä½ å¯ä»¥é€šè¿‡kafka-topics â€“zookeeper â€¦ â€“alter â€“topic â€¦ â€“replication-factor N ç­‰ä¿®æ”¹è¿™äº›ç¼ºçœå€¼ã€‚</p>
<p>ä½ éœ€è¦ä¸ºå…¶ä¸­ä¸€ä¸ªæˆ–è€…ä¸¤ä¸ªtopicé…ç½®æŒç»­æ—¶é—´ã€‚å°¤å…¶é‡è¦çš„æ˜¯éœ€è¦é™åˆ¶æ›´æ–°topicçš„æŒç»­æ—¶é—´ï¼Œå› ä¸ºå®æ—¶è®¡ç®—å±‚å’ŒæœåŠ¡å±‚éœ€è¦ä»å¯åŠ¨å¼€å§‹çš„èµ·ç‚¹è·å–æ•´ä¸ªtopicã€‚è¿™ä¸ªæœºåˆ¶å¹¶ä¸å¦‚è¾“å…¥æ•°æ®é‡è¦ï¼Œè¾“å…¥æ•°æ®ä¸ä¼šå†æ¬¡ä»å¤´è¯»å–æ•°æ®ã€‚</p>
<p>è®¾ç½®è¿™ä¸ªå€¼ä¸ºæ‰¹é‡å¤„ç†å±‚æ›´æ–°é—´éš”çš„2å€æ˜¯æ¯”è¾ƒåˆé€‚ã€‚æ¯”å¦‚è®¾ç½®è¯¥å€¼ä¸º1å¤©ï¼ˆ24 * 60 * 60 * 1000 = 86400000 msï¼‰ï¼Œè®¾ç½®topicçš„ä¸º86400000msã€‚è¿™ä¸ªå¯ä»¥é€šè¿‡oryx-run.shè®¾ç½®è„šæœ¬è‡ªåŠ¨è®¾ç½®ã€‚</p>
<p>ä¸Šè¿°ä¸¤ä¸ªtopicsä¼šåŒ…å«å¤§é‡ä¿¡æ¯ï¼›å°¤å…¶æ˜¯æ›´æ–°topicåŒ…å«æ•´ä¸ªåºåˆ—åŒ–çš„PMMLæ¨¡å‹ã€‚å¾ˆæœ‰å¯èƒ½ä»–ä¼šè¶…è¿‡Kafkaç¼ºçœæœ€å¤§æ¶ˆæ¯çš„å¤§å°ï¼ˆkafkaæ¶ˆæ¯æœ€å¤§1Mibï¼‰ã€‚å¦‚æœæœ‰æ›´å¤§çš„æ•°æ®åˆ™éœ€è¦è®¾ç½®topicâ€™s max.message.bytesã€‚oryx-run.sh Kafkaè®¾ç½®è„šæœ¬è®¾ç½®æ›´æ–°topicç¼ºçœä¸º16Mibã€‚è¿™ä¹Ÿæ˜¯Oryxè¯•å›¾å¸å…¥æ›´æ–°topicé‡Œçš„æ¨¡å‹çš„æœ€å¤§å€¼é»˜è®¤ï¼›æ›´å¤§çš„æ¨¡å‹åªä¼šä»¥æ–‡ä»¶çš„å½¢å¼ä¿å­˜åˆ°HDFSä¸­çš„è·¯å¾„ä¸­ã€‚è¯·æŸ¥çœ‹å±æ€§oryx.update-topic.message.max-sizeã€‚</p>
<p>Kafkaä»£ç†çš„message.max.byteså±æ€§å¯ä»¥æ§åˆ¶è¿™ä¸ªï¼Œä½†æ˜¯è®¾ç½®è¿™ä¸ªå€¼ä¼šå½±å“åˆ°ä»£ç†ç®¡ç†çš„æ‰€æœ‰çš„topicsï¼Œç”šè‡³åŒ…æ‹¬ä¸è‰¯çŠ¶æ€çš„topicsã€‚å¯ä»¥é€šè¿‡æŸ¥çœ‹æ€§èƒ½å’Œèµ„æºéƒ¨åˆ†äº†è§£æ›´å¤šã€‚å°¤å…¶æ˜¯éœ€è¦æ³¨æ„çš„ï¼Œå¿…é¡»è®¾ç½®ä»£ç†çš„replica.fetch.max.byteså±æ€§ï¼Œä»¥é˜²æ­¢é‡å¤ä»»ä½•éå¸¸å¤§çš„æ¶ˆæ¯ã€‚</p>
<blockquote>
<p>There is no per-topic equivalent to this.</p>
</blockquote>
<h3 id="Kafkaé…ç½®è‡ªåŠ¨è®¾ç½®"><a href="#Kafkaé…ç½®è‡ªåŠ¨è®¾ç½®" class="headerlink" title="Kafkaé…ç½®è‡ªåŠ¨è®¾ç½®"></a>Kafkaé…ç½®è‡ªåŠ¨è®¾ç½®</h3><p>æä¾›çš„oryx-run.shè„šæœ¬å¯ä»¥æ‰“å°ZKçš„å½“å‰é…ç½®ï¼Œåˆ—å‡ºå·²ç»å­˜åœ¨çš„Kafkaä¸­çš„topicsï¼Œå¦‚æœéœ€è¦ï¼Œä¼šåˆ›å»ºé…ç½®å¥½çš„è¾“å…¥topicså’Œæ›´æ–°topicsã€‚</p>
<p>ä½ éœ€è¦å…ˆåˆ›å»ºOryxé…ç½®æ–‡ä»¶ï¼Œæˆ–è€…å¯ä»¥æ‹·è´conf/als-example.confã€‚éœ€è¦æŒ‰ç…§è¦æ±‚ä¿®æ”¹Kafkaå’ŒZKçš„é…ç½®æ–‡ä»¶ï¼Œæ¯”å¦‚topicåç§°ã€‚</p>
<p>oryx.confæ–‡ä»¶éœ€è¦å’Œæ¯ä¸ªå±‚çš„JARæ–‡ä»¶æ”¾åœ¨åŒä¸€ä¸ªç›®å½•ä¸‹ï¼Œç„¶åæ‰§è¡Œï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">./oryx-run.sh kafka-setup</span><br><span class="line"></span><br><span class="line">Input  ZK:    your-zk:2181</span><br><span class="line">Input  Kafka: your-kafka:9092</span><br><span class="line">Input  topic: OryxInput</span><br><span class="line">Update ZK:    your-zk:2181</span><br><span class="line">Update Kafka: your-kafka:9092</span><br><span class="line">Update topic: OryxUpdate</span><br><span class="line"></span><br><span class="line">All available topics:</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Input topic OryxInput does not exist. Create it? y</span><br><span class="line">Creating topic OryxInput</span><br><span class="line">Created topic &quot;OryxInput&quot;.</span><br><span class="line">Status of topic OryxInput:</span><br><span class="line">Topic:OryxInput	PartitionCount:4	ReplicationFactor:1	Configs:</span><br><span class="line">	Topic: OryxInput	Partition: 0	Leader: 120	Replicas: 120,121	Isr: 120,121</span><br><span class="line">	Topic: OryxInput	Partition: 1	Leader: 121	Replicas: 121,120	Isr: 121,120</span><br><span class="line">	Topic: OryxInput	Partition: 2	Leader: 120	Replicas: 120,121	Isr: 120,121</span><br><span class="line">	Topic: OryxInput	Partition: 3	Leader: 121	Replicas: 121,120	Isr: 121,120</span><br><span class="line"></span><br><span class="line">Update topic OryxUpdate does not exist. Create it? y</span><br><span class="line">Creating topic OryxUpdate</span><br><span class="line">Created topic &quot;OryxUpdate&quot;.</span><br><span class="line">Updated config for topic &quot;OryxUpdate&quot;.</span><br><span class="line">Status of topic OryxUpdate:</span><br><span class="line">Topic:OryxUpdate	PartitionCount:1	ReplicationFactor:1	Configs:retention.ms=86400000,max.message.bytes=16777216</span><br><span class="line">	Topic: OryxUpdate	Partition: 0	Leader: 120	Replicas: 120,121	Isr: 120,121</span><br></pre></td></tr></table></figure>
<p>æŸ¥çœ‹å‘é€åˆ°è¾“å…¥å’Œæ›´æ–°topicï¼Œç›‘æ§åº”ç”¨çš„åŠ¨ä½œï¼Œå¯ä»¥æ‰§è¡Œï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">./oryx-run.sh kafka-tail</span><br><span class="line">Input  ZK:    your-zk:2181</span><br><span class="line">Input  Kafka: your-kafka:9092</span><br><span class="line">Input  topic: OryxInput</span><br><span class="line">Update ZK:    your-zk:2181</span><br><span class="line">Update Kafka: your-kafka:9092</span><br><span class="line">Update topic: OryxUpdate</span><br><span class="line"></span><br><span class="line">...output...</span><br></pre></td></tr></table></figure>

<p>æ¥ç€åœ¨å¦å¤–ä¸€ä¸ªçª—å£ï¼Œå¯ä»¥æ¥å—è¾“å…¥æ•°æ®ï¼Œæ¯”å¦‚å°†æ¥è‡ªç»ˆç«¯ç”¨æˆ·çš„æ–‡æ¡£data.csvåŠ å…¥åˆ°è¾“å…¥é˜Ÿåˆ—ï¼Œå¹¶éªŒè¯ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./oryx-run.sh kafka-input --input-file data.csv</span><br></pre></td></tr></table></figure>

<p>å¦‚æœä»¥ä¸Šå…¨éƒ¨æˆåŠŸäº†ï¼Œå¯ä»¥å…³é—­è¿™äº›è¿›ç¨‹ã€‚é›†ç¾¤è‡³æ­¤å·²ç»å‡†å¤‡å¥½è¿è¡ŒOryxäº†ã€‚</p>
<h3 id="HDFSå’Œæ•°æ®å±‚"><a href="#HDFSå’Œæ•°æ®å±‚" class="headerlink" title="HDFSå’Œæ•°æ®å±‚"></a>HDFSå’Œæ•°æ®å±‚</h3><p>åœ¨Oryxä¸­ï¼ŒKafkaæ˜¯æ•°æ®ä¼ è¾“çš„é€”å¾„ï¼Œå› æ­¤æ•°æ®åœ¨Kafkaä¸­åªæ˜¯éœ€è¦æš‚æ—¶å­˜æ”¾çš„ã€‚ç„¶è€Œè¾“å…¥æ•°æ®ä¹Ÿä¼šæŒä¹…åŒ–åˆ°HDFSä¸­ä»¥å¤‡ä¹‹åä½¿ç”¨ã€‚åŒæ ·çš„ï¼Œæ¨¡å‹å’Œæ›´æ–°ç”¨æ¥ä¸ºKafkaçš„æ›´æ–°topicæä¾›æ•°æ®ï¼Œæ¨¡å‹ä¹Ÿä¼šæŒä¹…åŒ–åˆ°HDFSä»¥å¤‡ä¹‹åå¼•ç”¨ã€‚</p>
<p>oryx.batch.storage.data-dirå®šä¹‰äº†è¾“å…¥æ•°æ®å­˜æ”¾åœ¨HDFSä¸­çš„ä½ç½®ã€‚åœ¨è¿™ä¸ªç›®å½•ä¸‹ï¼Œå­ç›®å½•æ ‡é¢˜ä¼šä»¥oryx-[timestamp].dataå½¢å¼åˆ›å»ºï¼Œæ¯ä¸€ä¸ªä¼šé€šè¿‡Spark Stramingåœ¨æ‰¹é‡å¤„ç†å±‚æ‰§è¡Œã€‚åœ¨è¿™é‡Œï¼Œæ—¶é—´æˆ³æ ¼å¼æ ¼å¼ä¸Unixç›¸åŒï¼Œä¸”ä»¥æ¯«ç§’ä¸ºå•ä½ã€‚</p>
<p>å®é™…ä¸Šï¼Œå’Œå¤§å¤šæ•°Hadoopä¸­åˆ†å¸ƒå¼è¿›ç¨‹è¾“å‡ºçš„ã€æ–‡ä»¶ã€ä¸€æ ·ï¼Œå­˜åœ¨è¿™æ ·çš„ä¸€ä¸ªå­ç›®å½•ï¼ŒåŒ…å«äº†å¾ˆå¤šä»¥part-å¼€å¤´çš„æ–‡ä»¶ã€‚æ¯ä¸ªæ–‡ä»¶éƒ½æ˜¯åºåˆ—åŒ–æ–‡ä»¶ï¼Œé€šè¿‡Writableç±»åºåˆ—åŒ–Kafkaè¾“å…¥topicsçš„é”®å€¼ï¼ŒWritableç±»å®ç°è‡ªoryx.batch.storage.key-writable-class å’Œ oryx.batch.storage.message-writable-classç±»ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œè¿™æ˜¯TextWritableï¼Œå¹¶ä¸”keyså’Œæ¶ˆæ¯æ˜¯ä»¥å­—ç¬¦ä¸²å½¢å¼è¢«è®°å½•ä¸‹æ¥çš„ã€‚</p>
<p>è¯¥ç›®å½•ä¸‹çš„æ•°æ®ä¼šè¢«åˆ é™¤ã€‚ä¹Ÿå°±ä¸ä¼šå†æ¬¡è¢«æ‰¹å¤„ç†å±‚è®¡ç®—ä½¿ç”¨ã€‚å°¤å…¶æ˜¯ï¼Œè®¾ç½®oryx.batch.storage.max-age-data-hoursä¸ºä¸€ä¸ªéè´Ÿæ•°ï¼Œå°†ä¼šä½¿æ‰¹å¤„ç†å±‚è‡ªåŠ¨åˆ é™¤å¤§äºç»™å®šæ—¶é—´çš„æ•°æ®ã€‚</p>
<p>åŒæ ·çš„ï¼Œåœ¨æ¯ä¸ªæ‰¹å¤„ç†é—´éš”å†…è¢«æ‰¹å¤„ç†å±‚é€‰ä¸­çš„æ¨¡å‹ä¼šè¢«åŸå§‹çš„æœºå™¨å­¦ä¹ åº”ç”¨ï¼ˆæ‰©å±•å­MLUpdateï¼‰è¾“å‡ºã€‚ä¹Ÿä¼šè¢«æŒä¹…åŒ–åˆ°oryx.batch.storage.model-dirå®šä¹‰çš„ç›®å½•ä¸‹çš„å­ç›®å½•ä¸­ã€‚åœ¨è¿™ä¸ªç›®å½•ä¸‹ï¼Œå­ç›®å½•çš„å‘½åéƒ½æ˜¯ä»¥æ—¶é—´æˆ³å½¢å¼å®ç°çš„ï¼ŒåŒUnixæ¯«ç§’å½¢å¼ã€‚</p>
<p>å­ç›®å½•ä¸‹çš„å†…å®¹å–å†³äºåº”ç”¨ï¼Œä½†æ˜¯ä¸€èˆ¬ä¼šåŒ…å«ä»¥model.pmmlå‘½åçš„PMMLæ¨¡å—ï¼Œå¹¶ä¸”å’Œæ¨¡å—ä¸€èµ·å­˜åœ¨çš„å¯é€‰çš„è¿½åŠ æ–‡ä»¶ã€‚</p>
<p>è¿™ä¸ªç›®å½•ä¹‹æ‰€ä»¥å­˜åœ¨æ˜¯å› ä¸ºéœ€è¦è®°å½•PMMLæ¨¡å—ç”¨æ¥å½’æ¡£ç”¨æˆ–è€…è¢«å…¶ä»–å·¥å…·ä½¿ç”¨ã€‚ä¹Ÿå¯æŒ‰ç…§è§„åˆ™åˆ é™¤å…¶å†…å®¹ã€‚</p>
<h3 id="æ•è·é”™è¯¯"><a href="#æ•è·é”™è¯¯" class="headerlink" title="æ•è·é”™è¯¯"></a>æ•è·é”™è¯¯</h3><p>æœ€åï¼Œä½ å¯èƒ½å¸Œæœ›åœæ­¢å…¶ä¸­ä¸€ä¸ªæˆ–è€…å‡ ä¸ªå±‚çš„è¿è¡Œï¼Œæˆ–è€…é‡å¯ã€‚æœåŠ¡ä¹Ÿå¯èƒ½æŒ‚é¸Ÿã€‚è¿™åˆ°åº•å‘ç”Ÿäº†ç¥é©¬ï¼Ÿä¸ºå•¥ä¼šè¿™æ ·æï¼Ÿ</p>
<h4 id="æ•°æ®ä¸¢å¤±"><a href="#æ•°æ®ä¸¢å¤±" class="headerlink" title="æ•°æ®ä¸¢å¤±"></a>æ•°æ®ä¸¢å¤±</h4><p>å†å²æ•°æ®å­˜æ”¾åœ¨HDFSä¸­ï¼Œç†è®ºä¸Šä¼šå­˜æ”¾å¤šä¸ªå‰¯æœ¬ã€‚HDFSä¼šç¡®ä¿æ•°æ®è¢«é è°±çš„å­˜æ”¾ç€ã€‚å½“è®¾ç½®äº†å‰¯æœ¬ï¼ŒKafkaä¹Ÿè¢«è®¾è®¡ä¸ºé‡‡ç”¨å‰¯æœ¬æ–¹å¼åº”å¯¹æ•…éšœã€‚</p>
<p>è¿™å¹¶æ²¡æœ‰å•¥é¸Ÿç”¨ï¼Œè¿™æ ·ä¸èƒ½ç¡®ä¿æ•°æ®ä¸ä¼šä¸¢å¤±ï¼Œåªèƒ½ä¾é HDFSå’ŒKafkaèƒ½æ­£å¸¸å¯ç”¨ç½¢äº†ã€‚</p>
<h4 id="æœåŠ¡å™¨æŒ‚é¸Ÿ"><a href="#æœåŠ¡å™¨æŒ‚é¸Ÿ" class="headerlink" title="æœåŠ¡å™¨æŒ‚é¸Ÿ"></a>æœåŠ¡å™¨æŒ‚é¸Ÿ</h4><p>é€šå¸¸æƒ…å†µä¸‹ï¼Œæ‰€æœ‰çš„ä¸‰å±‚æœåŠ¡è¿›ç¨‹åº”è¯¥ä¼šæŒç»­çš„å·¥ä½œï¼Œå¦‚æœä¸å¾—ä¸åœæ­¢æˆ–è€…æŒ‚é¸Ÿçš„è¯ï¼ŒæœåŠ¡è‡ªå·±ä¼šç«‹å³é‡å¯ã€‚è¿™ä¸ªå¯ä»¥é€šè¿‡åˆå§‹åŒ–è„šæœ¬å®Œç¾çš„å®Œæˆæˆ–è€…ç±»ä¼¼æœºåˆ¶ï¼ˆå°šæœªå®ç°é¸Ÿï¼‰</p>
<h5 id="æœåŠ¡å±‚"><a href="#æœåŠ¡å±‚" class="headerlink" title="æœåŠ¡å±‚"></a>æœåŠ¡å±‚</h5><p>æœåŠ¡å±‚æ˜¯æ— çŠ¶æ€çš„ã€‚å¯åŠ¨åï¼Œä»–ä¼šè¯»å–æ›´æ–°topicsä¸­çš„æ‰€æœ‰çš„æ¨¡å‹å’Œå¯ç”¨æ›´æ–°ã€‚å½“é¦–ä¸ªå¯ç”¨çš„æ¨¡å‹å°±ç»ªåï¼Œå°±å¯ä»¥å¼€å§‹åº”ç­”è¯·æ±‚ã€‚åŸºäºè¿™ä¸ªåŸå› ï¼Œéœ€è¦é€‚å½“çš„é™åˆ¶æ›´æ–°topicçš„æŒç»­æ—¶é—´ã€‚</p>
<p>æœåŠ¡å±‚çš„æ“ä½œä¸æ˜¯åˆ†å¸ƒå¼çš„ï¼Œæ¯ä¸ªå®ä¾‹æ˜¯ç‹¬ç«‹çš„ï¼Œå¯åŠ¨å’Œåœæ­¢ä¸ä¼šå½±å“åˆ°å…¶ä»–éƒ¨åˆ†ã€‚</p>
<h5 id="å®æ—¶è®¡ç®—å±‚"><a href="#å®æ—¶è®¡ç®—å±‚" class="headerlink" title="å®æ—¶è®¡ç®—å±‚"></a>å®æ—¶è®¡ç®—å±‚</h5><p>å®æ—¶è®¡ç®—å±‚åŒæ ·ä¹Ÿä¸å­˜åœ¨çŠ¶æ€ï¼Œä¹Ÿä¼šåœ¨è¯»å–å…¨éƒ¨çš„æ¨¡å‹å’Œæ›´æ–°topicçš„æ›´æ–°ã€‚åªè¦å­˜åœ¨åˆæ³•çš„æ¨¡å‹ï¼Œå°±å¯ä»¥ç”Ÿæˆæ›´æ–°ã€‚åŒæ—¶ï¼Œä»æœ€åä¸€æ¬¡åç§»ä½ç½®å¼€å§‹è¯»å–è¾“å…¥topicsã€‚</p>
<p>å®æ—¶è®¡ç®—å±‚ä½¿ç”¨Sparkå’ŒSpark Streaming åšè®¡ç®—ã€‚Sparkä¼šå“åº”è®¡ç®—è¿‡ç¨‹ä¸­å¤±è´¥æƒ…å†µï¼Œå¹¶é‡è¯•ä»»åŠ¡ã€‚</p>
<p>Spark Streamingçš„Kafkaé›†æˆæ¨¡å—åœ¨æŸäº›æƒ…å†µä¸‹å¯ä»¥æ¢å¤æ¥æ”¶çš„æ•…éšœã€‚<br>å¦‚æœæ˜¯æ•´ä¸ªè¿›ç¨‹æ­»æ‰å¹¶è¢«é‡æ–°å¯åŠ¨ï¼Œoryx.idçš„å€¼è¢«è®¾å®šä»¥åï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨ä»ä¸Šä¸€æ¬¡Kafkaè®°å½•çš„åç§»åœ°å€å¼€å§‹è¯»å–ã€‚ï¼ˆå¦åˆ™ï¼Œå°†ä¼šä»ä¸Šæ¬¡åç§»åœ°å€å¼€å§‹ï¼Œè¿™å°±æ„å‘³ç€å®æ—¶è®¡ç®—å±‚æ²¡æœ‰è¿è¡Œçš„æ—¶å€™ï¼Œåˆ°è¾¾çš„æ•°æ®å°±ä¸ä¼šç”Ÿæˆä»»ä½•æ›´æ–°ã€‚ï¼‰ï¼ŒåŒæ ·çš„ï¼Œå¦‚æœå®æ—¶è®¡ç®—å±‚çš„æ¨¡å‹è¿˜æ²¡æœ‰å‡†å¤‡å¥½çš„è¯ï¼Œæ”¶åˆ°çš„æ•°æ®ä¹Ÿä¼šè¢«å¿½ç•¥ã€‚It effectively adopts â€œat most onceâ€ semantics.</p>
<p>ç”±äºå®æ—¶è®¡ç®—å±‚çš„ä½œç”¨æ˜¯ä¸ºæœ€åå‘å¸ƒçš„æ¨¡å‹æä¾›approximate, â€œbest effortâ€çš„æ›´æ–°ã€‚è¿™ç§è¡Œä¸ºç”±äºå…¶é—´æ¥æ€§ä¸€èˆ¬æ˜¯æ²¡æœ‰é—®é¢˜ï¼Œä¸”ä»¤äººæ»¡æ„çš„ã€‚</p>
<h5 id="æ‰¹å¤„ç†å±‚"><a href="#æ‰¹å¤„ç†å±‚" class="headerlink" title="æ‰¹å¤„ç†å±‚"></a>æ‰¹å¤„ç†å±‚</h5><p>æ‰¹å¤„ç†å±‚æ˜¯æœ€å¤æ‚çš„ï¼Œå› ä¸ºä»–å¹¶ç”ŸæˆæŸäº›çŠ¶æ€ï¼š</p>
<ul>
<li>å†å²æ•°æ®ï¼Œæ€»æ˜¯æŒä¹…åŒ–åˆ°HDFS</li>
<li>å¦‚æœåº”ç”¨é€‰æ‹©çš„è¯ï¼Œæ¨¡å‹çš„æ‰©å±•çŠ¶æ€å’Œtopicséƒ½å¯ä»¥è¢«æŒä¹…åŒ–åˆ°HDFSä¸Š</li>
</ul>
<p>å¯¹äºå¤šæ¬¡æˆ–è€…æ ¹æœ¬ä¸è¯»å–æ•°æ®æ˜¯éå¸¸æ•æ„Ÿçš„ï¼Œå› ä¸ºä»–æœ¬æ¥å°±æ˜¯ç”Ÿäº§å®˜æ–¹ä¸‹ä¸€ä»£æ¨¡å‹çš„ç»„ä»¶</p>
<p>ä¸å®æ—¶è®¡ç®—å±‚ä¸€èµ·ï¼ŒSparkå’ŒSpark Streamingåœ¨è®¡ç®—è¿‡ç¨‹ä¸­å¯ä»¥æ•è·å¾ˆå¤šé”™è¯¯æƒ…å†µã€‚ä¹Ÿå¯ä»¥ç®¡ç†å­˜å‚¨åˆ°HDFSä¸­çš„æ•°æ®ï¼Œè´Ÿè´£é¿å…ä¸¤æ¬¡å†™å…¥ç›¸åŒæ•°æ®ã€‚</p>
<p>åº”ç”¨è´Ÿè´£å›å¤å„è‡ªçš„ã€ŒçŠ¶æ€ã€ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå»ºç«‹åœ¨Oryx MLå±‚çš„åº”ç”¨ä¼šå°†çŠ¶æ€å†™å…¥å”¯ä¸€çš„å­ç›®å½•ä¸­ï¼Œå¹¶ä¸”é‡å¯åä¼šåœ¨æ–°çš„ç›®å½•ç®€å•çš„äº§ç”Ÿä¸€ä¸ªæ–°çŠ¶æ€ã€‚å‰ä¸€ä¸ªçŠ¶æ€å¦‚æœå­˜åœ¨çš„è¯ï¼Œä¹Ÿä¼šè¢«å®Œæ•´å†™å…¥æˆ–è€…è¢«å®Œå…¨å¿½è§†ã€‚</p>
<p>æ‰¹å¤„ç†å±‚ä¹Ÿå’Œå®æ—¶è®¡ç®—å±‚ä¸€æ ·ï¼Œç¬¦åˆã€è‡³å¤šä¸€æ¬¡ã€çš„è§„åˆ™ã€‚ç»¼ä¸Šï¼Œå¦‚æœæ•´ä¸ªè¿›ç¨‹æ­»æ‰æˆ–è€…è¢«é‡å¯ï¼Œoryx.idè¢«è®¾ç½®çš„è¯ï¼Œåˆ™ä¼šä»Kafkaè®°å½•çš„æœ€åä¸€æ¬¡åç§»é‡æ–°è¯»å–ï¼Œå¦åˆ™ä¼šåœ¨æœ€åä¸€æ¬¡åç§»å¤„é‡æ–°è¯»å–æ•°æ®ã€‚</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2022/01/30/2015-12-21-Oryx2-Admin-Docs/" data-id="ckz0rdm4b000894utc6z45so6" data-title="Oryx2 ç®¡ç†å‘˜æ–‡æ¡£" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-2015-12-10-apache-flume-ng-structure" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2022/01/30/2015-12-10-apache-flume-ng-structure/" class="article-date">
  <time class="dt-published" datetime="2022-01-30T04:24:01.487Z" itemprop="datePublished">2022-01-30</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2022/01/30/2015-12-10-apache-flume-ng-structure/">Apache Flume-ng Structure</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="Apache-flume-NG-é…ç½®"><a href="#Apache-flume-NG-é…ç½®" class="headerlink" title="Apache-flume NG é…ç½®"></a>Apache-flume NG é…ç½®</h2><h3 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h3><p>  Flume NGæ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼ã€å¯é ã€å¯ç”¨çš„ç³»ç»Ÿï¼Œå®ƒèƒ½å¤Ÿå°†ä¸åŒæ•°æ®æºçš„æµ·é‡æ—¥å¿—æ•°æ®è¿›è¡Œé«˜æ•ˆæ”¶é›†ã€èšåˆã€ç§»åŠ¨ï¼Œæœ€åå­˜å‚¨åˆ°ä¸€ä¸ªä¸­å¿ƒåŒ–æ•°æ®å­˜å‚¨ç³»ç»Ÿä¸­ã€‚</p>
<p>  ç”±åŸæ¥çš„Flume OGåˆ°ç°åœ¨çš„Flume NGï¼Œè¿›è¡Œäº†æ¶æ„é‡æ„ï¼Œå¹¶ä¸”ç°åœ¨NGç‰ˆæœ¬å®Œå…¨ä¸å…¼å®¹åŸæ¥çš„OGç‰ˆæœ¬ã€‚</p>
<p>  ç»è¿‡æ¶æ„é‡æ„åï¼ŒFlume NGæ›´åƒæ˜¯ä¸€ä¸ªè½»é‡çš„å°å·¥å…·ï¼Œéå¸¸ç®€å•ï¼Œå®¹æ˜“é€‚åº”å„ç§æ–¹å¼æ—¥å¿—æ”¶é›†ï¼Œå¹¶æ”¯æŒfailoverå’Œè´Ÿè½½å‡è¡¡ã€‚</p>
<h3 id="æ¶æ„è®¾è®¡è¦ç‚¹"><a href="#æ¶æ„è®¾è®¡è¦ç‚¹" class="headerlink" title="æ¶æ„è®¾è®¡è¦ç‚¹"></a>æ¶æ„è®¾è®¡è¦ç‚¹</h3><h4 id="æ ¸å¿ƒæ¦‚å¿µ"><a href="#æ ¸å¿ƒæ¦‚å¿µ" class="headerlink" title="æ ¸å¿ƒæ¦‚å¿µ"></a>æ ¸å¿ƒæ¦‚å¿µ</h4><ul>
<li>Eventï¼šä¸€ä¸ªæ•°æ®å•å…ƒï¼Œå¸¦æœ‰ä¸€ä¸ªå¯é€‰çš„æ¶ˆæ¯å¤´</li>
<li>Flowï¼šEventä»æºç‚¹åˆ°è¾¾ç›®çš„ç‚¹çš„è¿ç§»çš„æŠ½è±¡</li>
<li>Clientï¼šæ“ä½œä½äºæºç‚¹å¤„çš„Eventï¼Œå°†å…¶å‘é€åˆ°Flume Agent</li>
<li>Agentï¼šä¸€ä¸ªç‹¬ç«‹çš„Flumeè¿›ç¨‹ï¼ŒåŒ…å«ç»„ä»¶Sourceã€Channelã€Sink</li>
<li>Sourceï¼šç”¨æ¥æ¶ˆè´¹ä¼ é€’åˆ°è¯¥ç»„ä»¶çš„Event</li>
<li>Channelï¼šä¸­è½¬Eventçš„ä¸€ä¸ªä¸´æ—¶å­˜å‚¨ï¼Œä¿å­˜æœ‰Sourceç»„ä»¶ä¼ é€’è¿‡æ¥çš„Event</li>
<li>Sinkï¼šä»Channelä¸­è¯»å–å¹¶ç§»é™¤Eventï¼Œå°†Eventä¼ é€’åˆ°Flow Pipelineä¸­çš„ä¸‹ä¸€ä¸ªAgentï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰</li>
</ul>
<h4 id="æ¶æ„å›¾"><a href="#æ¶æ„å›¾" class="headerlink" title="æ¶æ„å›¾"></a>æ¶æ„å›¾</h4><p>![flume-ngæ€»ä½“ç»“æ„å›¾](/assets/images/posts/flume-ng/flume-ng-architecture.png)</p>
<h4 id="åŸºæœ¬æµç¨‹"><a href="#åŸºæœ¬æµç¨‹" class="headerlink" title="åŸºæœ¬æµç¨‹"></a>åŸºæœ¬æµç¨‹</h4><p>å¤–éƒ¨ç³»ç»Ÿäº§ç”Ÿæ—¥å¿—ï¼Œç›´æ¥é€šè¿‡Flumeçš„Agentçš„Sourceç»„ä»¶å°†äº‹ä»¶ï¼ˆå¦‚æ—¥å¿—è¡Œï¼‰å‘é€åˆ°ä¸­é—´ä¸´æ—¶çš„channelç»„ä»¶ï¼Œæœ€åä¼ é€’ç»™Sinkç»„ä»¶ï¼ŒHDFS Sinkç»„ä»¶å¯ä»¥ç›´æ¥æŠŠæ•°æ®å­˜å‚¨åˆ°HDFSé›†ç¾¤ä¸Šã€‚</p>
<h4 id="å•Agent"><a href="#å•Agent" class="headerlink" title="å•Agent"></a>å•Agent</h4><p>  ä¸€ä¸ªæœ€åŸºæœ¬Flowçš„é…ç½®ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š</p>
  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># list the sources, sinks and channels for the agent</span><br><span class="line">&lt;Agent&gt;.sources = &lt;Source1&gt; &lt;Source2&gt;</span><br><span class="line">&lt;Agent&gt;.sinks = &lt;Sink1&gt; &lt;Sink2&gt;</span><br><span class="line">&lt;Agent&gt;.channels = &lt;Channel1&gt; &lt;Channel2&gt;</span><br><span class="line"></span><br><span class="line"># set channel for source</span><br><span class="line">&lt;Agent&gt;.sources.&lt;Source1&gt;.channels = &lt;Channel1&gt; &lt;Channel2&gt; ...</span><br><span class="line">&lt;Agent&gt;.sources.&lt;Source2&gt;.channels = &lt;Channel1&gt; &lt;Channel2&gt; ...</span><br><span class="line"></span><br><span class="line"># set channel for sink</span><br><span class="line">&lt;Agent&gt;.sinks.&lt;Sink1&gt;.channel = &lt;Channel1&gt;</span><br><span class="line">&lt;Agent&gt;.sinks.&lt;Sink2&gt;.channel = &lt;Channel2&gt;</span><br></pre></td></tr></table></figure>

<p>  å°–æ‹¬å·é‡Œé¢çš„ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®å®é™…éœ€æ±‚æˆ–ä¸šåŠ¡æ¥ä¿®æ”¹åç§°ã€‚</p>
<p>  ä¸‹é¢è¯¦ç»†è¯´æ˜ï¼š</p>
<ul>
<li><Agent> è¡¨ç¤ºé…ç½®ä¸€ä¸ªAgentçš„åç§°ï¼Œä¸€ä¸ªAgentè‚¯å®šæœ‰ä¸€ä¸ªåç§°ã€‚</li>
<li><Source1>å’Œ<Source2>æ˜¯Agentçš„Sourceç»„ä»¶çš„åç§°ï¼Œæ¶ˆè´¹ä¼ é€’è¿‡æ¥çš„Eventã€‚</li>
<li><Channel1>å’Œ<Channel2>æ˜¯Agentçš„Channelç»„ä»¶çš„åç§°ã€‚</li>
<li><Sink1>ä¸<Sink2>æ˜¯Agentçš„Sinkç»„ä»¶çš„åç§°ï¼Œä»Channelä¸­æ¶ˆè´¹ï¼ˆç§»é™¤ï¼‰Eventã€‚</li>
</ul>
<p>  ä¸Šé¢é…ç½®å†…å®¹ä¸­</p>
<ul>
<li>ç¬¬ä¸€ç»„ä¸­é…ç½®Sourceã€Sinkã€Channelï¼Œå®ƒä»¬çš„å€¼å¯ä»¥æœ‰1ä¸ªæˆ–è€…å¤šä¸ªï¼›</li>
<li>ç¬¬äºŒç»„ä¸­é…ç½®Sourceå°†æŠŠæ•°æ®å­˜å‚¨ï¼ˆPutï¼‰åˆ°å“ªä¸€ä¸ªChannelä¸­ï¼Œå¯ä»¥å­˜å‚¨åˆ°1ä¸ªæˆ–å¤šä¸ªChannelä¸­ï¼Œ<br>åŒä¸€ä¸ªSourceå°†æ•°æ®å­˜å‚¨åˆ°å¤šä¸ªChannelä¸­ï¼Œå®é™…ä¸Šæ˜¯Replicationï¼›</li>
<li>ç¬¬ä¸‰ç»„ä¸­é…ç½®Sinkä»å“ªä¸€ä¸ªChannelä¸­å–ï¼ˆTaskï¼‰æ•°æ®ï¼Œä¸€ä¸ªSinkåªèƒ½ä»ä¸€ä¸ªChannelä¸­å–æ•°æ®ã€‚</li>
</ul>
<h4 id="å¤šä¸ªAgenté¡ºåºè¿æ¥"><a href="#å¤šä¸ªAgenté¡ºåºè¿æ¥" class="headerlink" title="å¤šä¸ªAgenté¡ºåºè¿æ¥"></a>å¤šä¸ªAgenté¡ºåºè¿æ¥</h4><p>![flume-ng å¤šä¸ªAgenté¡ºåºè¿æ¥](/assets/images/posts/flume-ng/flume-multiseq-agents.png)</p>
<p>  å¯ä»¥å°†å¤šä¸ªAgenté¡ºåºè¿æ¥èµ·æ¥ï¼Œå°†æœ€åˆçš„æ•°æ®æºç»è¿‡æ”¶é›†ï¼Œå­˜å‚¨åˆ°æœ€ç»ˆçš„å­˜å‚¨ç³»ç»Ÿä¸­ã€‚è¿™æ˜¯æœ€ç®€å•çš„æƒ…å†µï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œåº”è¯¥æ§åˆ¶è¿™ç§é¡ºåºè¿æ¥çš„Agentçš„æ•°é‡ï¼Œå› ä¸ºæ•°æ®æµç»çš„è·¯å¾„å˜é•¿äº†ï¼Œå¦‚æœä¸è€ƒè™‘failoverçš„è¯ï¼Œå‡ºç°æ•…éšœå°†å½±å“æ•´ä¸ªFlowä¸Šçš„Agentæ”¶é›†æœåŠ¡ã€‚</p>
<h4 id="å¤šä¸ªAgentçš„æ•°æ®æ±‡èšåˆ°åŒä¸€ä¸ªAgent"><a href="#å¤šä¸ªAgentçš„æ•°æ®æ±‡èšåˆ°åŒä¸€ä¸ªAgent" class="headerlink" title="å¤šä¸ªAgentçš„æ•°æ®æ±‡èšåˆ°åŒä¸€ä¸ªAgent"></a>å¤šä¸ªAgentçš„æ•°æ®æ±‡èšåˆ°åŒä¸€ä¸ªAgent</h4><p>![flume-ng å¤šä¸ªAgentçš„æ•°æ®æ±‡èšåˆ°åŒä¸€ä¸ªAgent](/assets/images/posts/flume-ng/flume-join-agent.png)</p>
<p>  è¿™ç§æƒ…å†µåº”ç”¨çš„åœºæ™¯æ¯”è¾ƒå¤šï¼Œæ¯”å¦‚è¦æ”¶é›†Webç½‘ç«™çš„ç”¨æˆ·è¡Œä¸ºæ—¥å¿—ï¼ŒWebç½‘ç«™ä¸ºäº†å¯ç”¨æ€§ä½¿ç”¨çš„è´Ÿè½½å‡è¡¡çš„é›†ç¾¤æ¨¡å¼ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½äº§ç”Ÿç”¨æˆ·è¡Œä¸ºæ—¥å¿—ï¼Œå¯ä»¥ä¸ºæ¯ä¸ªèŠ‚ç‚¹éƒ½é…ç½®ä¸€ä¸ªAgentæ¥å•ç‹¬æ”¶é›†æ—¥å¿—æ•°æ®ï¼Œç„¶åå¤šä¸ªAgentå°†æ•°æ®æœ€ç»ˆæ±‡èšåˆ°ä¸€ä¸ªç”¨æ¥å­˜å‚¨æ•°æ®å­˜å‚¨ç³»ç»Ÿï¼Œå¦‚HDFSä¸Šã€‚</p>
<h4 id="å¤šè·¯ï¼ˆMultiplexingï¼‰Agent"><a href="#å¤šè·¯ï¼ˆMultiplexingï¼‰Agent" class="headerlink" title="å¤šè·¯ï¼ˆMultiplexingï¼‰Agent"></a>å¤šè·¯ï¼ˆMultiplexingï¼‰Agent</h4><p>![flume-ng å¤šè·¯ï¼ˆMultiplexingï¼‰Agent](/assets/images/posts/flume-ng/flume-multiplexing-agent.png)</p>
<p>  è¿™ç§æ¨¡å¼ï¼Œæœ‰ä¸¤ç§æ–¹å¼</p>
<ul>
<li><p>ä¸€ç§æ˜¯ç”¨æ¥å¤åˆ¶ï¼ˆReplicationï¼‰</p>
<ul>
<li><p>Replicationæ–¹å¼ï¼Œå¯ä»¥å°†æœ€å‰ç«¯çš„æ•°æ®æºå¤åˆ¶å¤šä»½ï¼Œåˆ†åˆ«ä¼ é€’åˆ°å¤šä¸ªchannelä¸­ï¼Œæ¯ä¸ªchannelæ¥æ”¶åˆ°çš„æ•°æ®éƒ½æ˜¯ç›¸åŒçš„ï¼Œé…ç½®æ ¼å¼</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># List the sources, sinks and channels for the agent</span><br><span class="line">&lt;Agent&gt;.sources = &lt;Source1&gt;</span><br><span class="line">&lt;Agent&gt;.sinks = &lt;Sink1&gt; &lt;Sink2&gt;</span><br><span class="line">&lt;Agent&gt;.channels = &lt;Channel1&gt; &lt;Channel2&gt;</span><br><span class="line"></span><br><span class="line"># set list of channels for source (separated by space)</span><br><span class="line">&lt;Agent&gt;.sources.&lt;Source1&gt;.channels = &lt;Channel1&gt; &lt;Channel2&gt;</span><br><span class="line"></span><br><span class="line"># set channel for sinks</span><br><span class="line">&lt;Agent&gt;.sinks.&lt;Sink1&gt;.channel = &lt;Channel1&gt;</span><br><span class="line">&lt;Agent&gt;.sinks.&lt;Sink2&gt;.channel = &lt;Channel2&gt;</span><br><span class="line"></span><br><span class="line">&lt;Agent&gt;.sources.&lt;Source1&gt;.selector.type = replicating</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨çš„Replicationæ–¹å¼ï¼ŒSource1ä¼šå°†æ•°æ®åˆ†åˆ«å­˜å‚¨åˆ°Channel1å’ŒChannel2ï¼Œè¿™ä¸¤ä¸ªchannelé‡Œé¢å­˜å‚¨çš„æ•°æ®æ˜¯ç›¸åŒçš„ï¼Œç„¶åæ•°æ®è¢«ä¼ é€’åˆ°Sink1å’ŒSink2ã€‚</p>
</li>
</ul>
</li>
<li><p>å¦ä¸€ç§æ˜¯ç”¨æ¥åˆ†æµï¼ˆMultiplexingï¼‰</p>
<ul>
<li><p>Multiplexingæ–¹å¼ï¼Œselectorå¯ä»¥æ ¹æ®headerçš„å€¼æ¥ç¡®å®šæ•°æ®ä¼ é€’åˆ°å“ªä¸€ä¸ªchannel</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># Mapping for multiplexing selector</span><br><span class="line">&lt;Agent&gt;.sources.&lt;Source1&gt;.selector.type = multiplexing</span><br><span class="line">&lt;Agent&gt;.sources.&lt;Source1&gt;.selector.header = &lt;someHeader&gt;</span><br><span class="line">&lt;Agent&gt;.sources.&lt;Source1&gt;.selector.mapping.&lt;Value1&gt; = &lt;Channel1&gt;</span><br><span class="line">&lt;Agent&gt;.sources.&lt;Source1&gt;.selector.mapping.&lt;Value2&gt; = &lt;Channel1&gt; &lt;Channel2&gt;</span><br><span class="line">&lt;Agent&gt;.sources.&lt;Source1&gt;.selector.mapping.&lt;Value3&gt; = &lt;Channel2&gt;</span><br><span class="line">#...</span><br><span class="line"></span><br><span class="line">&lt;Agent&gt;.sources.&lt;Source1&gt;.selector.default = &lt;Channel2&gt;</span><br></pre></td></tr></table></figure>

<p>ä¸Šé¢selectorçš„typeçš„å€¼ä¸ºmultiplexingï¼ŒåŒæ—¶é…ç½®selectorçš„headerä¿¡æ¯ï¼Œè¿˜é…ç½®äº†å¤šä¸ªselectorçš„mappingçš„å€¼ï¼Œå³headerçš„å€¼ï¼šå¦‚æœheaderçš„å€¼ä¸ºValue1ã€Value2ï¼Œæ•°æ®ä»Source1è·¯ç”±åˆ°Channel1ï¼›å¦‚æœheaderçš„å€¼ä¸ºValue2ã€Value3ï¼Œæ•°æ®ä»Source1è·¯ç”±åˆ°Channel2ã€‚</p>
</li>
</ul>
</li>
</ul>
<h4 id="å®ç°load-balanceåŠŸèƒ½"><a href="#å®ç°load-balanceåŠŸèƒ½" class="headerlink" title="å®ç°load balanceåŠŸèƒ½"></a>å®ç°load balanceåŠŸèƒ½</h4><p>![å®ç°load balanceåŠŸèƒ½](/assets/images/posts/flume-ng/flume-load-balance-agents.png)</p>
<p>  Load balancing Sink Processorèƒ½å¤Ÿå®ç°load balanceåŠŸèƒ½ï¼Œä¸Šå›¾Agent1æ˜¯ä¸€ä¸ªè·¯ç”±èŠ‚ç‚¹ï¼Œ<br>  è´Ÿè´£å°†Channelæš‚å­˜çš„Eventå‡è¡¡åˆ°å¯¹åº”çš„å¤šä¸ªSinkç»„ä»¶ä¸Šï¼Œè€Œæ¯ä¸ªSinkç»„ä»¶åˆ†åˆ«è¿æ¥åˆ°ä¸€ä¸ªç‹¬ç«‹çš„Agentä¸Š</p>
  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">a1.sinkgroups = g1</span><br><span class="line">a1.sinkgroups.g1.sinks = k1 k2 k3</span><br><span class="line">a1.sinkgroups.g1.processor.type = load_balance</span><br><span class="line">a1.sinkgroups.g1.processor.backoff = true</span><br><span class="line">a1.sinkgroups.g1.processor.selector = round_robin</span><br><span class="line">a1.sinkgroups.g1.processor.selector.maxTimeOut=10000</span><br></pre></td></tr></table></figure>

<h4 id="å®ç°failoverèƒ½"><a href="#å®ç°failoverèƒ½" class="headerlink" title="å®ç°failoverèƒ½"></a>å®ç°failoverèƒ½</h4><p>  Failover Sink Processorèƒ½å¤Ÿå®ç°failoveråŠŸèƒ½ï¼Œå…·ä½“æµç¨‹ç±»ä¼¼load balanceï¼Œ<br>  ä½†æ˜¯å†…éƒ¨å¤„ç†æœºåˆ¶ä¸load balanceå®Œå…¨ä¸åŒï¼šFailover Sink Processorç»´æŠ¤ä¸€ä¸ªä¼˜å…ˆçº§Sinkç»„ä»¶åˆ—è¡¨ï¼Œåªè¦æœ‰ä¸€ä¸ªSinkç»„ä»¶å¯ç”¨ï¼Œ<br>  Eventå°±è¢«ä¼ é€’åˆ°ä¸‹ä¸€ä¸ªç»„ä»¶ã€‚å¦‚æœä¸€ä¸ªSinkèƒ½å¤ŸæˆåŠŸå¤„ç†Eventï¼Œåˆ™ä¼šåŠ å…¥åˆ°ä¸€ä¸ªPoolä¸­ï¼Œå¦åˆ™ä¼šè¢«ç§»å‡ºPoolå¹¶è®¡ç®—å¤±è´¥æ¬¡æ•°ï¼Œè®¾ç½®ä¸€ä¸ªæƒ©ç½šå› å­</p>
  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">a1.sinkgroups = g1</span><br><span class="line">a1.sinkgroups.g1.sinks = k1 k2 k3</span><br><span class="line">a1.sinkgroups.g1.processor.type = failover</span><br><span class="line">a1.sinkgroups.g1.processor.priority.k1 = 5</span><br><span class="line">a1.sinkgroups.g1.processor.priority.k2 = 7</span><br><span class="line">a1.sinkgroups.g1.processor.priority.k3 = 6</span><br><span class="line">a1.sinkgroups.g1.processor.maxpenalty = 20000</span><br></pre></td></tr></table></figure>

<h3 id="å®‰è£…é…ç½®"><a href="#å®‰è£…é…ç½®" class="headerlink" title="å®‰è£…é…ç½®"></a>å®‰è£…é…ç½®</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># ä¸‹è½½äºŒè¿›åˆ¶åŒ…</span><br><span class="line">[mofun_mining@i-tev02vc1 ~]$ wget &quot;http://apache.arvixe.com/flume/1.6.0/apache-flume-1.6.0-bin.tar.gz&quot;</span><br><span class="line">[mofun_mining@i-tev02vc1 ~]$ tar xvzf apache-flume-1.6.0-bin.tar.gz</span><br><span class="line">[mofun_mining@i-tev02vc1 ~]$ mv apache-flume-1.6.0-bin /usr/local/</span><br><span class="line"># ä¿®æ”¹é…ç½®æ–‡ä»¶</span><br><span class="line">[mofun_mining@i-qe32ajmq conf]$ pwd</span><br><span class="line">/usr/local/apache-flume-1.6.0-bin/conf</span><br><span class="line">[mofun_mining@i-qe32ajmq conf]$ sudo cp flume-conf.properties.template flume-conf.properties</span><br></pre></td></tr></table></figure>

<p>é‡‡ç”¨ Avro Source+Memory Channel+HDFS Sink æ–¹å¼</p>
<ul>
<li>æœåŠ¡å™¨ï¼ˆæ—¥å¿—æ±‡æ€»æœåŠ¡å™¨agentï¼‰ç«¯é…ç½®æ–‡ä»¶</li>
</ul>
  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">[mofun_mining@i-tev02vc1 ~]$ cd /usr/local/apache-flume-1.6.0-bin/conf/</span><br><span class="line">[mofun_mining@i-tev02vc1 conf]$ ls</span><br><span class="line">flume-conf.properties  flume-conf.properties.template  flume-env.ps1.template  flume-env.sh  flume-env.sh.template  log4j.properties</span><br><span class="line">[mofun_mining@i-tev02vc1 conf]$ pwd</span><br><span class="line">/usr/local/apache-flume-1.6.0-bin/conf</span><br><span class="line">[mofun_mining@i-tev02vc1 conf]$ sudo vim flume-conf.properties</span><br><span class="line"># example.conf: A single-node Flume configuration</span><br><span class="line"></span><br><span class="line"># Name the components on this agent</span><br><span class="line">agent1.sources = r1</span><br><span class="line">agent1.sinks = k1</span><br><span class="line">agent1.channels = c1</span><br><span class="line"></span><br><span class="line"># Describe/configure the source</span><br><span class="line">agent1.sources.r1.type = avro</span><br><span class="line">agent1.sources.r1.bind = 192.168.1.33</span><br><span class="line">agent1.sources.r1.port = 41414</span><br><span class="line">agent1.sources.r1.channels = c1</span><br><span class="line"></span><br><span class="line"># Describe the sink</span><br><span class="line">agent1.sinks.k1.type = hdfs</span><br><span class="line">agent1.sinks.k1.channel = c1</span><br><span class="line">agent1.sinks.k1.hdfs.fileType = DataStream</span><br><span class="line">agent1.sinks.k1.hdfs.useLocalTimeStamp = true</span><br><span class="line">agent1.sinks.k1.hdfs.path = /flume/events/%Y-%m-%d</span><br><span class="line">#agent1.sinks.k1.hdfs.round = true</span><br><span class="line">#agent1.sinks.k1.hdfs.roundValue = 10</span><br><span class="line">#agent1.sinks.k1.hdfs.roundUnit = minute</span><br><span class="line">agent1.sinks.k1.hdfs.rollCount = 5000</span><br><span class="line">agent1.sinks.k1.hdfs.rollSize = 0</span><br><span class="line">agent1.sinks.k1.hdfs.rollInterval= 0</span><br><span class="line"></span><br><span class="line"># Use a channel which buffers events in memory</span><br><span class="line">agent1.channels.c1.type = memory</span><br><span class="line">agent1.channels.c1.capacity = 10000</span><br><span class="line">agent1.channels.c1.transactionCapacity = 1000</span><br></pre></td></tr></table></figure>

<ul>
<li>å®¢æˆ·ç«¯ï¼ˆæ—¥å¿—æ”¶é›†agentï¼‰</li>
</ul>
  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">[reason@i-qunray9x conf]$ cd /usr/local/apache-flume-1.6.0-bin/conf/</span><br><span class="line">[reason@i-qunray9x conf]$ pwd</span><br><span class="line">/usr/local/apache-flume-1.6.0-bin/conf</span><br><span class="line">[reason@i-qunray9x conf]$ sudo vim flume-conf.properties</span><br><span class="line"></span><br><span class="line"># example.conf: A single-node Flume configuration</span><br><span class="line"></span><br><span class="line"># Name the components on this agent</span><br><span class="line">agent1.sources = r1</span><br><span class="line">agent1.sinks = k1</span><br><span class="line">agent1.channels = c1</span><br><span class="line"></span><br><span class="line"># Describe/configure the source</span><br><span class="line">agent1.sources.r1.type = exec</span><br><span class="line">agent1.sources.r1.command = tail -n 0 -F /home/reason/1.txt</span><br><span class="line">agent1.sources.r1.channels = c1</span><br><span class="line"></span><br><span class="line"># Describe the sink</span><br><span class="line">agent1.sinks.k1.type = avro</span><br><span class="line">agent1.sinks.k1.channel = c1</span><br><span class="line">agent1.sinks.k1.hdfs.useLocalTimeStamp = true</span><br><span class="line">agent1.sinks.k1.hdfs.path = /flume/events/%Y-%m-%d</span><br><span class="line">agent1.sinks.k1.hostname=192.168.1.33</span><br><span class="line">agent1.sinks.k1.port = 41414</span><br><span class="line"></span><br><span class="line"># Use a channel which buffers events in memory</span><br><span class="line">agent1.channels.c1.type = memory</span><br><span class="line">agent1.channels.c1.capacity = 5000</span><br><span class="line">agent1.channels.c1.transactionCapacity = 500</span><br></pre></td></tr></table></figure>

<ul>
<li>å¯åŠ¨æœåŠ¡å™¨</li>
</ul>
  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[mofun_mining@i-tev02vc1 conf]$</span><br><span class="line">/usr/local/apache-flume-1.6.0-bin/bin/flume-ng agent -c ./conf/ -f /usr/local/apache-flume-1.6.0-bin/conf/flume-conf.properties -n agent1 -Dflume.root.logger=INFO,console</span><br></pre></td></tr></table></figure>

<ul>
<li>å¯åŠ¨å®¢æˆ·ç«¯</li>
</ul>
  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[reason@i-qunray9x conf]$</span><br><span class="line">/usr/local/apache-flume-1.6.0-bin/bin/flume-ng agent -c conf -f /usr/local/apache-flume-1.6.0-bin/conf/flume-conf.properties -n agent1</span><br></pre></td></tr></table></figure>

<ul>
<li>æµ‹è¯•</li>
</ul>
  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[mofun_mining@i-r6cuv8iq ~]$ hdfs dfs -ls /flume/events/2015-12-15</span><br><span class="line">Found 40 items</span><br><span class="line">-rw-r--r--   2 mofun_mining supergroup      34844 2015-12-15 17:39 /flume/events/2015-12-15/FlumeData.1450172340281</span><br><span class="line">-rw-r--r--   2 mofun_mining supergroup      34850 2015-12-15 17:39 /flume/events/2015-12-15/FlumeData.1450172340282</span><br><span class="line">-rw-r--r--   2 mofun_mining supergroup      34850 2015-12-15 17:39 /flume/events/2015-12-15/FlumeData.1450172340283</span><br><span class="line">-rw-r--r--   2 mofun_mining supergroup      34850 2015-12-15 17:39 /flume/events/2015-12-15/FlumeData.1450172340284</span><br><span class="line">-rw-r--r--   2 mofun_mining supergroup      34850 2015-12-15 17:39 /flume/events/2015-12-15/FlumeData.1450172340285</span><br><span class="line">-rw-r--r--   2 mofun_mining supergroup      34850 2015-12-15 17:39 /flume/events/2015-12-15/FlumeData.1450172340286</span><br><span class="line">-rw-r--r--   2 mofun_mining supergroup      34850 2015-12-15 17:39 /flume/events/2015-12-15/FlumeData.1450172340287</span><br><span class="line">-rw-r--r--   2 mofun_mining supergroup      34850 2015-12-15 17:39 /flume/events/2015-12-15/FlumeData.1450172340288</span><br><span class="line">-rw-r--r--   2 mofun_mining supergroup      34850 2015-12-15 17:39 /flume/events/2015-12-15/FlumeData.1450172340289</span><br><span class="line">-rw-r--r--   2 mofun_mining supergroup      34850 2015-12-15 17:39</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>  æ­¤æ—¶ï¼Œé€šè¿‡nginxå®æ—¶äº§ç”Ÿçš„æ—¥å¿—ï¼Œå³å¯å®æ—¶æ’å…¥åˆ°hdfsä¸­äº†ã€‚</p>
<h3 id="å‚è€ƒæ–‡çŒ®"><a href="#å‚è€ƒæ–‡çŒ®" class="headerlink" title="å‚è€ƒæ–‡çŒ®"></a>å‚è€ƒæ–‡çŒ®</h3><ul>
<li><a target="_blank" rel="noopener" href="http://shiyanjun.cn/archives/915.html">http://shiyanjun.cn/archives/915.html</a></li>
<li><a target="_blank" rel="noopener" href="http://my.oschina.net/leejun2005/blog/288136">http://my.oschina.net/leejun2005/blog/288136</a></li>
<li><a target="_blank" rel="noopener" href="http://tech.meituan.com/mt-log-system-optimization.html">http://tech.meituan.com/mt-log-system-optimization.html</a></li>
<li><a target="_blank" rel="noopener" href="http://www.ixirong.com/2015/05/18/how-to-install-flume-ng/">http://www.ixirong.com/2015/05/18/how-to-install-flume-ng/</a></li>
<li><a target="_blank" rel="noopener" href="https://flume.apache.org/FlumeUserGuide.html#setting-up-an-agent">https://flume.apache.org/FlumeUserGuide.html#setting-up-an-agent</a></li>
<li><a target="_blank" rel="noopener" href="http://m.blog.csdn.net/blog/xueliang1029/24039459">http://m.blog.csdn.net/blog/xueliang1029/24039459</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2022/01/30/2015-12-10-apache-flume-ng-structure/" data-id="ckz0rdm4a000794uthk7mhavn" data-title="Apache Flume-ng Structure" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/3/">Next &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/iOS/">iOS</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Docker/" rel="tag">Docker</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Emacs/" rel="tag">Emacs</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Java/" rel="tag">Java</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Laravel/" rel="tag">Laravel</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PHP/" rel="tag">PHP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/QSS/" rel="tag">QSS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Rails/" rel="tag">Rails</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Ruby/" rel="tag">Ruby</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Spark/" rel="tag">Spark</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Vagrant/" rel="tag">Vagrant</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/logrotate/" rel="tag">logrotate</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nginx/" rel="tag">nginx</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/pyqt5/" rel="tag">pyqt5</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%BD%BF%E7%94%A8%E6%80%BB%E7%BB%93/" rel="tag">ä½¿ç”¨æ€»ç»“</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%A1%85%E8%B0%B7%E6%9D%A5%E4%BF%A1/" rel="tag">ç¡…è°·æ¥ä¿¡</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%89%BA%E6%9C%AF/" rel="tag">è‰ºæœ¯</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%8B%B9%E6%9E%9C%E8%B4%A6%E5%8F%B7/" rel="tag">è‹¹æœè´¦å·</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%AF%BB%E5%90%8E%E6%84%9F/" rel="tag">è¯»åæ„Ÿ</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%B0%B7%E6%AD%8C%E6%96%B9%E6%B3%95%E8%AE%BA/" rel="tag">è°·æ­Œæ–¹æ³•è®º</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/Docker/" style="font-size: 10px;">Docker</a> <a href="/tags/Emacs/" style="font-size: 10px;">Emacs</a> <a href="/tags/Java/" style="font-size: 10px;">Java</a> <a href="/tags/Laravel/" style="font-size: 10px;">Laravel</a> <a href="/tags/PHP/" style="font-size: 10px;">PHP</a> <a href="/tags/QSS/" style="font-size: 10px;">QSS</a> <a href="/tags/Rails/" style="font-size: 10px;">Rails</a> <a href="/tags/Ruby/" style="font-size: 10px;">Ruby</a> <a href="/tags/Spark/" style="font-size: 10px;">Spark</a> <a href="/tags/Vagrant/" style="font-size: 10px;">Vagrant</a> <a href="/tags/logrotate/" style="font-size: 10px;">logrotate</a> <a href="/tags/nginx/" style="font-size: 10px;">nginx</a> <a href="/tags/pyqt5/" style="font-size: 10px;">pyqt5</a> <a href="/tags/%E4%BD%BF%E7%94%A8%E6%80%BB%E7%BB%93/" style="font-size: 10px;">ä½¿ç”¨æ€»ç»“</a> <a href="/tags/%E7%A1%85%E8%B0%B7%E6%9D%A5%E4%BF%A1/" style="font-size: 20px;">ç¡…è°·æ¥ä¿¡</a> <a href="/tags/%E8%89%BA%E6%9C%AF/" style="font-size: 10px;">è‰ºæœ¯</a> <a href="/tags/%E8%8B%B9%E6%9E%9C%E8%B4%A6%E5%8F%B7/" style="font-size: 10px;">è‹¹æœè´¦å·</a> <a href="/tags/%E8%AF%BB%E5%90%8E%E6%84%9F/" style="font-size: 20px;">è¯»åæ„Ÿ</a> <a href="/tags/%E8%B0%B7%E6%AD%8C%E6%96%B9%E6%B3%95%E8%AE%BA/" style="font-size: 10px;">è°·æ­Œæ–¹æ³•è®º</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/01/">January 2022</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2022/01/30/2019-03-22-%E5%90%B4%E5%86%9B-%E8%B0%B7%E6%AD%8C%E6%96%B9%E6%B3%95%E8%AE%BA-%E8%AF%AD%E6%96%87%E5%AD%A6%E4%B9%A0%E7%9A%84%E6%84%8F%E4%B9%89/">è¯» å´å†›ã€Šè°·æ­Œæ–¹æ³•è®ºã€‹- ä¸ºä»€ä¹ˆå­¦ä¹ è¯­æ–‡</a>
          </li>
        
          <li>
            <a href="/2022/01/30/2019-03-16-pyqt5-QSS%E7%9A%84%E4%B8%80%E4%BA%9B%E6%80%BB%E7%BB%93/">Pyqt5 QSS</a>
          </li>
        
          <li>
            <a href="/2022/01/30/2019-03-14-%E5%86%85%E7%94%B0%E5%85%89%E5%AD%90-%E5%85%B3%E4%BA%8E%E4%B8%80%E6%B5%81%E6%B0%B4%E5%87%86%E7%9A%84%E6%80%9D%E8%80%83/">å†…ç”°å…‰å­-å…³äºä¸€æµæ°´å‡†çš„æ€è€ƒ</a>
          </li>
        
          <li>
            <a href="/2022/01/30/2019-03-11-%E5%90%B4%E5%86%9B-%E7%A1%85%E8%B0%B7%E6%9D%A5%E4%BF%A1-%E7%AC%94%E8%AE%B0-01/">è¯»å´å†›ã€Šç¡…è°·æ¥ä¿¡ã€‹å¿ƒå¾—ç¬”è®° - ç¬¬ä¸€ç¯‡</a>
          </li>
        
          <li>
            <a href="/2022/01/30/2019-03-11-2018%E5%B9%B4%E5%A4%A7%E5%85%B4%E5%8C%BA%E5%B9%BC%E5%8D%87%E5%B0%8F%E6%94%BF%E7%AD%96/">2018å¹´å¤§å…´åŒºå¹¼å‡å°æ”¿ç­–</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2022 John Doe<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>