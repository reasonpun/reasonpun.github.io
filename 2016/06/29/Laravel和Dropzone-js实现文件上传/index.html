<!DOCTYPE html><html lang=""><head><meta http-equiv="content-type" content="text/html; charset=utf-8"/><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"/><meta content="yes" name="apple-mobile-web-app-capable"/><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"/><meta content="telephone=no" name="format-detection"/><meta name="description" content=""/><title>Laravel和Dropzone.js实现文件上传 | Tensor Cell</title><link rel="stylesheet" type="text/css" href="/css/normalize.css"/><link rel="stylesheet" type="text/css" href="/css/pure-min.css"/><link rel="stylesheet" type="text/css" href="/css/grids-responsive-min.css"/><link rel="stylesheet" type="text/css" href="/css/style.css"/><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"/><link rel="apple-touch-icon" href="/apple-touch-icon.png"/><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"/><link rel="alternate" type="application/atom+xml" href="/atom.xml"/></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Laravel和Dropzone.js实现文件上传</h1><a id="logo" href="/">Tensor Cell</a><p class="description">还要再走500里</p></div><div id="nav-menu"><a href="/" class="current"><i class="icon-home"> 首页</i></a><a href="/archives/"><i class="icon-archive"> 归档</i></a><a href="/about/"><i class="icon-about"> 关于</i></a><a href="/atom.xml"><i class="icon-rss"> 订阅</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post post-page"><h1 class="post-title">Laravel和Dropzone.js实现文件上传</h1><div class="post-meta">2016-06-29 | <span class="categories">分类于<a href="/categories/Lavarel/"> Lavarel</a><a href="/categories/Lavarel/PHP/"> PHP</a></span></div><span data-disqus-identifier="2016/06/29/Laravel和Dropzone-js实现文件上传/" class="disqus-comment-count"></span><div class="post-content"><!--  -->
<!--  -->
<!--  _ __    __     __      ____    ___     ___   _____   __  __    ___     -->
<!-- /\`'__\/'__`\ /'__`\   /',__\  / __`\ /' _ `\/\ '__`\/\ \/\ \ /' _ `\   -->
<!-- \ \ \//\  __//\ \L\.\_/\__, `\/\ \L\ \/\ \/\ \ \ \L\ \ \ \_\ \/\ \/\ \  -->
<!--  \ \_\\ \____\ \__/.\_\/\____/\ \____/\ \_\ \_\ \ ,__/\ \____/\ \_\ \_\ -->
<!--   \/_/ \/____/\/__/\/_/\/___/  \/___/  \/_/\/_/\ \ \/  \/___/  \/_/\/_/ -->
<!--                                                 \ \_\                   -->
<!--                                                  \/_/                   -->
<!--  -->
<p>Dropzone是一个最好的免费库，可以通过拖拽实现文件的上传。拥有很多特性和选项，可以通过多种方式定制开发。</p>
<p>在Laravel项目中加入Dropzone对于没有经验的新手来说会有很多麻烦，所以在这里会讲些最靠谱的解决方法。</p>
<p>这篇引导会讲到：</p>
<ul>
<li>文件自动上传（上传队列自动处理）</li>
<li>在预览页面通过ajax直接删除图片</li>
<li>还可以统计上传的图片数量</li>
<li>保存两种图片尺寸：原始尺寸和icon尺寸</li>
<li>Using Image Intervention package for resizing and image encoding</li>
<li>保存图片数据到数据库</li>
<li>服务器端保存唯一的文件名</li>
</ul>
<p>如果正在找一种上传和编辑图片的最贱的方法，可以checkout<a href="http://www.croppic.net/" target="_blank" rel="external">Croppic jQuery plugin</a>。Croppic是一个简单的类似Facebook，Twitter或者LinkedIn的照片属性编辑组件。</p>
<blockquote>
<p>整个项目可以从 <a href="https://github.com/codingo-me/dropzone-laravel-image-upload" target="_blank" rel="external">https://github.com/codingo-me/dropzone-laravel-image-upload</a> 获取</p>
</blockquote>
<p>实现的效果图如下</p>
<img src="/images/laravel/dropzoneLaravelImg.png">
<h2 id="u57FA_u672C_u7684_u9879_u76EE_u914D_u7F6E"><a href="#u57FA_u672C_u7684_u9879_u76EE_u914D_u7F6E" class="headerlink" title="基本的项目配置"></a>基本的项目配置</h2><p>我将会使用Laravel安装器安装一版纯净的Laravel环境 and create environment file with database credentials.</p>
<p>首先从 <a href="https://github.com/enyo/dropzone/tree/master/dist" target="_blank" rel="external">https://github.com/enyo/dropzone/tree/master/dist</a> 下载最新的js和styles文件。然后放到项目的public/packages/dropzone文件夹下。</p>
<p>前端使用Bootstrap。 把相关文件放到public/packages/bootstrap。</p>
<p>需要用到两个第三方包：</p>
<figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">...</span><span class="attribute">...</span></span><br><span class="line">    <span class="string">"require"</span>: &#123;</span><br><span class="line">        <span class="string">"php"</span>: <span class="string">"&gt;=5.5.9"</span>,</span><br><span class="line">        <span class="string">"laravel/framework"</span>: <span class="string">"5.2.*"</span>,</span><br><span class="line">        <span class="string">"laravelcollective/html"</span>: <span class="string">"5.2.*"</span>,</span><br><span class="line">        <span class="string">"intervention/image"</span>: <span class="string">"^2.3"</span></span><br><span class="line">    &#125;,</span><br><span class="line"><span class="attribute">...</span><span class="attribute">...</span></span><br></pre></td></tr></table></figure>
<p>通过composer install/update安装完成后，需要在同一个文件中添加：</p>
<figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Intervention\Image\<span class="attribute">ImageServiceProvider</span>::<span class="class"><span class="keyword">class</span>,</span></span><br><span class="line">Collective\Html\<span class="attribute">HtmlServiceProvider</span>::<span class="class"><span class="keyword">class</span>,</span></span><br></pre></td></tr></table></figure>
<p>和facades</p>
<figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">'Form'</span>      =&gt; Collective\Html\<span class="attribute">FormFacade</span>::<span class="class"><span class="keyword">class</span>,</span></span><br><span class="line"><span class="string">'HTML'</span>      =&gt; Collective\Html\<span class="attribute">HtmlFacade</span>::<span class="class"><span class="keyword">class</span>,</span></span><br><span class="line"><span class="string">'Image'</span>     =&gt; Intervention\Image\Facades\<span class="attribute">Image</span>::<span class="class"><span class="keyword">class</span></span></span><br></pre></td></tr></table></figure>
<h2 id="u89C6_u56FE"><a href="#u89C6_u56FE" class="headerlink" title="视图"></a>视图</h2><p>这个引导只包含一个用来上传图片的页面。但是最好能分割成不同的模块：主布局文件和独立的文件；</p>
<figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml"><span class="doctype">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">html</span> <span class="attribute">lang</span>=<span class="value">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">meta</span> <span class="attribute">charset</span>=<span class="value">"utf-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">title</span>&gt;</span>Image upload in Laravel 5.2 with Dropzone.js<span class="tag">&lt;/<span class="title">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">meta</span> <span class="attribute">name</span>=<span class="value">"viewport"</span> <span class="attribute">content</span>=<span class="value">"width=device-width, initial-scale=1.0"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    </span><span class="expression">&#123;!! <span class="variable">HTML</span>::<span class="variable">style</span>('<span class="end-block">/packages</span><span class="end-block">/bootstrap</span><span class="end-block">/css</span><span class="end-block">/bootstrap.min.css</span>') !!&#125;</span><span class="xml"></span><br><span class="line">    </span><span class="expression">&#123;!! <span class="variable">HTML</span>::<span class="variable">style</span>('<span class="end-block">/assets</span><span class="end-block">/css</span><span class="end-block">/style.css</span>') !!&#125;</span><span class="xml"></span><br><span class="line">    </span><span class="expression">&#123;!! <span class="variable">HTML</span>::<span class="variable">script</span>('<span class="variable">https</span>:/<span class="end-block">/code.jquery.com</span><span class="end-block">/jquery-</span>2<span class="variable">.</span>1<span class="variable">.</span>4<span class="variable">.min.js</span>') !!&#125;</span><span class="xml"></span><br><span class="line"></span><br><span class="line">    @yield('head')</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="title">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="title">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="title">div</span> <span class="attribute">class</span>=<span class="value">"container"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="title">div</span> <span class="attribute">class</span>=<span class="value">"navbar navbar-default"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">div</span> <span class="attribute">class</span>=<span class="value">"navbar-header"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="title">button</span> <span class="attribute">type</span>=<span class="value">"button"</span> <span class="attribute">class</span>=<span class="value">"navbar-toggle"</span> <span class="attribute">data-toggle</span>=<span class="value">"collapse"</span> <span class="attribute">data-target</span>=<span class="value">".navbar-collapse"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="title">span</span> <span class="attribute">class</span>=<span class="value">"icon-bar"</span>&gt;</span><span class="tag">&lt;/<span class="title">span</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="title">span</span> <span class="attribute">class</span>=<span class="value">"icon-bar"</span>&gt;</span><span class="tag">&lt;/<span class="title">span</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="title">span</span> <span class="attribute">class</span>=<span class="value">"icon-bar"</span>&gt;</span><span class="tag">&lt;/<span class="title">span</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="title">button</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="title">a</span> <span class="attribute">class</span>=<span class="value">"navbar-brand"</span> <span class="attribute">href</span>=<span class="value">"/"</span>&gt;</span>Dropzone + Laravel<span class="tag">&lt;/<span class="title">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">div</span> <span class="attribute">class</span>=<span class="value">"navbar-collapse collapse"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="title">ul</span> <span class="attribute">class</span>=<span class="value">"nav navbar-nav"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="title">li</span>&gt;</span><span class="tag">&lt;<span class="title">a</span> <span class="attribute">href</span>=<span class="value">"/"</span>&gt;</span>Upload<span class="tag">&lt;/<span class="title">a</span>&gt;</span><span class="tag">&lt;/<span class="title">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="title">ul</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="title">br</span>&gt;</span><span class="tag">&lt;<span class="title">br</span>&gt;</span></span><br><span class="line"></span><br><span class="line">@yield('content')</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line">@yield('footer')</span><br><span class="line"><span class="tag">&lt;/<span class="title">html</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<p>主要的布局文件非常简单，只是包含底部导航栏和多个balde的section。</p>
<figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml">@extends('layout')</span><br><span class="line"></span><br><span class="line">@section('head')</span><br><span class="line">    </span><span class="expression">&#123;!! <span class="variable">HTML</span>::<span class="variable">style</span>('<span class="end-block">/packages</span><span class="end-block">/dropzone</span><span class="end-block">/dropzone.css</span>') !!&#125;</span><span class="xml"></span><br><span class="line">@stop</span><br><span class="line"></span><br><span class="line">@section('footer')</span><br><span class="line">    </span><span class="expression">&#123;!! <span class="variable">HTML</span>::<span class="variable">script</span>('<span class="end-block">/packages</span><span class="end-block">/dropzone</span><span class="end-block">/dropzone.js</span>') !!&#125;</span><span class="xml"></span><br><span class="line">    </span><span class="expression">&#123;!! <span class="variable">HTML</span>::<span class="variable">script</span>('<span class="end-block">/assets</span><span class="end-block">/js</span><span class="end-block">/dropzone-config.js</span>') !!&#125;</span><span class="xml"></span><br><span class="line">@stop</span><br><span class="line"></span><br><span class="line">@section('content')</span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="title">div</span> <span class="attribute">class</span>=<span class="value">"row"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">div</span> <span class="attribute">class</span>=<span class="value">"col-md-offset-1 col-md-10"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="title">div</span> <span class="attribute">class</span>=<span class="value">"jumbotron how-to-create"</span> &gt;</span></span><br><span class="line"></span><br><span class="line">                <span class="tag">&lt;<span class="title">h3</span>&gt;</span>Images <span class="tag">&lt;<span class="title">span</span> <span class="attribute">id</span>=<span class="value">"photoCounter"</span>&gt;</span><span class="tag">&lt;/<span class="title">span</span>&gt;</span><span class="tag">&lt;/<span class="title">h3</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="title">br</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">                </span><span class="expression">&#123;!! <span class="variable">Form</span>::<span class="variable">open</span>(['<span class="variable">url</span>' =&gt; <span class="variable">route</span>('<span class="variable">upload-post</span>'), '<span class="variable">class</span>' =&gt; '<span class="variable">dropzone</span>', '<span class="variable">files</span>'=&gt;<span class="variable">true</span>, '<span class="variable">id</span>'=&gt;'<span class="variable">real-dropzone</span>']) !!&#125;</span><span class="xml"></span><br><span class="line"></span><br><span class="line">                <span class="tag">&lt;<span class="title">div</span> <span class="attribute">class</span>=<span class="value">"dz-message"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                <span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                <span class="tag">&lt;<span class="title">div</span> <span class="attribute">class</span>=<span class="value">"fallback"</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="title">input</span> <span class="attribute">name</span>=<span class="value">"file"</span> <span class="attribute">type</span>=<span class="value">"file"</span> <span class="attribute">multiple</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                <span class="tag">&lt;<span class="title">div</span> <span class="attribute">class</span>=<span class="value">"dropzone-previews"</span> <span class="attribute">id</span>=<span class="value">"dropzonePreview"</span>&gt;</span><span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                <span class="tag">&lt;<span class="title">h4</span> <span class="attribute">style</span>=<span class="value">"text-align: center;color:#428bca;"</span>&gt;</span>Drop images in this area  <span class="tag">&lt;<span class="title">span</span> <span class="attribute">class</span>=<span class="value">"glyphicon glyphicon-hand-down"</span>&gt;</span><span class="tag">&lt;/<span class="title">span</span>&gt;</span><span class="tag">&lt;/<span class="title">h4</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                </span><span class="expression">&#123;!! <span class="variable">Form</span>::<span class="variable">close</span>() !!&#125;</span><span class="xml"></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="title">div</span> <span class="attribute">class</span>=<span class="value">"jumbotron how-to-create"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="title">ul</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="title">li</span>&gt;</span>Images are uploaded as soon as you drop them<span class="tag">&lt;/<span class="title">li</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="title">li</span>&gt;</span>Maximum allowed size of image is 8MB<span class="tag">&lt;/<span class="title">li</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="title">ul</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- Dropzone Preview Template --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">div</span> <span class="attribute">id</span>=<span class="value">"preview-template"</span> <span class="attribute">style</span>=<span class="value">"display: none;"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="title">div</span> <span class="attribute">class</span>=<span class="value">"dz-preview dz-file-preview"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="title">div</span> <span class="attribute">class</span>=<span class="value">"dz-image"</span>&gt;</span><span class="tag">&lt;<span class="title">img</span> <span class="attribute">data-dz-thumbnail</span>=<span class="value">""</span>&gt;</span><span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="title">div</span> <span class="attribute">class</span>=<span class="value">"dz-details"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="title">div</span> <span class="attribute">class</span>=<span class="value">"dz-size"</span>&gt;</span><span class="tag">&lt;<span class="title">span</span> <span class="attribute">data-dz-size</span>=<span class="value">""</span>&gt;</span><span class="tag">&lt;/<span class="title">span</span>&gt;</span><span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="title">div</span> <span class="attribute">class</span>=<span class="value">"dz-filename"</span>&gt;</span><span class="tag">&lt;<span class="title">span</span> <span class="attribute">data-dz-name</span>=<span class="value">""</span>&gt;</span><span class="tag">&lt;/<span class="title">span</span>&gt;</span><span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="title">div</span> <span class="attribute">class</span>=<span class="value">"dz-progress"</span>&gt;</span><span class="tag">&lt;<span class="title">span</span> <span class="attribute">class</span>=<span class="value">"dz-upload"</span> <span class="attribute">data-dz-uploadprogress</span>=<span class="value">""</span>&gt;</span><span class="tag">&lt;/<span class="title">span</span>&gt;</span><span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="title">div</span> <span class="attribute">class</span>=<span class="value">"dz-error-message"</span>&gt;</span><span class="tag">&lt;<span class="title">span</span> <span class="attribute">data-dz-errormessage</span>=<span class="value">""</span>&gt;</span><span class="tag">&lt;/<span class="title">span</span>&gt;</span><span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="title">div</span> <span class="attribute">class</span>=<span class="value">"dz-success-mark"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="title">svg</span> <span class="attribute">width</span>=<span class="value">"54px"</span> <span class="attribute">height</span>=<span class="value">"54px"</span> <span class="attribute">viewBox</span>=<span class="value">"0 0 54 54"</span> <span class="attribute">version</span>=<span class="value">"1.1"</span> <span class="attribute">xmlns</span>=<span class="value">"http://www.w3.org/2000/svg"</span> <span class="attribute">xmlns:xlink</span>=<span class="value">"http://www.w3.org/1999/xlink"</span> <span class="attribute">xmlns:sketch</span>=<span class="value">"http://www.bohemiancoding.com/sketch/ns"</span>&gt;</span></span><br><span class="line">                    <span class="comment">&lt;!-- Generator: Sketch 3.2.1 (9971) - http://www.bohemiancoding.com/sketch --&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="title">title</span>&gt;</span>Check<span class="tag">&lt;/<span class="title">title</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="title">desc</span>&gt;</span>Created with Sketch.<span class="tag">&lt;/<span class="title">desc</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="title">defs</span>&gt;</span><span class="tag">&lt;/<span class="title">defs</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="title">g</span> <span class="attribute">id</span>=<span class="value">"Page-1"</span> <span class="attribute">stroke</span>=<span class="value">"none"</span> <span class="attribute">stroke-width</span>=<span class="value">"1"</span> <span class="attribute">fill</span>=<span class="value">"none"</span> <span class="attribute">fill-rule</span>=<span class="value">"evenodd"</span> <span class="attribute">sketch:type</span>=<span class="value">"MSPage"</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="title">path</span> <span class="attribute">d</span>=<span class="value">"M23.5,31.8431458 L17.5852419,25.9283877 C16.0248253,24.3679711 13.4910294,24.366835 11.9289322,25.9289322 C10.3700136,27.4878508 10.3665912,30.0234455 11.9283877,31.5852419 L20.4147581,40.0716123 C20.5133999,40.1702541 20.6159315,40.2626649 20.7218615,40.3488435 C22.2835669,41.8725651 24.794234,41.8626202 26.3461564,40.3106978 L43.3106978,23.3461564 C44.8771021,21.7797521 44.8758057,19.2483887 43.3137085,17.6862915 C41.7547899,16.1273729 39.2176035,16.1255422 37.6538436,17.6893022 L23.5,31.8431458 Z M27,53 C41.3594035,53 53,41.3594035 53,27 C53,12.6405965 41.3594035,1 27,1 C12.6405965,1 1,12.6405965 1,27 C1,41.3594035 12.6405965,53 27,53 Z"</span> <span class="attribute">id</span>=<span class="value">"Oval-2"</span> <span class="attribute">stroke-opacity</span>=<span class="value">"0.198794158"</span> <span class="attribute">stroke</span>=<span class="value">"#747474"</span> <span class="attribute">fill-opacity</span>=<span class="value">"0.816519475"</span> <span class="attribute">fill</span>=<span class="value">"#FFFFFF"</span> <span class="attribute">sketch:type</span>=<span class="value">"MSShapeGroup"</span>&gt;</span><span class="tag">&lt;/<span class="title">path</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="title">g</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="title">svg</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="title">div</span> <span class="attribute">class</span>=<span class="value">"dz-error-mark"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="title">svg</span> <span class="attribute">width</span>=<span class="value">"54px"</span> <span class="attribute">height</span>=<span class="value">"54px"</span> <span class="attribute">viewBox</span>=<span class="value">"0 0 54 54"</span> <span class="attribute">version</span>=<span class="value">"1.1"</span> <span class="attribute">xmlns</span>=<span class="value">"http://www.w3.org/2000/svg"</span> <span class="attribute">xmlns:xlink</span>=<span class="value">"http://www.w3.org/1999/xlink"</span> <span class="attribute">xmlns:sketch</span>=<span class="value">"http://www.bohemiancoding.com/sketch/ns"</span>&gt;</span></span><br><span class="line">                    <span class="comment">&lt;!-- Generator: Sketch 3.2.1 (9971) - http://www.bohemiancoding.com/sketch --&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="title">title</span>&gt;</span>error<span class="tag">&lt;/<span class="title">title</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="title">desc</span>&gt;</span>Created with Sketch.<span class="tag">&lt;/<span class="title">desc</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="title">defs</span>&gt;</span><span class="tag">&lt;/<span class="title">defs</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="title">g</span> <span class="attribute">id</span>=<span class="value">"Page-1"</span> <span class="attribute">stroke</span>=<span class="value">"none"</span> <span class="attribute">stroke-width</span>=<span class="value">"1"</span> <span class="attribute">fill</span>=<span class="value">"none"</span> <span class="attribute">fill-rule</span>=<span class="value">"evenodd"</span> <span class="attribute">sketch:type</span>=<span class="value">"MSPage"</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="title">g</span> <span class="attribute">id</span>=<span class="value">"Check-+-Oval-2"</span> <span class="attribute">sketch:type</span>=<span class="value">"MSLayerGroup"</span> <span class="attribute">stroke</span>=<span class="value">"#747474"</span> <span class="attribute">stroke-opacity</span>=<span class="value">"0.198794158"</span> <span class="attribute">fill</span>=<span class="value">"#FFFFFF"</span> <span class="attribute">fill-opacity</span>=<span class="value">"0.816519475"</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="title">path</span> <span class="attribute">d</span>=<span class="value">"M32.6568542,29 L38.3106978,23.3461564 C39.8771021,21.7797521 39.8758057,19.2483887 38.3137085,17.6862915 C36.7547899,16.1273729 34.2176035,16.1255422 32.6538436,17.6893022 L27,23.3431458 L21.3461564,17.6893022 C19.7823965,16.1255422 17.2452101,16.1273729 15.6862915,17.6862915 C14.1241943,19.2483887 14.1228979,21.7797521 15.6893022,23.3461564 L21.3431458,29 L15.6893022,34.6538436 C14.1228979,36.2202479 14.1241943,38.7516113 15.6862915,40.3137085 C17.2452101,41.8726271 19.7823965,41.8744578 21.3461564,40.3106978 L27,34.6568542 L32.6538436,40.3106978 C34.2176035,41.8744578 36.7547899,41.8726271 38.3137085,40.3137085 C39.8758057,38.7516113 39.8771021,36.2202479 38.3106978,34.6538436 L32.6568542,29 Z M27,53 C41.3594035,53 53,41.3594035 53,27 C53,12.6405965 41.3594035,1 27,1 C12.6405965,1 1,12.6405965 1,27 C1,41.3594035 12.6405965,53 27,53 Z"</span> <span class="attribute">id</span>=<span class="value">"Oval-2"</span> <span class="attribute">sketch:type</span>=<span class="value">"MSShapeGroup"</span>&gt;</span><span class="tag">&lt;/<span class="title">path</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="title">g</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="title">g</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="title">svg</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- End Dropzone Preview Template --&gt;</span></span><br><span class="line"></span><br><span class="line"></span><span class="expression">&#123;!! <span class="variable">Form</span>::<span class="variable">hidden</span>('<span class="variable">csrf-token</span>', <span class="variable">csrf</span>_<span class="variable">token</span>(), ['<span class="variable">id</span>' =&gt; '<span class="variable">csrf-token</span>']) !!&#125;</span><span class="xml"></span><br><span class="line">@stop</span></span><br></pre></td></tr></table></figure>
<p>在上传视图的 <strong>头部部分</strong> 加入Dropzone的缺省样式，在 <strong>底部部分</strong> 加入Dropzone缺省的js文件，和自己的Dropzone配置文件。</p>
<p>内容部分包含两个，第一个是上传表单部分，第二部分是隐藏的预览模板部分。在Dropzone下载了预览模板的代码。配置文件中的模板部分用来显示上传文件的预览。</p>
<p>因为需要使用token完成提交和删除路由，所以在内容的底部部分，加入隐藏的csrf字段。</p>
<h2 id="Dropzone_u7684_u914D_u7F6E"><a href="#Dropzone_u7684_u914D_u7F6E" class="headerlink" title="Dropzone的配置"></a>Dropzone的配置</h2><p>Dropzone具有很多可用的配置选项。对于这个项目来说，使用Dropzone实现文件的批量顺序上传，就可以避免重复选择需要上传的文件。并行的上传数最大100个，单个文件的尺寸最大设置为8MB。同时上传成功的文件可以在模板html页面中显示预览。</p>
<p>每个预览的图片都可以通过点击下方的删除链接删除，这个操作会触发删除文件事件。这个事件会创建一个ajax发起一个删除请求，并且会返回200状态码，图片数也会相应的减少。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> photo_counter = <span class="number">0</span>;</span><br><span class="line">Dropzone.options.realDropzone = &#123;</span><br><span class="line"></span><br><span class="line">    uploadMultiple: <span class="literal">false</span>,</span><br><span class="line">    parallelUploads: <span class="number">100</span>,</span><br><span class="line">    maxFilesize: <span class="number">8</span>,</span><br><span class="line">    previewsContainer: <span class="string">'#dropzonePreview'</span>,</span><br><span class="line">    previewTemplate: <span class="built_in">document</span>.querySelector(<span class="string">'#preview-template'</span>).innerHTML,</span><br><span class="line">    addRemoveLinks: <span class="literal">true</span>,</span><br><span class="line">    dictRemoveFile: <span class="string">'Remove'</span>,</span><br><span class="line">    dictFileTooBig: <span class="string">'Image is bigger than 8MB'</span>,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// The setting up of the dropzone</span></span><br><span class="line">    init:<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">this</span>.on(<span class="string">"removedfile"</span>, <span class="function"><span class="keyword">function</span>(<span class="params">file</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">            $.ajax(&#123;</span><br><span class="line">                type: <span class="string">'POST'</span>,</span><br><span class="line">                url: <span class="string">'upload/delete'</span>,</span><br><span class="line">                data: &#123;id: file.name, _token: $(<span class="string">'#csrf-token'</span>).val()&#125;,</span><br><span class="line">                dataType: <span class="string">'html'</span>,</span><br><span class="line">                success: <span class="function"><span class="keyword">function</span>(<span class="params">data</span>)</span>&#123;</span><br><span class="line">                    <span class="keyword">var</span> rep = <span class="built_in">JSON</span>.parse(data);</span><br><span class="line">                    <span class="keyword">if</span>(rep.code == <span class="number">200</span>)</span><br><span class="line">                    &#123;</span><br><span class="line">                        photo_counter--;</span><br><span class="line">                        $(<span class="string">"#photoCounter"</span>).text( <span class="string">"("</span> + photo_counter + <span class="string">")"</span>);</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line"></span><br><span class="line">        &#125; );</span><br><span class="line">    &#125;,</span><br><span class="line">    error: <span class="function"><span class="keyword">function</span>(<span class="params">file, response</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>($.type(response) === <span class="string">"string"</span>)</span><br><span class="line">            <span class="keyword">var</span> message = response; <span class="comment">//dropzone sends it's own error messages in string</span></span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="keyword">var</span> message = response.message;</span><br><span class="line">        file.previewElement.classList.add(<span class="string">"dz-error"</span>);</span><br><span class="line">        _ref = file.previewElement.querySelectorAll(<span class="string">"[data-dz-errormessage]"</span>);</span><br><span class="line">        _results = [];</span><br><span class="line">        <span class="keyword">for</span> (_i = <span class="number">0</span>, _len = _ref.length; _i &lt; _len; _i++) &#123;</span><br><span class="line">            node = _ref[_i];</span><br><span class="line">            _results.push(node.textContent = message);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> _results;</span><br><span class="line">    &#125;,</span><br><span class="line">    success: <span class="function"><span class="keyword">function</span>(<span class="params">file,done</span>) </span>&#123;</span><br><span class="line">        photo_counter++;</span><br><span class="line">        $(<span class="string">"#photoCounter"</span>).text( <span class="string">"("</span> + photo_counter + <span class="string">")"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在配置文件底部，当文件上传成功后，图片计数器会增加。</p>
<h2 id="u4E0A_u4F20_u903B_u8F91"><a href="#u4E0A_u4F20_u903B_u8F91" class="headerlink" title="上传逻辑"></a>上传逻辑</h2><p>根据功能逻辑划分不同的实现类，在这个项目中，实现了一个<strong>ImageRepository</strong>类，将其放到目录app/Logic/Image/ImageRepository.php中。</p>
<p>迄今为止这个类只有2个功能，主要是负责上传单个文件和删除指定文件。在<strong>ImageController</strong>类文件中实现了这个类的实例。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="php"><span class="preprocessor">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Http</span>\<span class="title">Controllers</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Logic</span>\<span class="title">Image</span>\<span class="title">ImageRepository</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Support</span>\<span class="title">Facades</span>\<span class="title">Input</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ImageController</span> <span class="keyword">extends</span> <span class="title">Controller</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$image</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">(ImageRepository <span class="variable">$imageRepository</span>)</span></span><br><span class="line">    </span>&#123;</span><br><span class="line">        <span class="variable">$this</span>-&gt;image = <span class="variable">$imageRepository</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getUpload</span><span class="params">()</span></span><br><span class="line">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> view(<span class="string">'pages.upload'</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">postUpload</span><span class="params">()</span></span><br><span class="line">    </span>&#123;</span><br><span class="line">        <span class="variable">$photo</span> = Input::all();</span><br><span class="line">        <span class="variable">$response</span> = <span class="variable">$this</span>-&gt;image-&gt;upload(<span class="variable">$photo</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$response</span>;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">deleteUpload</span><span class="params">()</span></span><br><span class="line">    </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="variable">$filename</span> = Input::get(<span class="string">'id'</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(!<span class="variable">$filename</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="variable">$response</span> = <span class="variable">$this</span>-&gt;image-&gt;delete( <span class="variable">$filename</span> );</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$response</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span></span><br></pre></td></tr></table></figure>
<p>因此这个控制器需要添加3个路由，一个用来显示上传表单，一个用来接收上传的文件，第三个用来发起删除请求。</p>
<figure class="highlight ocaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Route</span>::get(<span class="char">'/'</span>, [<span class="symbol">'as'</span> =&gt; <span class="symbol">'upload'</span>, <span class="symbol">'uses'</span> =&gt; <span class="symbol">'ImageController</span>@getUpload']);</span><br><span class="line"><span class="type">Route</span>::post(<span class="symbol">'upload'</span>, [<span class="symbol">'as'</span> =&gt; <span class="symbol">'upload</span>-post', <span class="symbol">'uses'</span> =&gt;<span class="symbol">'ImageController</span>@postUpload']);</span><br><span class="line"><span class="type">Route</span>::post(<span class="symbol">'upload</span>/delete', [<span class="symbol">'as'</span> =&gt; <span class="symbol">'upload</span>-remove', <span class="symbol">'uses'</span> =&gt;<span class="symbol">'ImageController</span>@deleteUpload']);</span><br></pre></td></tr></table></figure>
<p>在类文件<strong>ImageController</strong> 的 <strong>postUpload</strong> 方法中将用户的输入传入  <strong>ImageRepository</strong> 类中的 <strong>upload</strong> 方法中。</p>
<p>这个方法</p>
<ul>
<li>首先会验证输入的合法性</li>
<li>然后会为上传的文件生成服务器唯一的文件名</li>
<li>最后将文件按照原始尺寸和icon的尺寸分别存入服务器不同的目录。</li>
</ul>
<p>同时，他也可以在数据库中创建完整的实体，从而Laravel可以轻松的掌控上传的图片。</p>
<p>首先，创建migration文件，并执行migrations。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="php"><span class="preprocessor">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Database</span>\<span class="title">Schema</span>\<span class="title">Blueprint</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Database</span>\<span class="title">Migrations</span>\<span class="title">Migration</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CreateImages</span> <span class="keyword">extends</span> <span class="title">Migration</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * Run the migrations.</span><br><span class="line">     *</span><br><span class="line">     * <span class="doctag">@return</span> void</span><br><span class="line">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">up</span><span class="params">()</span></span><br><span class="line">    </span>&#123;</span><br><span class="line">        Schema::create(<span class="string">'images'</span>, <span class="function"><span class="keyword">function</span> <span class="params">(Blueprint <span class="variable">$table</span>)</span> </span>&#123;</span><br><span class="line">            <span class="variable">$table</span>-&gt;increments(<span class="string">'id'</span>);</span><br><span class="line">            <span class="variable">$table</span>-&gt;text(<span class="string">'original_name'</span>);</span><br><span class="line">            <span class="variable">$table</span>-&gt;text(<span class="string">'filename'</span>);</span><br><span class="line">            <span class="variable">$table</span>-&gt;timestamps();</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * Reverse the migrations.</span><br><span class="line">     *</span><br><span class="line">     * <span class="doctag">@return</span> void</span><br><span class="line">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">down</span><span class="params">()</span></span><br><span class="line">    </span>&#123;</span><br><span class="line">        Schema::drop(<span class="string">'images'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span></span><br></pre></td></tr></table></figure>
<p>注意到上传的文件会被保存为两种格式，原始尺寸和icon尺寸。使用 <strong>Image Intervention package</strong> 修改图片尺寸和编码。</p>
<figure class="highlight xquery"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> App\Logic\Image;</span><br><span class="line"></span><br><span class="line">use Illuminate\Support\Facades\Validator;</span><br><span class="line">use Illuminate\Support\Facades\Response;</span><br><span class="line">use Illuminate\Support\Facades\Config;</span><br><span class="line">use Illuminate\Support\Facades\File;</span><br><span class="line">use Intervention\Image\ImageManager;</span><br><span class="line">use App\Models\Image;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class ImageRepository</span><br><span class="line">&#123;</span><br><span class="line">    public function upload( <span class="variable">$form</span>_data )</span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">        <span class="variable">$validator</span> = Validator::make(<span class="variable">$form</span>_data, Image::<span class="variable">$rules</span>, Image::<span class="variable">$messages</span>);</span><br><span class="line"></span><br><span class="line">        if (<span class="variable">$validator-</span>&gt;fails()) &#123;</span><br><span class="line"></span><br><span class="line">            return Response::json([</span><br><span class="line">                <span class="string">'error'</span> =&gt; true,</span><br><span class="line">                <span class="string">'message'</span> =&gt; <span class="variable">$validator-</span>&gt;messages()-&gt;first(),</span><br><span class="line">                <span class="string">'code'</span> =&gt; <span class="number">400</span></span><br><span class="line">            ], <span class="number">400</span>);</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="variable">$photo</span> = <span class="variable">$form</span>_data[<span class="string">'file'</span>];</span><br><span class="line"></span><br><span class="line">        <span class="variable">$originalName</span> = <span class="variable">$photo-</span>&gt;getClientOriginalName();</span><br><span class="line">        <span class="variable">$extension</span> = <span class="variable">$photo-</span>&gt;getClientOriginalExtension();</span><br><span class="line">        <span class="variable">$originalNameWithoutExt</span> = substr(<span class="variable">$originalName</span>, <span class="number">0</span>, strlen(<span class="variable">$originalName</span>) - strlen(<span class="variable">$extension</span>) - <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        <span class="variable">$filename</span> = <span class="variable">$this-</span>&gt;sanitize(<span class="variable">$originalNameWithoutExt</span>);</span><br><span class="line">        <span class="variable">$allowed</span>_filename = <span class="variable">$this-</span>&gt;createUniqueFilename( <span class="variable">$filename</span>, <span class="variable">$extension</span> );</span><br><span class="line"></span><br><span class="line">        <span class="variable">$uploadSuccess1</span> = <span class="variable">$this-</span>&gt;original( <span class="variable">$photo</span>, <span class="variable">$allowed</span>_filename );</span><br><span class="line"></span><br><span class="line">        <span class="variable">$uploadSuccess2</span> = <span class="variable">$this-</span>&gt;icon( <span class="variable">$photo</span>, <span class="variable">$allowed</span>_filename );</span><br><span class="line"></span><br><span class="line">        if( !<span class="variable">$uploadSuccess1</span> || !<span class="variable">$uploadSuccess2</span> ) &#123;</span><br><span class="line"></span><br><span class="line">            return Response::json([</span><br><span class="line">                <span class="string">'error'</span> =&gt; true,</span><br><span class="line">                <span class="string">'message'</span> =&gt; <span class="string">'Server error while uploading'</span>,</span><br><span class="line">                <span class="string">'code'</span> =&gt; <span class="number">500</span></span><br><span class="line">            ], <span class="number">500</span>);</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="variable">$sessionImage</span> = new Image;</span><br><span class="line">        <span class="variable">$sessionImage-</span>&gt;filename      = <span class="variable">$allowed</span>_filename;</span><br><span class="line">        <span class="variable">$sessionImage-</span>&gt;original_name = <span class="variable">$originalName</span>;</span><br><span class="line">        <span class="variable">$sessionImage-</span>&gt;save();</span><br><span class="line"></span><br><span class="line">        return Response::json([</span><br><span class="line">            <span class="string">'error'</span> =&gt; false,</span><br><span class="line">            <span class="string">'code'</span>  =&gt; <span class="number">200</span></span><br><span class="line">        ], <span class="number">200</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public function createUniqueFilename( <span class="variable">$filename</span>, <span class="variable">$extension</span> )</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="variable">$full</span>_size_dir = Config::get(<span class="string">'images.full_size'</span>);</span><br><span class="line">        <span class="variable">$full</span>_image_path = <span class="variable">$full</span>_size_dir . <span class="variable">$filename</span> . <span class="string">'.'</span> . <span class="variable">$extension</span>;</span><br><span class="line"></span><br><span class="line">        if ( File::exists( <span class="variable">$full</span>_image_path ) )</span><br><span class="line">        &#123;</span><br><span class="line">            // Generate token for image</span><br><span class="line">            <span class="variable">$imageToken</span> = substr(sha1(mt_rand()), <span class="number">0</span>, <span class="number">5</span>);</span><br><span class="line">            return <span class="variable">$filename</span> . <span class="string">'-'</span> . <span class="variable">$imageToken</span> . <span class="string">'.'</span> . <span class="variable">$extension</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        return <span class="variable">$filename</span> . <span class="string">'.'</span> . <span class="variable">$extension</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * Optimize Original Image</span><br><span class="line">     */</span><br><span class="line">    public function original( <span class="variable">$photo</span>, <span class="variable">$filename</span> )</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="variable">$manager</span> = new ImageManager();</span><br><span class="line">        <span class="variable">$image</span> = <span class="variable">$manager-</span>&gt;make( <span class="variable">$photo</span> )-&gt;save(Config::get(<span class="string">'images.full_size'</span>) . <span class="variable">$filename</span> );</span><br><span class="line"></span><br><span class="line">        return <span class="variable">$image</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * Create Icon From Original</span><br><span class="line">     */</span><br><span class="line">    public function icon( <span class="variable">$photo</span>, <span class="variable">$filename</span> )</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="variable">$manager</span> = new ImageManager();</span><br><span class="line">        <span class="variable">$image</span> = <span class="variable">$manager-</span>&gt;make( <span class="variable">$photo</span> )-&gt;resize(<span class="number">200</span>, null, function (<span class="variable">$constraint</span>) &#123;</span><br><span class="line">            <span class="variable">$constraint-</span>&gt;aspectRatio();</span><br><span class="line">            &#125;)</span><br><span class="line">            -&gt;save( Config::get(<span class="string">'images.icon_size'</span>)  . <span class="variable">$filename</span> );</span><br><span class="line"></span><br><span class="line">        return <span class="variable">$image</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * Delete Image From Session folder, based on original filename</span><br><span class="line">     */</span><br><span class="line">    public function delete( <span class="variable">$originalFilename</span>)</span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">        <span class="variable">$full</span>_size_dir = Config::get(<span class="string">'images.full_size'</span>);</span><br><span class="line">        <span class="variable">$icon</span>_size_dir = Config::get(<span class="string">'images.icon_size'</span>);</span><br><span class="line"></span><br><span class="line">        <span class="variable">$sessionImage</span> = Image::where(<span class="string">'original_name'</span>, <span class="string">'like'</span>, <span class="variable">$originalFilename</span>)-&gt;first();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        if(empty(<span class="variable">$sessionImage</span>))</span><br><span class="line">        &#123;</span><br><span class="line">            return Response::json([</span><br><span class="line">                <span class="string">'error'</span> =&gt; true,</span><br><span class="line">                <span class="string">'code'</span>  =&gt; <span class="number">400</span></span><br><span class="line">            ], <span class="number">400</span>);</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="variable">$full</span>_path1 = <span class="variable">$full</span>_size_dir . <span class="variable">$sessionImage-</span>&gt;filename;</span><br><span class="line">        <span class="variable">$full</span>_path2 = <span class="variable">$icon</span>_size_dir . <span class="variable">$sessionImage-</span>&gt;filename;</span><br><span class="line"></span><br><span class="line">        if ( File::exists( <span class="variable">$full</span>_path1 ) )</span><br><span class="line">        &#123;</span><br><span class="line">            File::delete( <span class="variable">$full</span>_path1 );</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        if ( File::exists( <span class="variable">$full</span>_path2 ) )</span><br><span class="line">        &#123;</span><br><span class="line">            File::delete( <span class="variable">$full</span>_path2 );</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        if( !empty(<span class="variable">$sessionImage</span>))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="variable">$sessionImage-</span>&gt;delete();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        return Response::json([</span><br><span class="line">            <span class="string">'error'</span> =&gt; false,</span><br><span class="line">            <span class="string">'code'</span>  =&gt; <span class="number">200</span></span><br><span class="line">        ], <span class="number">200</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function sanitize(<span class="variable">$string</span>, <span class="variable">$force</span>_lowercase = true, <span class="variable">$anal</span> = false)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="variable">$strip</span> = array(<span class="string">"~"</span>, <span class="string">"`"</span>, <span class="string">"!"</span>, <span class="string">"@"</span>, <span class="string">"#"</span>, <span class="string">"$"</span>, <span class="string">"%"</span>, <span class="string">"^"</span>, <span class="string">"&amp;"</span>, <span class="string">"*"</span>, <span class="string">"("</span>, <span class="string">")"</span>, <span class="string">"_"</span>, <span class="string">"="</span>, <span class="string">"+"</span>, <span class="string">"["</span>, <span class="string">"&#123;"</span>, <span class="string">"]"</span>,</span><br><span class="line">            <span class="string">"&#125;"</span>, <span class="string">"\\"</span>, <span class="string">"|"</span>, <span class="string">";"</span>, <span class="string">":"</span>, <span class="string">"\"", "</span><span class="string">'", "&amp;#8216;", "&amp;#8217;", "&amp;#8220;", "&amp;#8221;", "&amp;#8211;", "&amp;#8212;",</span><br><span class="line">            "â€”", "â€“", ",", "&lt;", ".", "&gt;", "/", "?");</span><br><span class="line">        $clean = trim(str_replace($strip, "", strip_tags($string)));</span><br><span class="line">        $clean = preg_replace('</span>/\s+/<span class="string">', "-", $clean);</span><br><span class="line">        $clean = ($anal) ? preg_replace("/[^a-zA-Z0-9]/", "", $clean) : $clean ;</span><br><span class="line"></span><br><span class="line">        return ($force_lowercase) ?</span><br><span class="line">            (function_exists('</span>mb_strtolower<span class="string">')) ?</span><br><span class="line">                mb_strtolower($clean, '</span>UTF-<span class="number">8</span><span class="string">') :</span><br><span class="line">                strtolower($clean) :</span><br><span class="line">            $clean;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span></span><br></pre></td></tr></table></figure>
<p>上传的方法中还会引用Image模型中验证规则验证图片类型，只有符合条件的图片可以上传。</p>
<p>然后，通过方法 <strong>createUniqueFilename</strong> 检查下图片原始的文件名称在服务器上是否唯一。如果存在同名的文件，这个方法会在文件名后追加随机字符串。这是最简单的解决办法，当然了，你可以通过其他方法实现。</p>
<p>当获取到唯一的文件名称后，将图片和这个文件名传给方法original() ，这个方法负责保存全尺寸的图片，使用icon()方法保存小尺寸图片。</p>
<p>当这两个尺寸的图片被保存后，系统会在images表中插入新的记录。</p>
<p>图片上传的目录路径被保存在图片配置文件中。同时使用了自己的sanitize()方法，你也可以使用Laravel内部自建的sanitize().</p>
<p>为了项目能正常的工作，需要拷贝.env.example 到.env文件，并且修改其中的值。上传目录需要以”/“结束。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="php"><span class="preprocessor">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> [</span><br><span class="line">    <span class="string">'full_size'</span>   =&gt; env(<span class="string">'UPLOAD_FULL_SIZE'</span>),</span><br><span class="line">    <span class="string">'icon_size'</span>   =&gt; env(<span class="string">'UPLOAD_ICON_SIZE'</span>),</span><br><span class="line">];</span></span><br></pre></td></tr></table></figure>
<p>删除方法会接受文件名，并且检查这个图片是否存在数据库和对应的两个目录下。如果存在则将其删除。p</p>
<h2 id="u6765_u6E90"><a href="#u6765_u6E90" class="headerlink" title="来源"></a>来源</h2><ul>
<li><a href="https://tuts.codingo.me/laravel-5-1-and-dropzone-js-auto-image-uploads-with-removal-links#" target="_blank" rel="external">https://tuts.codingo.me/laravel-5-1-and-dropzone-js-auto-image-uploads-with-removal-links#</a></li>
</ul>
</div><div class="tags"><a href="/tags/Lavarel/">Lavarel</a><a href="/tags/PHP/">PHP</a></div><div class="post-nav"><a href="/2016/06/13/Lavarel-环境安装和配置/" class="next">Lavarel 环境安装和配置<i class="icon-next"></i></a></div><div id="disqus_thread"><script>var disqus_shortname = 'reasonpun';
var disqus_identifier = '2016/06/29/Laravel和Dropzone-js实现文件上传/';
var disqus_title = 'Laravel和Dropzone.js实现文件上传';
var disqus_url = 'http://reasonpun.com/2016/06/29/Laravel和Dropzone-js实现文件上传/';
(function() {
  var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//reasonpun.disqus.com/count.js" async="async"></script></div></div></div></div><div class="pure-u-1-4"><div id="sidebar"><div class="widget"><form action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank" class="search-form"><input type="text" name="q" maxlength="20" placeholder="Search" class="search-form-input"/><input type="hidden" name="sitesearch" value="http://reasonpun.com"/></form></div><div class="widget"><div class="widget-title">分类</div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/AWK/">AWK</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/AWK/Linux/">Linux</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/AWK/Linux/Ebook/">Ebook</a></li></ul></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Android/">Android</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Android/源码/">源码</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Lavarel/">Lavarel</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Lavarel/PHP/">PHP</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Nginx/">Nginx</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/">Python</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Python/学习/">学习</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/数据挖掘/">数据挖掘</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/数据挖掘/实时计算/">实时计算</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/数据挖掘/实时计算/优化/">优化</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/数据挖掘/实时计算/源码分析/">源码分析</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/数据挖掘/实时计算/虚拟化/">虚拟化</a></li></ul></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/系统维护/">系统维护</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/系统维护/日志处理/">日志处理</a></li></ul></li></ul></div><div class="widget"><div class="widget-title">标签</div><div class="tagcloud"><a href="/tags/Documentation/" style="font-size: 15px;">Documentation</a> <a href="/tags/Spark/" style="font-size: 15px;">Spark</a> <a href="/tags/Kernel/" style="font-size: 15px;">Kernel</a> <a href="/tags/Docker/" style="font-size: 15px;">Docker</a> <a href="/tags/HDFS/" style="font-size: 15px;">HDFS</a> <a href="/tags/Oryx2/" style="font-size: 15px;">Oryx2</a> <a href="/tags/documentation/" style="font-size: 15px;">documentation</a> <a href="/tags/Admin/" style="font-size: 15px;">Admin</a> <a href="/tags/Hadoop/" style="font-size: 15px;">Hadoop</a> <a href="/tags/Spark-Streaming/" style="font-size: 15px;">Spark-Streaming</a> <a href="/tags/Nginx/" style="font-size: 15px;">Nginx</a> <a href="/tags/Logrorate/" style="font-size: 15px;">Logrorate</a> <a href="/tags/Linux/" style="font-size: 15px;">Linux</a> <a href="/tags/Shell/" style="font-size: 15px;">Shell</a> <a href="/tags/Kafka/" style="font-size: 15px;">Kafka</a> <a href="/tags/Source/" style="font-size: 15px;">Source</a> <a href="/tags/Apache/" style="font-size: 15px;">Apache</a> <a href="/tags/Flume-NG/" style="font-size: 15px;">Flume-NG</a> <a href="/tags/awk/" style="font-size: 15px;">awk</a> <a href="/tags/programming/" style="font-size: 15px;">programming</a> <a href="/tags/spark/" style="font-size: 15px;">spark</a> <a href="/tags/优化/" style="font-size: 15px;">优化</a> <a href="/tags/正则/" style="font-size: 15px;">正则</a> <a href="/tags/日志/" style="font-size: 15px;">日志</a> <a href="/tags/Python/" style="font-size: 15px;">Python</a> <a href="/tags/Java/" style="font-size: 15px;">Java</a> <a href="/tags/Recommendation/" style="font-size: 15px;">Recommendation</a> <a href="/tags/Android/" style="font-size: 15px;">Android</a> <a href="/tags/Lavarel/" style="font-size: 15px;">Lavarel</a> <a href="/tags/PHP/" style="font-size: 15px;">PHP</a> <a href="/tags/Genetic-Algorithm/" style="font-size: 15px;">Genetic Algorithm</a></div></div><div class="widget"><div class="widget-title">最新文章</div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2016/06/29/Laravel和Dropzone-js实现文件上传/">Laravel和Dropzone.js实现文件上传</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/06/13/Lavarel-环境安装和配置/">Lavarel 环境安装和配置</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/04/08/set-up-oryx-env/">玩转 Oryx2 （一）</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/04/07/Oryx2-performance-doc/">Oryx2 性能优化文档</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/04/06/Oryx2-developer-doc/">Oryx2 开发者文档</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/04/06/Oryx2-end-user-doc/">Oryx2 终端用户文档</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/03/08/Java-keyword-volatile/">Java关键字volatile</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/03/08/OKHttp-sourcecode/">OKHttp源码学习过程</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/01/24/Reg-Nginx/">正则表达式处理Nginx</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/01/06/TAPL/">TAPL</a></li></ul></div><div class="widget"><div class="widget-title">最近评论</div><script type="text/javascript" src="//reasonpun.disqus.com/recent_comments_widget.js?num_items=5&amp;hide_avatars=1&amp;avatar_size=32&amp;excerpt_length=20&amp;hide_mods=1"></script></div><div class="widget"><div class="widget-title">友情链接</div><ul></ul><a href="http://people.csail.mit.edu/matei/" title="Matei Zaharia" target="_blank">Matei Zaharia</a><ul></ul><a href="https://github.com/tensorflow/tensorflow" title="tensorflow" target="_blank">tensorflow</a></div></div></div></div><div id="footer">© <a href="/" rel="nofollow">Tensor Cell.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div><a id="rocket" href="#top" class="show"></a><script src="/js/jquery.min.js" type="text/javascript"></script>
<script src="/js/totop.js" type="text/javascript"></script><script src="/js/fancybox.pack.js" type="text/javascript"></script>
<script src="/js/jquery.fancybox.js" type="text/javascript"></script><link rel="stylesheet" href="/css/jquery.fancybox.css" type="text/css"></div><!-- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
</body></html>