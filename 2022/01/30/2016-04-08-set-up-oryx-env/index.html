<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>玩转 Oryx2 （一） | Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="准备环境 CDH 5.5.2, Parcel HDFS YARN Zookeeper Kafka Spark (on YARN)    下载最新版本 进入下载页面，分别下载  compute-classpath.sh oryx-batch-2.1.2.jar oryx-run.sh oryx-serving-2.1.2.jar oryx-speed-2.1.2.jar   下载conf文件  以A">
<meta property="og:type" content="article">
<meta property="og:title" content="玩转 Oryx2 （一）">
<meta property="og:url" content="http://example.com/2022/01/30/2016-04-08-set-up-oryx-env/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="准备环境 CDH 5.5.2, Parcel HDFS YARN Zookeeper Kafka Spark (on YARN)    下载最新版本 进入下载页面，分别下载  compute-classpath.sh oryx-batch-2.1.2.jar oryx-run.sh oryx-serving-2.1.2.jar oryx-speed-2.1.2.jar   下载conf文件  以A">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2022-01-30T04:24:01.508Z">
<meta property="article:modified_time" content="2022-01-30T03:40:55.632Z">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 6.0.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-2016-04-08-set-up-oryx-env" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2022/01/30/2016-04-08-set-up-oryx-env/" class="article-date">
  <time class="dt-published" datetime="2022-01-30T04:24:01.508Z" itemprop="datePublished">2022-01-30</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="p-name article-title" itemprop="headline name">
      玩转 Oryx2 （一）
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="准备"><a href="#准备" class="headerlink" title="准备"></a>准备</h2><h3 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h3><ul>
<li>CDH 5.5.2, Parcel<ul>
<li>HDFS</li>
<li>YARN</li>
<li>Zookeeper</li>
<li>Kafka</li>
<li>Spark (on YARN)</li>
</ul>
</li>
</ul>
<h3 id="下载最新版本"><a href="#下载最新版本" class="headerlink" title="下载最新版本"></a>下载最新版本</h3><ul>
<li><p>进入<a target="_blank" rel="noopener" href="https://github.com/OryxProject/oryx/releases/tag/oryx-2.1.2">下载页面</a>，分别下载</p>
<ul>
<li>compute-classpath.sh</li>
<li>oryx-batch-2.1.2.jar</li>
<li>oryx-run.sh</li>
<li>oryx-serving-2.1.2.jar</li>
<li>oryx-speed-2.1.2.jar</li>
</ul>
</li>
<li><p>下载conf文件</p>
<ul>
<li><p>以ALS为例，在源码目录oryx/app/conf下<a target="_blank" rel="noopener" href="https://github.com/OryxProject/oryx/blob/master/app%2Fconf%2Fals-example.conf">als-example.conf</a></p>
</li>
<li><p>并将其重命名为oryx.conf（注：文件需要和每个层的JAR文件放在同一个目录下）</p>
</li>
<li><p>修改conf文件</p>
</li>
</ul>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"># 现阶段只需要修改这么几个字段就OK了</span><br><span class="line">kafka-brokers = &quot;data-mining-46.slave:9092,data-mining-47.slave:9092,data-mining-48.slave:9092,data-mining-49.master:9092&quot;</span><br><span class="line">zk-servers = &quot;data-mining-46.slave:2181,data-mining-47.slave:2181,data-mining-48.slave:2181/kafka&quot;</span><br><span class="line">hdfs-base = &quot;hdfs:///Oryx&quot;</span><br><span class="line"></span><br><span class="line">oryx &#123;</span><br><span class="line">id = &quot;ALSExample&quot;</span><br><span class="line">als &#123;</span><br><span class="line">  rescorer-provider-class = null</span><br><span class="line">&#125;</span><br><span class="line">input-topic &#123;</span><br><span class="line">  broker = $&#123;kafka-brokers&#125;</span><br><span class="line">  lock = &#123;</span><br><span class="line">    master = $&#123;zk-servers&#125;</span><br><span class="line">  &#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<h3 id="开始"><a href="#开始" class="headerlink" title="开始"></a>开始</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line">[root@data-mining-49 oryx]# ./oryx-run.sh kafka-setup</span><br><span class="line">Input   ZK      data-mining-46.slave:2181,data-mining-47.slave:2181,data-mining-48.slave:2181/kafka</span><br><span class="line">        Kafka   data-mining-46.slave:9092,data-mining-47.slave:9092,data-mining-48.slave:9092,data-mining-49.master:9092</span><br><span class="line">        topic   OryxInput</span><br><span class="line">Update  ZK      data-mining-46.slave:2181,data-mining-47.slave:2181,data-mining-48.slave:2181/kafka</span><br><span class="line">        Kafka   data-mining-46.slave:9092,data-mining-47.slave:9092,data-mining-48.slave:9092,data-mining-49.master:9092</span><br><span class="line">        topic   OryxUpdate</span><br><span class="line"></span><br><span class="line">All available topics:</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Input topic OryxInput does not exist. Create it? y</span><br><span class="line">Creating topic OryxInput</span><br><span class="line">Error while executing topic command : org.apache.zookeeper.KeeperException$NoNodeException: KeeperErrorCode = NoNode for /brokers/ids</span><br><span class="line">[2016-04-08 16:53:09,383] ERROR org.I0Itec.zkclient.exception.ZkNoNodeException: org.apache.zookeeper.KeeperException$NoNodeException: KeeperErrorCode =</span><br><span class="line">NoNode for /brokers/ids</span><br><span class="line">        at org.I0Itec.zkclient.exception.ZkException.create(ZkException.java:47)</span><br><span class="line">        at org.I0Itec.zkclient.ZkClient.retryUntilConnected(ZkClient.java:995)</span><br><span class="line">        at org.I0Itec.zkclient.ZkClient.getChildren(ZkClient.java:675)</span><br><span class="line">        at org.I0Itec.zkclient.ZkClient.getChildren(ZkClient.java:671)</span><br><span class="line">        at kafka.utils.ZkUtils.getChildren(ZkUtils.scala:537)</span><br><span class="line">        at kafka.utils.ZkUtils.getSortedBrokerList(ZkUtils.scala:172)</span><br><span class="line">        at kafka.admin.AdminUtils$.createTopic(AdminUtils.scala:243)</span><br><span class="line">        at kafka.admin.TopicCommand$.createTopic(TopicCommand.scala:107)</span><br><span class="line">        at kafka.admin.TopicCommand$.main(TopicCommand.scala:60)</span><br><span class="line">        at kafka.admin.TopicCommand.main(TopicCommand.scala)</span><br><span class="line">Caused by: org.apache.zookeeper.KeeperException$NoNodeException: KeeperErrorCode = NoNode for /brokers/ids</span><br><span class="line">        at org.apache.zookeeper.KeeperException.create(KeeperException.java:111)</span><br><span class="line">        at org.apache.zookeeper.KeeperException.create(KeeperException.java:51)</span><br><span class="line">        at org.apache.zookeeper.ZooKeeper.getChildren(ZooKeeper.java:1468)</span><br><span class="line">        at org.apache.zookeeper.ZooKeeper.getChildren(ZooKeeper.java:1496)</span><br><span class="line">        at org.I0Itec.zkclient.ZkConnection.getChildren(ZkConnection.java:114)</span><br><span class="line">        at org.I0Itec.zkclient.ZkClient$4.call(ZkClient.java:678)</span><br><span class="line">        at org.I0Itec.zkclient.ZkClient$4.call(ZkClient.java:675)</span><br><span class="line">        at org.I0Itec.zkclient.ZkClient.retryUntilConnected(ZkClient.java:985)</span><br><span class="line">        ... 8 more</span><br><span class="line"> (kafka.admin.TopicCommand$)</span><br><span class="line">Status of topic OryxInput:</span><br><span class="line">y</span><br><span class="line">Update topic OryxUpdate does not exist. Create it?</span><br><span class="line">Creating topic OryxUpdate</span><br><span class="line">Error while executing topic command : org.apache.zookeeper.KeeperException$NoNodeException: KeeperErrorCode = NoNode for /brokers/ids</span><br><span class="line">[2016-04-08 16:53:11,094] ERROR org.I0Itec.zkclient.exception.ZkNoNodeException: org.apache.zookeeper.KeeperException$NoNodeException: KeeperErrorCode = NoNode for /brokers/ids</span><br><span class="line">        at org.I0Itec.zkclient.exception.ZkException.create(ZkException.java:47)</span><br><span class="line">        at org.I0Itec.zkclient.ZkClient.retryUntilConnected(ZkClient.java:995)</span><br><span class="line">        at org.I0Itec.zkclient.ZkClient.getChildren(ZkClient.java:675)</span><br><span class="line">        at org.I0Itec.zkclient.ZkClient.getChildren(ZkClient.java:671)</span><br><span class="line">        at kafka.utils.ZkUtils.getChildren(ZkUtils.scala:537)</span><br><span class="line">        at kafka.utils.ZkUtils.getSortedBrokerList(ZkUtils.scala:172)</span><br><span class="line">        at kafka.admin.AdminUtils$.createTopic(AdminUtils.scala:243)</span><br><span class="line">        at kafka.admin.TopicCommand$.createTopic(TopicCommand.scala:107)</span><br><span class="line">        at kafka.admin.TopicCommand$.main(TopicCommand.scala:60)</span><br><span class="line">        at kafka.admin.TopicCommand.main(TopicCommand.scala)</span><br><span class="line">Caused by: org.apache.zookeeper.KeeperException$NoNodeException: KeeperErrorCode = NoNode for /brokers/ids</span><br><span class="line">        at org.apache.zookeeper.KeeperException.create(KeeperException.java:111)</span><br><span class="line">        at org.apache.zookeeper.KeeperException.create(KeeperException.java:51)</span><br><span class="line">        at org.apache.zookeeper.ZooKeeper.getChildren(ZooKeeper.java:1468)</span><br><span class="line">        at org.apache.zookeeper.ZooKeeper.getChildren(ZooKeeper.java:1496)</span><br><span class="line">        at org.I0Itec.zkclient.ZkConnection.getChildren(ZkConnection.java:114)</span><br><span class="line">        at org.I0Itec.zkclient.ZkClient$4.call(ZkClient.java:678)</span><br><span class="line">        at org.I0Itec.zkclient.ZkClient$4.call(ZkClient.java:675)</span><br><span class="line">        at org.I0Itec.zkclient.ZkClient.retryUntilConnected(ZkClient.java:985)</span><br><span class="line">        ... 8 more</span><br><span class="line"> (kafka.admin.TopicCommand$)</span><br><span class="line">Error while executing topic command : Topic OryxUpdate does not exist on ZK path data-mining-46.slave:2181,data-mining-47.slave:2181,data-mining-48.slave:2181/kafka</span><br><span class="line">[2016-04-08 16:53:11,833] ERROR java.lang.IllegalArgumentException: Topic OryxUpdate does not exist on ZK path data-mining-46.slave:2181,data-mining-47.slave:2181,data-mining-48.slave:2181/kafka</span><br><span class="line">        at kafka.admin.TopicCommand$.alterTopic(TopicCommand.scala:119)</span><br><span class="line">        at kafka.admin.TopicCommand$.main(TopicCommand.scala:62)</span><br><span class="line">        at kafka.admin.TopicCommand.main(TopicCommand.scala)</span><br><span class="line"> (kafka.admin.TopicCommand$)</span><br><span class="line">Status of topic OryxUpdate:</span><br><span class="line"></span><br><span class="line">[root@data-mining-49 oryx]#</span><br></pre></td></tr></table></figure>

<h3 id="此时出现了一个问题："><a href="#此时出现了一个问题：" class="headerlink" title="此时出现了一个问题："></a>此时出现了一个问题：</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Error while executing topic command : org.apache.zookeeper.KeeperException$NoNodeException: KeeperErrorCode = NoNode for /brokers/ids</span><br></pre></td></tr></table></figure>

<p>这个问题应该是：CDH没有启动Kafka服务没有启动。通过CDH后台启动Kafka服务（如果没有添加Kafka服务，则需要先添加）。</p>
<p>![Kafka Service](/assets/images/posts/oryx/add-kafka-service.png)</p>
<p>此时重新执行setup命令：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">[root@data-mining-49 oryx]# ./oryx-run.sh kafka-setup</span><br><span class="line">Input   ZK      data-mining-46.slave:2181,data-mining-47.slave:2181,data-mining-48.slave:2181/kafka</span><br><span class="line">        Kafka   data-mining-47.slave:9092,data-mining-48.slave:9092</span><br><span class="line">        topic   OryxInput</span><br><span class="line">Update  ZK      data-mining-46.slave:2181,data-mining-47.slave:2181,data-mining-48.slave:2181/kafka</span><br><span class="line">        Kafka   data-mining-47.slave:9092,data-mining-48.slave:9092</span><br><span class="line">        topic   OryxUpdate</span><br><span class="line"></span><br><span class="line">All available topics:</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Input topic OryxInput does not exist. Create it? y</span><br><span class="line">Creating topic OryxInput</span><br><span class="line">Created topic &quot;OryxInput&quot;.</span><br><span class="line">Status of topic OryxInput:</span><br><span class="line">Topic:OryxInput PartitionCount:4        ReplicationFactor:1     Configs:</span><br><span class="line">        Topic: OryxInput        Partition: 0    Leader: 140     Replicas: 140   Isr: 140</span><br><span class="line">        Topic: OryxInput        Partition: 1    Leader: 141     Replicas: 141   Isr: 141</span><br><span class="line">        Topic: OryxInput        Partition: 2    Leader: 140     Replicas: 140   Isr: 140</span><br><span class="line">        Topic: OryxInput        Partition: 3    Leader: 141     Replicas: 141   Isr: 141</span><br><span class="line"></span><br><span class="line">Update topic OryxUpdate does not exist. Create it? y</span><br><span class="line">Creating topic OryxUpdate</span><br><span class="line">Created topic &quot;OryxUpdate&quot;.</span><br><span class="line">Updated config for topic &quot;OryxUpdate&quot;.</span><br><span class="line">Status of topic OryxUpdate:</span><br><span class="line">Topic:OryxUpdate        PartitionCount:1        ReplicationFactor:1     Configs:retention.ms=86400000,max.message.bytes=16777216</span><br><span class="line">        Topic: OryxUpdate       Partition: 0    Leader: 140     Replicas: 140   Isr: 140</span><br><span class="line"></span><br><span class="line">[root@data-mining-49 oryx]#</span><br></pre></td></tr></table></figure>

<p>OK！</p>
<h3 id="需要将如上的二进制脚本都同步到其他集群的节点上了"><a href="#需要将如上的二进制脚本都同步到其他集群的节点上了" class="headerlink" title="需要将如上的二进制脚本都同步到其他集群的节点上了"></a>需要将如上的二进制脚本都同步到其他集群的节点上了</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@data-mining-49 data]# scp -r oryx/ root@192.168.1.48:/data/</span><br><span class="line">compute-classpath.sh    100% 1893     1.9KB/s   00:00</span><br><span class="line">oryx-run.sh             100%   13KB  13.2KB/s   00:00</span><br><span class="line">oryx-batch-2.1.2.jar    100%   26MB  26.0MB/s   00:00</span><br><span class="line">oryx-serving-2.1.2.jar  100%   33MB  33.0MB/s   00:01</span><br><span class="line">oryx-speed-2.1.2.jar    100%   26MB  26.0MB/s   00:00</span><br><span class="line">oryx.conf               100%   1884  1.8KB/s    00:00</span><br></pre></td></tr></table></figure>

<h3 id="接下来我们需要找一个可用的数据集："><a href="#接下来我们需要找一个可用的数据集：" class="headerlink" title="接下来我们需要找一个可用的数据集："></a>接下来我们需要找一个可用的数据集：</h3><p><a target="_blank" rel="noopener" href="http://files.grouplens.org/datasets/movielens/ml-100k.zip">MovieLens 100K Dataset</a>，</p>
<p>将这个数据集的格式修改下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@data-mining-49 ml-100k]# tr &#x27;\t&#x27; &#x27;,&#x27; &lt; u.data &gt; data.csv</span><br><span class="line">[root@data-mining-49 ml-100k]# tail data.csv</span><br><span class="line">806,421,4,882388897</span><br><span class="line">676,538,4,892685437</span><br><span class="line">721,262,3,877137285</span><br><span class="line">913,209,2,881367150</span><br><span class="line">378,78,3,880056976</span><br><span class="line">880,476,3,880175444</span><br><span class="line">716,204,5,879795543</span><br><span class="line">276,1090,1,874795795</span><br><span class="line">13,225,2,882399156</span><br><span class="line">12,203,3,879959583</span><br><span class="line">[root@data-mining-49 ml-100k]#</span><br></pre></td></tr></table></figure>

<p>数据准备完毕，我们可以通过</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@data-mining-49 oryx]# ./oryx-run.sh kafka-input --input-file data.csv</span><br></pre></td></tr></table></figure>
<p>命令导入系统， 同时打开另一个终端窗口，通过命令</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">[root@data-mining-49 oryx]# ./oryx-run.sh kafka-tail</span><br><span class="line">Input   ZK      data-mining-46.slave:2181,data-mining-47.slave:2181,data-mining-48.slave:2181/kafka</span><br><span class="line">        Kafka   data-mining-47.slave:9092,data-mining-48.slave:9092</span><br><span class="line">        topic   OryxInput</span><br><span class="line">Update  ZK      data-mining-46.slave:2181,data-mining-47.slave:2181,data-mining-48.slave:2181/kafka</span><br><span class="line">        Kafka   data-mining-47.slave:9092,data-mining-48.slave:9092</span><br><span class="line">        topic   OryxUpdate</span><br><span class="line"></span><br><span class="line">279,64,1,875308510</span><br><span class="line">646,750,3,888528902</span><br><span class="line">654,370,2,887863914</span><br><span class="line">617,582,4,883789294</span><br><span class="line">913,690,3,880824288</span><br><span class="line">660,229,2,891406212</span><br><span class="line">421,498,4,892241344</span><br><span class="line">495,1091,4,888637503</span><br><span class="line">806,421,4,882388897</span><br><span class="line">676,538,4,892685437</span><br><span class="line">721,262,3,877137285</span><br><span class="line">913,209,2,881367150</span><br><span class="line">378,78,3,880056976</span><br><span class="line">880,476,3,880175444</span><br><span class="line">716,204,5,879795543</span><br><span class="line">276,1090,1,874795795</span><br><span class="line">13,225,2,882399156</span><br><span class="line">12,203,3,879959583</span><br></pre></td></tr></table></figure>

<p>实时跟踪输入导入情况，当数据全部导入完毕后，用户可以手动的通过Ctrl-C关闭这个命令。</p>
<p>如果以上全部成功了，可以关闭这些进程。集群至此已经准备好运行Oryx了。</p>
<h3 id="启动服务"><a href="#启动服务" class="headerlink" title="启动服务"></a>启动服务</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">./oryx-run.sh batch</span><br><span class="line">./oryx-run.sh speed</span><br><span class="line">./oryx-run.sh serving</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>blablabla…..好多输出，先不要管他。</p>
<p>确认服务层启动成功以后，可以导入数据（难道刚才导数据是测试用的？）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget --quiet --post-file data.csv --output-document -  --header &quot;Content-Type: text/csv&quot; http://192.168.1.49:8080/ingest</span><br></pre></td></tr></table></figure>
<p>批处理层已经开始触发一个新的计算了。</p>
<p>此时看看HDFS中的数据是这样的：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@data-mining-49 oryx]# hdfs dfs -ls /Oryx</span><br><span class="line">Found 2 items</span><br><span class="line">drwxr-xr-x   - hdfs supergroup          0 2016-04-08 18:40 /Oryx/data</span><br><span class="line">drwxr-xr-x   - hdfs supergroup          0 2016-04-08 18:40 /Oryx/model</span><br><span class="line">^[[A[root@data-mining-49 oryx]# hdfs dfs -ls /Oryx/data</span><br><span class="line">Found 1 items</span><br><span class="line">drwxr-xr-x   - hdfs supergroup          0 2016-04-08 18:40 /Oryx/data/oryx-1460112000000.data</span><br><span class="line">[root@data-mining-49 oryx]# hdfs dfs -ls /Oryx/model</span><br><span class="line">Found 3 items</span><br><span class="line">drwxr-xr-x   - hdfs supergroup          0 2016-04-08 18:41 /Oryx/model/.checkpoint</span><br><span class="line">drwxr-xr-x   - hdfs supergroup          0 2016-04-08 18:40 /Oryx/model/.temporary</span><br><span class="line">drwxr-xr-x   - hdfs supergroup          0 2016-04-08 18:40 /Oryx/model/1460112018440</span><br><span class="line">[root@data-mining-49 oryx]#</span><br></pre></td></tr></table></figure>

<p>表明数据已经ok了，通过API确认计算是否完成</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@data-mining-49 ~]# wget --quiet --output-document - --server-response http://192.168.1.49:8080/ready</span><br><span class="line">  HTTP/1.1 200 OK</span><br><span class="line">  Content-Length: 0</span><br><span class="line">  Date: Fri, 08 Apr 2016 10:43:27 GMT</span><br><span class="line">  Server: Oryx</span><br></pre></td></tr></table></figure>

<p>OK！</p>
<h3 id="我们来查看下推荐结果"><a href="#我们来查看下推荐结果" class="headerlink" title="我们来查看下推荐结果"></a>我们来查看下推荐结果</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">[root@data-mining-49 ~]# wget --quiet --output-document -  http://192.168.1.49:8080/recommend/17</span><br><span class="line">50,0.8234792673029006</span><br><span class="line">127,0.7889597890898585</span><br><span class="line">181,0.7442612769082189</span><br><span class="line">275,0.7263787714764476</span><br><span class="line">258,0.7164891492575407</span><br><span class="line">121,0.7006391943432391</span><br><span class="line">15,0.697495789732784</span><br><span class="line">288,0.6787936894688755</span><br><span class="line">285,0.6696474105119705</span><br><span class="line">25,0.6603603088587988</span><br><span class="line">[root@data-mining-49 ~]# wget --quiet --output-document -  http://192.168.1.49:8080/recommend/806</span><br><span class="line">173,1.084704713546671</span><br><span class="line">64,1.0142679414711893</span><br><span class="line">7,0.9939510896801949</span><br><span class="line">183,0.9918235178338364</span><br><span class="line">22,0.9644620651379228</span><br><span class="line">69,0.945814429782331</span><br><span class="line">202,0.9420167971402407</span><br><span class="line">11,0.9270770070143044</span><br><span class="line">135,0.9227914617804345</span><br><span class="line">191,0.9215727103874087</span><br><span class="line">[root@data-mining-49 ~]#</span><br></pre></td></tr></table></figure>

<p>完美结束。</p>
<p>这貌似是走的批处理逻辑，中途实时计算层挂鸟</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">16/04/08 18:42:38 INFO SparkContext: Successfully stopped SparkContext</span><br><span class="line">16/04/08 18:42:38 INFO OutputCommitCoordinator$OutputCommitCoordinatorEndpoint: OutputCommitCoordinator stopped!</span><br><span class="line">Exception in thread &quot;main&quot; org.apache.spark.SparkException: Job aborted due to stage failure: Task 0 in stage 0.0 failed 4 times, most recent failure: Lost task 0.3 in stage 0.0 (TID 3, data-mining-47.slave): java.io.IOException: org.apache.spark.SparkException: Failed to get broadcast_0_piece0 of broadcast_0</span><br><span class="line">        at org.apache.spark.util.Utils$.tryOrIOException(Utils.scala:1177)</span><br><span class="line">        at org.apache.spark.broadcast.TorrentBroadcast.readBroadcastBlock(TorrentBroadcast.scala:165)</span><br><span class="line">        at org.apache.spark.broadcast.TorrentBroadcast._value$lzycompute(TorrentBroadcast.scala:64)</span><br><span class="line">        at org.apache.spark.broadcast.TorrentBroadcast._value(TorrentBroadcast.scala:64)</span><br><span class="line">        at org.apache.spark.broadcast.TorrentBroadcast.getValue(TorrentBroadcast.scala:88)</span><br><span class="line">        at org.apache.spark.broadcast.Broadcast.value(Broadcast.scala:70)</span><br><span class="line">        at org.apache.spark.scheduler.ResultTask.runTask(ResultTask.scala:62)</span><br><span class="line">        at org.apache.spark.scheduler.Task.run(Task.scala:88)</span><br><span class="line">        at org.apache.spark.executor.Executor$TaskRunner.run(Executor.scala:214)</span><br><span class="line">        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)</span><br><span class="line">        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)</span><br><span class="line">        at java.lang.Thread.run(Thread.java:745)</span><br><span class="line">Caused by: org.apache.spark.SparkException: Failed to get broadcast_0_piece0 of broadcast_0</span><br><span class="line">        at org.apache.spark.broadcast.TorrentBroadcast$$anonfun$org$apache$spark$broadcast$TorrentBroadcast$$readBlocks$1$$anonfun$2.apply(TorrentBroadcast.scala:138)</span><br><span class="line">        at org.apache.spark.broadcast.TorrentBroadcast$$anonfun$org$apache$spark$broadcast$TorrentBroadcast$$readBlocks$1$$anonfun$2.apply(TorrentBroadcast.scala:138)</span><br><span class="line">        at scala.Option.getOrElse(Option.scala:120)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>咱们下一篇再找找原因吧。</p>
<h2 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h2><ul>
<li><a target="_blank" rel="noopener" href="http://oryx.io/docs/admin.html">http://oryx.io/docs/admin.html</a></li>
<li><a target="_blank" rel="noopener" href="http://oryx.io/docs/endusers.html">http://oryx.io/docs/endusers.html</a></li>
<li><a target="_blank" rel="noopener" href="http://oryx.io/docs/developer.html">http://oryx.io/docs/developer.html</a></li>
<li><a target="_blank" rel="noopener" href="http://oryx.io/docs/performance.html">http://oryx.io/docs/performance.html</a></li>
<li><a target="_blank" rel="noopener" href="http://oryx.io/apidocs/index.html">http://oryx.io/apidocs/index.html</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2022/01/30/2016-04-08-set-up-oryx-env/" data-id="ckz0rdm4h000n94ut1x4n1314" data-title="玩转 Oryx2 （一）" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2022/01/30/2016-06-13-Laravel-%E7%8E%AF%E5%A2%83%E5%AE%89%E8%A3%85%E5%92%8C%E9%85%8D%E7%BD%AE/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          Laravel 环境安装和配置
        
      </div>
    </a>
  
  
    <a href="/2022/01/30/2016-04-07-Oryx2-performance-doc/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Oryx2 性能优化文档</div>
    </a>
  
</nav>

  
</article>


</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/iOS/">iOS</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Docker/" rel="tag">Docker</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Emacs/" rel="tag">Emacs</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Java/" rel="tag">Java</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Laravel/" rel="tag">Laravel</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PHP/" rel="tag">PHP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/QSS/" rel="tag">QSS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Rails/" rel="tag">Rails</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Ruby/" rel="tag">Ruby</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Spark/" rel="tag">Spark</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Vagrant/" rel="tag">Vagrant</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/logrotate/" rel="tag">logrotate</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nginx/" rel="tag">nginx</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/pyqt5/" rel="tag">pyqt5</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%BD%BF%E7%94%A8%E6%80%BB%E7%BB%93/" rel="tag">使用总结</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%A1%85%E8%B0%B7%E6%9D%A5%E4%BF%A1/" rel="tag">硅谷来信</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%89%BA%E6%9C%AF/" rel="tag">艺术</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%8B%B9%E6%9E%9C%E8%B4%A6%E5%8F%B7/" rel="tag">苹果账号</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%AF%BB%E5%90%8E%E6%84%9F/" rel="tag">读后感</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%B0%B7%E6%AD%8C%E6%96%B9%E6%B3%95%E8%AE%BA/" rel="tag">谷歌方法论</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/Docker/" style="font-size: 10px;">Docker</a> <a href="/tags/Emacs/" style="font-size: 10px;">Emacs</a> <a href="/tags/Java/" style="font-size: 10px;">Java</a> <a href="/tags/Laravel/" style="font-size: 10px;">Laravel</a> <a href="/tags/PHP/" style="font-size: 10px;">PHP</a> <a href="/tags/QSS/" style="font-size: 10px;">QSS</a> <a href="/tags/Rails/" style="font-size: 10px;">Rails</a> <a href="/tags/Ruby/" style="font-size: 10px;">Ruby</a> <a href="/tags/Spark/" style="font-size: 10px;">Spark</a> <a href="/tags/Vagrant/" style="font-size: 10px;">Vagrant</a> <a href="/tags/logrotate/" style="font-size: 10px;">logrotate</a> <a href="/tags/nginx/" style="font-size: 10px;">nginx</a> <a href="/tags/pyqt5/" style="font-size: 10px;">pyqt5</a> <a href="/tags/%E4%BD%BF%E7%94%A8%E6%80%BB%E7%BB%93/" style="font-size: 10px;">使用总结</a> <a href="/tags/%E7%A1%85%E8%B0%B7%E6%9D%A5%E4%BF%A1/" style="font-size: 20px;">硅谷来信</a> <a href="/tags/%E8%89%BA%E6%9C%AF/" style="font-size: 10px;">艺术</a> <a href="/tags/%E8%8B%B9%E6%9E%9C%E8%B4%A6%E5%8F%B7/" style="font-size: 10px;">苹果账号</a> <a href="/tags/%E8%AF%BB%E5%90%8E%E6%84%9F/" style="font-size: 20px;">读后感</a> <a href="/tags/%E8%B0%B7%E6%AD%8C%E6%96%B9%E6%B3%95%E8%AE%BA/" style="font-size: 10px;">谷歌方法论</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/01/">January 2022</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2022/01/30/2019-03-22-%E5%90%B4%E5%86%9B-%E8%B0%B7%E6%AD%8C%E6%96%B9%E6%B3%95%E8%AE%BA-%E8%AF%AD%E6%96%87%E5%AD%A6%E4%B9%A0%E7%9A%84%E6%84%8F%E4%B9%89/">读 吴军《谷歌方法论》- 为什么学习语文</a>
          </li>
        
          <li>
            <a href="/2022/01/30/2019-03-16-pyqt5-QSS%E7%9A%84%E4%B8%80%E4%BA%9B%E6%80%BB%E7%BB%93/">Pyqt5 QSS</a>
          </li>
        
          <li>
            <a href="/2022/01/30/2019-03-14-%E5%86%85%E7%94%B0%E5%85%89%E5%AD%90-%E5%85%B3%E4%BA%8E%E4%B8%80%E6%B5%81%E6%B0%B4%E5%87%86%E7%9A%84%E6%80%9D%E8%80%83/">内田光子-关于一流水准的思考</a>
          </li>
        
          <li>
            <a href="/2022/01/30/2019-03-11-%E5%90%B4%E5%86%9B-%E7%A1%85%E8%B0%B7%E6%9D%A5%E4%BF%A1-%E7%AC%94%E8%AE%B0-01/">读吴军《硅谷来信》心得笔记 - 第一篇</a>
          </li>
        
          <li>
            <a href="/2022/01/30/2019-03-11-2018%E5%B9%B4%E5%A4%A7%E5%85%B4%E5%8C%BA%E5%B9%BC%E5%8D%87%E5%B0%8F%E6%94%BF%E7%AD%96/">2018年大兴区幼升小政策</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2022 John Doe<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>