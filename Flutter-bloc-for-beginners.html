<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.3.0"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png"><link rel="mask-icon" href="/images/logo.svg" color="#222"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.0.0/css/all.min.css" integrity="sha256-jTIdiMuX/e3DGJUGwl3pKSxuc6YOuqtJYkM0bGQESA4=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous"><script class="next-config" data-name="main" type="application/json">{"hostname":"pangz.fun","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.10.1","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":true,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4592202470693653" crossorigin="anonymous"></script><meta name="description" content="什么是Flutter 的Bocl模式Flutter bloc 是 Fl​​utter 应用程序的状态管理之一。您可以使用它以 简单 的方式处理应用程序的所有可能状态。Flutter bloc 易于使用，因为您和您的团队将很快理解这个概念，无论您的级别是什么，这个库都有非常好的文档和大量的示例，也是 Flutter 社区中使用最多的库之一，因此，如果您有任何疑问或问题，您可能会通过互联网上的简单"><meta property="og:type" content="article"><meta property="og:title" content="适合初学者的Flutter Bloc模式"><meta property="og:url" content="https://pangz.fun/Flutter-bloc-for-beginners.html"><meta property="og:site_name" content="酷学小栈"><meta property="og:description" content="什么是Flutter 的Bocl模式Flutter bloc 是 Fl​​utter 应用程序的状态管理之一。您可以使用它以 简单 的方式处理应用程序的所有可能状态。Flutter bloc 易于使用，因为您和您的团队将很快理解这个概念，无论您的级别是什么，这个库都有非常好的文档和大量的示例，也是 Flutter 社区中使用最多的库之一，因此，如果您有任何疑问或问题，您可能会通过互联网上的简单"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://pangz.fun/Flutter-bloc-for-beginners/1.png"><meta property="og:image" content="https://pangz.fun/Flutter-bloc-for-beginners/2.png"><meta property="og:image" content="https://pangz.fun/Flutter-bloc-for-beginners/3.png"><meta property="og:image" content="https://pangz.fun/Flutter-bloc-for-beginners/4.png"><meta property="og:image" content="https://pangz.fun/Flutter-bloc-for-beginners/5.png"><meta property="og:image" content="https://pangz.fun/Flutter-bloc-for-beginners/6.png"><meta property="og:image" content="https://pangz.fun/Flutter-bloc-for-beginners/7.png"><meta property="og:image" content="https://pangz.fun/Flutter-bloc-for-beginners/8.png"><meta property="og:image" content="https://pangz.fun/Flutter-bloc-for-beginners/9.png"><meta property="og:image" content="https://pangz.fun/Flutter-bloc-for-beginners/10.png"><meta property="og:image" content="https://pangz.fun/Flutter-bloc-for-beginners/11.gif"><meta property="og:image" content="https://pangz.fun/Flutter-bloc-for-beginners/12.png"><meta property="og:image" content="https://pangz.fun/Flutter-bloc-for-beginners/13.png"><meta property="og:image" content="https://pangz.fun/Flutter-bloc-for-beginners/15.png"><meta property="og:image" content="https://pangz.fun/Flutter-bloc-for-beginners/16.png"><meta property="article:published_time" content="2022-03-15T07:06:52.000Z"><meta property="article:modified_time" content="2025-01-23T09:09:21.439Z"><meta property="article:author" content="木辛念做梓"><meta property="article:tag" content="Flutter"><meta property="article:tag" content="Patterns"><meta property="article:tag" content="Beginners"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://pangz.fun/Flutter-bloc-for-beginners/1.png"><link rel="canonical" href="https://pangz.fun/Flutter-bloc-for-beginners.html"><script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://pangz.fun/Flutter-bloc-for-beginners.html","path":"Flutter-bloc-for-beginners.html","title":"适合初学者的Flutter Bloc模式"}</script><script class="next-config" data-name="calendar" type="application/json">""</script><title>适合初学者的Flutter Bloc模式 | 酷学小栈</title><script async src="https://www.googletagmanager.com/gtag/js?id=G-1HVT1YE421"></script><script class="next-config" data-name="google_analytics" type="application/json">{"tracking_id":"G-1HVT1YE421","only_pageview":false}</script><script src="/js/third-party/analytics/google-analytics.js"></script><link rel="stylesheet" type="text/css" href="/css/injector/main.css"><link rel="preload" as="style" href="/css/injector/light.css"><link rel="preload" as="style" href="/css/injector/dark.css"><noscript><link rel="stylesheet" href="/css/noscript.css"></noscript><style>.github-emoji{position:relative;display:inline-block;width:1.2em;min-height:1.2em;overflow:hidden;vertical-align:top;color:transparent}.github-emoji>span{position:relative;z-index:10}.github-emoji .fancybox,.github-emoji img{margin:0!important;padding:0!important;border:none!important;outline:0!important;text-decoration:none!important;user-select:none!important;cursor:auto!important}.github-emoji img{height:1.2em!important;width:1.2em!important;position:absolute!important;left:50%!important;top:50%!important;transform:translate(-50%,-50%)!important;user-select:none!important;cursor:auto!important}.github-emoji-fallback{color:inherit}.github-emoji-fallback img{opacity:0!important}</style><link rel="alternate" href="/atom.xml" title="酷学小栈" type="application/atom+xml"></head><body itemscope itemtype="http://schema.org/WebPage" class="use-motion"><div class="headband"></div><main class="main"><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏" role="button"><span class="toggle-line"></span> <span class="toggle-line"></span> <span class="toggle-line"></span></div></div><div class="site-meta"><a href="/" class="brand" rel="start"><i class="logo-line"></i><p class="site-title">酷学小栈</p><i class="logo-line"></i></a><p class="site-subtitle" itemprop="description">还要再走500里</p></div><div class="site-nav-right"><div class="toggle popup-trigger"></div></div></div><nav class="site-nav"><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li><li class="menu-item menu-item-rss"><a href="/atom.xml" rel="section"><i class="fa fa-rss fa-fw"></i>RSS</a></li></ul></nav></div><div class="toggle sidebar-toggle" role="button"><span class="toggle-line"></span> <span class="toggle-line"></span> <span class="toggle-line"></span></div><aside class="sidebar"><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class="sidebar-nav"><li class="sidebar-nav-toc">文章目录</li><li class="sidebar-nav-overview">站点概览</li></ul><div class="sidebar-panel-container"><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%80%E4%B9%88%E6%98%AFFlutter-%E7%9A%84Bocl%E6%A8%A1%E5%BC%8F"><span class="nav-number">1.</span> <span class="nav-text">什么是Flutter 的Bocl模式</span></a></li></ol><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%82%A3%E4%B9%88%E2%80%A6%E2%80%A6%E6%88%91%E8%AF%A5%E5%A6%82%E4%BD%95%E4%BB%8E-Flutter-bloc-%E5%BC%80%E5%A7%8B%E5%91%A2%EF%BC%9F"><span class="nav-number"></span> <span class="nav-text">那么……我该如何从 Flutter bloc 开始呢？</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%83%E6%98%AF%E5%A6%82%E4%BD%95%E5%B7%A5%E4%BD%9C%E7%9A%84%EF%BC%9F"><span class="nav-number">1.</span> <span class="nav-text">它是如何工作的？</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Bloc-Widgets"><span class="nav-number">2.</span> <span class="nav-text">Bloc Widgets</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#RepositoryProvider-MultiRepositoryProvider"><span class="nav-number">3.</span> <span class="nav-text">RepositoryProvider&#x2F;MultiRepositoryProvider</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#BlocListener"><span class="nav-number">4.</span> <span class="nav-text">BlocListener</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#BlocBuilder"><span class="nav-number">5.</span> <span class="nav-text">BlocBuilder</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#BlocConsumer"><span class="nav-number">6.</span> <span class="nav-text">BlocConsumer</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#BlocSelector"><span class="nav-number">7.</span> <span class="nav-text">BlocSelector</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9C%A8%E5%AE%9E%E9%99%85%E9%A1%B9%E7%9B%AE%E4%B8%AD%E4%BD%BF%E7%94%A8-Flutter-Bloc"><span class="nav-number"></span> <span class="nav-text">在实际项目中使用 Flutter Bloc</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A0%87%E9%A2%98"><span class="nav-number">1.</span> <span class="nav-text">标题</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%B1%BB%E5%88%AB%E5%B0%8F%E9%83%A8%E4%BB%B6"><span class="nav-number">2.</span> <span class="nav-text">类别小部件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%86%E7%B1%BB%E7%AD%9B%E9%80%89%E6%B8%B8%E6%88%8F%E5%B0%8F%E9%83%A8%E4%BB%B6"><span class="nav-number">3.</span> <span class="nav-text">分类筛选游戏小部件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%85%A8%E9%83%A8%E6%B8%B8%E6%88%8F"><span class="nav-number">4.</span> <span class="nav-text">全部游戏</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%A1%B9%E7%9B%AE%E7%BB%93%E6%9E%84"><span class="nav-number">5.</span> <span class="nav-text">项目结构</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Home%E9%A1%B5%E9%9D%A2"><span class="nav-number">6.</span> <span class="nav-text">Home页面</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#HomeLayout"><span class="nav-number">7.</span> <span class="nav-text">HomeLayout</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#CategoriesWidget"><span class="nav-number"></span> <span class="nav-text">CategoriesWidget</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Category-event"><span class="nav-number">1.</span> <span class="nav-text">Category event</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Category-state"><span class="nav-number">2.</span> <span class="nav-text">Category state</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Category-bloc"><span class="nav-number">3.</span> <span class="nav-text">Category bloc</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#GameByCategoryWidget"><span class="nav-number"></span> <span class="nav-text">GameByCategoryWidget</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#GameByCategoryEvent"><span class="nav-number">1.</span> <span class="nav-text">GameByCategoryEvent</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#GameByCategoryState"><span class="nav-number">2.</span> <span class="nav-text">GameByCategoryState</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#GameByCategoryBloc"><span class="nav-number">3.</span> <span class="nav-text">GameByCategoryBloc</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#AllGamesWidget"><span class="nav-number"></span> <span class="nav-text">AllGamesWidget</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#AllGamesEvent"><span class="nav-number">1.</span> <span class="nav-text">AllGamesEvent</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#AllGamesState"><span class="nav-number">2.</span> <span class="nav-text">AllGamesState</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#AllGamesBloc"><span class="nav-number">3.</span> <span class="nav-text">AllGamesBloc</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#AllGamesWidget-1"><span class="nav-number">4.</span> <span class="nav-text">AllGamesWidget</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%A2%9D%E5%A4%96%E7%9A%84%E4%B8%9C%E8%A5%BF%F0%9F%99%8C"><span class="nav-number">5.</span> <span class="nav-text">额外的东西🙌</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BB%93%E8%AE%BA"><span class="nav-number"></span> <span class="nav-text">结论</span></a></li></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person"><p class="site-author-name" itemprop="name">木辛念做梓</p><div class="site-description" itemprop="description">读万卷书，行万里路，胸中脱去尘浊</div></div><div class="site-state-wrap site-overview-item animated"><nav class="site-state"><div class="site-state-item site-state-posts"><a href="/archives/"><span class="site-state-item-count">109</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"><a href="/categories/"><span class="site-state-item-count">21</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"><a href="/tags/"><span class="site-state-item-count">113</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="links-of-blogroll site-overview-item animated"><div class="links-of-blogroll-title"><i class="fa fa-globe fa-fw"></i> Links</div><ul class="links-of-blogroll-list"><li class="links-of-blogroll-item"><a href="https://io-oi.me/" title="https:&#x2F;&#x2F;io-oi.me" rel="noopener" target="_blank">reuixiy</a></li></ul></div></div></div></div></aside><div class="sidebar-dimmer"></div></header><div class="back-to-top" role="button" aria-label="返回顶部"><i class="fa fa-arrow-up"></i> <span>0%</span></div><noscript><div class="noscript-warning">Theme NexT works best with JavaScript enabled</div></noscript><div class="main-inner post posts-expand"><div class="post-block"><article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://pangz.fun/Flutter-bloc-for-beginners.html"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.gif"><meta itemprop="name" content="木辛念做梓"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="酷学小栈"><meta itemprop="description" content="读万卷书，行万里路，胸中脱去尘浊"></span><span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork"><meta itemprop="name" content="适合初学者的Flutter Bloc模式 | 酷学小栈"><meta itemprop="description" content=""></span><header class="post-header"><h1 class="post-title" itemprop="name headline">适合初学者的Flutter Bloc模式</h1><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2022-03-15 15:06:52" itemprop="dateCreated datePublished" datetime="2022-03-15T15:06:52+08:00">2022-03-15</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i> </span><span class="post-meta-item-text">更新于</span> <time title="修改时间：2025-01-23 17:09:21" itemprop="dateModified" datetime="2025-01-23T17:09:21+08:00">2025-01-23</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Flutter/" itemprop="url" rel="index"><span itemprop="name">Flutter</span></a> </span></span><span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv"><span class="post-meta-item-icon"><i class="far fa-eye"></i> </span><span class="post-meta-item-text">阅读次数：</span> <span id="busuanzi_value_page_pv"></span> </span><span class="post-meta-break"></span> <span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="far fa-file-word"></i> </span><span class="post-meta-item-text">本文字数：</span> <span>20k</span> </span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="far fa-clock"></i> </span><span class="post-meta-item-text">阅读时长 &asymp;</span> <span>18 分钟</span></span></div></div></header><div class="post-body" itemprop="articleBody"><img src="/Flutter-bloc-for-beginners/1.png" title="示意图 width=400"><h3 id="什么是Flutter-的Bocl模式"><a href="#什么是Flutter-的Bocl模式" class="headerlink" title="什么是Flutter 的Bocl模式"></a>什么是Flutter 的Bocl模式</h3><p>Flutter bloc 是 Fl​​utter 应用程序的状态管理之一。您可以使用它以 <strong>简单</strong> 的方式处理应用程序的所有可能状态。<br>Flutter bloc 易于使用，因为您和您的团队将很快理解这个概念，无论您的级别是什么，这个库都有非常好的文档和大量的示例，也是 Flutter 社区中使用最多的库之一，因此，如果您有任何疑问或问题，您可能会通过互联网上的简单搜索找到解决方案。</p><span id="more"></span><p><strong>功能强大</strong>是因为它可以帮助您创建各种应用程序，例如您可以创建用于学习目的的应用程序，也可以在生产环境中创建复杂的应用程序，flutter bloc 在这两种情况下都有效。<br>这个库的另一个重要方面是您可以轻松地<strong>测试</strong>您的块逻辑。</p><p>更多信息，您可以访问官方网站：<a target="_blank" rel="noopener" href="https://bloclibrary.dev/#/gettingstarted">https://bloclibrary.dev/#/gettingstarted</a></p><h2 id="那么……我该如何从-Flutter-bloc-开始呢？"><a href="#那么……我该如何从-Flutter-bloc-开始呢？" class="headerlink" title="那么……我该如何从 Flutter bloc 开始呢？"></a>那么……我该如何从 Flutter bloc 开始呢？</h2><p>我给你的第一个建议是你应该阅读文档并阅读基础知识，在本文中我将尝试解释它，但如果你需要更深入，我强烈建议你访问文档。</p><h3 id="它是如何工作的？"><a href="#它是如何工作的？" class="headerlink" title="它是如何工作的？"></a>它是如何工作的？</h3><p>当您使用Flutter bloc 时，您将创建事件来触发与应用程序的交互，然后负责的 bloc 将发出带有状态的请求数据，在一个真实的示例中，它将是这样的：</p><p>1- 用户单击按钮以获取游戏列表。<br>2- 事件被触发，并通知阻止用户想要一个游戏列表。<br>3- 该bloc将请求此数据（例如，从负责连接到 API 以获取数据的存储库）。<br>4-当块有数据时，它将确定数据是成功还是错误，然后它会发出一个状态。<br>5- 视图将听取欧盟可能发出的所有可能状态以对其作出反应。例如，如果 bloc 发出 Success 作为状态，则视图将使用游戏列表重建它，但如果状态为 Error，则视图将使用错误消息或您想要显示的任何内容进行重建。</p><img src="/Flutter-bloc-for-beginners/2.png" title="示意图 width=400"><p>完美，现在您知道了Flutter bloc 如何工作的主要概念！现在，是时候知道如何使用它了。<br>想象一下，你想创建一个与游戏相关的块逻辑，你将需要这三个类：</p><ul><li>games_bloc.dart</li><li>games_state.dart</li><li>games_event.dart</li></ul><p>如您所见，您将需要一个块、状态和事件类。<br>在每个类中，您将管理所需的信息，不要着急，接下里的内容里我们会详细讲解一下这些知识。</p><h3 id="Bloc-Widgets"><a href="#Bloc-Widgets" class="headerlink" title="Bloc Widgets"></a>Bloc Widgets</h3><p>这些是库为您提供的用于管理所有可能情况的小部件，例如，添加事件、侦听状态、发出状态、根据状态重建视图等。</p><p><em>BlocProvider/MultiBlocProvider</em></p><p>BlocProvider 负责为其子代提供bloc。是在使用之前“初始化” bloc 的方式。</p><img src="/Flutter-bloc-for-beginners/3.png" title="示意图 width=400"><p>如果您需要提供多个块，您可以使用 MultiBlocProvider 来获取不同的提供者。</p><img src="/Flutter-bloc-for-beginners/4.png" title="示意图 width=400"><h3 id="RepositoryProvider-MultiRepositoryProvider"><a href="#RepositoryProvider-MultiRepositoryProvider" class="headerlink" title="RepositoryProvider/MultiRepositoryProvider"></a>RepositoryProvider/MultiRepositoryProvider</h3><p>RepositoryProvider 用于为其子项提供存储库。通常，当您需要创建存储库类的实例时，您将使用它，然后使用 BlocProvider，您将在</p><pre class="line-numbers language-none"><code class="language-none">context.read&lt;YourRepository&gt;(); <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>的帮助下访问该存储库；</p><p>这是一个例子。</p><img src="/Flutter-bloc-for-beginners/5.png" title="示意图 width=400"><p>如果您需要多个存储库提供程序，您可以使用 MultiRepositoryProvider</p><img src="/Flutter-bloc-for-beginners/6.png" title="示意图 width=400"><h3 id="BlocListener"><a href="#BlocListener" class="headerlink" title="BlocListener"></a>BlocListener</h3><p>使用这个小部件，您将能够“监听”从您的bloc发出的不同状态，然后对它们做出反应，例如，显示一个快餐栏、对话框或导航到另一个页面……这个小部件不重建视图，它只是在听。</p><img src="/Flutter-bloc-for-beginners/7.png" title="示意图 width=400"><h3 id="BlocBuilder"><a href="#BlocBuilder" class="headerlink" title="BlocBuilder"></a>BlocBuilder</h3><p>有了这个，你将能够根据它们的状态重建你的小部件。</p><img src="/Flutter-bloc-for-beginners/8.png" title="示意图 width=400"><h3 id="BlocConsumer"><a href="#BlocConsumer" class="headerlink" title="BlocConsumer"></a>BlocConsumer</h3><p>当您需要控制块的状态以重建小部件以及导航或显示对话框等时，此小部件非常有用。此小部件具有侦听器和构建器功能，因此您可以一起使用它。</p><img src="/Flutter-bloc-for-beginners/9.png" title="示意图 width=400"><h3 id="BlocSelector"><a href="#BlocSelector" class="headerlink" title="BlocSelector"></a>BlocSelector</h3><p>此小部件允许开发人员通过根据当前区块状态选择新值来过滤更新。</p><img src="/Flutter-bloc-for-beginners/10.png" title="示意图 width=400"><p>有关更多信息，您可以查看文档。<br>之后，我们可以从例子开始🙌</p><h2 id="在实际项目中使用-Flutter-Bloc"><a href="#在实际项目中使用-Flutter-Bloc" class="headerlink" title="在实际项目中使用 Flutter Bloc"></a>在实际项目中使用 Flutter Bloc</h2><p>在这个项目中，我们将使用来自游戏 API 的数据来获取有关游戏的信息并在我们的视图中显示它们。<br>我选择的 API 是 <a target="_blank" rel="noopener" href="https://rawg.io/apidocs">RAWG</a>。要使用它，您需要创建一个 API 密钥。</p><p>做好的程序大概张这个样子</p><img src="/Flutter-bloc-for-beginners/11.gif" title="示意图 width=400"><p>主页有不同的部分，我们来看看。</p><h3 id="标题"><a href="#标题" class="headerlink" title="标题"></a>标题</h3><p>这是一个简单的小部件，显示两个文本和一个圆形头像。</p><img src="/Flutter-bloc-for-beginners/12.png" title="示意图 width=400"><h3 id="类别小部件"><a href="#类别小部件" class="headerlink" title="类别小部件"></a>类别小部件</h3><p>显示 API 返回调用 getGenres 的不同类型。这个小部件有四种可能的状态：</p><ul><li>成功：显示类别（类型）列表。</li><li>错误：显示错误信息。</li><li>正在加载：显示一个 CircularProgressIndicator。</li><li>已选：更改所选类别的大小和颜色。</li></ul><img src="/Flutter-bloc-for-beginners/13.png" title="示意图 width=400"><h3 id="分类筛选游戏小部件"><a href="#分类筛选游戏小部件" class="headerlink" title="分类筛选游戏小部件"></a>分类筛选游戏小部件</h3><p>显示 API 在使用额外的类型参数调用 getGames 时返回的按类型过滤的不同游戏。它具有三种可能的状态：</p><ul><li>成功：按类别显示游戏列表。</li><li>错误：显示错误信息。</li><li>正在加载：显示一个 CircularProgressIndicator。</li></ul><h3 id="全部游戏"><a href="#全部游戏" class="headerlink" title="全部游戏"></a>全部游戏</h3><p>显示没有过滤器的游戏列表。此小部件仅在其 bloc 发出 Success 状态并具有三种可能状态时才会显示：</p><ul><li>成功：显示游戏列表。</li><li>错误：显示错误信息。</li><li>正在加载：显示一个 CircularProgressIndicator。</li></ul><img src="/Flutter-bloc-for-beginners/15.png" title="示意图 width=400"><h3 id="项目结构"><a href="#项目结构" class="headerlink" title="项目结构"></a>项目结构</h3><p>对于这个例子，我创建了这个结构：</p><img src="/Flutter-bloc-for-beginners/16.png" title="示意图 width=400"><p>正如您在 home 小部件文件夹中看到的那样，我添加了我之前提到的所有小部件。每个小部件都有自己的bloc，因此更干净和可维护。</p><h3 id="Home页面"><a href="#Home页面" class="headerlink" title="Home页面"></a>Home页面</h3><p>这个页面非常重要，因为我在这里使用了两个 Bloc Widget：MultiBlocProvider 和 RepositoryProvider。<br>这个页面的想法是在初始化这个页面时让所有的块都准备好使用，所以，要做到这一点，我需要用 RepositoryProvider 包装我的子类，为所有块提供存储库，而且，我需要初始化所有带有 MultiBlocProvider 的块。</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'package:flutter/material.dart'</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'package:flutter_bloc/flutter_bloc.dart'</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'package:infogames/repository/game_repository.dart'</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'package:infogames/repository/service/game_service.dart'</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'package:infogames/ui/home/pages/home_layout.dart'</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'package:infogames/ui/home/widgets/category/category_barrel.dart'</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'package:infogames/ui/home/widgets/all_games_list_widget/all_games_barrel.dart'</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'package:infogames/ui/home/widgets/games_by_category/games_by_category.dart'</span></span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">HomePage</span> <span class="token keyword">extends</span> <span class="token class-name">StatelessWidget</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token class-name">HomePage</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token class-name">Key</span><span class="token operator">?</span> key<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword">super</span><span class="token punctuation">(</span>key<span class="token punctuation">:</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token metadata function">@override</span>
  <span class="token class-name">Widget</span> <span class="token function">build</span><span class="token punctuation">(</span><span class="token class-name">BuildContext</span> context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token class-name">Scaffold</span><span class="token punctuation">(</span>
      backgroundColor<span class="token punctuation">:</span> <span class="token class-name">Colors</span><span class="token punctuation">.</span>deepOrangeAccent<span class="token punctuation">,</span>
      body<span class="token punctuation">:</span> <span class="token class-name">RepositoryProvider</span><span class="token punctuation">(</span>
        create<span class="token punctuation">:</span> <span class="token punctuation">(</span>context<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token class-name">GameRepository</span><span class="token punctuation">(</span>service<span class="token punctuation">:</span> <span class="token class-name">GameService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        child<span class="token punctuation">:</span> <span class="token class-name">MultiBlocProvider</span><span class="token punctuation">(</span>
          providers<span class="token punctuation">:</span> <span class="token punctuation">[</span>
            <span class="token class-name">BlocProvider</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AllGamesBloc</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>
              create<span class="token punctuation">:</span> <span class="token punctuation">(</span>context<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token class-name">AllGamesBloc</span><span class="token punctuation">(</span>
                gameRepository<span class="token punctuation">:</span> context<span class="token punctuation">.</span>read<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">GameRepository</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>
                  <span class="token class-name">GetGames</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token class-name">BlocProvider</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CategoryBloc</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>
              create<span class="token punctuation">:</span> <span class="token punctuation">(</span>context<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token class-name">CategoryBloc</span><span class="token punctuation">(</span>
                gameRepository<span class="token punctuation">:</span> context<span class="token punctuation">.</span>read<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">GameRepository</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>
                  <span class="token class-name">GetCategories</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token class-name">BlocProvider</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">GamesByCategoryBloc</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>
              create<span class="token punctuation">:</span> <span class="token punctuation">(</span>context<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token class-name">GamesByCategoryBloc</span><span class="token punctuation">(</span>
                gameRepository<span class="token punctuation">:</span> context<span class="token punctuation">.</span>read<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">GameRepository</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token punctuation">]</span><span class="token punctuation">,</span>
          child<span class="token punctuation">:</span> <span class="token class-name">HomeLayout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>事实上，正如您在这段代码中看到的那样，有两个bloc在开头添加了两个事件：</p><ul><li>获取游戏</li><li>获取类别<br>这是添加新事件以通知其我们需要一些数据的方法之一。所以此时，主页有三个bloc，触发了两个事件。现在来看看 HomeLayout。</li></ul><h3 id="HomeLayout"><a href="#HomeLayout" class="headerlink" title="HomeLayout"></a>HomeLayout</h3><p>此类具有我上面提到的三个主要小部件，还包含视图的骨架。</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'package:flutter/material.dart'</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'package:infogames/ui/home/widgets/all_games_widget/all_games_widget.dart'</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'package:infogames/ui/home/widgets/category_widget/categories_widget.dart'</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'package:infogames/ui/home/widgets/games_by_category_widget/games_by_category_widget.dart'</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'package:infogames/ui/home/widgets/header_title/header_title.dart'</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'package:infogames/ui/widgets/container_body.dart'</span></span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">HomeLayout</span> <span class="token keyword">extends</span> <span class="token class-name">StatelessWidget</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token class-name">HomeLayout</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token class-name">Key</span><span class="token operator">?</span> key<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword">super</span><span class="token punctuation">(</span>key<span class="token punctuation">:</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token metadata function">@override</span>
  <span class="token class-name">Widget</span> <span class="token function">build</span><span class="token punctuation">(</span><span class="token class-name">BuildContext</span> context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token class-name">Padding</span><span class="token punctuation">(</span>
      padding<span class="token punctuation">:</span> <span class="token keyword">const</span> <span class="token class-name">EdgeInsets</span><span class="token punctuation">.</span><span class="token function">only</span><span class="token punctuation">(</span>top<span class="token punctuation">:</span> <span class="token number">80.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      child<span class="token punctuation">:</span> <span class="token class-name">Column</span><span class="token punctuation">(</span>
        crossAxisAlignment<span class="token punctuation">:</span> <span class="token class-name">CrossAxisAlignment</span><span class="token punctuation">.</span>start<span class="token punctuation">,</span>
        children<span class="token punctuation">:</span> <span class="token punctuation">[</span>
          <span class="token class-name">HeaderTitle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token keyword">const</span> <span class="token class-name">SizedBox</span><span class="token punctuation">(</span>height<span class="token punctuation">:</span> <span class="token number">40.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token class-name">ContainerBody</span><span class="token punctuation">(</span>
            children<span class="token punctuation">:</span> <span class="token punctuation">[</span>
              <span class="token class-name">CategoriesWidget</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token class-name">GamesByCategoryWidget</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token class-name">AllGamesWidget</span><span class="token punctuation">(</span>title<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">'All games'</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">]</span><span class="token punctuation">,</span>
          <span class="token punctuation">)</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>下一步是查看这些小部件中的每一个，所以让我们开始使用 CategoriesWidget。</p><h2 id="CategoriesWidget"><a href="#CategoriesWidget" class="headerlink" title="CategoriesWidget"></a>CategoriesWidget</h2><h3 id="Category-event"><a href="#Category-event" class="headerlink" title="Category event"></a>Category event</h3><p>这是我添加此小部件所需的所有事件的地方。</p><ul><li>GetCategories：获取类别的事件。</li><li>SelectCategories：知道何时选择类别的事件。</li></ul><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"> <span class="token keyword">part</span> of <span class="token string-literal"><span class="token string">'category_bloc.dart'</span></span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">CategoryEvent</span> <span class="token keyword">extends</span> <span class="token class-name">Equatable</span> <span class="token punctuation">{</span>
  <span class="token metadata function">@override</span>
  <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">get</span> props <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">GetCategories</span> <span class="token keyword">extends</span> <span class="token class-name">CategoryEvent</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">SelectCategory</span> <span class="token keyword">extends</span> <span class="token class-name">CategoryEvent</span> <span class="token punctuation">{</span>
  <span class="token class-name">SelectCategory</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    required <span class="token keyword">this</span><span class="token punctuation">.</span>idSelected<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">final</span> int idSelected<span class="token punctuation">;</span>

  <span class="token metadata function">@override</span>
  <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">get</span> props <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span>idSelected<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="Category-state"><a href="#Category-state" class="headerlink" title="Category state"></a>Category state</h3><p>在这个类里边，bloc可以发出不同的状态。我创建了一个扩展来以简洁明了的方式处理视图中所有可能的状态。<br>我使用 Equatable 库和 Dart 中的对象作比较，如果你不是很清楚的话，强烈建议您查看<a target="_blank" rel="noopener" href="https://pub.dev/packages/equatable">文档</a>。</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token keyword">part</span> of <span class="token string-literal"><span class="token string">'category_bloc.dart'</span></span><span class="token punctuation">;</span>

<span class="token keyword">enum</span> <span class="token class-name">CategoryStatus</span> <span class="token punctuation">{</span> initial<span class="token punctuation">,</span> success<span class="token punctuation">,</span> error<span class="token punctuation">,</span> loading<span class="token punctuation">,</span> selected <span class="token punctuation">}</span>

<span class="token keyword">extension</span> <span class="token class-name">CategoryStatusX</span> <span class="token keyword">on</span> <span class="token class-name">CategoryStatus</span> <span class="token punctuation">{</span>
  bool <span class="token keyword">get</span> isInitial <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token keyword">this</span> <span class="token operator">==</span> <span class="token class-name">CategoryStatus</span><span class="token punctuation">.</span>initial<span class="token punctuation">;</span>
  bool <span class="token keyword">get</span> isSuccess <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token keyword">this</span> <span class="token operator">==</span> <span class="token class-name">CategoryStatus</span><span class="token punctuation">.</span>success<span class="token punctuation">;</span>
  bool <span class="token keyword">get</span> isError <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token keyword">this</span> <span class="token operator">==</span> <span class="token class-name">CategoryStatus</span><span class="token punctuation">.</span>error<span class="token punctuation">;</span>
  bool <span class="token keyword">get</span> isLoading <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token keyword">this</span> <span class="token operator">==</span> <span class="token class-name">CategoryStatus</span><span class="token punctuation">.</span>loading<span class="token punctuation">;</span>
  bool <span class="token keyword">get</span> isSelected <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token keyword">this</span> <span class="token operator">==</span> <span class="token class-name">CategoryStatus</span><span class="token punctuation">.</span>selected<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">CategoryState</span> <span class="token keyword">extends</span> <span class="token class-name">Equatable</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token class-name">CategoryState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token class-name">CategoryStatus</span><span class="token punctuation">.</span>initial<span class="token punctuation">,</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Genre</span><span class="token punctuation">&gt;</span></span><span class="token operator">?</span> categories<span class="token punctuation">,</span>
    int idSelected <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>  <span class="token punctuation">:</span> categories <span class="token operator">=</span> categories <span class="token operator">?</span><span class="token operator">?</span> <span class="token keyword">const</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        idSelected <span class="token operator">=</span> idSelected<span class="token punctuation">;</span>

  <span class="token keyword">final</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Genre</span><span class="token punctuation">&gt;</span></span> categories<span class="token punctuation">;</span>
  <span class="token keyword">final</span> <span class="token class-name">CategoryStatus</span> status<span class="token punctuation">;</span>
  <span class="token keyword">final</span> int idSelected<span class="token punctuation">;</span>

  <span class="token metadata function">@override</span>
  <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">get</span> props <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span>status<span class="token punctuation">,</span> categories<span class="token punctuation">,</span> idSelected<span class="token punctuation">]</span><span class="token punctuation">;</span>

  <span class="token class-name">CategoryState</span> <span class="token function">copyWith</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Genre</span><span class="token punctuation">&gt;</span></span><span class="token operator">?</span> categories<span class="token punctuation">,</span>
    <span class="token class-name">CategoryStatus</span><span class="token operator">?</span> status<span class="token punctuation">,</span>
    int<span class="token operator">?</span> idSelected<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token class-name">CategoryState</span><span class="token punctuation">(</span>
      categories<span class="token punctuation">:</span> categories <span class="token operator">?</span><span class="token operator">?</span> <span class="token keyword">this</span><span class="token punctuation">.</span>categories<span class="token punctuation">,</span>
      status<span class="token punctuation">:</span> status <span class="token operator">?</span><span class="token operator">?</span> <span class="token keyword">this</span><span class="token punctuation">.</span>status<span class="token punctuation">,</span>
      idSelected<span class="token punctuation">:</span> idSelected <span class="token operator">?</span><span class="token operator">?</span> <span class="token keyword">this</span><span class="token punctuation">.</span>idSelected<span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="Category-bloc"><a href="#Category-bloc" class="headerlink" title="Category bloc"></a>Category bloc</h3><p>在这里，您需要处理您拥有的所有事件。如您所见，在第 13 行和第 14 行，我正在检查事件是否是一个或另一个以创建它的方法。<br>mapGetCategoriesEventToState：此方法调用存储库以从 API 获取数据。当存储库返回数据 o 抛出错误时，该块会发出相应的状态。<br>mapSelectCategoryEventToState：此方法将发出“选定”这样的状态。</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'package:equatable/equatable.dart'</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'package:flutter_bloc/flutter_bloc.dart'</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'package:infogames/repository/game_repository.dart'</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'package:infogames/repository/models/model_barrel.dart'</span></span><span class="token punctuation">;</span>

<span class="token keyword">part</span> <span class="token string-literal"><span class="token string">'category_event.dart'</span></span><span class="token punctuation">;</span>
<span class="token keyword">part</span> <span class="token string-literal"><span class="token string">'category_state.dart'</span></span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">CategoryBloc</span> <span class="token keyword">extends</span> <span class="token class-name">Bloc</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CategoryEvent</span><span class="token punctuation">,</span> <span class="token class-name">CategoryState</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
  <span class="token class-name">CategoryBloc</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    required <span class="token keyword">this</span><span class="token punctuation">.</span>gameRepository<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token class-name">CategoryState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">on</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">GetCategories</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>_mapGetCategoriesEventToState<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">on</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SelectCategory</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>_mapSelectCategoryEventToState<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">final</span> <span class="token class-name">GameRepository</span> gameRepository<span class="token punctuation">;</span>

  <span class="token keyword">void</span> <span class="token function">_mapGetCategoriesEventToState</span><span class="token punctuation">(</span>
      <span class="token class-name">GetCategories</span> event<span class="token punctuation">,</span> <span class="token class-name">Emitter</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CategoryState</span><span class="token punctuation">&gt;</span></span> emit<span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token punctuation">{</span>
    <span class="token function">emit</span><span class="token punctuation">(</span>state<span class="token punctuation">.</span><span class="token function">copyWith</span><span class="token punctuation">(</span>status<span class="token punctuation">:</span> <span class="token class-name">CategoryStatus</span><span class="token punctuation">.</span>loading<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      <span class="token keyword">final</span> genres <span class="token operator">=</span> <span class="token keyword">await</span> gameRepository<span class="token punctuation">.</span><span class="token function">getGenres</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">emit</span><span class="token punctuation">(</span>
        state<span class="token punctuation">.</span><span class="token function">copyWith</span><span class="token punctuation">(</span>
          status<span class="token punctuation">:</span> <span class="token class-name">CategoryStatus</span><span class="token punctuation">.</span>success<span class="token punctuation">,</span>
          categories<span class="token punctuation">:</span> genres<span class="token punctuation">,</span>
        <span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">,</span> stacktrace<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">print</span><span class="token punctuation">(</span>stacktrace<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">emit</span><span class="token punctuation">(</span>state<span class="token punctuation">.</span><span class="token function">copyWith</span><span class="token punctuation">(</span>status<span class="token punctuation">:</span> <span class="token class-name">CategoryStatus</span><span class="token punctuation">.</span>error<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">void</span> <span class="token function">_mapSelectCategoryEventToState</span><span class="token punctuation">(</span>
      <span class="token class-name">SelectCategory</span> event<span class="token punctuation">,</span> <span class="token class-name">Emitter</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CategoryState</span><span class="token punctuation">&gt;</span></span> emit<span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token punctuation">{</span>
    <span class="token function">emit</span><span class="token punctuation">(</span>
      state<span class="token punctuation">.</span><span class="token function">copyWith</span><span class="token punctuation">(</span>
        status<span class="token punctuation">:</span> <span class="token class-name">CategoryStatus</span><span class="token punctuation">.</span>selected<span class="token punctuation">,</span>
        idSelected<span class="token punctuation">:</span> event<span class="token punctuation">.</span>idSelected<span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>现在……我如何检查视图中的状态？<br>好吧，当发出一个状态时，我想用相应的数据重建视图。为此，在我看来，我有一个 BlocBuilder。<br>在这种情况下，我只想在当前状态成功时重建视图，因此我使用 buildWhen() 来实现（第 11 行）。</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'package:flutter/material.dart'</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'package:flutter_bloc/flutter_bloc.dart'</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'package:infogames/ui/home/widgets/category_widget/category_barrel.dart'</span></span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">CategoriesWidget</span> <span class="token keyword">extends</span> <span class="token class-name">StatelessWidget</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token class-name">CategoriesWidget</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token class-name">Key</span><span class="token operator">?</span> key<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword">super</span><span class="token punctuation">(</span>key<span class="token punctuation">:</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token metadata function">@override</span>
  <span class="token class-name">Widget</span> <span class="token function">build</span><span class="token punctuation">(</span><span class="token class-name">BuildContext</span> context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token class-name">BlocBuilder</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CategoryBloc</span><span class="token punctuation">,</span> <span class="token class-name">CategoryState</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>
      buildWhen<span class="token punctuation">:</span> <span class="token punctuation">(</span>previous<span class="token punctuation">,</span> current<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> current<span class="token punctuation">.</span>status<span class="token punctuation">.</span>isSuccess<span class="token punctuation">,</span>
      builder<span class="token punctuation">:</span> <span class="token punctuation">(</span>context<span class="token punctuation">,</span> state<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">CategoriesSuccessWidget</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>很酷，当显示此小部件时，用户将能够单击其中一个类别，当这些发生时，我将添加两个事件：<br>GetGamesByCategory ：按类型过滤游戏。这将由另一个块处理：GamesByCategoryBloc（第 26 行）。我很快就会谈到这个bloc。<br>SelectCategory：在视图中更改所选项目的颜色和大小。这将使用相同的块处理：CategoryBloc（第 32 行）。</p><p>来看下完整的类。</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'package:flutter/material.dart'</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'package:flutter_bloc/flutter_bloc.dart'</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'package:infogames/repository/models/genre.dart'</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'package:infogames/ui/home/widgets/category_widget/category_barrel.dart'</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'package:infogames/ui/home/widgets/games_by_category_widget/games_by_category_barrel.dart'</span></span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">CategoriesSuccessWidget</span> <span class="token keyword">extends</span> <span class="token class-name">StatelessWidget</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token class-name">CategoriesSuccessWidget</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token class-name">Key</span><span class="token operator">?</span> key<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword">super</span><span class="token punctuation">(</span>key<span class="token punctuation">:</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token metadata function">@override</span>
  <span class="token class-name">Widget</span> <span class="token function">build</span><span class="token punctuation">(</span><span class="token class-name">BuildContext</span> context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token class-name">BlocBuilder</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CategoryBloc</span><span class="token punctuation">,</span> <span class="token class-name">CategoryState</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>
      builder<span class="token punctuation">:</span> <span class="token punctuation">(</span>context<span class="token punctuation">,</span> state<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">SizedBox</span><span class="token punctuation">(</span>
          height<span class="token punctuation">:</span> <span class="token class-name">MediaQuery</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">.</span>size<span class="token punctuation">.</span>height <span class="token operator">*</span> <span class="token number">.15</span><span class="token punctuation">,</span>
          child<span class="token punctuation">:</span> <span class="token class-name">ListView</span><span class="token punctuation">.</span><span class="token function">separated</span><span class="token punctuation">(</span>
            padding<span class="token punctuation">:</span> <span class="token keyword">const</span> <span class="token class-name">EdgeInsets</span><span class="token punctuation">.</span><span class="token function">symmetric</span><span class="token punctuation">(</span>horizontal<span class="token punctuation">:</span> <span class="token number">16.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            shrinkWrap<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
            itemBuilder<span class="token punctuation">:</span> <span class="token punctuation">(</span>context<span class="token punctuation">,</span> index<span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token keyword">return</span> <span class="token class-name">CategoryItem</span><span class="token punctuation">(</span>
                key<span class="token punctuation">:</span> <span class="token class-name">ValueKey</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">'</span><span class="token interpolation"><span class="token punctuation">${</span><span class="token expression">state<span class="token punctuation">.</span>categories<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">.</span>name</span><span class="token punctuation">}</span></span><span class="token interpolation"><span class="token punctuation">$</span><span class="token expression">index</span></span><span class="token string">'</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                category<span class="token punctuation">:</span> state<span class="token punctuation">.</span>categories<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">,</span>
                callback<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token class-name">Genre</span> categorySelected<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                  context<span class="token punctuation">.</span>read<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">GamesByCategoryBloc</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>
                        <span class="token class-name">GetGamesByCategory</span><span class="token punctuation">(</span>
                          idSelected<span class="token punctuation">:</span> categorySelected<span class="token punctuation">.</span>id<span class="token punctuation">,</span>
                          categoryName<span class="token punctuation">:</span> categorySelected<span class="token punctuation">.</span>name <span class="token operator">?</span><span class="token operator">?</span> <span class="token string-literal"><span class="token string">''</span></span><span class="token punctuation">,</span>
                        <span class="token punctuation">)</span><span class="token punctuation">,</span>
                      <span class="token punctuation">)</span><span class="token punctuation">;</span>
                  context<span class="token punctuation">.</span>read<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CategoryBloc</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>
                        <span class="token class-name">SelectCategory</span><span class="token punctuation">(</span>
                          idSelected<span class="token punctuation">:</span> categorySelected<span class="token punctuation">.</span>id<span class="token punctuation">,</span>
                        <span class="token punctuation">)</span><span class="token punctuation">,</span>
                      <span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
              <span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            scrollDirection<span class="token punctuation">:</span> <span class="token class-name">Axis</span><span class="token punctuation">.</span>horizontal<span class="token punctuation">,</span>
            separatorBuilder<span class="token punctuation">:</span> <span class="token punctuation">(</span>_<span class="token punctuation">,</span> __<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token class-name">SizedBox</span><span class="token punctuation">(</span>
              width<span class="token punctuation">:</span> <span class="token number">16.0</span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
            itemCount<span class="token punctuation">:</span> state<span class="token punctuation">.</span>categories<span class="token punctuation">.</span>length<span class="token punctuation">,</span>
          <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>让我们看一下 state.isSelected 时的视图（选择类别时）。<br>我使用 BlocSelector 来控制这种情况，当用户单击其中一个类别时，将触发事件并且该 bloc 将发出带有所选类别 id 的状态 isSelected，因此在 bloc选择器，我必须检查这些条件是否为真（第 24 行）以使用新的大小和颜色重建视图（第 35、36 和 39 行）。</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'package:flutter/material.dart'</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'package:flutter_bloc/flutter_bloc.dart'</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'package:infogames/repository/models/genre.dart'</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'package:infogames/ui/home/widgets/category_widget/category_barrel.dart'</span></span><span class="token punctuation">;</span>

<span class="token keyword">typedef</span> <span class="token class-name">CategoryCLicked</span> <span class="token operator">=</span> <span class="token class-name">Function</span><span class="token punctuation">(</span><span class="token class-name">Genre</span> categorySelected<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">CategoryItem</span> <span class="token keyword">extends</span> <span class="token class-name">StatelessWidget</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token class-name">CategoryItem</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token class-name">Key</span><span class="token operator">?</span> key<span class="token punctuation">,</span>
    required <span class="token keyword">this</span><span class="token punctuation">.</span>category<span class="token punctuation">,</span>
    required <span class="token keyword">this</span><span class="token punctuation">.</span>callback<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword">super</span><span class="token punctuation">(</span>key<span class="token punctuation">:</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">final</span> <span class="token class-name">Genre</span> category<span class="token punctuation">;</span>
  <span class="token keyword">final</span> <span class="token class-name">CategoryCLicked</span> callback<span class="token punctuation">;</span>

  <span class="token metadata function">@override</span>
  <span class="token class-name">Widget</span> <span class="token function">build</span><span class="token punctuation">(</span><span class="token class-name">BuildContext</span> context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token class-name">GestureDetector</span><span class="token punctuation">(</span>
      onTap<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">callback</span><span class="token punctuation">(</span>category<span class="token punctuation">)</span><span class="token punctuation">,</span>
      child<span class="token punctuation">:</span> <span class="token class-name">BlocSelector</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CategoryBloc</span><span class="token punctuation">,</span> <span class="token class-name">CategoryState</span><span class="token punctuation">,</span> bool<span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>
        selector<span class="token punctuation">:</span> <span class="token punctuation">(</span>state<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span>
            <span class="token punctuation">(</span>state<span class="token punctuation">.</span>status<span class="token punctuation">.</span>isSelected <span class="token operator">&amp;&amp;</span> state<span class="token punctuation">.</span>idSelected <span class="token operator">==</span> category<span class="token punctuation">.</span>id<span class="token punctuation">)</span>
                <span class="token operator">?</span> <span class="token boolean">true</span>
                <span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        builder<span class="token punctuation">:</span> <span class="token punctuation">(</span>context<span class="token punctuation">,</span> state<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> <span class="token class-name">Column</span><span class="token punctuation">(</span>
            children<span class="token punctuation">:</span> <span class="token punctuation">[</span>
              <span class="token class-name">AnimatedContainer</span><span class="token punctuation">(</span>
                duration<span class="token punctuation">:</span> <span class="token keyword">const</span> <span class="token class-name">Duration</span><span class="token punctuation">(</span>milliseconds<span class="token punctuation">:</span> <span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                curve<span class="token punctuation">:</span> <span class="token class-name">Curves</span><span class="token punctuation">.</span>easeInOutCirc<span class="token punctuation">,</span>
                padding<span class="token punctuation">:</span> <span class="token keyword">const</span> <span class="token class-name">EdgeInsets</span><span class="token punctuation">.</span><span class="token function">symmetric</span><span class="token punctuation">(</span>horizontal<span class="token punctuation">:</span> <span class="token number">2.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                alignment<span class="token punctuation">:</span> <span class="token class-name">Alignment</span><span class="token punctuation">.</span>center<span class="token punctuation">,</span>
                height<span class="token punctuation">:</span> state <span class="token operator">?</span> <span class="token number">70.0</span> <span class="token punctuation">:</span> <span class="token number">60.0</span><span class="token punctuation">,</span>
                width<span class="token punctuation">:</span> state <span class="token operator">?</span> <span class="token number">70.0</span> <span class="token punctuation">:</span> <span class="token number">60.0</span><span class="token punctuation">,</span>
                decoration<span class="token punctuation">:</span> <span class="token class-name">BoxDecoration</span><span class="token punctuation">(</span>
                  shape<span class="token punctuation">:</span> <span class="token class-name">BoxShape</span><span class="token punctuation">.</span>circle<span class="token punctuation">,</span>
                  color<span class="token punctuation">:</span> state <span class="token operator">?</span> <span class="token class-name">Colors</span><span class="token punctuation">.</span>deepOrangeAccent <span class="token punctuation">:</span> <span class="token class-name">Colors</span><span class="token punctuation">.</span>amberAccent<span class="token punctuation">,</span>
                <span class="token punctuation">)</span><span class="token punctuation">,</span>
                child<span class="token punctuation">:</span> <span class="token class-name">Icon</span><span class="token punctuation">(</span>
                  <span class="token class-name">Icons</span><span class="token punctuation">.</span>gamepad_outlined<span class="token punctuation">,</span>
                <span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token class-name">SizedBox</span><span class="token punctuation">(</span>height<span class="token punctuation">:</span> <span class="token number">4.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token class-name">Container</span><span class="token punctuation">(</span>
                width<span class="token punctuation">:</span> <span class="token number">60</span><span class="token punctuation">,</span>
                child<span class="token punctuation">:</span> <span class="token class-name">Text</span><span class="token punctuation">(</span>
                  category<span class="token punctuation">.</span>name <span class="token operator">?</span><span class="token operator">?</span> <span class="token string-literal"><span class="token string">''</span></span><span class="token punctuation">,</span>
                  style<span class="token punctuation">:</span> <span class="token class-name">TextStyle</span><span class="token punctuation">(</span>
                      fontSize<span class="token punctuation">:</span> <span class="token number">10.0</span><span class="token punctuation">,</span>
                      fontWeight<span class="token punctuation">:</span> <span class="token class-name">FontWeight</span><span class="token punctuation">.</span>bold<span class="token punctuation">,</span>
                      color<span class="token punctuation">:</span> <span class="token class-name">Colors</span><span class="token punctuation">.</span>black87<span class="token punctuation">)</span><span class="token punctuation">,</span>
                  textAlign<span class="token punctuation">:</span> <span class="token class-name">TextAlign</span><span class="token punctuation">.</span>center<span class="token punctuation">,</span>
                  maxLines<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
                  overflow<span class="token punctuation">:</span> <span class="token class-name">TextOverflow</span><span class="token punctuation">.</span>ellipsis<span class="token punctuation">,</span>
                <span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token punctuation">)</span>
            <span class="token punctuation">]</span><span class="token punctuation">,</span>
          <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="GameByCategoryWidget"><a href="#GameByCategoryWidget" class="headerlink" title="GameByCategoryWidget"></a>GameByCategoryWidget</h2><h3 id="GameByCategoryEvent"><a href="#GameByCategoryEvent" class="headerlink" title="GameByCategoryEvent"></a>GameByCategoryEvent</h3><p>在这里，我创建了一个事件来按类别过滤所有游戏，并添加了类别名称以将其显示为列表的标题。</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token keyword">part</span> of <span class="token string-literal"><span class="token string">'games_by_category_bloc.dart'</span></span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">GamesByCategoryEvent</span> <span class="token keyword">extends</span> <span class="token class-name">Equatable</span> <span class="token punctuation">{</span>
  <span class="token metadata function">@override</span>
  <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">get</span> props <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">GetGamesByCategory</span> <span class="token keyword">extends</span> <span class="token class-name">GamesByCategoryEvent</span> <span class="token punctuation">{</span>
  <span class="token class-name">GetGamesByCategory</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    required <span class="token keyword">this</span><span class="token punctuation">.</span>idSelected<span class="token punctuation">,</span>
    required <span class="token keyword">this</span><span class="token punctuation">.</span>categoryName<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">final</span> int idSelected<span class="token punctuation">;</span>
  <span class="token keyword">final</span> <span class="token class-name">String</span> categoryName<span class="token punctuation">;</span>

  <span class="token metadata function">@override</span>
  <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">get</span> props <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span>idSelected<span class="token punctuation">,</span> categoryName<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="GameByCategoryState"><a href="#GameByCategoryState" class="headerlink" title="GameByCategoryState"></a>GameByCategoryState</h3><p>和之前的状态类一样，这里我有一个扩展来检查不同的状态，还有一个 copyWith 方法来创建游戏列表和类别名称的新副本。</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token keyword">part</span> of <span class="token string-literal"><span class="token string">'games_by_category_bloc.dart'</span></span><span class="token punctuation">;</span>

<span class="token keyword">enum</span> <span class="token class-name">GamesByCategoryStatus</span> <span class="token punctuation">{</span> initial<span class="token punctuation">,</span> success<span class="token punctuation">,</span> error<span class="token punctuation">,</span> loading <span class="token punctuation">}</span>

<span class="token keyword">extension</span> <span class="token class-name">GamesByCategoryStatusX</span> <span class="token keyword">on</span> <span class="token class-name">GamesByCategoryStatus</span> <span class="token punctuation">{</span>
  bool <span class="token keyword">get</span> isInitial <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token keyword">this</span> <span class="token operator">==</span> <span class="token class-name">GamesByCategoryStatus</span><span class="token punctuation">.</span>initial<span class="token punctuation">;</span>
  bool <span class="token keyword">get</span> isSuccess <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token keyword">this</span> <span class="token operator">==</span> <span class="token class-name">GamesByCategoryStatus</span><span class="token punctuation">.</span>success<span class="token punctuation">;</span>
  bool <span class="token keyword">get</span> isError <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token keyword">this</span> <span class="token operator">==</span> <span class="token class-name">GamesByCategoryStatus</span><span class="token punctuation">.</span>error<span class="token punctuation">;</span>
  bool <span class="token keyword">get</span> isLoading <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token keyword">this</span> <span class="token operator">==</span> <span class="token class-name">GamesByCategoryStatus</span><span class="token punctuation">.</span>loading<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">GamesByCategoryState</span> <span class="token keyword">extends</span> <span class="token class-name">Equatable</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token class-name">GamesByCategoryState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token class-name">GamesByCategoryStatus</span><span class="token punctuation">.</span>initial<span class="token punctuation">,</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Result</span><span class="token punctuation">&gt;</span></span><span class="token operator">?</span> games<span class="token punctuation">,</span>
    <span class="token class-name">String</span><span class="token operator">?</span> categoryName<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>  <span class="token punctuation">:</span> games <span class="token operator">=</span> games <span class="token operator">?</span><span class="token operator">?</span> <span class="token keyword">const</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        categoryName <span class="token operator">=</span> categoryName <span class="token operator">?</span><span class="token operator">?</span> <span class="token string-literal"><span class="token string">''</span></span><span class="token punctuation">;</span>

  <span class="token keyword">final</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Result</span><span class="token punctuation">&gt;</span></span> games<span class="token punctuation">;</span>
  <span class="token keyword">final</span> <span class="token class-name">GamesByCategoryStatus</span> status<span class="token punctuation">;</span>
  <span class="token keyword">final</span> <span class="token class-name">String</span> categoryName<span class="token punctuation">;</span>

  <span class="token metadata function">@override</span>
  <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">get</span> props <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span>status<span class="token punctuation">,</span> games<span class="token punctuation">,</span> categoryName<span class="token punctuation">]</span><span class="token punctuation">;</span>

  <span class="token class-name">GamesByCategoryState</span> <span class="token function">copyWith</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Result</span><span class="token punctuation">&gt;</span></span><span class="token operator">?</span> games<span class="token punctuation">,</span>
    <span class="token class-name">GamesByCategoryStatus</span><span class="token operator">?</span> status<span class="token punctuation">,</span>
    <span class="token class-name">String</span><span class="token operator">?</span> categoryName<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token class-name">GamesByCategoryState</span><span class="token punctuation">(</span>
      games<span class="token punctuation">:</span> games <span class="token operator">?</span><span class="token operator">?</span> <span class="token keyword">this</span><span class="token punctuation">.</span>games<span class="token punctuation">,</span>
      status<span class="token punctuation">:</span> status <span class="token operator">?</span><span class="token operator">?</span> <span class="token keyword">this</span><span class="token punctuation">.</span>status<span class="token punctuation">,</span>
      categoryName<span class="token punctuation">:</span> categoryName <span class="token operator">?</span><span class="token operator">?</span> <span class="token keyword">this</span><span class="token punctuation">.</span>categoryName<span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="GameByCategoryBloc"><a href="#GameByCategoryBloc" class="headerlink" title="GameByCategoryBloc"></a>GameByCategoryBloc</h3><p>在这个块中，我将处理调用存储库的事件 GetGamesByCategory 以获取与该类型 ID 匹配的所有游戏。当存储库返回有效数据时，bloc将发出成功的消息，例如状态和列表的新副本以及类别名称，相反，如果结果无效，则bloc将发出错误状态。</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'package:equatable/equatable.dart'</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'package:flutter_bloc/flutter_bloc.dart'</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'package:infogames/repository/game_repository.dart'</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'package:infogames/repository/models/model_barrel.dart'</span></span><span class="token punctuation">;</span>

<span class="token keyword">part</span> <span class="token string-literal"><span class="token string">'games_by_category_event.dart'</span></span><span class="token punctuation">;</span>
<span class="token keyword">part</span> <span class="token string-literal"><span class="token string">'games_by_category_state.dart'</span></span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">GamesByCategoryBloc</span>
    <span class="token keyword">extends</span> <span class="token class-name">Bloc</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">GamesByCategoryEvent</span><span class="token punctuation">,</span> <span class="token class-name">GamesByCategoryState</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
  <span class="token class-name">GamesByCategoryBloc</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    required <span class="token keyword">this</span><span class="token punctuation">.</span>gameRepository<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token class-name">GamesByCategoryState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">on</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">GetGamesByCategory</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>_mapGetGamesByCategoryEventToState<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">final</span> <span class="token class-name">GameRepository</span> gameRepository<span class="token punctuation">;</span>

  <span class="token keyword">void</span> <span class="token function">_mapGetGamesByCategoryEventToState</span><span class="token punctuation">(</span>
      <span class="token class-name">GetGamesByCategory</span> event<span class="token punctuation">,</span> <span class="token class-name">Emitter</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">GamesByCategoryState</span><span class="token punctuation">&gt;</span></span> emit<span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      <span class="token function">emit</span><span class="token punctuation">(</span>state<span class="token punctuation">.</span><span class="token function">copyWith</span><span class="token punctuation">(</span>status<span class="token punctuation">:</span> <span class="token class-name">GamesByCategoryStatus</span><span class="token punctuation">.</span>loading<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token keyword">final</span> gamesByCategory <span class="token operator">=</span>
          <span class="token keyword">await</span> gameRepository<span class="token punctuation">.</span><span class="token function">getGamesByCategory</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>idSelected<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">emit</span><span class="token punctuation">(</span>
        state<span class="token punctuation">.</span><span class="token function">copyWith</span><span class="token punctuation">(</span>
          status<span class="token punctuation">:</span> <span class="token class-name">GamesByCategoryStatus</span><span class="token punctuation">.</span>success<span class="token punctuation">,</span>
          games<span class="token punctuation">:</span> gamesByCategory<span class="token punctuation">,</span>
          categoryName<span class="token punctuation">:</span> event<span class="token punctuation">.</span>categoryName<span class="token punctuation">,</span>
        <span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">emit</span><span class="token punctuation">(</span>state<span class="token punctuation">.</span><span class="token function">copyWith</span><span class="token punctuation">(</span>status<span class="token punctuation">:</span> <span class="token class-name">GamesByCategoryStatus</span><span class="token punctuation">.</span>error<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>完美，下一步是检查视图中的状态以对它们做出反应。</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'package:flutter/material.dart'</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'package:flutter_bloc/flutter_bloc.dart'</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'package:infogames/ui/widgets/error_widget.dart'</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'games_by_category_barrel.dart'</span></span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">GamesByCategoryWidget</span> <span class="token keyword">extends</span> <span class="token class-name">StatelessWidget</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token class-name">GamesByCategoryWidget</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token class-name">Key</span><span class="token operator">?</span> key<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword">super</span><span class="token punctuation">(</span>key<span class="token punctuation">:</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token metadata function">@override</span>
  <span class="token class-name">Widget</span> <span class="token function">build</span><span class="token punctuation">(</span><span class="token class-name">BuildContext</span> context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token class-name">BlocBuilder</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">GamesByCategoryBloc</span><span class="token punctuation">,</span> <span class="token class-name">GamesByCategoryState</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>
      builder<span class="token punctuation">:</span> <span class="token punctuation">(</span>context<span class="token punctuation">,</span> state<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> state<span class="token punctuation">.</span>status<span class="token punctuation">.</span>isSuccess
            <span class="token operator">?</span> <span class="token class-name">GameByCategorySuccessWidget</span><span class="token punctuation">(</span>
                categoryName<span class="token punctuation">:</span> state<span class="token punctuation">.</span>categoryName<span class="token punctuation">,</span>
                games<span class="token punctuation">:</span> state<span class="token punctuation">.</span>games<span class="token punctuation">,</span>
              <span class="token punctuation">)</span>
            <span class="token punctuation">:</span> state<span class="token punctuation">.</span>status<span class="token punctuation">.</span>isLoading
                <span class="token operator">?</span> <span class="token class-name">Center</span><span class="token punctuation">(</span>
                    child<span class="token punctuation">:</span> <span class="token class-name">CircularProgressIndicator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                  <span class="token punctuation">)</span>
                <span class="token punctuation">:</span> state<span class="token punctuation">.</span>status<span class="token punctuation">.</span>isError
                    <span class="token operator">?</span> <span class="token class-name">ErrorGameWidget</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token punctuation">:</span> <span class="token keyword">const</span> <span class="token class-name">SizedBox</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>如您所见，我根据状态使用三个选项处理视图：</p><ul><li>错误：显示常见错误小部件。</li><li>正在加载：显示 CircularProgressIndicator。</li><li>成功：显示 GameByCategorySuccessWidget。这个小部件负责按类别显示游戏列表。<br>这是小部件：</li></ul><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'package:flutter/material.dart'</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'package:infogames/repository/models/result.dart'</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'package:infogames/ui/home/widgets/games_by_category_widget/games_by_category_barrel.dart'</span></span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">GameByCategorySuccessWidget</span> <span class="token keyword">extends</span> <span class="token class-name">StatelessWidget</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token class-name">GameByCategorySuccessWidget</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token class-name">Key</span><span class="token operator">?</span> key<span class="token punctuation">,</span>
    required <span class="token keyword">this</span><span class="token punctuation">.</span>categoryName<span class="token punctuation">,</span>
    required <span class="token keyword">this</span><span class="token punctuation">.</span>games<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword">super</span><span class="token punctuation">(</span>key<span class="token punctuation">:</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">final</span> <span class="token class-name">String</span> categoryName<span class="token punctuation">;</span>
  <span class="token keyword">final</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Result</span><span class="token punctuation">&gt;</span></span> games<span class="token punctuation">;</span>

  <span class="token metadata function">@override</span>
  <span class="token class-name">Widget</span> <span class="token function">build</span><span class="token punctuation">(</span><span class="token class-name">BuildContext</span> context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token class-name">Column</span><span class="token punctuation">(</span>
      crossAxisAlignment<span class="token punctuation">:</span> <span class="token class-name">CrossAxisAlignment</span><span class="token punctuation">.</span>start<span class="token punctuation">,</span>
      children<span class="token punctuation">:</span> <span class="token punctuation">[</span>
        <span class="token class-name">Padding</span><span class="token punctuation">(</span>
          padding<span class="token punctuation">:</span> <span class="token keyword">const</span> <span class="token class-name">EdgeInsets</span><span class="token punctuation">.</span><span class="token function">only</span><span class="token punctuation">(</span>
            left<span class="token punctuation">:</span> <span class="token number">24.0</span><span class="token punctuation">,</span>
            bottom<span class="token punctuation">:</span> <span class="token number">16.0</span><span class="token punctuation">,</span>
          <span class="token punctuation">)</span><span class="token punctuation">,</span>
          child<span class="token punctuation">:</span> <span class="token class-name">Text</span><span class="token punctuation">(</span>
            categoryName<span class="token punctuation">,</span>
            style<span class="token punctuation">:</span> <span class="token class-name">TextStyle</span><span class="token punctuation">(</span>
              fontWeight<span class="token punctuation">:</span> <span class="token class-name">FontWeight</span><span class="token punctuation">.</span>bold<span class="token punctuation">,</span>
              fontSize<span class="token punctuation">:</span> <span class="token number">18.0</span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token class-name">Container</span><span class="token punctuation">(</span>
          height<span class="token punctuation">:</span> <span class="token class-name">MediaQuery</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">.</span>size<span class="token punctuation">.</span>height <span class="token operator">*</span> <span class="token number">.2</span><span class="token punctuation">,</span>
          child<span class="token punctuation">:</span> <span class="token class-name">ListView</span><span class="token punctuation">.</span><span class="token function">separated</span><span class="token punctuation">(</span>
            padding<span class="token punctuation">:</span> <span class="token keyword">const</span> <span class="token class-name">EdgeInsets</span><span class="token punctuation">.</span><span class="token function">only</span><span class="token punctuation">(</span>
              left<span class="token punctuation">:</span> <span class="token number">24.0</span><span class="token punctuation">,</span>
              right<span class="token punctuation">:</span> <span class="token number">24.0</span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
            scrollDirection<span class="token punctuation">:</span> <span class="token class-name">Axis</span><span class="token punctuation">.</span>horizontal<span class="token punctuation">,</span>
            itemBuilder<span class="token punctuation">:</span> <span class="token punctuation">(</span>context<span class="token punctuation">,</span> index<span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token keyword">return</span> <span class="token class-name">GameByCategoryImage</span><span class="token punctuation">(</span>
                name<span class="token punctuation">:</span> games<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">.</span>name <span class="token operator">?</span><span class="token operator">?</span> <span class="token string-literal"><span class="token string">'No data'</span></span><span class="token punctuation">,</span>
                backgroundImage<span class="token punctuation">:</span> games<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">.</span>backgroundImage <span class="token operator">?</span><span class="token operator">?</span> <span class="token string-literal"><span class="token string">''</span></span><span class="token punctuation">,</span>
              <span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            separatorBuilder<span class="token punctuation">:</span> <span class="token punctuation">(</span>_<span class="token punctuation">,</span> __<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token class-name">SizedBox</span><span class="token punctuation">(</span>
              width<span class="token punctuation">:</span> <span class="token number">25.0</span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
            itemCount<span class="token punctuation">:</span> games<span class="token punctuation">.</span>length<span class="token punctuation">,</span>
          <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>最后是主布局的最后一部分，AllGamesWidget。</p><h2 id="AllGamesWidget"><a href="#AllGamesWidget" class="headerlink" title="AllGamesWidget"></a>AllGamesWidget</h2><h3 id="AllGamesEvent"><a href="#AllGamesEvent" class="headerlink" title="AllGamesEvent"></a>AllGamesEvent</h3><p>我创建了一个事件来从 API 获取所有游戏。</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token keyword">part</span> of <span class="token string-literal"><span class="token string">'all_games_bloc.dart'</span></span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">AllGamesEvent</span> <span class="token keyword">extends</span> <span class="token class-name">Equatable</span> <span class="token punctuation">{</span>
  <span class="token metadata function">@override</span>
  <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">get</span> props <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">GetGames</span> <span class="token keyword">extends</span> <span class="token class-name">AllGamesEvent</span> <span class="token punctuation">{</span>
  <span class="token metadata function">@override</span>
  <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">get</span> props <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="AllGamesState"><a href="#AllGamesState" class="headerlink" title="AllGamesState"></a>AllGamesState</h3><p>和之前一样，我创建了一个扩展来处理所有可能的状态，并且我还有一个 copyWith 方法可以在需要时创建对象的新副本。</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token keyword">part</span> of <span class="token string-literal"><span class="token string">'all_games_bloc.dart'</span></span><span class="token punctuation">;</span>

<span class="token keyword">enum</span> <span class="token class-name">AllGamesStatus</span> <span class="token punctuation">{</span> initial<span class="token punctuation">,</span> success<span class="token punctuation">,</span> error<span class="token punctuation">,</span> loading <span class="token punctuation">}</span>

<span class="token keyword">extension</span> <span class="token class-name">AllGamesStatusX</span> <span class="token keyword">on</span> <span class="token class-name">AllGamesStatus</span> <span class="token punctuation">{</span>
  bool <span class="token keyword">get</span> isInitial <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token keyword">this</span> <span class="token operator">==</span> <span class="token class-name">AllGamesStatus</span><span class="token punctuation">.</span>initial<span class="token punctuation">;</span>
  bool <span class="token keyword">get</span> isSuccess <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token keyword">this</span> <span class="token operator">==</span> <span class="token class-name">AllGamesStatus</span><span class="token punctuation">.</span>success<span class="token punctuation">;</span>
  bool <span class="token keyword">get</span> isError <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token keyword">this</span> <span class="token operator">==</span> <span class="token class-name">AllGamesStatus</span><span class="token punctuation">.</span>error<span class="token punctuation">;</span>
  bool <span class="token keyword">get</span> isLoading <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token keyword">this</span> <span class="token operator">==</span> <span class="token class-name">AllGamesStatus</span><span class="token punctuation">.</span>loading<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">AllGamesState</span> <span class="token keyword">extends</span> <span class="token class-name">Equatable</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token class-name">AllGamesState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token class-name">AllGamesStatus</span><span class="token punctuation">.</span>initial<span class="token punctuation">,</span>
    <span class="token class-name">Game</span><span class="token operator">?</span> games<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> games <span class="token operator">=</span> games <span class="token operator">?</span><span class="token operator">?</span> <span class="token class-name">Game</span><span class="token punctuation">.</span>empty<span class="token punctuation">;</span>

  <span class="token keyword">final</span> <span class="token class-name">Game</span> games<span class="token punctuation">;</span>
  <span class="token keyword">final</span> <span class="token class-name">AllGamesStatus</span> status<span class="token punctuation">;</span>

  <span class="token metadata function">@override</span>
  <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">get</span> props <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span>status<span class="token punctuation">,</span> games<span class="token punctuation">]</span><span class="token punctuation">;</span>

  <span class="token class-name">AllGamesState</span> <span class="token function">copyWith</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token class-name">Game</span><span class="token operator">?</span> games<span class="token punctuation">,</span>
    <span class="token class-name">AllGamesStatus</span><span class="token operator">?</span> status<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token class-name">AllGamesState</span><span class="token punctuation">(</span>
      games<span class="token punctuation">:</span> games <span class="token operator">?</span><span class="token operator">?</span> <span class="token keyword">this</span><span class="token punctuation">.</span>games<span class="token punctuation">,</span>
      status<span class="token punctuation">:</span> status <span class="token operator">?</span><span class="token operator">?</span> <span class="token keyword">this</span><span class="token punctuation">.</span>status<span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="AllGamesBloc"><a href="#AllGamesBloc" class="headerlink" title="AllGamesBloc"></a>AllGamesBloc</h3><p>在这里，我调用存储库，当它返回有效数据时，bloc 将通过游戏列表的副本发出成功，相反，如果存储库返回无效数据，bloc 将发出错误状态。</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'package:equatable/equatable.dart'</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'package:flutter_bloc/flutter_bloc.dart'</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'package:infogames/repository/game_repository.dart'</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'package:infogames/repository/models/model_barrel.dart'</span></span><span class="token punctuation">;</span>

<span class="token keyword">part</span> <span class="token string-literal"><span class="token string">'all_games_event.dart'</span></span><span class="token punctuation">;</span>
<span class="token keyword">part</span> <span class="token string-literal"><span class="token string">'all_games_state.dart'</span></span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">AllGamesBloc</span> <span class="token keyword">extends</span> <span class="token class-name">Bloc</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AllGamesEvent</span><span class="token punctuation">,</span> <span class="token class-name">AllGamesState</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
  <span class="token class-name">AllGamesBloc</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    required <span class="token keyword">this</span><span class="token punctuation">.</span>gameRepository<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token class-name">AllGamesState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">on</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">GetGames</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>_mapGetGamesEventToState<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">final</span> <span class="token class-name">GameRepository</span> gameRepository<span class="token punctuation">;</span>

  <span class="token keyword">void</span> <span class="token function">_mapGetGamesEventToState</span><span class="token punctuation">(</span>
      <span class="token class-name">GetGames</span> event<span class="token punctuation">,</span> <span class="token class-name">Emitter</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AllGamesState</span><span class="token punctuation">&gt;</span></span> emit<span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      <span class="token function">emit</span><span class="token punctuation">(</span>state<span class="token punctuation">.</span><span class="token function">copyWith</span><span class="token punctuation">(</span>status<span class="token punctuation">:</span> <span class="token class-name">AllGamesStatus</span><span class="token punctuation">.</span>loading<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">final</span> games <span class="token operator">=</span> <span class="token keyword">await</span> gameRepository<span class="token punctuation">.</span><span class="token function">getGames</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">emit</span><span class="token punctuation">(</span>
        state<span class="token punctuation">.</span><span class="token function">copyWith</span><span class="token punctuation">(</span>
          status<span class="token punctuation">:</span> <span class="token class-name">AllGamesStatus</span><span class="token punctuation">.</span>success<span class="token punctuation">,</span>
          games<span class="token punctuation">:</span> games<span class="token punctuation">,</span>
        <span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">emit</span><span class="token punctuation">(</span>state<span class="token punctuation">.</span><span class="token function">copyWith</span><span class="token punctuation">(</span>status<span class="token punctuation">:</span> <span class="token class-name">AllGamesStatus</span><span class="token punctuation">.</span>error<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="AllGamesWidget-1"><a href="#AllGamesWidget-1" class="headerlink" title="AllGamesWidget"></a>AllGamesWidget</h3><p>这是所有游戏小部件。在这里，我有一个 BlocBuilder 来根据状态重建视图。</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'package:flutter/material.dart'</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'package:flutter_bloc/flutter_bloc.dart'</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'package:infogames/ui/home/widgets/all_games_widget/all_games_barrel.dart'</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'package:infogames/ui/widgets/error_widget.dart'</span></span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">AllGamesWidget</span> <span class="token keyword">extends</span> <span class="token class-name">StatelessWidget</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token class-name">AllGamesWidget</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token class-name">Key</span><span class="token operator">?</span> key<span class="token punctuation">,</span>
    required <span class="token keyword">this</span><span class="token punctuation">.</span>title<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword">super</span><span class="token punctuation">(</span>key<span class="token punctuation">:</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">final</span> <span class="token class-name">String</span> title<span class="token punctuation">;</span>

  <span class="token metadata function">@override</span>
  <span class="token class-name">Widget</span> <span class="token function">build</span><span class="token punctuation">(</span><span class="token class-name">BuildContext</span> context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token class-name">BlocBuilder</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AllGamesBloc</span><span class="token punctuation">,</span> <span class="token class-name">AllGamesState</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>
      builder<span class="token punctuation">:</span> <span class="token punctuation">(</span>context<span class="token punctuation">,</span> state<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> state<span class="token punctuation">.</span>status<span class="token punctuation">.</span>isSuccess
            <span class="token operator">?</span> <span class="token class-name">AllGamesSuccessWidget</span><span class="token punctuation">(</span>
                title<span class="token punctuation">:</span> title<span class="token punctuation">,</span>
                games<span class="token punctuation">:</span> state<span class="token punctuation">.</span>games<span class="token punctuation">.</span>results<span class="token punctuation">,</span>
              <span class="token punctuation">)</span>
            <span class="token punctuation">:</span> state<span class="token punctuation">.</span>status<span class="token punctuation">.</span>isLoading
                <span class="token operator">?</span> <span class="token class-name">Center</span><span class="token punctuation">(</span>
                    child<span class="token punctuation">:</span> <span class="token class-name">CircularProgressIndicator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                  <span class="token punctuation">)</span>
                <span class="token punctuation">:</span> state<span class="token punctuation">.</span>status<span class="token punctuation">.</span>isError
                    <span class="token operator">?</span> <span class="token class-name">ErrorGameWidget</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token punctuation">:</span> <span class="token keyword">const</span> <span class="token class-name">SizedBox</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这些是三种状态：</p><ul><li>错误：显示常见错误小部件。</li><li>正在加载：显示 CircularProgressIndicator。</li><li>成功：显示 AllGamesSuccessWidget。这个小部件负责显示游戏列表。</li></ul><p>这是小部件：</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'package:flutter/material.dart'</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'package:infogames/repository/models/result.dart'</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'package:infogames/ui/home/widgets/all_games_widget/all_games_barrel.dart'</span></span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">AllGamesSuccessWidget</span> <span class="token keyword">extends</span> <span class="token class-name">StatelessWidget</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token class-name">AllGamesSuccessWidget</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token class-name">Key</span><span class="token operator">?</span> key<span class="token punctuation">,</span>
    required <span class="token keyword">this</span><span class="token punctuation">.</span>games<span class="token punctuation">,</span>
    required <span class="token keyword">this</span><span class="token punctuation">.</span>title<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword">super</span><span class="token punctuation">(</span>key<span class="token punctuation">:</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">final</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Result</span><span class="token punctuation">&gt;</span></span> games<span class="token punctuation">;</span>
  <span class="token keyword">final</span> <span class="token class-name">String</span> title<span class="token punctuation">;</span>

  <span class="token metadata function">@override</span>
  <span class="token class-name">Widget</span> <span class="token function">build</span><span class="token punctuation">(</span><span class="token class-name">BuildContext</span> context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token class-name">Column</span><span class="token punctuation">(</span>
      crossAxisAlignment<span class="token punctuation">:</span> <span class="token class-name">CrossAxisAlignment</span><span class="token punctuation">.</span>stretch<span class="token punctuation">,</span>
      children<span class="token punctuation">:</span> <span class="token punctuation">[</span>
        <span class="token class-name">Padding</span><span class="token punctuation">(</span>
          padding<span class="token punctuation">:</span> <span class="token keyword">const</span> <span class="token class-name">EdgeInsets</span><span class="token punctuation">.</span><span class="token function">only</span><span class="token punctuation">(</span>left<span class="token punctuation">:</span> <span class="token number">24.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          child<span class="token punctuation">:</span> <span class="token class-name">Text</span><span class="token punctuation">(</span>
            title<span class="token punctuation">,</span>
            style<span class="token punctuation">:</span> <span class="token class-name">TextStyle</span><span class="token punctuation">(</span>
              fontWeight<span class="token punctuation">:</span> <span class="token class-name">FontWeight</span><span class="token punctuation">.</span>bold<span class="token punctuation">,</span>
              fontSize<span class="token punctuation">:</span> <span class="token number">18.0</span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token class-name">Container</span><span class="token punctuation">(</span>
          height<span class="token punctuation">:</span>
              <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">100</span> <span class="token operator">*</span> games<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token class-name">MediaQuery</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">.</span>size<span class="token punctuation">.</span>width<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">24.0</span><span class="token punctuation">,</span>
          child<span class="token punctuation">:</span> <span class="token class-name">ListView</span><span class="token punctuation">.</span><span class="token function">separated</span><span class="token punctuation">(</span>
            physics<span class="token punctuation">:</span> <span class="token class-name">NeverScrollableScrollPhysics</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            padding<span class="token punctuation">:</span> <span class="token keyword">const</span> <span class="token class-name">EdgeInsets</span><span class="token punctuation">.</span><span class="token function">only</span><span class="token punctuation">(</span>
              left<span class="token punctuation">:</span> <span class="token number">24.0</span><span class="token punctuation">,</span>
              right<span class="token punctuation">:</span> <span class="token number">24.0</span><span class="token punctuation">,</span>
              top<span class="token punctuation">:</span> <span class="token number">24.0</span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
            itemBuilder<span class="token punctuation">:</span> <span class="token punctuation">(</span>context<span class="token punctuation">,</span> index<span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token keyword">return</span> <span class="token class-name">AllGamesItem</span><span class="token punctuation">(</span>
                game<span class="token punctuation">:</span> games<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">,</span>
              <span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            separatorBuilder<span class="token punctuation">:</span> <span class="token punctuation">(</span>_<span class="token punctuation">,</span> __<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token class-name">SizedBox</span><span class="token punctuation">(</span>
              height<span class="token punctuation">:</span> <span class="token number">20.0</span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
            itemCount<span class="token punctuation">:</span> games<span class="token punctuation">.</span>length<span class="token punctuation">,</span>
          <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="额外的东西🙌"><a href="#额外的东西🙌" class="headerlink" title="额外的东西🙌"></a>额外的东西🙌</h3><p>如果你想有一个日志来知道哪个是当前状态，哪个是下一个要添加的事件，你需要一个 Bloc Observer 类。您应该创建此类并将其初始化到您的主类中。</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token keyword">class</span> <span class="token class-name">AppBlocObserver</span> <span class="token keyword">extends</span> <span class="token class-name">BlocObserver</span> <span class="token punctuation">{</span>
  <span class="token metadata function">@override</span>
  <span class="token keyword">void</span> <span class="token function">onChange</span><span class="token punctuation">(</span><span class="token class-name">BlocBase</span> bloc<span class="token punctuation">,</span> <span class="token class-name">Change</span> change<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onChange</span><span class="token punctuation">(</span>bloc<span class="token punctuation">,</span> change<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>bloc <span class="token operator">is</span> <span class="token class-name">Cubit</span><span class="token punctuation">)</span> <span class="token function">print</span><span class="token punctuation">(</span>change<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token metadata function">@override</span>
  <span class="token keyword">void</span> <span class="token function">onTransition</span><span class="token punctuation">(</span><span class="token class-name">Bloc</span> bloc<span class="token punctuation">,</span> <span class="token class-name">Transition</span> transition<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onTransition</span><span class="token punctuation">(</span>bloc<span class="token punctuation">,</span> transition<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">print</span><span class="token punctuation">(</span>transition<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// main class</span>

<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token punctuation">{</span>
  <span class="token class-name">BlocOverrides</span><span class="token punctuation">.</span><span class="token function">runZoned</span><span class="token punctuation">(</span>
    <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">runApp</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token class-name">MyApp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    blocObserver<span class="token punctuation">:</span> <span class="token class-name">AppBlocObserver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h2><p>必须为您的Flutter应用程序使用良好的状态管理。 Flutter bloc 是一个很好的选择，你可以看到它使用起来并不复杂，而且很容易理解如何使用它的主要概念。此外，它还为您提供了很多管理视图或小部件的方法。<br>就个人而言，我喜欢创建具有特定逻辑的小块，以使我的代码更清晰和可维护，而不是管理很多事情的大块，但如果你的逻辑需要你也可以这样做。</p><p>感谢您阅读本文，我希望您现在可以更好地理解 Flutter bloc 的工作原理，并且能够毫无问题地将这个惊人的库添加到您的项目中。如果这对您有帮助，我将非常感谢您的反馈和鼓掌！👏</p></div><footer class="post-footer"><div class="reward-container"><div>你的鼓励是我更新的动力！</div><button>赞赏</button><div class="post-reward"><div><img src="/images/wechatpay.png" alt="木辛念做梓 微信"> <span>微信</span></div><div><img src="/images/alipay.png" alt="木辛念做梓 支付宝"> <span>支付宝</span></div></div></div><div class="post-tags"><a href="/tags/Flutter/" rel="tag"># Flutter</a> <a href="/tags/Patterns/" rel="tag"># Patterns</a> <a href="/tags/Beginners/" rel="tag"># Beginners</a></div><div class="post-nav"><div class="post-nav-item"><a href="/Architecture-patterns-in-Flutter.html" rel="prev" title="Flutter中的架构模式"><i class="fa fa-chevron-left"></i> Flutter中的架构模式</a></div><div class="post-nav-item"><a href="/A-Deep-Dive-Into-Flutter-TextField.html" rel="next" title="深入了解 Flutter TextField">深入了解 Flutter TextField <i class="fa fa-chevron-right"></i></a></div></div></footer></article></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright">&copy; <span itemprop="copyrightYear">2025</span> <span class="with-love"><i class="fa fa-heart"></i> </span><span class="author" itemprop="copyrightHolder">木辛念做梓</span></div><div class="wordcount"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-chart-line"></i> </span><span>站点总字数：</span> <span title="站点总字数">530k</span> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-coffee"></i> </span><span>站点阅读时长 &asymp;</span> <span title="站点阅读时长">8:02</span></span></div><div class="busuanzi-count"><span class="post-meta-item" id="busuanzi_container_site_uv"><span class="post-meta-item-icon"><i class="fa fa-user"></i> </span><span class="site-uv" title="总访客量"><span id="busuanzi_value_site_uv"></span> </span></span><span class="post-meta-item" id="busuanzi_container_site_pv"><span class="post-meta-item-icon"><i class="fa fa-eye"></i> </span><span class="site-pv" title="总访问量"><span id="busuanzi_value_site_pv"></span></span></span></div><div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动</div></div></footer><script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.6/dist/medium-zoom.min.js" integrity="sha256-EdPgYcPk/IIrw7FYeuJQexva49pVRZNmt3LculEr7zM=" crossorigin="anonymous"></script><script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div class="moon-menu"><div class="moon-menu-items"><div id="moon-menu-item-back2bottom" class="moon-menu-item"><i class="fas fa-chevron-down"></i></div><div id="moon-menu-item-back2top" class="moon-menu-item"><i class="fas fa-chevron-up"></i></div></div><div class="moon-menu-button"><svg class="moon-menu-bg"><circle class="moon-menu-cricle" cx="50%" cy="50%" r="44%"></circle><circle class="moon-menu-border" cx="50%" cy="50%" r="48%"></circle></svg><div class="moon-menu-content"><div class="moon-menu-icon"><i class="fas fa-ellipsis-v"></i></div><div class="moon-menu-text"></div></div></div></div><script src="/js/injector.js"></script></body></html>