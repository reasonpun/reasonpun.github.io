<!DOCTYPE html><html lang=""><head><meta http-equiv="content-type" content="text/html; charset=utf-8"/><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"/><meta content="yes" name="apple-mobile-web-app-capable"/><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"/><meta content="telephone=no" name="format-detection"/><meta name="description" content=""/><title>Docker中搭建Spark计算框架 | Tensor Cell</title><link rel="stylesheet" type="text/css" href="/css/normalize.css"/><link rel="stylesheet" type="text/css" href="/css/pure-min.css"/><link rel="stylesheet" type="text/css" href="/css/grids-responsive-min.css"/><link rel="stylesheet" type="text/css" href="/css/style.css"/><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"/><link rel="apple-touch-icon" href="/apple-touch-icon.png"/><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"/><link rel="alternate" type="application/atom+xml" href="/atom.xml"/></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Docker中搭建Spark计算框架</h1><a id="logo" href="/">Tensor Cell</a><p class="description">还要再走500里</p></div><div id="nav-menu"><a href="/" class="current"><i class="icon-home"> 首页</i></a><a href="/archives/"><i class="icon-archive"> 归档</i></a><a href="/about/"><i class="icon-about"> 关于</i></a><a href="/atom.xml"><i class="icon-rss"> 订阅</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post post-page"><h1 class="post-title">Docker中搭建Spark计算框架</h1><div class="post-meta">2015-12-04 | <span class="categories">分类于<a href="/categories/数据挖掘/"> 数据挖掘</a><a href="/categories/数据挖掘/实时计算/"> 实时计算</a><a href="/categories/数据挖掘/实时计算/虚拟化/"> 虚拟化</a></span></div><span data-disqus-identifier="2015/12/04/spark-in-docker/" class="disqus-comment-count"></span><div class="post-content"><!--  -->
<!--  -->
<!--  _ __    __     __      ____    ___     ___   _____   __  __    ___     -->
<!-- /\`'__\/'__`\ /'__`\   /',__\  / __`\ /' _ `\/\ '__`\/\ \/\ \ /' _ `\   -->
<!-- \ \ \//\  __//\ \L\.\_/\__, `\/\ \L\ \/\ \/\ \ \ \L\ \ \ \_\ \/\ \/\ \  -->
<!--  \ \_\\ \____\ \__/.\_\/\____/\ \____/\ \_\ \_\ \ ,__/\ \____/\ \_\ \_\ -->
<!--   \/_/ \/____/\/__/\/_/\/___/  \/___/  \/_/\/_/\ \ \/  \/___/  \/_/\/_/ -->
<!--                                                 \ \_\                   -->
<!--                                                  \/_/                   -->
<!--  -->
<h4 id="u5B89_u88C5_u597DDocker_u4E4B_u540E"><a href="#u5B89_u88C5_u597DDocker_u4E4B_u540E" class="headerlink" title="安装好Docker之后"></a>安装好Docker之后</h4><h4 id="u5148_u62C9_u53D6_u4E00_u4E2A_u5B98_u65B9_u7684_u57FA_u672C_u955C_u50CFubuntu"><a href="#u5148_u62C9_u53D6_u4E00_u4E2A_u5B98_u65B9_u7684_u57FA_u672C_u955C_u50CFubuntu" class="headerlink" title="先拉取一个官方的基本镜像ubuntu"></a>先拉取一个官方的基本镜像ubuntu</h4><p>docker pull ubuntu</p>
<p>我们将在这个基础镜像上运行容器，将这个容器当成一个普通的ubuntu虚拟机来操作部署spark，最后将配置好的容器commit为一个镜像，之后就可以通过这个镜像运行n个节点来完成集群的搭建</p>
<h4 id="u4E0B_u8F7D_u5B8Cubuntu_u955C_u50CF_u4E4B_u540E_u8FD0_u884C"><a href="#u4E0B_u8F7D_u5B8Cubuntu_u955C_u50CF_u4E4B_u540E_u8FD0_u884C" class="headerlink" title="下载完ubuntu镜像之后运行"></a>下载完ubuntu镜像之后运行</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[reason@localhost ~]$ docker images</span><br><span class="line">REPOSITORY          TAG                 IMAGE ID            CREATED             VIRTUAL SIZE</span><br><span class="line">mofun/spark         v2<span class="number">.0</span>                b2dacac3e132        About an hour ago   <span class="number">1.508</span> GB</span><br><span class="line">mofun/spark         v1<span class="number">.3</span>                <span class="number">4</span>d2f33ca61ee        <span class="number">18</span> hours ago        <span class="number">1.506</span> GB</span><br><span class="line">ubuntu              latest              <span class="number">0</span>a17decee413        <span class="number">6</span> days ago          <span class="number">188.3</span> MB</span><br><span class="line">docker/whalesay     latest              ded5e192a685        <span class="number">4</span> months ago        <span class="number">247</span> MB</span><br><span class="line">[reason@localhost ~]$</span><br></pre></td></tr></table></figure>
<h4 id="u8FD0_u884Cubuntu_u5BB9_u5668"><a href="#u8FD0_u884Cubuntu_u5BB9_u5668" class="headerlink" title="运行ubuntu容器"></a>运行ubuntu容器</h4><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[reason<span class="variable">@localhost</span> ~]<span class="variable">$ </span>docker run -v /home/docker/software/<span class="symbol">:/software</span> -it ubuntu</span><br><span class="line">root<span class="variable">@f4c0a9d42852</span><span class="symbol">:/</span><span class="comment">#</span></span><br></pre></td></tr></table></figure>
<h4 id="u5728_u5BB9_u5668_u4E2D_u5B89_u88C5ssh"><a href="#u5728_u5BB9_u5668_u4E2D_u5B89_u88C5ssh" class="headerlink" title="在容器中安装ssh"></a>在容器中安装ssh</h4><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">[reason<span class="comment">@localhost ~]$ docker run -v /home/docker/software/:/software -it ubuntu</span></span><br><span class="line">root<span class="comment">@3970c1e5466e:/# apt-get install ssh</span></span><br><span class="line">Reading package lists... Done</span><br><span class="line">Building dependency tree</span><br><span class="line">Reading state information... Done</span><br><span class="line"></span><br><span class="line"><span class="comment"># ssh默认配置root无法登陆</span></span><br><span class="line">root<span class="comment">@3970c1e5466e:~/.ssh# vim /etc/ssh/sshd_config</span></span><br><span class="line">root<span class="comment">@3970c1e5466e:~/.ssh#</span></span><br><span class="line"><span class="comment"># 将 /etc/ssh/sshd_config中PermitRootLogin no/without_passwd 改为yes</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 生成访问密钥</span></span><br><span class="line">root<span class="comment">@3970c1e5466e:~# ssh-keygen -t rsa -P '' -f ~/.ssh/id_rsa</span></span><br><span class="line">Generating public/private rsa key pair.</span><br><span class="line">Created directory '/root/.ssh'.</span><br><span class="line">Your identification has been saved in /root/.ssh/id_rsa.</span><br><span class="line">Your public key has been saved in /root/.ssh/id_rsa.pub.</span><br><span class="line">The key fingerprint is:</span><br><span class="line">b5:d1:e1:dd:98:7d:be:cc:55:69:c6:e7:67:80:d8:d3 root<span class="comment">@3970c1e5466e</span></span><br><span class="line">The key's randomart image is:</span><br><span class="line">+--[ RSA 2048]----+</span><br><span class="line">|<span class="string">            .    </span>|</span><br><span class="line">|<span class="string">           = =.=.</span>|</span><br><span class="line">|<span class="string">          + * E=*</span>|</span><br><span class="line">|<span class="string">         . o .o++</span>|</span><br><span class="line">|<span class="string">        S .     *</span>|</span><br><span class="line">|<span class="string">              o.+</span>|</span><br><span class="line">|<span class="string">               + </span>|</span><br><span class="line">|<span class="string">                 </span>|</span><br><span class="line">|<span class="string">                 </span>|</span><br><span class="line">+-----------------+</span><br><span class="line">root<span class="comment">@3970c1e5466e:~#</span></span><br><span class="line">root<span class="comment">@3970c1e5466e:~# cd ~/.ssh/</span></span><br><span class="line">root<span class="comment">@3970c1e5466e:~/.ssh# cat id_rsa.pub &gt;&gt; authorized_keys</span></span><br><span class="line">root<span class="comment">@3970c1e5466e:~/.ssh#</span></span><br><span class="line">root<span class="comment">@3970c1e5466e:~/.ssh# vim ~/.bashrc</span></span><br><span class="line"><span class="comment">#加入/usr/sbin/sshd</span></span><br><span class="line"><span class="comment">#如果在启动容器的时候还是无法启动ssh的话，</span></span><br><span class="line"><span class="comment"># 在/etc/rc.local文件中也加入</span></span><br><span class="line">root<span class="comment">@3970c1e5466e:~/.ssh# vim /etc/rc.local</span></span><br><span class="line"><span class="comment">#加入</span></span><br><span class="line">root<span class="comment">@3970c1e5466e:~/.ssh# /usr/sbin/sshd</span></span><br><span class="line">Missing privilege separation directory: /var/run/sshd</span><br><span class="line">root<span class="comment">@3970c1e5466e:~/.ssh# mkdir /var/run/sshd</span></span><br><span class="line">root<span class="comment">@3970c1e5466e:~/.ssh# /usr/sbin/sshd</span></span><br><span class="line">root<span class="comment">@3970c1e5466e:~/.ssh#</span></span><br><span class="line"><span class="comment"># 开启ssh服务后验证是否可以使用，打印出当前时间</span></span><br><span class="line">root<span class="comment">@3970c1e5466e:~/.ssh# ssh localhost date</span></span><br><span class="line">The authenticity of host 'localhost (::1)' can't be established.</span><br><span class="line">ECDSA key fingerprint is ab:43:27:e6:1c:44:be:2c:f1:17:27:90:6d:2c:68:86.</span><br><span class="line">Are you sure you want to continue connecting (yes/no)? yes</span><br><span class="line">Warning: Permanently added 'localhost' (ECDSA) to the list of known hosts.</span><br><span class="line">Mon Oct 19 05:57:44 UTC 2015</span><br><span class="line">root<span class="comment">@3970c1e5466e:~/.ssh#</span></span><br><span class="line"><span class="comment"># ssh安装完毕</span></span><br></pre></td></tr></table></figure>
<h4 id="u5B89_u88C5JDK"><a href="#u5B89_u88C5JDK" class="headerlink" title="安装JDK"></a>安装JDK</h4><p>可以使用apt-get方式直接下载安装jdk（不推荐，下载速度慢，有可能还会失败）<br>这里选择从网上下载完jdk-8u60-linux-xx.bin之后<br>将其传到Ubuntu宿主机中，在运行容器的时候使用-v参数将宿主机上的目录映射到容器中，这样在容器中就可以访问到宿主机中的文件了</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">如果提示不能安装.bin文件，使用以下命令即可解决</span><br><span class="line">root<span class="variable">@3970c1e5466e</span><span class="symbol">:~/</span>.ssh<span class="comment"># apt-get update</span></span><br><span class="line">root<span class="variable">@3970c1e5466e</span><span class="symbol">:~/</span>.ssh<span class="comment"># apt-getinstall g++-multilib</span></span><br></pre></td></tr></table></figure>
<h4 id="u5B89_u88C5Zookeeper"><a href="#u5B89_u88C5Zookeeper" class="headerlink" title="安装Zookeeper"></a>安装Zookeeper</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">将下载好的zookeeper-<span class="number">3.4</span><span class="number">.6</span>.tar.gz上传</span><br><span class="line">root@<span class="number">3970</span>c1e5466e:~/.ssh<span class="preprocessor"># mv /software/zookeeper-<span class="number">3.4</span><span class="number">.6</span>.tar.gz /usr/local/zookeeper-<span class="number">3.4</span><span class="number">.6</span></span></span><br><span class="line">root@<span class="number">3970</span>c1e5466e:~/.ssh<span class="preprocessor"># tar -zxvf zookeeper-<span class="number">3.4</span><span class="number">.6</span>.tar.gz</span></span><br><span class="line">root@<span class="number">3970</span>c1e5466e:~/.ssh<span class="preprocessor"># cd /usr/local/zookeeper-<span class="number">3.4</span><span class="number">.6</span>/conf/</span></span><br><span class="line">root@<span class="number">3970</span>c1e5466e:~/.ssh<span class="preprocessor"># cp zoo_sample.cfgzoo.cfgvim zoo.cfg</span></span><br><span class="line">root@<span class="number">3970</span>c1e5466e:~/.ssh<span class="preprocessor"># vim zoo.cfg</span></span><br><span class="line"><span class="preprocessor">#修改：dataDir=/root/zookeeper/tmp</span></span><br><span class="line"><span class="preprocessor">#在最后添加：</span></span><br><span class="line">server<span class="number">.1</span>=cloud4:<span class="number">2888</span>:<span class="number">3888</span></span><br><span class="line">server<span class="number">.2</span>=cloud5:<span class="number">2888</span>:<span class="number">3888</span></span><br><span class="line">server<span class="number">.3</span>=cloud6:<span class="number">2888</span>:<span class="number">3888</span></span><br><span class="line"></span><br><span class="line"><span class="preprocessor">#保存退出，然后创建一个tmp文件夹</span></span><br><span class="line">root@<span class="number">3970</span>c1e5466e:~/.ssh<span class="preprocessor"># mkdir /data/zookeeper/tmp</span></span><br><span class="line"><span class="preprocessor">#再创建一个空文件</span></span><br><span class="line">root@<span class="number">3970</span>c1e5466e:~/.ssh<span class="preprocessor"># touch /data/zookeeper/tmp/myid</span></span><br><span class="line"><span class="preprocessor">#最后向该文件写入ID</span></span><br><span class="line">root@<span class="number">3970</span>c1e5466e:~/.ssh<span class="preprocessor"># echo <span class="number">1</span>&gt; /data/zookeeper/tmp/myid</span></span><br></pre></td></tr></table></figure>
<h4 id="u5B89_u88C5Hadoop"><a href="#u5B89_u88C5Hadoop" class="headerlink" title="安装Hadoop"></a>安装Hadoop</h4><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root<span class="variable">@3970c1e5466e</span><span class="symbol">:~/</span>.ssh<span class="comment"># mv /software/hadoop-2.6.1.tar.gz /usr/local/</span></span><br><span class="line">root<span class="variable">@3970c1e5466e</span><span class="symbol">:~/</span>.ssh<span class="comment"># tar -zxvf hadoop-2.2.0-64bit.tar.gz</span></span><br><span class="line">root<span class="variable">@3970c1e5466e</span><span class="symbol">:~/</span>.ssh<span class="comment"># cd /usr/local/hadoop/etc/hadoop</span></span><br></pre></td></tr></table></figure>
<p>更改hadoop-env.sh</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">root<span class="variable">@3970c1e5466e</span><span class="symbol">:/data/test</span><span class="comment"># cd /usr/local/hadoop-2.6.1/</span></span><br><span class="line">root<span class="variable">@3970c1e5466e</span><span class="symbol">:/usr/local/hadoop-</span><span class="number">2.6</span>.<span class="number">1</span><span class="comment"># ls</span></span><br><span class="line"><span class="constant">LICENSE</span>.txt  <span class="constant">NOTICE</span>.txt  <span class="constant">README</span>.txt  bin  etc  <span class="keyword">include</span>  lib  libexec  logs  sbin  share</span><br><span class="line">root<span class="variable">@3970c1e5466e</span><span class="symbol">:/usr/local/hadoop-</span><span class="number">2.6</span>.<span class="number">1</span><span class="comment"># cd etc/hadoop/</span></span><br><span class="line">root<span class="variable">@3970c1e5466e</span><span class="symbol">:/usr/local/hadoop-</span><span class="number">2.6</span>.<span class="number">1</span>/etc/hadoop<span class="comment"># vim hadoop-env.sh</span></span><br><span class="line"><span class="comment">#加入java环境变量</span></span><br><span class="line">export <span class="constant">JAVA_HOME</span>=<span class="regexp">/usr/local</span><span class="regexp">/jdk1.8.0_60</span></span><br></pre></td></tr></table></figure>
<p>修改core-site.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">root@3970c1e5466e:/usr/local/hadoop-2.6.1/etc/hadoop# vim core-site.xml</span><br><span class="line"></span><br><span class="line"><span class="pi">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="pi">&lt;?xml-stylesheet type="text/xsl" href="configuration.xsl"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">configuration</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="title">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">name</span>&gt;</span>fs.defaultFS<span class="tag">&lt;/<span class="title">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">value</span>&gt;</span>hdfs://ns1<span class="tag">&lt;/<span class="title">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">name</span>&gt;</span>hadoop.tmp.dir<span class="tag">&lt;/<span class="title">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">value</span>&gt;</span>/data/hadoop/tmp<span class="tag">&lt;/<span class="title">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">name</span>&gt;</span>ha.zookeeper.quorum<span class="tag">&lt;/<span class="title">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">value</span>&gt;</span>cloud4:2181,cloud5:2182,cloud6:2183<span class="tag">&lt;/<span class="title">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>修改hdfs-site.xml, mapred-site.xml, yarn-site.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line">root@3970c1e5466e:/usr/local/hadoop-2.6.1/etc/hadoop# vim hdfs-site.xml</span><br><span class="line"><span class="pi">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="pi">&lt;?xml-stylesheet type="text/xsl" href="configuration.xsl"?&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="title">configuration</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">name</span>&gt;</span>dfs.nameservices<span class="tag">&lt;/<span class="title">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">value</span>&gt;</span>ns1<span class="tag">&lt;/<span class="title">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">name</span>&gt;</span>dfs.ha.namenodes.ns1<span class="tag">&lt;/<span class="title">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">value</span>&gt;</span>nn1,nn2<span class="tag">&lt;/<span class="title">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">name</span>&gt;</span>dfs.namenode.rpc-address.ns1.nn1<span class="tag">&lt;/<span class="title">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">value</span>&gt;</span>cloud1:9000<span class="tag">&lt;/<span class="title">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">name</span>&gt;</span>dfs.namenode.http-address.ns1.nn1<span class="tag">&lt;/<span class="title">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">value</span>&gt;</span>cloud1:50070<span class="tag">&lt;/<span class="title">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">name</span>&gt;</span>dfs.namenode.rpc-address.ns1.nn2<span class="tag">&lt;/<span class="title">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">value</span>&gt;</span>cloud2:9000<span class="tag">&lt;/<span class="title">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">name</span>&gt;</span>dfs.namenode.http-address.ns1.nn2<span class="tag">&lt;/<span class="title">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">value</span>&gt;</span>cloud2:50070<span class="tag">&lt;/<span class="title">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">name</span>&gt;</span>dfs.namenode.shared.edits.dir<span class="tag">&lt;/<span class="title">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">value</span>&gt;</span>qjournal://cloud4:8485;cloud5:8485;cloud6:8485/ns1<span class="tag">&lt;/<span class="title">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">name</span>&gt;</span>dfs.journalnode.edits.dir<span class="tag">&lt;/<span class="title">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">value</span>&gt;</span>/data/hadoop/journal<span class="tag">&lt;/<span class="title">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">name</span>&gt;</span>dfs.ha.automatic-failover.enabled<span class="tag">&lt;/<span class="title">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">value</span>&gt;</span>true<span class="tag">&lt;/<span class="title">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">name</span>&gt;</span>dfs.client.failover.proxy.provider.ns1<span class="tag">&lt;/<span class="title">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">value</span>&gt;</span></span><br><span class="line">org.apache.hadoop.hdfs.server.namenode.ha.ConfiguredFailoverProxyProvider</span><br><span class="line"><span class="tag">&lt;/<span class="title">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">name</span>&gt;</span>dfs.ha.fencing.methods<span class="tag">&lt;/<span class="title">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">value</span>&gt;</span></span><br><span class="line">sshfence</span><br><span class="line"><span class="tag">&lt;/<span class="title">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">name</span>&gt;</span>dfs.ha.fencing.ssh.private-key-files<span class="tag">&lt;/<span class="title">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">value</span>&gt;</span>/root/.ssh/id_rsa<span class="tag">&lt;/<span class="title">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">name</span>&gt;</span>dfs.ha.fencing.ssh.connect-timeout<span class="tag">&lt;/<span class="title">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">value</span>&gt;</span>30000<span class="tag">&lt;/<span class="title">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">name</span>&gt;</span>dfs.namenode.name.dir<span class="tag">&lt;/<span class="title">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">value</span>&gt;</span>file:///data/hadoop/workspace/hdfs/name<span class="tag">&lt;/<span class="title">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="title">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">name</span>&gt;</span>dfs.datanode.data.dir<span class="tag">&lt;/<span class="title">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">value</span>&gt;</span>file:///data/hadoop/workspace/hdfs/data<span class="tag">&lt;/<span class="title">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="title">property</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="title">name</span>&gt;</span>dfs.replication<span class="tag">&lt;/<span class="title">name</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="title">value</span>&gt;</span>2<span class="tag">&lt;/<span class="title">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">root@3970c1e5466e:/usr/local/hadoop-2.6.1/etc/hadoop# mv mapred-site.xml.template mapred-site.xml</span><br><span class="line">root@3970c1e5466e:/usr/local/hadoop-2.6.1/etc/hadoop# vim mapred-site.xml</span><br><span class="line"><span class="pi">&lt;?xml version="1.0"?&gt;</span></span><br><span class="line"><span class="pi">&lt;?xml-stylesheet type="text/xsl" href="configuration.xsl"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">configuration</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="title">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">name</span>&gt;</span>mapreduce.framework.name<span class="tag">&lt;/<span class="title">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">value</span>&gt;</span>yarn<span class="tag">&lt;/<span class="title">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">root@3970c1e5466e:/usr/local/hadoop-2.6.1/etc/hadoop# vim yarn-site.xml</span><br><span class="line"><span class="pi">&lt;?xml version="1.0"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">configuration</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="title">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">name</span>&gt;</span>yarn.resourcemanager.hostname<span class="tag">&lt;/<span class="title">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">value</span>&gt;</span>cloud3<span class="tag">&lt;/<span class="title">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">name</span>&gt;</span>yarn.nodemanager.aux-services<span class="tag">&lt;/<span class="title">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">value</span>&gt;</span>mapreduce_shuffle<span class="tag">&lt;/<span class="title">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="title">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">root<span class="variable">@3970c1e5466e</span><span class="symbol">:/usr/local/hadoop-</span><span class="number">2.6</span>.<span class="number">1</span>/etc/hadoop<span class="comment"># vim slaves</span></span><br><span class="line">cloud1</span><br><span class="line">cloud2</span><br><span class="line">cloud3</span><br><span class="line">cloud4</span><br><span class="line">cloud5</span><br><span class="line">cloud6</span><br></pre></td></tr></table></figure>
<h4 id="u5B89_u88C5Spark"><a href="#u5B89_u88C5Spark" class="headerlink" title="安装Spark"></a>安装Spark</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">root@<span class="number">3970</span>c1e5466e:~/.ssh<span class="preprocessor"># mv /software/scala-<span class="number">2.11</span><span class="number">.7</span> /usr/local/</span></span><br><span class="line">root@<span class="number">3970</span>c1e5466e:~/.ssh<span class="preprocessor"># tar -zxvf scala-<span class="number">2.11</span><span class="number">.7</span>.tgz</span></span><br><span class="line">root@<span class="number">3970</span>c1e5466e:~/.ssh<span class="preprocessor"># vim ~/.bashrc</span></span><br><span class="line"><span class="keyword">export</span> JAVA_HOME=/usr/local/jdk1<span class="number">.8</span><span class="number">.0</span>_60</span><br><span class="line"><span class="keyword">export</span> HADOOP_HOME=/usr/local/hadoop-<span class="number">2.6</span><span class="number">.1</span></span><br><span class="line"><span class="keyword">export</span> SCALA_HOME=/usr/local/scala-<span class="number">2.11</span><span class="number">.7</span></span><br><span class="line"><span class="keyword">export</span> SPARK_HOME=/usr/local/spark-<span class="number">1.5</span><span class="number">.1</span>-bin-hadoop2<span class="number">.6</span></span><br><span class="line"><span class="keyword">export</span> PATH=$PATH:$JAVA_HOME/bin:$HADOOP_HOME/bin:$SCALA_HOME/bin:$SPARK_HOME/bin</span><br><span class="line"></span><br><span class="line">root@<span class="number">3970</span>c1e5466e:~/.ssh<span class="preprocessor"># mv /software/spark-<span class="number">1.5</span><span class="number">.1</span>-bin-hadoop2<span class="number">.6</span>.tgz /usr/local/</span></span><br><span class="line">root@<span class="number">3970</span>c1e5466e:~/.ssh<span class="preprocessor"># tar -zxvf spark-<span class="number">1.5</span><span class="number">.1</span>-bin-hadoop2<span class="number">.6</span></span></span><br></pre></td></tr></table></figure>
<p>编辑配置文件</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">root@<span class="number">3970</span>c1e5466e:~/.ssh<span class="preprocessor"># cd /usr/local/spark-<span class="number">1.5</span><span class="number">.1</span>-bin-hadoop2<span class="number">.6</span>/</span></span><br><span class="line">root@<span class="number">3970</span>c1e5466e:/usr/local/spark-<span class="number">1.5</span><span class="number">.1</span>-bin-hadoop2<span class="number">.6</span><span class="preprocessor"># cd conf/</span></span><br><span class="line">root@<span class="number">3970</span>c1e5466e:/usr/local/spark-<span class="number">1.5</span><span class="number">.1</span>-bin-hadoop2<span class="number">.6</span><span class="preprocessor"># vim slaves</span></span><br><span class="line">cloud1</span><br><span class="line">cloud2</span><br><span class="line">cloud3</span><br><span class="line">cloud4</span><br><span class="line">cloud5</span><br><span class="line">cloud6</span><br><span class="line">root@<span class="number">3970</span>c1e5466e:/usr/local/spark-<span class="number">1.5</span><span class="number">.1</span>-bin-hadoop2<span class="number">.6</span><span class="preprocessor"># mv spark-env.sh.template spark-env.sh</span></span><br><span class="line">root@<span class="number">3970</span>c1e5466e:/usr/local/spark-<span class="number">1.5</span><span class="number">.1</span>-bin-hadoop2<span class="number">.6</span><span class="preprocessor"># vim ~/spark/conf/spark-env.sh</span></span><br><span class="line"><span class="keyword">export</span> SPARK_MASTER_IP=cloud1</span><br><span class="line"><span class="keyword">export</span> SPARK_WORKER_MEMORY=<span class="number">128</span>m</span><br><span class="line"><span class="keyword">export</span> JAVA_HOME=/usr/local/jdk1<span class="number">.8</span><span class="number">.0</span>_60</span><br><span class="line"><span class="keyword">export</span> SCALA_HOME=/usr/local/scala-<span class="number">2.11</span><span class="number">.7</span></span><br><span class="line"><span class="keyword">export</span> SPARK_HOME=/usr/local/spark-<span class="number">1.5</span><span class="number">.1</span>-bin-hadoop2<span class="number">.6</span></span><br><span class="line"><span class="keyword">export</span> HADOOP_CONF_DIR=/usr/local/hadoop-<span class="number">2.6</span><span class="number">.1</span>/etc/hadoop</span><br><span class="line"><span class="keyword">export</span> SPARK_LIBRARY_PATH=$$SPARK_HOME/lib</span><br><span class="line"><span class="keyword">export</span> SCALA_LIBRARY_PATH=$SPARK_LIBRARY_PATH</span><br><span class="line"><span class="keyword">export</span> SPARK_WORKER_CORES=<span class="number">1</span></span><br><span class="line"><span class="keyword">export</span> SPARK_WORKER_INSTANCES=<span class="number">1</span></span><br><span class="line"><span class="keyword">export</span> SPARK_MASTER_PORT=<span class="number">7077</span></span><br></pre></td></tr></table></figure>
<p>此时配置已经基本完成，所以需要<strong>保存镜像</strong></p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[reason<span class="variable">@localhost</span> ~]<span class="variable">$ </span>sudo docker commit -m <span class="string">"mofun spark first commit"</span> -a <span class="string">"reason"</span> cloud1 mofun/<span class="symbol">spark:</span>v1.<span class="number">0</span></span><br></pre></td></tr></table></figure>
<p>查看执行过的镜像</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[reason@localhost ~]$ sudo docker ps -a</span><br><span class="line">CONTAINER ID        IMAGE                 COMMAND                  CREATED             STATUS                         PORTS               NAMES</span><br><span class="line">d4e581ba6af8        mofun/spark:v1<span class="number">.0</span>   <span class="string">"/bin/bash"</span>              <span class="number">11</span> <span class="function">seconds ago      <span class="title">Exited</span> <span class="params">(<span class="number">0</span>)</span> 7 seconds ago                           hungry_pasteur</span></span><br></pre></td></tr></table></figure>
<p>启动容器</p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 后台模式运行</span></span><br><span class="line">[reason@localhost ~]$ docker <span class="command">run</span> -d <span class="comment">--name cloud2 -h cloud2 -it mofun/spark:v2.0 /bin/bash</span></span><br><span class="line"></span><br><span class="line">需要使用刚才制作的镜像启动<span class="number">6</span>个容器</span><br><span class="line">[reason@localhost ~]$ docker <span class="command">run</span> <span class="comment">--name cloud1 -h cloud1 -it mofun/spark:v2.0 /bin/bash</span></span><br><span class="line">[reason@localhost ~]$ docker <span class="command">run</span> <span class="comment">--name cloud2 -h cloud2 -it mofun/spark:v2.0 /bin/bash</span></span><br><span class="line">[reason@localhost ~]$ docker <span class="command">run</span> <span class="comment">--name cloud3 -h cloud3 -it mofun/spark:v2.0 /bin/bash</span></span><br><span class="line">[reason@localhost ~]$ docker <span class="command">run</span> <span class="comment">--name cloud4 -h cloud4 -it mofun/spark:v2.0 /bin/bash</span></span><br><span class="line">[reason@localhost ~]$ docker <span class="command">run</span> <span class="comment">--name cloud5 -h cloud5 -it mofun/spark:v2.0 /bin/bash</span></span><br><span class="line">[reason@localhost ~]$ docker <span class="command">run</span> <span class="comment">--name cloud6 -h cloud6 -it mofun/spark:v2.0 /bin/bash</span></span><br></pre></td></tr></table></figure>
<p>做最后的修改</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">#在cloud5~cloud6中分别手动修改myid</span></span><br><span class="line">root@cloud5:~<span class="preprocessor"># echo <span class="number">2</span> &gt;  /data/zookeeper/myid</span></span><br><span class="line">root@cloud5:~<span class="preprocessor"># echo <span class="number">2</span> &gt; /usr/local/zookeeper-<span class="number">3.4</span><span class="number">.6</span>/tmp/myid</span></span><br><span class="line">root@cloud6:~<span class="preprocessor"># echo <span class="number">3</span> &gt;  /data/zookeeper/myid</span></span><br><span class="line">root@cloud6:~<span class="preprocessor"># echo <span class="number">3</span> &gt; /usr/local/zookeeper-<span class="number">3.4</span><span class="number">.6</span>/tmp/myid</span></span><br></pre></td></tr></table></figure>
<p>启动zookeeper集群</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor"># 启动zookeeper集群（分别在cloud4、cloud5、cloud6上启动zk）</span></span><br><span class="line"><span class="preprocessor"># 全部节点启动后，再执行zkServer.sh status</span></span><br><span class="line"><span class="preprocessor"># 返回正常</span></span><br><span class="line"><span class="preprocessor"># root@cloud6:/usr/local/zookeeper-<span class="number">3.4</span><span class="number">.6</span>/bin# ./zkServer.sh status</span></span><br><span class="line"><span class="preprocessor"># JMX enabled by default</span></span><br><span class="line"><span class="preprocessor"># Using config: /usr/local/zookeeper-<span class="number">3.4</span><span class="number">.6</span>/bin/../conf/zoo.cfg</span></span><br><span class="line"><span class="preprocessor"># Mode: follower</span></span><br><span class="line">root@cloud5:~<span class="preprocessor"># /usr/local/zookeeper-<span class="number">3.4</span><span class="number">.6</span>/bin/zkServer.sh start</span></span><br><span class="line"><span class="preprocessor"># 当<span class="number">3</span>个节点服务正常启动后</span></span><br><span class="line"><span class="preprocessor"># 使用status查看是否启动</span></span><br><span class="line">root@cloud5:~<span class="preprocessor"># /usr/local/zookeeper-<span class="number">3.4</span><span class="number">.6</span>/bin/zkServer.sh status</span></span><br><span class="line">JMX enabled by <span class="keyword">default</span></span><br><span class="line">Using config: /usr/local/zookeeper-<span class="number">3.4</span><span class="number">.6</span>/bin/../conf/zoo.cfg</span><br><span class="line">Mode: follower</span><br><span class="line">root@cloud5:~<span class="preprocessor">#</span></span><br></pre></td></tr></table></figure>
<p>进入cloud1，开启hadoop和spark服务</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 启动journalnode（在cloud1上启动所有journalnode，注意：是调用的hadoop-daemons.sh这个脚本，注意是复数s的那个脚本）</span></span><br><span class="line"><span class="comment"># 运行jps命令检验，cloud4、cloud5、cloud6上多了JournalNode进程</span></span><br><span class="line">root<span class="variable">@cloud1</span><span class="symbol">:/usr/local/hadoop-</span><span class="number">2.6</span>.<span class="number">1</span>/sbin<span class="comment"># pwd</span></span><br><span class="line">/usr/local/hadoop-<span class="number">2.6</span>.<span class="number">1</span>/sbin</span><br><span class="line">root<span class="variable">@cloud1</span><span class="symbol">:/usr/local/hadoop-</span><span class="number">2.6</span>.<span class="number">1</span>/sbin<span class="comment">#</span></span><br><span class="line">root<span class="variable">@cloud1</span><span class="symbol">:/usr/local/hadoop-</span><span class="number">2.6</span>.<span class="number">1</span>/sbin<span class="comment"># hadoop-daemons.sh start journalnode</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 格式化ZK(在cloud1上执行即可，在bin目录下)</span></span><br><span class="line">root<span class="variable">@cloud1</span><span class="symbol">:/usr/local/hadoop-</span><span class="number">2.6</span>.<span class="number">1</span>/bin<span class="comment"># hdfs zkfc -formatZK</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 进入节点cloud4，查看zookeeper信息</span></span><br><span class="line">root<span class="variable">@cloud4</span><span class="symbol">:/usr/local/zookeeper-</span><span class="number">3.4</span>.<span class="number">6</span>/bin<span class="comment"># pwd</span></span><br><span class="line">/usr/local/zookeeper-<span class="number">3.4</span>.<span class="number">6</span>/bin</span><br><span class="line">root<span class="variable">@cloud4</span><span class="symbol">:/usr/local/zookeeper-</span><span class="number">3.4</span>.<span class="number">6</span>/bin<span class="comment"># ls</span></span><br><span class="line"><span class="constant">README</span>.txt  zkCleanup.sh  zkCli.cmd  zkCli.sh  zkEnv.cmd  zkEnv.sh  zkServer.cmd  zkServer.sh  zookeeper.out</span><br><span class="line">root<span class="variable">@cloud4</span><span class="symbol">:/usr/local/zookeeper-</span><span class="number">3.4</span>.<span class="number">6</span>/bin<span class="comment">#</span></span><br><span class="line">root<span class="variable">@cloud4</span><span class="symbol">:/usr/local/zookeeper-</span><span class="number">3.4</span>.<span class="number">6</span>/bin<span class="comment"># ./zkCli.sh</span></span><br><span class="line"><span class="constant">Connecting</span> to <span class="symbol">localhost:</span><span class="number">2181</span></span><br><span class="line"><span class="number">2015</span>-<span class="number">10</span>-<span class="number">21</span> 09<span class="symbol">:</span><span class="number">34</span><span class="symbol">:</span><span class="number">34</span>,<span class="number">485</span> [<span class="symbol">myid:</span>] - <span class="constant">INFO</span>  [<span class="symbol">main:</span><span class="constant">Environment</span><span class="variable">@100</span>] - <span class="constant">Client</span> <span class="symbol">environment:</span>zookeeper.version=<span class="number">3.4</span>.<span class="number">6</span>-<span class="number">1569965</span>, built on <span class="number">02</span>/<span class="number">20</span>/<span class="number">2014</span> 09<span class="symbol">:</span>09 <span class="constant">GMT</span></span><br><span class="line"><span class="number">2015</span>-<span class="number">10</span>-<span class="number">21</span> 09<span class="symbol">:</span><span class="number">34</span><span class="symbol">:</span><span class="number">34</span>,<span class="number">487</span> [<span class="symbol">myid:</span>] - <span class="constant">INFO</span>  [<span class="symbol">main:</span><span class="constant">Environment</span><span class="variable">@100</span>] - <span class="constant">Client</span> <span class="symbol">environment:</span>host.name=cloud4</span><br><span class="line"><span class="number">2015</span>-<span class="number">10</span>-<span class="number">21</span> 09<span class="symbol">:</span><span class="number">34</span><span class="symbol">:</span><span class="number">34</span>,<span class="number">487</span> [<span class="symbol">myid:</span>] - <span class="constant">INFO</span>  [<span class="symbol">main:</span><span class="constant">Environment</span><span class="variable">@100</span>] - <span class="constant">Client</span> <span class="symbol">environment:</span>java.version=<span class="number">1.8</span>.<span class="number">0_</span>...</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">[<span class="symbol">zk:</span> <span class="symbol">localhost:</span><span class="number">2181</span>(<span class="constant">CONNECTED</span>) <span class="number">2</span>] ls /hadoop-ha</span><br><span class="line">[ns1]</span><br><span class="line">[<span class="symbol">zk:</span> <span class="symbol">localhost:</span><span class="number">2181</span>(<span class="constant">CONNECTED</span>) <span class="number">3</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 格式化HDFS(在bin目录下),在cloud1上执行命令:</span></span><br><span class="line">root<span class="variable">@cloud1</span><span class="symbol">:/usr/local/hadoop-</span><span class="number">2.6</span>.<span class="number">1</span>/bin<span class="comment"># hdfs namenode -format</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 首先启动active节点，执行如下命令(在cloud1上执行)</span></span><br><span class="line">root<span class="variable">@cloud1</span><span class="symbol">:/usr/local/hadoop-</span><span class="number">2.6</span>.<span class="number">1</span>/sbin<span class="comment"># hadoop-daemon.sh start namenode  </span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 进入cloud2，需要启动standy模式</span></span><br><span class="line">root<span class="variable">@cloud2</span><span class="symbol">:/usr/local/hadoop-</span><span class="number">2.6</span>.<span class="number">1</span>/bin<span class="comment"># pwd</span></span><br><span class="line">/usr/local/hadoop-<span class="number">2.6</span>.<span class="number">1</span>/bin</span><br><span class="line">root<span class="variable">@cloud2</span><span class="symbol">:/usr/local/hadoop-</span><span class="number">2.6</span>.<span class="number">1</span>/bin<span class="comment"># ./hdfs namenode -bootstrapStandby</span></span><br><span class="line">root<span class="variable">@cloud2</span><span class="symbol">:/usr/local/hadoop-</span><span class="number">2.6</span>.<span class="number">1</span>/sbin<span class="comment"># pwd</span></span><br><span class="line">/usr/local/hadoop-<span class="number">2.6</span>.<span class="number">1</span>/sbin</span><br><span class="line"><span class="comment"># 这条命令可以等到hadoop-daemons.sh start zkfc 成功以后执行</span></span><br><span class="line"><span class="comment"># 貌似是zkfc的启动慢导致standby模式启动出错？</span></span><br><span class="line"></span><br><span class="line">root<span class="variable">@cloud1</span><span class="symbol">:/usr/local/spark-</span><span class="number">1.5</span>.<span class="number">1</span>-bin-hadoop2.<span class="number">6</span>/bin<span class="comment"># jps</span></span><br><span class="line"><span class="number">1522</span> <span class="constant">NameNode</span></span><br><span class="line"><span class="number">2546</span> <span class="constant">Jps</span></span><br><span class="line"><span class="number">1859</span> <span class="constant">DFSZKFailoverController</span></span><br><span class="line"><span class="number">1109</span> <span class="constant">Worker</span></span><br><span class="line"><span class="number">104</span> <span class="constant">JournalNode</span></span><br><span class="line"><span class="number">426</span> <span class="constant">DataNode</span></span><br><span class="line"><span class="number">558</span> <span class="constant">NodeManager</span></span><br><span class="line"><span class="number">943</span> <span class="constant">Master</span></span><br><span class="line"><span class="comment"># 仔细观察DFSZKFailoverController 这个进程的存在情况</span></span><br><span class="line"></span><br><span class="line">root<span class="variable">@cloud2</span><span class="symbol">:/usr/local/hadoop-</span><span class="number">2.6</span>.<span class="number">1</span>/sbin<span class="comment"># ./hadoop-daemon.sh start namenode</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 重新进入cloud1 ，启动datanode</span></span><br><span class="line">root<span class="variable">@cloud4</span><span class="symbol">:/usr/local/hadoop-</span><span class="number">2.6</span>.<span class="number">1</span>/sbin<span class="comment"># pwd</span></span><br><span class="line">/usr/local/hadoop-<span class="number">2.6</span>.<span class="number">1</span>/sbin</span><br><span class="line">root<span class="variable">@cloud4</span><span class="symbol">:/usr/local/hadoop-</span><span class="number">2.6</span>.<span class="number">1</span>/sbin<span class="comment"># ./hadoop-daemons.sh start datanode</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 在cloud3上执行start-yarn.sh</span></span><br><span class="line">root<span class="variable">@cloud3</span><span class="symbol">:/usr/local/hadoop-</span><span class="number">2.6</span>.<span class="number">1</span>/sbin<span class="comment"># start-yarn.sh</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 启动ZKFC</span></span><br><span class="line">root<span class="variable">@cloud1</span><span class="symbol">:/usr/local/hadoop-</span><span class="number">2.6</span>.<span class="number">1</span>/sbin<span class="comment"># ./hadoop-daemons.sh start zkfc</span></span><br><span class="line"><span class="comment"># 启动spark集群</span></span><br><span class="line">root<span class="variable">@cloud1</span><span class="symbol">:/usr/local/hadoop-</span><span class="number">2.6</span>.<span class="number">1</span>/sbin<span class="comment"># cd /usr/local/spark-1.5.1-bin-hadoop2.6/sbin/</span></span><br><span class="line">root<span class="variable">@cloud1</span><span class="symbol">:/usr/local/spark-</span><span class="number">1.5</span>.<span class="number">1</span>-bin-hadoop2.<span class="number">6</span>/sbin<span class="comment"># start-all.sh</span></span><br></pre></td></tr></table></figure>
<p>此时可以通过CURL访问服务了，如果宿主机中的hosts文件没有配置docker容器的主机名和IP地址映射关系的话要换成用IP访问</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[reason<span class="annotation">@localhost</span> ~]$ curl <span class="string">http:</span><span class="comment">//172.17.0.56:50070</span></span><br><span class="line">[reason<span class="annotation">@localhost</span> ~]$</span><br></pre></td></tr></table></figure>
<h4 id="u5176_u4ED6"><a href="#u5176_u4ED6" class="headerlink" title="其他"></a>其他</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor"># 删除镜像</span></span><br><span class="line">[reason@localhost ~]$ docker images</span><br><span class="line">REPOSITORY          TAG                 IMAGE ID            CREATED             VIRTUAL SIZE</span><br><span class="line">mofun/spark         v2<span class="number">.0</span>                b2dacac3e132        <span class="number">3</span> hours ago         <span class="number">1.508</span> GB</span><br><span class="line">mofun/spark         v1<span class="number">.3</span>                <span class="number">4</span>d2f33ca61ee        <span class="number">21</span> hours ago        <span class="number">1.506</span> GB</span><br><span class="line">ubuntu              latest              <span class="number">0</span>a17decee413        <span class="number">6</span> days ago          <span class="number">188.3</span> MB</span><br><span class="line">docker/whalesay     latest              ded5e192a685        <span class="number">4</span> months ago        <span class="number">247</span> MB</span><br><span class="line">[reason@localhost ~]$ sudo docker rmi <span class="number">4</span>d2f</span><br></pre></td></tr></table></figure>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 删除容器</span></span><br><span class="line">[reason<span class="variable">@localhost</span> ~]<span class="variable">$ </span>docker ps -a</span><br><span class="line"><span class="constant">CONTAINER ID </span>       <span class="constant">IMAGE </span>              <span class="constant">COMMAND </span>            <span class="constant">CREATED </span>            <span class="constant">STATUS </span>                       <span class="constant">PORTS </span>              <span class="constant">NAMES</span></span><br><span class="line"><span class="number">8258875263</span>be        ubuntu              <span class="string">"/bin/bash"</span>         <span class="number">3</span> minutes ago       <span class="constant">Exited </span>(<span class="number">127</span>) <span class="number">3</span> minutes ago                        mad_mestorf</span><br><span class="line">[reason<span class="variable">@localhost</span> ~]<span class="variable">$ </span>sudo docker rm <span class="number">8258875263</span>be</span><br><span class="line"><span class="number">8258875263</span>be</span><br><span class="line">[reason<span class="variable">@localhost</span> ~]$</span><br></pre></td></tr></table></figure>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 删除(NULL) 容器</span></span><br><span class="line">root<span class="variable">@iZ28ikebrg6Z</span><span class="symbol">:/var/run</span><span class="comment"># docker images  </span></span><br><span class="line"><span class="constant">REPOSITORY </span>            <span class="constant">TAG </span>                <span class="constant">IMAGE ID </span>           <span class="constant">CREATED </span>            <span class="constant">VIRTUAL SIZE </span> </span><br><span class="line">&lt;none&gt;                 &lt;none&gt;              def2e0b08cbc        <span class="constant">About </span>an hour ago   <span class="number">1.37</span> <span class="constant">GB </span> </span><br><span class="line">sameersbn/redmine      latest              f0bec095f291        <span class="number">2</span> hours ago         <span class="number">614.6</span> <span class="constant">MB </span> </span><br><span class="line">root<span class="variable">@iZ28ikebrg6Z</span><span class="symbol">:/var/run</span><span class="comment"># docker ps -a  </span></span><br><span class="line"><span class="constant">CONTAINER ID </span>       <span class="constant">IMAGE </span>                   <span class="constant">COMMAND </span>               <span class="constant">CREATED </span>            <span class="constant">STATUS </span>                    <span class="constant">PORTS </span>              <span class="constant">NAMES </span> </span><br><span class="line"><span class="number">5</span>d6373cb79e6        <span class="number">224</span>b40d4b89f             <span class="string">"/bin/sh -c 'apt-get   25 hours ago        Exited (0) 25 hours ago                        distracted_blackwell    </span><br><span class="line">root@iZ28ikebrg6Z:/var/run# docker rm 5d63  </span><br><span class="line">5d63</span></span><br></pre></td></tr></table></figure>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 镜像导出</span></span><br><span class="line">[reason<span class="variable">@localhost</span> ~]<span class="variable">$ </span>sudo docker ps -a</span><br><span class="line"><span class="constant">CONTAINER ID </span>       <span class="constant">IMAGE </span>                <span class="constant">COMMAND </span>                 <span class="constant">CREATED </span>            <span class="constant">STATUS </span>                        <span class="constant">PORTS </span>              <span class="constant">NAMES</span></span><br><span class="line">d4e581ba6af8        mofun/<span class="symbol">spark_rc:</span>v1.<span class="number">0</span>   <span class="string">"/bin/bash"</span>              <span class="number">11</span> seconds ago      <span class="constant">Exited </span>(<span class="number">0</span>) <span class="number">7</span> seconds ago                           hungry_pasteur</span><br><span class="line">[reason<span class="variable">@localhost</span> ~]<span class="variable">$ </span>sudo docker export d4e581ba6af8 &gt; mofunspark_v1.<span class="number">0</span>.tar</span><br><span class="line"></span><br><span class="line"><span class="comment"># 和导入恢复</span></span><br><span class="line">[reason<span class="variable">@localhost</span> ~]<span class="variable">$ </span>cat mofunspark_v1.<span class="number">0</span>.tar | sudo docker import - mofun/<span class="symbol">spark:</span>v1.<span class="number">0</span></span><br></pre></td></tr></table></figure>
<p>执行Scala交互模式时出错时，需要检查</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">root@cloud1:/usr/local/jdk1<span class="number">.8</span><span class="number">.0</span>_60/jre/lib/ext<span class="preprocessor"># ls -la</span></span><br><span class="line">total <span class="number">25632</span></span><br><span class="line">drwxr-xr-x.  <span class="number">3</span>  <span class="number">501</span> staff     <span class="number">4096</span> Oct <span class="number">19</span> <span class="number">02</span>:<span class="number">35</span> .</span><br><span class="line">drwxr-xr-x. <span class="number">15</span>  <span class="number">501</span> staff     <span class="number">4096</span> Oct <span class="number">18</span> <span class="number">03</span>:<span class="number">34</span> ..</span><br><span class="line">-rw-r--r--.  <span class="number">1</span>  <span class="number">501</span> staff  <span class="number">3860522</span> Aug  <span class="number">4</span> <span class="number">19</span>:<span class="number">29</span> cldrdata.jar</span><br><span class="line">-rw-r--r--.  <span class="number">1</span>  <span class="number">501</span> staff     <span class="number">8286</span> Aug  <span class="number">4</span> <span class="number">19</span>:<span class="number">29</span> dnsns.jar</span><br><span class="line">-rw-r--r--.  <span class="number">1</span>  <span class="number">501</span> staff    <span class="number">44516</span> Aug  <span class="number">4</span> <span class="number">19</span>:<span class="number">29</span> jaccess.jar</span><br><span class="line">-rwxr-xr-x.  <span class="number">1</span>  <span class="number">501</span> staff <span class="number">18464934</span> Aug  <span class="number">3</span> <span class="number">17</span>:<span class="number">58</span> jfxrt.jar</span><br><span class="line">-rw-r--r--.  <span class="number">1</span>  <span class="number">501</span> staff  <span class="number">1178935</span> Aug  <span class="number">4</span> <span class="number">19</span>:<span class="number">29</span> localedata.jar</span><br><span class="line">-rw-r--r--.  <span class="number">1</span>  <span class="number">501</span> staff     <span class="number">1269</span> Aug  <span class="number">4</span> <span class="number">19</span>:<span class="number">29</span> meta-index</span><br><span class="line">-rw-r--r--.  <span class="number">1</span>  <span class="number">501</span> staff  <span class="number">2014239</span> Aug  <span class="number">4</span> <span class="number">19</span>:<span class="number">29</span> nashorn.jar</span><br><span class="line">-rw-r--r--.  <span class="number">1</span>  <span class="number">501</span> staff    <span class="number">39771</span> Aug  <span class="number">4</span> <span class="number">19</span>:<span class="number">29</span> sunec.jar</span><br><span class="line">-rw-r--r--.  <span class="number">1</span>  <span class="number">501</span> staff   <span class="number">278680</span> Aug  <span class="number">4</span> <span class="number">19</span>:<span class="number">29</span> sunjce_provider.jar</span><br><span class="line">-rw-r--r--.  <span class="number">1</span>  <span class="number">501</span> staff   <span class="number">250826</span> Aug  <span class="number">4</span> <span class="number">19</span>:<span class="number">29</span> sunpkcs11.jar</span><br><span class="line">drwxr-xr-x.  <span class="number">2</span> root root      <span class="number">4096</span> Oct <span class="number">19</span> <span class="number">02</span>:<span class="number">35</span> tmp</span><br><span class="line">-rw-r--r--.  <span class="number">1</span>  <span class="number">501</span> staff    <span class="number">68848</span> Aug  <span class="number">4</span> <span class="number">19</span>:<span class="number">29</span> zipfs.jar</span><br><span class="line">root@cloud1:/usr/local/jdk1<span class="number">.8</span><span class="number">.0</span>_60/jre/lib/ext<span class="preprocessor">#</span></span><br><span class="line"><span class="preprocessor"># 该目录下出现了很多类似._jfxrt.jar 的包，直接予以删除即可。</span></span><br></pre></td></tr></table></figure>
<h4 id="u53C2_u8003_u6587_u732E"><a href="#u53C2_u8003_u6587_u732E" class="headerlink" title="参考文献"></a>参考文献</h4><ul>
<li><a href="http://eksliang.iteye.com/blog/2226986" target="_blank" rel="external">http://eksliang.iteye.com/blog/2226986</a></li>
<li><a href="http://dockerpool.com/static/books/docker_practice/container/daemon.html" target="_blank" rel="external">http://dockerpool.com/static/books/docker_practice/container/daemon.html</a></li>
<li><a href="http://dockerpool.com/static/books/docker_practice/install/ubuntu.html" target="_blank" rel="external">http://dockerpool.com/static/books/docker_practice/install/ubuntu.html</a></li>
<li><a href="http://dockerpool.com/static/books/docker_practice/image/create.html" target="_blank" rel="external">http://dockerpool.com/static/books/docker_practice/image/create.html</a></li>
<li><a href="http://dockerpool.com/static/books/docker_practice/image/save_load.html" target="_blank" rel="external">http://dockerpool.com/static/books/docker_practice/image/save_load.html</a></li>
<li><a href="http://dockerpool.com/static/books/docker_practice/container/rm.html" target="_blank" rel="external">http://dockerpool.com/static/books/docker_practice/container/rm.html</a></li>
<li><a href="http://blog.csdn.net/qq1010885678/article/details/46353101" target="_blank" rel="external">http://blog.csdn.net/qq1010885678/article/details/46353101</a></li>
<li><a href="http://cn.soulmachine.me/blog/20131027/" target="_blank" rel="external">http://cn.soulmachine.me/blog/20131027/</a></li>
<li><a href="http://my.oschina.net/zjzhai/blog/225112" target="_blank" rel="external">http://my.oschina.net/zjzhai/blog/225112</a></li>
<li><a href="http://blog.csdn.net/minimicall/article/details/40188251" target="_blank" rel="external">http://blog.csdn.net/minimicall/article/details/40188251</a></li>
<li><a href="http://www.scala-lang.org/documentation/" target="_blank" rel="external">http://www.scala-lang.org/documentation/</a>  </li>
<li><a href="https://github.com/apache/spark/blob/master/examples/src/main/scala/org/apache/spark/examples/streaming/NetworkWordCount.scala" target="_blank" rel="external">https://github.com/apache/spark/blob/master/examples/src/main/scala/org/apache/spark/examples/streaming/NetworkWordCount.scala</a></li>
<li><a href="http://spark.apache.org/docs/latest/" target="_blank" rel="external">http://spark.apache.org/docs/latest/</a></li>
<li><a href="https://docs.sigmoidanalytics.com/index.php/Error:_Failed_to_initialize_compiler:_object_scala_not_found." target="_blank" rel="external">https://docs.sigmoidanalytics.com/index.php/Error:_Failed_to_initialize_compiler:_object_scala_not_found.</a></li>
<li><a href="http://docs.docker.com/linux/step_one/" target="_blank" rel="external">http://docs.docker.com/linux/step_one/</a></li>
<li><a href="http://blog.sequenceiq.com/blog/2015/01/09/spark-1-2-0-docker/" target="_blank" rel="external">http://blog.sequenceiq.com/blog/2015/01/09/spark-1-2-0-docker/</a></li>
</ul>
</div><div class="tags"><a href="/tags/Docker/">Docker</a><a href="/tags/HDFS/">HDFS</a><a href="/tags/Spark/">Spark</a></div><div class="post-nav"><a href="/2015/12/05/linux-shell-generate-date/" class="pre"><i class="icon-previous">linux shell 获得以前日期</i></a><a href="/2015/12/04/nginx-logrotate/" class="next">nginx-logrotate<i class="icon-next"></i></a></div><div id="disqus_thread"><script>var disqus_shortname = 'reasonpun';
var disqus_identifier = '2015/12/04/spark-in-docker/';
var disqus_title = 'Docker中搭建Spark计算框架';
var disqus_url = 'http://reasonpun.com/2015/12/04/spark-in-docker/';
(function() {
  var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//reasonpun.disqus.com/count.js" async="async"></script></div></div></div></div><div class="pure-u-1-4"><div id="sidebar"><div class="widget"><form action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank" class="search-form"><input type="text" name="q" maxlength="20" placeholder="Search" class="search-form-input"/><input type="hidden" name="sitesearch" value="http://reasonpun.com"/></form></div><div class="widget"><div class="widget-title">分类</div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/AWK/">AWK</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/AWK/Linux/">Linux</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/AWK/Linux/Ebook/">Ebook</a></li></ul></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Android/">Android</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Android/源码/">源码</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Laravel/">Laravel</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Laravel/PHP/">PHP</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Nginx/">Nginx</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/">Python</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Python/学习/">学习</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/数据挖掘/">数据挖掘</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/数据挖掘/实时计算/">实时计算</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/数据挖掘/实时计算/优化/">优化</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/数据挖掘/实时计算/源码分析/">源码分析</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/数据挖掘/实时计算/虚拟化/">虚拟化</a></li></ul></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/系统维护/">系统维护</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/系统维护/日志处理/">日志处理</a></li></ul></li></ul></div><div class="widget"><div class="widget-title">标签</div><div class="tagcloud"><a href="/tags/Documentation/" style="font-size: 15px;">Documentation</a> <a href="/tags/Spark/" style="font-size: 15px;">Spark</a> <a href="/tags/Kernel/" style="font-size: 15px;">Kernel</a> <a href="/tags/Docker/" style="font-size: 15px;">Docker</a> <a href="/tags/HDFS/" style="font-size: 15px;">HDFS</a> <a href="/tags/Oryx2/" style="font-size: 15px;">Oryx2</a> <a href="/tags/documentation/" style="font-size: 15px;">documentation</a> <a href="/tags/Admin/" style="font-size: 15px;">Admin</a> <a href="/tags/Hadoop/" style="font-size: 15px;">Hadoop</a> <a href="/tags/Spark-Streaming/" style="font-size: 15px;">Spark-Streaming</a> <a href="/tags/Nginx/" style="font-size: 15px;">Nginx</a> <a href="/tags/Logrorate/" style="font-size: 15px;">Logrorate</a> <a href="/tags/Linux/" style="font-size: 15px;">Linux</a> <a href="/tags/Shell/" style="font-size: 15px;">Shell</a> <a href="/tags/Kafka/" style="font-size: 15px;">Kafka</a> <a href="/tags/Source/" style="font-size: 15px;">Source</a> <a href="/tags/Apache/" style="font-size: 15px;">Apache</a> <a href="/tags/Flume-NG/" style="font-size: 15px;">Flume-NG</a> <a href="/tags/awk/" style="font-size: 15px;">awk</a> <a href="/tags/programming/" style="font-size: 15px;">programming</a> <a href="/tags/spark/" style="font-size: 15px;">spark</a> <a href="/tags/优化/" style="font-size: 15px;">优化</a> <a href="/tags/正则/" style="font-size: 15px;">正则</a> <a href="/tags/日志/" style="font-size: 15px;">日志</a> <a href="/tags/Python/" style="font-size: 15px;">Python</a> <a href="/tags/Java/" style="font-size: 15px;">Java</a> <a href="/tags/Recommendation/" style="font-size: 15px;">Recommendation</a> <a href="/tags/Android/" style="font-size: 15px;">Android</a> <a href="/tags/Laravel/" style="font-size: 15px;">Laravel</a> <a href="/tags/PHP/" style="font-size: 15px;">PHP</a> <a href="/tags/Genetic-Algorithm/" style="font-size: 15px;">Genetic Algorithm</a></div></div><div class="widget"><div class="widget-title">最新文章</div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2016/06/29/Laravel和Dropzone-js实现文件上传/">Laravel和Dropzone.js实现文件上传</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/06/13/Laravel-环境安装和配置/">Laravel 环境安装和配置</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/04/08/set-up-oryx-env/">玩转 Oryx2 （一）</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/04/07/Oryx2-performance-doc/">Oryx2 性能优化文档</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/04/06/Oryx2-developer-doc/">Oryx2 开发者文档</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/04/06/Oryx2-end-user-doc/">Oryx2 终端用户文档</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/03/08/Java-keyword-volatile/">Java关键字volatile</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/03/08/OKHttp-sourcecode/">OKHttp源码学习过程</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/01/24/Reg-Nginx/">正则表达式处理Nginx</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/01/06/TAPL/">TAPL</a></li></ul></div><div class="widget"><div class="widget-title">最近评论</div><script type="text/javascript" src="//reasonpun.disqus.com/recent_comments_widget.js?num_items=5&amp;hide_avatars=1&amp;avatar_size=32&amp;excerpt_length=20&amp;hide_mods=1"></script></div><div class="widget"><div class="widget-title">友情链接</div><ul></ul><a href="http://people.csail.mit.edu/matei/" title="Matei Zaharia" target="_blank">Matei Zaharia</a><ul></ul><a href="https://github.com/tensorflow/tensorflow" title="tensorflow" target="_blank">tensorflow</a></div></div></div></div><div id="footer">© <a href="/" rel="nofollow">Tensor Cell.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div><a id="rocket" href="#top" class="show"></a><script src="/js/jquery.min.js" type="text/javascript"></script>
<script src="/js/totop.js" type="text/javascript"></script><script src="/js/fancybox.pack.js" type="text/javascript"></script>
<script src="/js/jquery.fancybox.js" type="text/javascript"></script><link rel="stylesheet" href="/css/jquery.fancybox.css" type="text/css"></div><!-- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
</body></html>