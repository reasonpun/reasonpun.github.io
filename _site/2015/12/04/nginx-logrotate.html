<!DOCTYPE html>
<html lang="zh-CN" >
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
  <meta content="yes" name="apple-mobile-web-app-capable">
  <meta content="black-translucent" name="apple-mobile-web-app-status-bar-style">
  <meta content="telephone=no" name="format-detection">
  
  <title>Nginx Logrotate</title>
  <meta name="description" content="logrotate is  designed to ease administration of systems that generatelarge numbers of log files.  It allows automatic rotation, compression,removal, and mai...">
  <link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico">
  <link rel="apple-touch-icon" href="/apple-touch-icon.png">
  <link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png">
  <link rel="alternate" type="application/rss+xml" title="Tensor Cell" href="/feed.xml">
  
  <link rel="stylesheet" type="text/css" href="/css/normalize.css">
  <link rel="stylesheet" type="text/css" href="/css/pure-min.css">
  <link rel="stylesheet" type="text/css" href="/css/grids-responsive-min.css">
  <link rel="stylesheet" type="text/css" href="/css/style.css">
  <link rel="stylesheet" type="text/css" href="/css/syntax.css">
</head>

  <body>
    <div class="body_container">
      <div id="header">
        <div class="site-name">
          <h1 class="hidden">Nginx Logrotate</h1>
          <a id="logo" href="/.">Tensor Cell</a>
          <p class="description">还要再走500里</p>
        </div>
        <div id="nav-menu">
          
            <a href="//"><i class="icon-home"> 首页</i></a>
          
            <a href="/archives/"><i class="icon-archive"> 归档</i></a>
          
            <a href="/about/"><i class="icon-about"> 关于</i></a>
          
            <a href="/history/"><i class="icon-history"> 历史</i></a>
          
            <a href="/feed.xml"><i class="icon-rss"> 订阅</i></a>
          
        </div>
      <script type="text/javascript">
      var menus=document.getElementById('nav-menu');
      var ishome = true;
      for (var i=1;i<menus.childElementCount;i++) {
        var path = location.href;
        var current = path.startsWith(menus.children[i].href);
        if (current) {
          menus.children[i].className ='current';
          ishome = false;
          break;
        }
      }
      if (ishome) {
      	menus.children[0].className ='current';
      }
      </script>
      </div>

      <div id="layout" class="pure-g">
        <div class="pure-u-1 pure-u-md-3-4">
          <div class="content_container">
            <article class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title" itemprop="name headline">Nginx Logrotate</h1>
    <p class="post-meta"><time datetime="2015-12-04T00:00:00+08:00" itemprop="datePublished">Dec 4, 2015</time></p>
  </header>

  <div class="post-content" itemprop="articleBody">
    <h3 id="centos-logrotate">Centos Logrotate</h3>

<h4 id="关于">关于</h4>

<p><em>logrotate</em> is  designed to ease administration of systems that generatelarge numbers of log files.  It allows automatic rotation, compression,removal, and mailing of log files.  Each log file may be handled daily,weekly, monthly, or when it grows too large. (<a href="http://linuxcommand.org/man_pages/logrotate8.html">Logrotate man page</a>)</p>

<h4 id="配置文件">配置文件</h4>

<h5 id="内容示例">内容示例</h5>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[reason@online_http:/etc/logrotate.d]$ cat nginx.logrotate.d
#
# author: reason@mofunsky.com
# date:   2015-03-31 10:15
# cron:
#       59 23 * * * /usr/sbin/logrotate /etc/logrotate.conf &gt; /dev/null
#
# location:
#       /etc/logrotate.d/nginx.logrotate.d
#
/local/nginx*.log {
    daily
    rotate 10
    missingok
    compress
    notifempty
    sharedscripts
    postrotate
        /bin/kill -USR1 $(cat /var/nginx.pid 2&gt;/dev/null) 2&gt;/dev/null || :
    endscript
}
</code></pre></div></div>

<h5 id="存放位置">存放位置</h5>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[reason@online_http:/etc/logrotate.d]$ pwd
/etc/logrotate.d
[reason@online_http:/etc/logrotate.d]$
</code></pre></div></div>

<h5 id="执行方式和时间">执行方式和时间</h5>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># add by reason @ 2015-04-05 20:41
# logrotate nginx log daily
59      23      *       *       *       root /usr/sbin/logrotate /etc/logrotate.conf &gt;/dev/null 2&gt;&amp;1
</code></pre></div></div>

<h5 id="执行效果">执行效果</h5>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># 会按照日期，在每天的23：59分将改天日志转储压缩为*.gz文件
[reason@online_http:/local/nginx_access_log]$ ls -lsh
total 5.1G
427M -rwxrwxrwx 1 nginx nginx 427M Oct 11 12:01 nginx_me_access.log
259M -rwxrwxrwx 1 nginx nginx 259M Oct  1 23:59 nginx_me_access.log-20151001.gz
233M -rwxrwxrwx 1 nginx nginx 233M Oct  2 23:59 nginx_me_access.log-20151002.gz
228M -rwxrwxrwx 1 nginx nginx 228M Oct  3 23:59 nginx_me_access.log-20151003.gz
225M -rwxrwxrwx 1 nginx nginx 225M Oct  4 23:59 nginx_me_access.log-20151004.gz
232M -rwxrwxrwx 1 nginx nginx 232M Oct  5 23:59 nginx_me_access.log-20151005.gz
</code></pre></div></div>

<h5 id="另外一种执行方式">另外一种执行方式</h5>
<p>logrotate 是linux系统的缺省安装命令，初始化状态下即存在缺省的配置信息，其中包括执行文件和时间</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[reason@online_http:/local/nginx_access_log]$ cd /etc/logrotate.d/
[reason@online_http:/etc/logrotate.d]$ ls
nginx.logrotate.d
[reason@online_http:/etc/logrotate.d]$ pwd
/etc/logrotate.d
[reason@online_http:/etc/logrotate.d]$
</code></pre></div></div>

<p>比如在/etc/logrotate.d目录下会缺省放置一批需要转储的日志服务对应的配置文件，比如httpd，exim等，logrotate会按照配置文件信息按照既定时间对其产生的日志数据进行转储操作。</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[reason@online_http:/etc/logrotate.d]$ pwd
/etc/logrotate.d
[reason@online_http:/etc/logrotate.d]$ cat yum
/var/log/yum.log {
    missingok
    notifempty
    size 30k
    yearly
    create 0600 root root
}
[reason@online_http:/etc/logrotate.d]$
</code></pre></div></div>
<p>具体参数涵义可参考<a href="http://linuxcommand.org/man_pages/logrotate8.html">Logrotate man page</a></p>

<p>缺省状态下，logrotate的自动执行分别被放入了如下几个文件中</p>

<ul>
  <li>cron.daily</li>
  <li>cron.weekly</li>
  <li>cron.monthly</li>
</ul>

<p>而对于不同的linux发行版本以上脚本可能被放置在/etc/crontab中
或者</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[root@i-bntub2bp logrotate.d]# cat /etc/anacrontab
# /etc/anacrontab: configuration file for anacron

# See anacron(8) and anacrontab(5) for details.

SHELL=/bin/sh
PATH=/sbin:/bin:/usr/sbin:/usr/bin
MAILTO=root
# the maximal random delay added to the base delay of the jobs
RANDOM_DELAY=45
# the jobs will be started during the following hours only
START_HOURS_RANGE=3-22

#period in days   delay in minutes   job-identifier   command
1       5       cron.daily              nice run-parts /etc/cron.daily
7       25      cron.weekly             nice run-parts /etc/cron.weekly
@monthly 45     cron.monthly            nice run-parts /etc/cron.monthly
[root@i-bntub2bp logrotate.d]#
</code></pre></div></div>
<p>针对</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[root@i-bntub2bp logrotate.d]# cat /etc/redhat-release
CentOS release 6.6 (Final)
[root@i-bntub2bp logrotate.d]#
</code></pre></div></div>
<p>而言，可以直接在/etc/<a href="https://www.centos.org/docs/2/rhl-cg-en-7.2/anacron.html">anacrontab</a>中找到如上信息。</p>

<p>大体解释下anacrontab的部分参数涵义</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>START_HOURS_RANGE=3-22  # 执行时间为3点到22点之间
RANDOM_DELAY=45 # 时间处于可执行区间内随机延迟45分钟之内任意时间
1       5       cron.daily              nice run-parts /etc/cron.daily
# 执行时间为3点到22点之间执行/etc/cron.daily脚本 (after reboot and after the machine has been up for 5 minutes^^), 如果没有重启服务，则会在3：05之后执行。
</code></pre></div></div>

<h4 id="参考文献">参考文献</h4>
<ul>
  <li><a href="http://huoding.com/2013/04/21/246">http://huoding.com/2013/04/21/246</a></li>
  <li><a href="http://serverfault.com/questions/135906/when-does-cron-daily-run">http://serverfault.com/questions/135906/when-does-cron-daily-run</a></li>
  <li><a href="http://www.cyberciti.biz/faq/linux-when-does-cron-daily-weekly-monthly-run/">http://www.cyberciti.biz/faq/linux-when-does-cron-daily-weekly-monthly-run/</a></li>
  <li><a href="http://linuxcommand.org/man_pages/logrotate8.html">http://linuxcommand.org/man_pages/logrotate8.html</a></li>
  <li><a href="https://www.centos.org/docs/2/rhl-cg-en-7.2/anacron.html">https://www.centos.org/docs/2/rhl-cg-en-7.2/anacron.html</a></li>
</ul>

  </div>

</article>

          </div>
        </div>
        
        <div class="pure-u-1-4">
          <div id="sidebar">
            <div class="widget">
              
                <form action="//www.baidu.com/s?gpc=stf" method="get" accept-charset="utf-8" target="_blank" class="search-form">
                  <input type="text" name="q1" maxlength="20" placeholder="Search" class="search-form-input">
                  <input type="hidden" name="q6" value="https://pangz.me">
                </form>
              
              
            </div>
            
            <div class="widget">
                <div class="widget-title">分类</div>
                <ul class="category-list">
                  
                </ul>
            </div>
              
            <div class="widget">
                <div class="widget-title">标签</div>
                <div class="tagcloud">
                  
                    <a href="/tag/nginx" style="font-size: 15px;">nginx</a>
                  
                    <a href="/tag/logrotate" style="font-size: 15px;">logrotate</a>
                  
                    <a href="/tag/Spark" style="font-size: 15px;">Spark</a>
                  
                    <a href="/tag/Docker" style="font-size: 15px;">Docker</a>
                  
                    <a href="/tag/Java" style="font-size: 15px;">Java</a>
                  
                    <a href="/tag/Laravel" style="font-size: 15px;">Laravel</a>
                  
                    <a href="/tag/PHP" style="font-size: 15px;">PHP</a>
                  
                    <a href="/tag/Vagrant" style="font-size: 15px;">Vagrant</a>
                  
                    <a href="/tag/Rails" style="font-size: 15px;">Rails</a>
                  
                    <a href="/tag/Ruby" style="font-size: 15px;">Ruby</a>
                  
                    <a href="/tag/Emacs" style="font-size: 15px;">Emacs</a>
                  
                    <a href="/tag/OKR" style="font-size: 15px;">OKR</a>
                  
                    <a href="/tag/硅谷来信" style="font-size: 15px;">硅谷来信</a>
                  
                    <a href="/tag/读后感" style="font-size: 15px;">读后感</a>
                  
                    <a href="/tag/艺术" style="font-size: 15px;">艺术</a>
                  
                    <a href="/tag/pyqt5" style="font-size: 15px;">pyqt5</a>
                  
                    <a href="/tag/QSS" style="font-size: 15px;">QSS</a>
                  
                    <a href="/tag/谷歌方法论" style="font-size: 15px;">谷歌方法论</a>
                  
                    <a href="/tag/苹果账号" style="font-size: 15px;">苹果账号</a>
                  
                    <a href="/tag/使用总结" style="font-size: 15px;">使用总结</a>
                  
                </div>
            </div>
              
            <div class="widget">
                <div class="widget-title">相关推荐</div>
                <ul class="post-list">
                
                  <li class="post-list-item"><a class="post-list-link" href="/2019/03/24/%E5%85%B3%E4%BA%8E%E8%8B%B9%E6%9E%9C%E5%8F%8C%E9%87%8D%E8%AE%A4%E8%AF%81%E5%BC%80%E5%90%AF%E7%9A%84%E4%B8%80%E4%B8%AA%E9%97%AE%E9%A2%98.html"> 关于苹果账号双重认证开启的一个问题 </a></li>
                
                  <li class="post-list-item"><a class="post-list-link" href="/2019/03/22/%E5%90%B4%E5%86%9B-%E8%B0%B7%E6%AD%8C%E6%96%B9%E6%B3%95%E8%AE%BA-%E8%AF%AD%E6%96%87%E5%AD%A6%E4%B9%A0%E7%9A%84%E6%84%8F%E4%B9%89.html"> 读 吴军《谷歌方法论》- 为什么学习语文 </a></li>
                
                  <li class="post-list-item"><a class="post-list-link" href="/2019/03/16/pyqt5-QSS%E7%9A%84%E4%B8%80%E4%BA%9B%E6%80%BB%E7%BB%93.html"> Pyqt5 QSS </a></li>
                
                  <li class="post-list-item"><a class="post-list-link" href="/2019/03/14/%E5%86%85%E7%94%B0%E5%85%89%E5%AD%90-%E5%85%B3%E4%BA%8E%E4%B8%80%E6%B5%81%E6%B0%B4%E5%87%86%E7%9A%84%E6%80%9D%E8%80%83.html"> 内田光子-关于一流水准的思考 </a></li>
                
                  <li class="post-list-item"><a class="post-list-link" href="/2019/03/11/%E5%90%B4%E5%86%9B-%E7%A1%85%E8%B0%B7%E6%9D%A5%E4%BF%A1-%E7%AC%94%E8%AE%B0-01.html"> 读吴军《硅谷来信》心得笔记 - 第一篇 </a></li>
                
                  <li class="post-list-item"><a class="post-list-link" href="/2019/03/11/2018%E5%B9%B4%E5%A4%A7%E5%85%B4%E5%8C%BA%E5%B9%BC%E5%8D%87%E5%B0%8F%E6%94%BF%E7%AD%96.html"> 2018年大兴区幼升小政策 </a></li>
                
                  <li class="post-list-item"><a class="post-list-link" href="/2019/01/01/2019_Q1_OKR.html"> 2019 Q1 OKR </a></li>
                
                  <li class="post-list-item"><a class="post-list-link" href="/2017/01/21/Emacs-STEP-1.html"> Emacs STEP-1 </a></li>
                
                  <li class="post-list-item"><a class="post-list-link" href="/2016/11/04/Using-Vagrant-for-Rails-Development.html"> 使用Vagrant部署Rails项目 </a></li>
                
                  <li class="post-list-item"><a class="post-list-link" href="/2016/06/29/Laravel%E5%92%8CDropzone-js%E5%AE%9E%E7%8E%B0%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0.html"> Laravel和Dropzone.js实现文件上传 </a></li>
                
                </ul>
            </div>
              
            <div class="widget">
              <div class="widget-title">友情链接</div>
              
                <a href="/"><i class=""> </i></a>
                <ul></ul><a href="http://people.csail.mit.edu/matei/" title="Matei Zaharia" target="_blank">Matei Zaharia</a>
              
                <a href="/"><i class=""> </i></a>
                <ul></ul><a href="https://github.com/tensorflow/tensorflow" title="tensorflow" target="_blank">tensorflow</a>
              
            </div>
          </div>
        </div>
      </div>
      
      <div id="footer">© 2019 
        <a href="/." rel="nofollow">Tensor Cell.</a> Theme by<a rel="nofollow" target="_blank" href="https://github.com/alafighting/maupassant-jekyll"> Maupassant.</a>
        
      </div>
      

      <a id="rocket" href="#top" class="show"></a>
      
      <script src="/js/jquery.min.js" type="text/javascript"></script>
      <script src="/js/totop.js" type="text/javascript"></script>
      <script src="/js/fancybox.pack.js" type="text/javascript"></script>
      <script src="/js/jquery.fancybox.js" type="text/javascript"></script>
      <link rel="stylesheet" href="/css/jquery.fancybox.css" type="text/css">
      
    </div>

    

  </body>

</html>
