<!DOCTYPE html>
<html lang="zh-CN" >
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
  <meta content="yes" name="apple-mobile-web-app-capable">
  <meta content="black-translucent" name="apple-mobile-web-app-status-bar-style">
  <meta content="telephone=no" name="format-detection">
  
  <title>Oryx2 开发者文档</title>
  <meta name="description" content="环境需求  git, 或者一个支持git的IDE  Apache Maven 3.2.1 或者更新版本  Java JDK (不能只有JRE) 7 或者更新版本">
  <link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico">
  <link rel="apple-touch-icon" href="/apple-touch-icon.png">
  <link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png">
  <link rel="alternate" type="application/rss+xml" title="Tensor Cell" href="/feed.xml">
  
  <link rel="stylesheet" type="text/css" href="/css/normalize.css">
  <link rel="stylesheet" type="text/css" href="/css/pure-min.css">
  <link rel="stylesheet" type="text/css" href="/css/grids-responsive-min.css">
  <link rel="stylesheet" type="text/css" href="/css/style.css">
</head>

  <body>
    <div class="body_container">
      <div id="header">
        <div class="site-name">
          <h1 class="hidden">Oryx2 开发者文档</h1>
          <a id="logo" href="/.">Tensor Cell</a>
          <p class="description">还要再走500里</p>
        </div>
        <div id="nav-menu">
          
            <a href="//"><i class="icon-home"> 首页</i></a>
          
            <a href="/archives/"><i class="icon-archive"> 归档</i></a>
          
            <a href="/about/"><i class="icon-about"> 关于</i></a>
          
            <a href="/history/"><i class="icon-history"> 历史</i></a>
          
            <a href="/feed.xml"><i class="icon-rss"> 订阅</i></a>
          
        </div>
      <script type="text/javascript">
      var menus=document.getElementById('nav-menu');
      var ishome = true;
      for (var i=1;i<menus.childElementCount;i++) {
        var path = location.href;
        var current = path.startsWith(menus.children[i].href);
        if (current) {
          menus.children[i].className ='current';
          ishome = false;
          break;
        }
      }
      if (ishome) {
      	menus.children[0].className ='current';
      }
      </script>
      </div>

      <div id="layout" class="pure-g">
        <div class="pure-u-1 pure-u-md-3-4">
          <div class="content_container">
            <article class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title" itemprop="name headline">Oryx2 开发者文档</h1>
    <p class="post-meta"><time datetime="2016-04-06T00:00:00+08:00" itemprop="datePublished">Apr 6, 2016</time></p>
  </header>

  <div class="post-content" itemprop="articleBody">
    <h3 id="环境需求">环境需求</h3>
<ul>
  <li><a href="http://git-scm.com/">git</a>, 或者一个支持git的IDE</li>
  <li><a href="http://maven.apache.org/">Apache Maven</a> 3.2.1 或者更新版本</li>
  <li><a href="http://www.oracle.com/technetwork/java/javase/downloads/index.html">Java JDK</a> (不能只有JRE) 7 或者更新版本</li>
</ul>

<p>以上需要已经安装到了你的开发环境中。</p>

<h2 id="building">Building</h2>

<p>克隆代码到你本地，并且编译：</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git clone https://github.com/OryxProject/oryx.git oryx
cd oryx
mvn -DskipTests package
</code></pre></div></div>

<p>会编译出如下的二进制的jar文件：</p>

<ul>
  <li>批处理层: deploy/oryx-batch/target/oryx-batch-2.1.2.jar</li>
  <li>实时处理层: deploy/oryx-speed/target/oryx-speed-2.1.2.jar</li>
  <li>服务层: deploy/oryx-serving/target/oryx-serving-2.1.2.jar</li>
</ul>

<p>友情提醒，如果你对开发Oryx感兴趣，可以根据这个<a href="https://help.github.com/articles/fork-a-repo">分支</a>克隆自己的分支，然后就可以提交修改了。</p>

<h3 id="java-8">Java 8</h3>

<p>如果使用Java8编译，需要添加参数-Pjava8 并且测试这里的指令。</p>

<h3 id="platform-only">Platform Only</h3>

<p>默认的编译包括基于Spark MLlib和其他库的端到端的ML程序。如果只是编译lambda和ML层，需要通过参数-P!app-tier关闭其他的选项。注意，在bash中，！需要转义： -P!app-tier。</p>

<h3 id="测试">测试</h3>

<p>mvn 测试会执行所有的但愿测试用例。也同时会执行所有的集成测试，这个可能会需要稍微长点的时间。</p>

<h2 id="模型对应表">模型对应表</h2>

<p>主要的模型和他们对应的层：</p>

<table>
  <thead>
    <tr>
      <th> </th>
      <th>Serving</th>
      <th>Speed</th>
      <th>Batch</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Binary</td>
      <td>oryx-serving</td>
      <td>oryx-speed</td>
      <td>oryx-batch</td>
    </tr>
    <tr>
      <td>App</td>
      <td>oryx-app-serving</td>
      <td>oryx-app-mllib oryx-app</td>
      <td>oryx-app-mllib oryx-app</td>
    </tr>
    <tr>
      <td>ML</td>
      <td> </td>
      <td>oryx-ml</td>
      <td>oryx-ml</td>
    </tr>
    <tr>
      <td>Lambda</td>
      <td>oryx-lambda-serving</td>
      <td>oryx-lambda</td>
      <td>oryx-lambda</td>
    </tr>
  </tbody>
</table>

<p>支持的模型，比如：<a href="https://github.com/OryxProject/oryx/tree/master/framework/oryx-common">oryx-common</a>, <a href="https://github.com/OryxProject/oryx/tree/master/app/oryx-app-common">oryx-app-common</a>, <a href="https://github.com/OryxProject/oryx/tree/master/framework/oryx-api">oryx-api</a>, and <a href="https://github.com/OryxProject/oryx/tree/master/app/oryx-app-api">oryx-app-api</a> 没有在这里列出了。</p>

<h2 id="实现一个oryx-程序">实现一个Oryx 程序</h2>

<p>Oryx 中的“app 层”，是实现了推荐的真实的批处理，实时，服务层逻辑，集群和分类。然而，任何实现都需要使用到Oryx。他们也可以混合和匹配。举个例子，你可以重新实现ALS-related推荐的批处理层，但是仍然使用原来的ALS的服务层和实时计算层。</p>

<h3 id="创建一个程序">创建一个程序</h3>

<p>在每个例子中，创建一个自定义的批处理层，实时计算层或者服务层的程序都需要实现com.cloudera.oryx.api中的几个关键的Java接口或者Scala的特性。这些接口/特性可以在项目的oryx-api模型中找到。</p>

<table>
  <thead>
    <tr>
      <th> </th>
      <th>Java</th>
      <th>Scala</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Batch</td>
      <td>batch.BatchLayerUpdate</td>
      <td>batch.ScalaBatchLayerUpdate</td>
    </tr>
    <tr>
      <td>Speed</td>
      <td>speed.SpeedModelManager</td>
      <td>speed.ScalaSpeedModelManager</td>
    </tr>
    <tr>
      <td>Serving</td>
      <td>serving.ServingModelManager</td>
      <td>serving.ScalaServingModelManager</td>
    </tr>
  </tbody>
</table>

<p>com.cloudera.oryx.api也包含大量的关键的类和接口，举个例子，<a href="https://github.com/OryxProject/oryx/blob/master/framework/oryx-api/src/main/java/com/cloudera/oryx/api/serving/OryxResource.java">serving.OryxResource</a>  是一个入口，用来编译自定义的JAX-RS 端点，但是不需要使用。</p>

<h3 id="编译程序">编译程序</h3>

<p>进入你的程序的这些接口/特性，添加一个com.cloudera.oryx:oryx-api的依赖，scope字段需要填写“provided”，在Maven中，需要添加如下依赖：
In Maven, this would mean adding a dependency like:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;dependencies&gt;
  &lt;dependency&gt;
    &lt;groupId&gt;com.cloudera.oryx&lt;/groupId&gt;
    &lt;artifactId&gt;oryx-api&lt;/artifactId&gt;
    &lt;scope&gt;provided&lt;/scope&gt;
    &lt;version&gt;2.1.2&lt;/version&gt;
  &lt;/dependency&gt;
&lt;/dependencies&gt;
</code></pre></div></div>

<p>这些artifacts被放在了<a href="https://repository.cloudera.com/artifactory/cloudera-repos/">Cloudera</a>这个分支下，因此在编译的时候需要引用这个分支：</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;repositories&gt;
  &lt;repository&gt;
    &lt;id&gt;cloudera&lt;/id&gt;
    &lt;url&gt;https://repository.cloudera.com/artifactory/cloudera-repos/&lt;/url&gt;
  &lt;/repository&gt;
&lt;/repositories&gt;
</code></pre></div></div>

<p>一个最小的实例可以访问<a href="https://github.com/OryxProject/oryx/tree/master/app/example">example/</a> 这里。</p>

<p>”Word Count” 这个程序是按照空格将行分割成独立的单词，然后统计出排重后的单词出现的次数。</p>

<p>编译代码后生成一个JAR文件，包含了程序实现和所有第三方的diam，如果使用Maven，可以通过mvn package命令。</p>

<h3 id="编译-word-count-例子">编译 Word Count 例子</h3>

<p>举例：编译样例代码如下：</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cd app/example
mvn package
</code></pre></div></div>

<p>生成的JAR包在target/example-2.1.2.jar。</p>

<h3 id="自定义oryx程序">自定义Oryx程序</h3>

<p>当发布一个源自Oryx的预打包程序，在某些情况下，有可能会提供一个扩展的实现，从而可以自定义他们的行为。举例，ALS推荐程序暴露了com.cloudera.oryx.app.als.RescorerProvider接口。这些特定程序API类可以在模块oryx-app-api中找到。这些接口的实现也可以在独立模式下被编译，打包，部署。</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;dependencies&gt;
  &lt;dependency&gt;
    &lt;groupId&gt;com.cloudera.oryx&lt;/groupId&gt;
    &lt;artifactId&gt;oryx-app-api&lt;/artifactId&gt;
    &lt;scope&gt;provided&lt;/scope&gt;
    &lt;version&gt;2.1.2&lt;/version&gt;
  &lt;/dependency&gt;
&lt;/dependencies&gt;

</code></pre></div></div>

<h2 id="发布程序">发布程序</h2>

<p>拷贝生成的JAR文件–myapp.jar，放到需要执行的Oryx 二进制JAR文件相同的目录下。</p>

<p>修改Oryx的配置文件，以便于引用自定义的批处理，实时计算和服务层的实现。
当执行批处理，实时计算和服务层时，需要添加–app-jar myapp.jar到oryx-run.sh命令行中。</p>

<h3 id="发布-word-count-例子">发布 Word Count 例子</h3>

<p>举例，如果已经编译好了上述的“word count”的程序，你可以执行这个程序，直接引用wordcount-example.conf这个配置文件：</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./oryx-run.sh batch --conf wordcount-example.conf --app-jar example-2.1.2.jar
</code></pre></div></div>

<p>… 对于实时计算和服务层也是同样的。</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl -X POST http://.../add/foo%20bar%20baz
...
curl http://.../distinct
{"foo":2,"bar":2,"baz":2}
</code></pre></div></div>

<p>配置文件本身已经配置好了主机名称和<a href="http://www.cloudera.com/content/www/en-us/downloads/quickstart_vms.html">Cloudera Quickstart VM</a>的参数。事实上，这个例子可以作为一个集群配置的例子：<a href="http://oryx.io/docs/admin.html#cloudera_quickstart_vm_setup">Cloudera Quickstart VM Setup</a>。</p>

  </div>

</article>

          </div>
        </div>
        
        <div class="pure-u-1-4">
          <div id="sidebar">
            <div class="widget">
              
                <form action="//www.baidu.com/s?gpc=stf" method="get" accept-charset="utf-8" target="_blank" class="search-form">
                  <input type="text" name="q1" maxlength="20" placeholder="Search" class="search-form-input">
                  <input type="hidden" name="q6" value="pangz.me">
                </form>
              
              
            </div>
            
            <div class="widget">
                <div class="widget-title">分类</div>
                <ul class="category-list">
                  
                </ul>
            </div>
              
            <div class="widget">
                <div class="widget-title">标签</div>
                <div class="tagcloud">
                  
                    <a href="/tag/Emacs" style="font-size: 15px;">Emacs</a>
                  
                    <a href="/tag/OKR" style="font-size: 15px;">OKR</a>
                  
                </div>
            </div>
              
            <div class="widget">
                <div class="widget-title">相关推荐</div>
                <ul class="post-list">
                
                  <li class="post-list-item"><a class="post-list-link" href="/2019/01/01/2019_Q1_OKR.html"> 2019 Q1 OKR </a></li>
                
                  <li class="post-list-item"><a class="post-list-link" href="/2017/01/21/Emacs-STEP-1.html"> Emacs STEP-1 </a></li>
                
                  <li class="post-list-item"><a class="post-list-link" href="/2016/11/04/Using-Vagrant-for-Rails-Development.html"> 使用Vagrant部署Rails项目 </a></li>
                
                  <li class="post-list-item"><a class="post-list-link" href="/2016/06/29/Laravel%E5%92%8CDropzone-js%E5%AE%9E%E7%8E%B0%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0.html"> Laravel和Dropzone.js实现文件上传 </a></li>
                
                  <li class="post-list-item"><a class="post-list-link" href="/2016/06/13/Laravel-%E7%8E%AF%E5%A2%83%E5%AE%89%E8%A3%85%E5%92%8C%E9%85%8D%E7%BD%AE.html"> Laravel 环境安装和配置 </a></li>
                
                  <li class="post-list-item"><a class="post-list-link" href="/2016/04/08/set-up-oryx-env.html"> 玩转 Oryx2 （一） </a></li>
                
                  <li class="post-list-item"><a class="post-list-link" href="/2016/04/07/Oryx2-performance-doc.html"> Oryx2 性能优化文档 </a></li>
                
                  <li class="post-list-item"><a class="post-list-link" href="/2016/04/06/Oryx2-end-user-doc.html"> Oryx2 终端用户文档 </a></li>
                
                  <li class="post-list-item"><a class="post-list-link" href="/2016/03/08/Java-keyword-volatile.html"> Java关键字volatile </a></li>
                
                  <li class="post-list-item"><a class="post-list-link" href="/2016/01/24/Reg-Nginx.html"> 正则表达式处理Nginx </a></li>
                
                </ul>
            </div>
              
            <div class="widget">
              <div class="widget-title">友情链接</div>
              
                <a href="/"><i class=""> </i></a>
                <ul></ul><a href="http://people.csail.mit.edu/matei/" title="Matei Zaharia" target="_blank">Matei Zaharia</a>
              
                <a href="/"><i class=""> </i></a>
                <ul></ul><a href="https://github.com/tensorflow/tensorflow" title="tensorflow" target="_blank">tensorflow</a>
              
            </div>
          </div>
        </div>
      </div>
      
      <div id="footer">© 2019 
        <a href="/." rel="nofollow">Tensor Cell.</a> Theme by<a rel="nofollow" target="_blank" href="https://github.com/alafighting/maupassant-jekyll"> Maupassant.</a>
        
      </div>
      

      <a id="rocket" href="#top" class="show"></a>
      
      <script src="/js/jquery.min.js" type="text/javascript"></script>
      <script src="/js/totop.js" type="text/javascript"></script>
      <script src="/js/fancybox.pack.js" type="text/javascript"></script>
      <script src="/js/jquery.fancybox.js" type="text/javascript"></script>
      <link rel="stylesheet" href="/css/jquery.fancybox.css" type="text/css">
      
    </div>

    

  </body>

</html>
